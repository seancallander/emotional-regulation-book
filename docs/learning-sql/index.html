<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="style.css" rel="stylesheet" type="text/css" /><title>Learning SQL, 2nd edition</title></head><body><div class="calibre" id="calibre_link-0">
<p class="calibre1"><a id="calibre_link-277"></a><img src="images/000024.jpg" alt="Image 1" class="calibre2" /></p>
<p class="calibre1"><a id="calibre_link-278"></a><b class="calibre3">SECOND EDITION</b></p>
<p class="calibre1"><b class="calibre3">Learning SQL</b></p>
<p class="calibre1"> <i class="calibre4"><b class="calibre3">Alan Beaulieu</b></i></p>
<p class="calibre1">Beijing <b class="calibre3">• </b>Cambridge <b class="calibre3">• </b>Farnham <b class="calibre3">• </b>Köln <b class="calibre3">• </b>Sebastopol <b class="calibre3">• </b>Taipei <b class="calibre3">• </b>Tokyo D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-279"></a><b class="calibre3">Learning SQL, Second Edition</b></p>
<p class="calibre1">by Alan Beaulieu</p>
<p class="calibre1">Copyright © 2009 O’Reilly Media, Inc. All rights reserved. </p>
<p class="calibre1">Printed in the United States of America. </p>
<p class="calibre1">Published by O’Reilly Media, Inc., 1005 Gravenstein Highway North, Sebastopol, CA 95472. </p>
<p class="calibre1">O’Reilly books may be purchased for educational, business, or sales promotional use. Online editions are also available for most titles <a href="http://safari.oreilly.com">( <i class="calibre4">http://safari.oreilly.com</i></a>). For more information, contact our corporate/</p>
<p class="calibre1">institutional sales department: (800) 998-9938 or  <i class="calibre4">corporate@oreilly.com</i>. </p>
<p class="calibre1"><b class="calibre3">Editor: </b>Mary E. Treseler</p>
<p class="calibre1"><b class="calibre3">Indexer: </b>Ellen Troutman Zaig</p>
<p class="calibre1"><b class="calibre3">Production Editor: </b>Loranah Dimant</p>
<p class="calibre1"><b class="calibre3">Cover Designer: </b>Karen Montgomery</p>
<p class="calibre1"><b class="calibre3">Copyeditor: </b>Audrey Doyle</p>
<p class="calibre1"><b class="calibre3">Interior Designer: </b>David Futato</p>
<p class="calibre1"><b class="calibre3">Proofreader: </b>Nancy Reinhardt</p>
<p class="calibre1"><b class="calibre3">Illustrator: </b>Robert Romano</p>
<p class="calibre1"><b class="calibre3">Printing History:</b></p>
<p class="calibre1">August 2005:</p>
<p class="calibre1">First Edition. </p>
<p class="calibre1">April 2009:</p>
<p class="calibre1">Second Edition. </p>
<p class="calibre1">Nutshell Handbook, the Nutshell Handbook logo, and the O’Reilly logo are registered trademarks of O’Reilly Media, Inc.  <i class="calibre4">Learning SQL</i>, the image of an Andean marsupial tree frog, and related trade dress are trademarks of O’Reilly Media, Inc. </p>
<p class="calibre1">Many of the designations used by manufacturers and sellers to distinguish their products are claimed as trademarks. Where those designations appear in this book, and O’Reilly Media, Inc. was aware of a trademark claim, the designations have been printed in caps or initial caps. </p>
<p class="calibre1">While every precaution has been taken in the preparation of this book, the publisher and author assume no responsibility for errors or omissions, or for damages resulting from the use of the information contained herein. </p>
<p class="calibre1"><b class="calibre3">TM</b></p>
<p class="calibre1">This book uses RepKover™, a durable and flexible lay-flat binding. </p>
<p class="calibre1">ISBN: 978-0-596-52083-0</p>
<p class="calibre1">[M]</p>
<p class="calibre1">1239115419</p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-240"></a><b class="calibre3">Table of Contents</b></p>
<p class="calibre1"><a href="#calibre_link-1"><b class="calibre3">Preface  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-1"> ix</a></b></p>
<p class="calibre1"><a href="#calibre_link-2"><b class="calibre3">1. A Little Background  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-2"> 1</a></b></p>
<p class="calibre1"><a href="#calibre_link-2">Introduction to Databases</a></p>
<p class="calibre1"><a href="#calibre_link-2">1</a></p>
<p class="calibre1"><a href="#calibre_link-3">Nonrelational Database Systems</a></p>
<p class="calibre1"><a href="#calibre_link-3">2</a></p>
<p class="calibre1"><a href="#calibre_link-4">The Relational Model</a></p>
<p class="calibre1"><a href="#calibre_link-4">4</a></p>
<p class="calibre1"><a href="#calibre_link-5">Some Terminology</a></p>
<p class="calibre1"><a href="#calibre_link-5">6</a></p>
<p class="calibre1"><a href="#calibre_link-6">What Is SQL? </a></p>
<p class="calibre1"><a href="#calibre_link-6">7</a></p>
<p class="calibre1"><a href="#calibre_link-6">SQL Statement Classes</a></p>
<p class="calibre1"><a href="#calibre_link-6">7</a></p>
<p class="calibre1"><a href="#calibre_link-7">SQL: A Nonprocedural Language</a></p>
<p class="calibre1"><a href="#calibre_link-7">9</a></p>
<p class="calibre1"><a href="#calibre_link-8">SQL Examples</a></p>
<p class="calibre1"><a href="#calibre_link-8">10</a></p>
<p class="calibre1"><a href="#calibre_link-9">What Is MySQL? </a></p>
<p class="calibre1"><a href="#calibre_link-9">12</a></p>
<p class="calibre1"><a href="#calibre_link-10">What’s in Store</a></p>
<p class="calibre1"><a href="#calibre_link-10">13</a></p>
<p class="calibre1"><a href="#calibre_link-11"><b class="calibre3">2. Creating and Populating a Database  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-11"> 15</a></b></p>
<p class="calibre1"><a href="#calibre_link-11">Creating a MySQL Database</a></p>
<p class="calibre1"><a href="#calibre_link-11">15</a></p>
<p class="calibre1"><a href="#calibre_link-12">Using the mysql Command-Line Tool</a></p>
<p class="calibre1"><a href="#calibre_link-12">17</a></p>
<p class="calibre1"><a href="#calibre_link-13">MySQL Data Types</a></p>
<p class="calibre1"><a href="#calibre_link-13">18</a></p>
<p class="calibre1"><a href="#calibre_link-13">Character Data</a></p>
<p class="calibre1"><a href="#calibre_link-13">18</a></p>
<p class="calibre1"><a href="#calibre_link-14">Numeric Data</a></p>
<p class="calibre1"><a href="#calibre_link-14">21</a></p>
<p class="calibre1"><a href="#calibre_link-15">Temporal Data</a></p>
<p class="calibre1"><a href="#calibre_link-15">23</a></p>
<p class="calibre1"><a href="#calibre_link-16">Table Creation</a></p>
<p class="calibre1"><a href="#calibre_link-16">25</a></p>
<p class="calibre1"><a href="#calibre_link-16">Step 1: Design</a></p>
<p class="calibre1"><a href="#calibre_link-16">25</a></p>
<p class="calibre1"><a href="#calibre_link-17">Step 2: Refinement</a></p>
<p class="calibre1"><a href="#calibre_link-17">26</a></p>
<p class="calibre1"><a href="#calibre_link-18">Step 3: Building SQL Schema Statements</a></p>
<p class="calibre1"><a href="#calibre_link-18">27</a></p>
<p class="calibre1"><a href="#calibre_link-19">Populating and Modifying Tables</a></p>
<p class="calibre1"><a href="#calibre_link-19">30</a></p>
<p class="calibre1"><a href="#calibre_link-20">Inserting Data</a></p>
<p class="calibre1"><a href="#calibre_link-20">31</a></p>
<p class="calibre1"><a href="#calibre_link-21">Updating Data</a></p>
<p class="calibre1"><a href="#calibre_link-21">35</a></p>
<p class="calibre1"><a href="#calibre_link-21">Deleting Data</a></p>
<p class="calibre1"><a href="#calibre_link-21">35</a></p>
<p class="calibre1"><a href="#calibre_link-22">When Good Statements Go Bad</a></p>
<p class="calibre1"><a href="#calibre_link-22">36</a></p>
<p class="calibre1"><a href="#calibre_link-22">Nonunique Primary Key</a></p>
<p class="calibre1"><a href="#calibre_link-22">36</a></p>
<p class="calibre1"><a href="#calibre_link-22">Nonexistent Foreign Key</a></p>
<p class="calibre1"><a href="#calibre_link-22">36</a></p>
<p class="calibre1"><b class="calibre3">iii</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-280"></a><a href="#calibre_link-23">Column Value Violations</a></p>
<p class="calibre1"><a href="#calibre_link-23">37</a></p>
<p class="calibre1"><a href="#calibre_link-23">Invalid Date Conversions</a></p>
<p class="calibre1"><a href="#calibre_link-23">37</a></p>
<p class="calibre1"><a href="#calibre_link-24">The Bank Schema</a></p>
<p class="calibre1"><a href="#calibre_link-24">38</a></p>
<p class="calibre1"><a href="#calibre_link-25"><b class="calibre3">3. Query Primer  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-25"> 41</a></b></p>
<p class="calibre1"><a href="#calibre_link-25">Query Mechanics</a></p>
<p class="calibre1"><a href="#calibre_link-25">41</a></p>
<p class="calibre1"><a href="#calibre_link-26">Query Clauses</a></p>
<p class="calibre1"><a href="#calibre_link-26">43</a></p>
<p class="calibre1"><a href="#calibre_link-26">The select Clause</a></p>
<p class="calibre1"><a href="#calibre_link-26">43</a></p>
<p class="calibre1"><a href="#calibre_link-27">Column Aliases</a></p>
<p class="calibre1"><a href="#calibre_link-27">46</a></p>
<p class="calibre1"><a href="#calibre_link-28">Removing Duplicates</a></p>
<p class="calibre1"><a href="#calibre_link-28">47</a></p>
<p class="calibre1"><a href="#calibre_link-29">The from Clause</a></p>
<p class="calibre1"><a href="#calibre_link-29">48</a></p>
<p class="calibre1"><a href="#calibre_link-30">Tables</a></p>
<p class="calibre1"><a href="#calibre_link-30">49</a></p>
<p class="calibre1"><a href="#calibre_link-31">Table Links</a></p>
<p class="calibre1"><a href="#calibre_link-31">51</a></p>
<p class="calibre1"><a href="#calibre_link-32">Defining Table Aliases</a></p>
<p class="calibre1"><a href="#calibre_link-32">52</a></p>
<p class="calibre1"><a href="#calibre_link-32">The where Clause</a></p>
<p class="calibre1"><a href="#calibre_link-32">52</a></p>
<p class="calibre1"><a href="#calibre_link-33">The group by and having Clauses</a></p>
<p class="calibre1"><a href="#calibre_link-33">54</a></p>
<p class="calibre1"><a href="#calibre_link-34">The order by Clause</a></p>
<p class="calibre1"><a href="#calibre_link-34">55</a></p>
<p class="calibre1"><a href="#calibre_link-35">Ascending Versus Descending Sort Order</a></p>
<p class="calibre1"><a href="#calibre_link-35">57</a></p>
<p class="calibre1"><a href="#calibre_link-36">Sorting via Expressions</a></p>
<p class="calibre1"><a href="#calibre_link-36">58</a></p>
<p class="calibre1"><a href="#calibre_link-37">Sorting via Numeric Placeholders</a></p>
<p class="calibre1"><a href="#calibre_link-37">59</a></p>
<p class="calibre1"><a href="#calibre_link-38">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-38">60</a></p>
<p class="calibre1"><a href="#calibre_link-39"><b class="calibre3">4. Filtering  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-39"> 63</a></b></p>
<p class="calibre1"><a href="#calibre_link-39">Condition Evaluation</a></p>
<p class="calibre1"><a href="#calibre_link-39">63</a></p>
<p class="calibre1"><a href="#calibre_link-40">Using Parentheses</a></p>
<p class="calibre1"><a href="#calibre_link-40">64</a></p>
<p class="calibre1"><a href="#calibre_link-41">Using the not Operator</a></p>
<p class="calibre1"><a href="#calibre_link-41">65</a></p>
<p class="calibre1"><a href="#calibre_link-42">Building a Condition</a></p>
<p class="calibre1"><a href="#calibre_link-42">66</a></p>
<p class="calibre1"><a href="#calibre_link-42">Condition Types</a></p>
<p class="calibre1"><a href="#calibre_link-42">66</a></p>
<p class="calibre1"><a href="#calibre_link-42">Equality Conditions</a></p>
<p class="calibre1"><a href="#calibre_link-42">66</a></p>
<p class="calibre1"><a href="#calibre_link-43">Range Conditions</a></p>
<p class="calibre1"><a href="#calibre_link-43">68</a></p>
<p class="calibre1"><a href="#calibre_link-44">Membership Conditions</a></p>
<p class="calibre1"><a href="#calibre_link-44">71</a></p>
<p class="calibre1"><a href="#calibre_link-45">Matching Conditions</a></p>
<p class="calibre1"><a href="#calibre_link-45">73</a></p>
<p class="calibre1"><a href="#calibre_link-46">Null: That Four-Letter Word</a></p>
<p class="calibre1"><a href="#calibre_link-46">76</a></p>
<p class="calibre1"><a href="#calibre_link-47">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-47">79</a></p>
<p class="calibre1"><a href="#calibre_link-48"><b class="calibre3">5. Querying Multiple Tables  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-48"> 81</a></b></p>
<p class="calibre1"><a href="#calibre_link-48">What Is a Join? </a></p>
<p class="calibre1"><a href="#calibre_link-48">81</a></p>
<p class="calibre1"><a href="#calibre_link-49">Cartesian Product</a></p>
<p class="calibre1"><a href="#calibre_link-49">82</a></p>
<p class="calibre1"><a href="#calibre_link-50">Inner Joins</a></p>
<p class="calibre1"><a href="#calibre_link-50">83</a></p>
<p class="calibre1"><a href="#calibre_link-51">The ANSI Join Syntax</a></p>
<p class="calibre1"><a href="#calibre_link-51">86</a></p>
<p class="calibre1"><a href="#calibre_link-52">Joining Three or More Tables</a></p>
<p class="calibre1"><a href="#calibre_link-52">88</a></p>
<p class="calibre1"><a href="#calibre_link-53">Using Subqueries As Tables</a></p>
<p class="calibre1"><a href="#calibre_link-53">90</a></p>
<p class="calibre1"><a href="#calibre_link-54">Using the Same Table Twice</a></p>
<p class="calibre1"><a href="#calibre_link-54">92</a></p>
<p class="calibre1"><b class="calibre3">iv | Table of Contents</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-281"></a><a href="#calibre_link-55">Self-Joins</a></p>
<p class="calibre1"><a href="#calibre_link-55">93</a></p>
<p class="calibre1"><a href="#calibre_link-56">Equi-Joins Versus Non-Equi-Joins</a></p>
<p class="calibre1"><a href="#calibre_link-56">94</a></p>
<p class="calibre1"><a href="#calibre_link-57">Join Conditions Versus Filter Conditions</a></p>
<p class="calibre1"><a href="#calibre_link-57">96</a></p>
<p class="calibre1"><a href="#calibre_link-58">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-58">97</a></p>
<p class="calibre1"><a href="#calibre_link-59"><b class="calibre3">6. Working with Sets  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-59"> 99</a></b></p>
<p class="calibre1"><a href="#calibre_link-59">Set Theory Primer</a></p>
<p class="calibre1"><a href="#calibre_link-59">99</a></p>
<p class="calibre1"><a href="#calibre_link-60">Set Theory in Practice</a></p>
<p class="calibre1"><a href="#calibre_link-60">101</a></p>
<p class="calibre1"><a href="#calibre_link-61">Set Operators</a></p>
<p class="calibre1"><a href="#calibre_link-61">103</a></p>
<p class="calibre1"><a href="#calibre_link-61">The union Operator</a></p>
<p class="calibre1"><a href="#calibre_link-61">103</a></p>
<p class="calibre1"><a href="#calibre_link-62">The intersect Operator</a></p>
<p class="calibre1"><a href="#calibre_link-62">106</a></p>
<p class="calibre1"><a href="#calibre_link-63">The except Operator</a></p>
<p class="calibre1"><a href="#calibre_link-63">107</a></p>
<p class="calibre1"><a href="#calibre_link-64">Set Operation Rules</a></p>
<p class="calibre1"><a href="#calibre_link-64">108</a></p>
<p class="calibre1"><a href="#calibre_link-64">Sorting Compound Query Results</a></p>
<p class="calibre1"><a href="#calibre_link-64">108</a></p>
<p class="calibre1"><a href="#calibre_link-65">Set Operation Precedence</a></p>
<p class="calibre1"><a href="#calibre_link-65">109</a></p>
<p class="calibre1"><a href="#calibre_link-66">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-66">111</a></p>
<p class="calibre1"><a href="#calibre_link-67"><b class="calibre3">7. Data Generation, Conversion, and Manipulation  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-67"> 113</a></b></p>
<p class="calibre1"><a href="#calibre_link-67">Working with String Data</a></p>
<p class="calibre1"><a href="#calibre_link-67">113</a></p>
<p class="calibre1"><a href="#calibre_link-68">String Generation</a></p>
<p class="calibre1"><a href="#calibre_link-68">114</a></p>
<p class="calibre1"><a href="#calibre_link-69">String Manipulation</a></p>
<p class="calibre1"><a href="#calibre_link-69">119</a></p>
<p class="calibre1"><a href="#calibre_link-70">Working with Numeric Data</a></p>
<p class="calibre1"><a href="#calibre_link-70">126</a></p>
<p class="calibre1"><a href="#calibre_link-70">Performing Arithmetic Functions</a></p>
<p class="calibre1"><a href="#calibre_link-70">126</a></p>
<p class="calibre1"><a href="#calibre_link-71">Controlling Number Precision</a></p>
<p class="calibre1"><a href="#calibre_link-71">128</a></p>
<p class="calibre1"><a href="#calibre_link-72">Handling Signed Data</a></p>
<p class="calibre1"><a href="#calibre_link-72">130</a></p>
<p class="calibre1"><a href="#calibre_link-72">Working with Temporal Data</a></p>
<p class="calibre1"><a href="#calibre_link-72">130</a></p>
<p class="calibre1"><a href="#calibre_link-73">Dealing with Time Zones</a></p>
<p class="calibre1"><a href="#calibre_link-73">131</a></p>
<p class="calibre1"><a href="#calibre_link-74">Generating Temporal Data</a></p>
<p class="calibre1"><a href="#calibre_link-74">132</a></p>
<p class="calibre1"><a href="#calibre_link-75">Manipulating Temporal Data</a></p>
<p class="calibre1"><a href="#calibre_link-75">137</a></p>
<p class="calibre1"><a href="#calibre_link-76">Conversion Functions</a></p>
<p class="calibre1"><a href="#calibre_link-76">141</a></p>
<p class="calibre1"><a href="#calibre_link-77">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-77">142</a></p>
<p class="calibre1"><a href="#calibre_link-78"><b class="calibre3">8. Grouping and Aggregates  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-78"> 143</a></b></p>
<p class="calibre1"><a href="#calibre_link-78">Grouping Concepts</a></p>
<p class="calibre1"><a href="#calibre_link-78">143</a></p>
<p class="calibre1"><a href="#calibre_link-79">Aggregate Functions</a></p>
<p class="calibre1"><a href="#calibre_link-79">145</a></p>
<p class="calibre1"><a href="#calibre_link-80">Implicit Versus Explicit Groups</a></p>
<p class="calibre1"><a href="#calibre_link-80">146</a></p>
<p class="calibre1"><a href="#calibre_link-81">Counting Distinct Values</a></p>
<p class="calibre1"><a href="#calibre_link-81">147</a></p>
<p class="calibre1"><a href="#calibre_link-82">Using Expressions</a></p>
<p class="calibre1"><a href="#calibre_link-82">149</a></p>
<p class="calibre1"><a href="#calibre_link-82">How Nulls Are Handled</a></p>
<p class="calibre1"><a href="#calibre_link-82">149</a></p>
<p class="calibre1"><a href="#calibre_link-83">Generating Groups</a></p>
<p class="calibre1"><a href="#calibre_link-83">150</a></p>
<p class="calibre1"><a href="#calibre_link-84">Single-Column Grouping</a></p>
<p class="calibre1"><a href="#calibre_link-84">151</a></p>
<p class="calibre1"><a href="#calibre_link-84">Multicolumn Grouping</a></p>
<p class="calibre1"><a href="#calibre_link-84">151</a></p>
<p class="calibre1"><a href="#calibre_link-85">Grouping via Expressions</a></p>
<p class="calibre1"><a href="#calibre_link-85">152</a></p>
<p class="calibre1"><b class="calibre3">Table of Contents | v</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-282"></a><a href="#calibre_link-85">Generating Rollups</a></p>
<p class="calibre1"><a href="#calibre_link-85">152</a></p>
<p class="calibre1"><a href="#calibre_link-86">Group Filter Conditions</a></p>
<p class="calibre1"><a href="#calibre_link-86">155</a></p>
<p class="calibre1"><a href="#calibre_link-87">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-87">156</a></p>
<p class="calibre1"><a href="#calibre_link-88"><b class="calibre3">9. Subqueries  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-88"> 157</a></b></p>
<p class="calibre1"><a href="#calibre_link-88">What Is a Subquery? </a></p>
<p class="calibre1"><a href="#calibre_link-88">157</a></p>
<p class="calibre1"><a href="#calibre_link-89">Subquery Types</a></p>
<p class="calibre1"><a href="#calibre_link-89">158</a></p>
<p class="calibre1"><a href="#calibre_link-90">Noncorrelated Subqueries</a></p>
<p class="calibre1"><a href="#calibre_link-90">159</a></p>
<p class="calibre1"><a href="#calibre_link-91">Multiple-Row, Single-Column Subqueries</a></p>
<p class="calibre1"><a href="#calibre_link-91">160</a></p>
<p class="calibre1"><a href="#calibre_link-92">Multicolumn Subqueries</a></p>
<p class="calibre1"><a href="#calibre_link-92">165</a></p>
<p class="calibre1"><a href="#calibre_link-93">Correlated Subqueries</a></p>
<p class="calibre1"><a href="#calibre_link-93">167</a></p>
<p class="calibre1"><a href="#calibre_link-94">The exists Operator</a></p>
<p class="calibre1"><a href="#calibre_link-94">169</a></p>
<p class="calibre1"><a href="#calibre_link-95">Data Manipulation Using Correlated Subqueries</a></p>
<p class="calibre1"><a href="#calibre_link-95">170</a></p>
<p class="calibre1"><a href="#calibre_link-96">When to Use Subqueries</a></p>
<p class="calibre1"><a href="#calibre_link-96">171</a></p>
<p class="calibre1"><a href="#calibre_link-97">Subqueries As Data Sources</a></p>
<p class="calibre1"><a href="#calibre_link-97">172</a></p>
<p class="calibre1"><a href="#calibre_link-98">Subqueries in Filter Conditions</a></p>
<p class="calibre1"><a href="#calibre_link-98">177</a></p>
<p class="calibre1"><a href="#calibre_link-98">Subqueries As Expression Generators</a></p>
<p class="calibre1"><a href="#calibre_link-98">177</a></p>
<p class="calibre1"><a href="#calibre_link-99">Subquery Wrap-up</a></p>
<p class="calibre1"><a href="#calibre_link-99">181</a></p>
<p class="calibre1"><a href="#calibre_link-99">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-99">181</a></p>
<p class="calibre1"><a href="#calibre_link-100"><b class="calibre3">10. Joins Revisited  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-100"> 183</a></b></p>
<p class="calibre1"><a href="#calibre_link-100">Outer Joins</a></p>
<p class="calibre1"><a href="#calibre_link-100">183</a></p>
<p class="calibre1"><a href="#calibre_link-101">Left Versus Right Outer Joins</a></p>
<p class="calibre1"><a href="#calibre_link-101">187</a></p>
<p class="calibre1"><a href="#calibre_link-102">Three-Way Outer Joins</a></p>
<p class="calibre1"><a href="#calibre_link-102">188</a></p>
<p class="calibre1"><a href="#calibre_link-103">Self Outer Joins</a></p>
<p class="calibre1"><a href="#calibre_link-103">190</a></p>
<p class="calibre1"><a href="#calibre_link-104">Cross Joins</a></p>
<p class="calibre1"><a href="#calibre_link-104">192</a></p>
<p class="calibre1"><a href="#calibre_link-105">Natural Joins</a></p>
<p class="calibre1"><a href="#calibre_link-105">198</a></p>
<p class="calibre1"><a href="#calibre_link-106">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-106">200</a></p>
<p class="calibre1"><a href="#calibre_link-107"><b class="calibre3">11. Conditional Logic  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-107"> 203</a></b></p>
<p class="calibre1"><a href="#calibre_link-107">What Is Conditional Logic? </a></p>
<p class="calibre1"><a href="#calibre_link-107">203</a></p>
<p class="calibre1"><a href="#calibre_link-108">The Case Expression</a></p>
<p class="calibre1"><a href="#calibre_link-108">204</a></p>
<p class="calibre1"><a href="#calibre_link-109">Searched Case Expressions</a></p>
<p class="calibre1"><a href="#calibre_link-109">205</a></p>
<p class="calibre1"><a href="#calibre_link-110">Simple Case Expressions</a></p>
<p class="calibre1"><a href="#calibre_link-110">206</a></p>
<p class="calibre1"><a href="#calibre_link-111">Case Expression Examples</a></p>
<p class="calibre1"><a href="#calibre_link-111">207</a></p>
<p class="calibre1"><a href="#calibre_link-112">Result Set Transformations</a></p>
<p class="calibre1"><a href="#calibre_link-112">208</a></p>
<p class="calibre1"><a href="#calibre_link-113">Selective Aggregation</a></p>
<p class="calibre1"><a href="#calibre_link-113">209</a></p>
<p class="calibre1"><a href="#calibre_link-114">Checking for Existence</a></p>
<p class="calibre1"><a href="#calibre_link-114">211</a></p>
<p class="calibre1"><a href="#calibre_link-115">Division-by-Zero Errors</a></p>
<p class="calibre1"><a href="#calibre_link-115">212</a></p>
<p class="calibre1"><a href="#calibre_link-116">Conditional Updates</a></p>
<p class="calibre1"><a href="#calibre_link-116">213</a></p>
<p class="calibre1"><a href="#calibre_link-117">Handling Null Values</a></p>
<p class="calibre1"><a href="#calibre_link-117">214</a></p>
<p class="calibre1"><a href="#calibre_link-118">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-118">215</a></p>
<p class="calibre1"><b class="calibre3">vi | Table of Contents</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-283"></a><a href="#calibre_link-119"><b class="calibre3">12. Transactions  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-119"> 217</a></b></p>
<p class="calibre1"><a href="#calibre_link-119">Multiuser Databases</a></p>
<p class="calibre1"><a href="#calibre_link-119">217</a></p>
<p class="calibre1"><a href="#calibre_link-119">Locking</a></p>
<p class="calibre1"><a href="#calibre_link-119">217</a></p>
<p class="calibre1"><a href="#calibre_link-120">Lock Granularities</a></p>
<p class="calibre1"><a href="#calibre_link-120">218</a></p>
<p class="calibre1"><a href="#calibre_link-121">What Is a Transaction? </a></p>
<p class="calibre1"><a href="#calibre_link-121">219</a></p>
<p class="calibre1"><a href="#calibre_link-122">Starting a Transaction</a></p>
<p class="calibre1"><a href="#calibre_link-122">220</a></p>
<p class="calibre1"><a href="#calibre_link-123">Ending a Transaction</a></p>
<p class="calibre1"><a href="#calibre_link-123">221</a></p>
<p class="calibre1"><a href="#calibre_link-124">Transaction Savepoints</a></p>
<p class="calibre1"><a href="#calibre_link-124">223</a></p>
<p class="calibre1"><a href="#calibre_link-125">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-125">225</a></p>
<p class="calibre1"><a href="#calibre_link-126"><b class="calibre3">13. Indexes and Constraints  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-126"> 227</a></b></p>
<p class="calibre1"><a href="#calibre_link-126">Indexes</a></p>
<p class="calibre1"><a href="#calibre_link-126">227</a></p>
<p class="calibre1"><a href="#calibre_link-127">Index Creation</a></p>
<p class="calibre1"><a href="#calibre_link-127">228</a></p>
<p class="calibre1"><a href="#calibre_link-128">Types of Indexes</a></p>
<p class="calibre1"><a href="#calibre_link-128">231</a></p>
<p class="calibre1"><a href="#calibre_link-129">How Indexes Are Used</a></p>
<p class="calibre1"><a href="#calibre_link-129">234</a></p>
<p class="calibre1"><a href="#calibre_link-130">The Downside of Indexes</a></p>
<p class="calibre1"><a href="#calibre_link-130">237</a></p>
<p class="calibre1"><a href="#calibre_link-131">Constraints</a></p>
<p class="calibre1"><a href="#calibre_link-131">238</a></p>
<p class="calibre1"><a href="#calibre_link-131">Constraint Creation</a></p>
<p class="calibre1"><a href="#calibre_link-131">238</a></p>
<p class="calibre1"><a href="#calibre_link-132">Constraints and Indexes</a></p>
<p class="calibre1"><a href="#calibre_link-132">239</a></p>
<p class="calibre1"><a href="#calibre_link-133">Cascading Constraints</a></p>
<p class="calibre1"><a href="#calibre_link-133">240</a></p>
<p class="calibre1"><a href="#calibre_link-134">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-134">242</a></p>
<p class="calibre1"><a href="#calibre_link-135"><b class="calibre3">14. Views  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-135"> 245</a></b></p>
<p class="calibre1"><a href="#calibre_link-135">What Are Views? </a></p>
<p class="calibre1"><a href="#calibre_link-135">245</a></p>
<p class="calibre1"><a href="#calibre_link-136">Why Use Views? </a></p>
<p class="calibre1"><a href="#calibre_link-136">248</a></p>
<p class="calibre1"><a href="#calibre_link-136">Data Security</a></p>
<p class="calibre1"><a href="#calibre_link-136">248</a></p>
<p class="calibre1"><a href="#calibre_link-137">Data Aggregation</a></p>
<p class="calibre1"><a href="#calibre_link-137">249</a></p>
<p class="calibre1"><a href="#calibre_link-138">Hiding Complexity</a></p>
<p class="calibre1"><a href="#calibre_link-138">250</a></p>
<p class="calibre1"><a href="#calibre_link-139">Joining Partitioned Data</a></p>
<p class="calibre1"><a href="#calibre_link-139">251</a></p>
<p class="calibre1"><a href="#calibre_link-139">Updatable Views</a></p>
<p class="calibre1"><a href="#calibre_link-139">251</a></p>
<p class="calibre1"><a href="#calibre_link-140">Updating Simple Views</a></p>
<p class="calibre1"><a href="#calibre_link-140">252</a></p>
<p class="calibre1"><a href="#calibre_link-141">Updating Complex Views</a></p>
<p class="calibre1"><a href="#calibre_link-141">253</a></p>
<p class="calibre1"><a href="#calibre_link-142">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-142">255</a></p>
<p class="calibre1"><a href="#calibre_link-143"><b class="calibre3">15. Metadata  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-143"> 257</a></b></p>
<p class="calibre1"><a href="#calibre_link-143">Data About Data</a></p>
<p class="calibre1"><a href="#calibre_link-143">257</a></p>
<p class="calibre1"><a href="#calibre_link-144">Information_Schema</a></p>
<p class="calibre1"><a href="#calibre_link-144">258</a></p>
<p class="calibre1"><a href="#calibre_link-145">Working with Metadata</a></p>
<p class="calibre1"><a href="#calibre_link-145">262</a></p>
<p class="calibre1"><a href="#calibre_link-146">Schema Generation Scripts</a></p>
<p class="calibre1"><a href="#calibre_link-146">263</a></p>
<p class="calibre1"><a href="#calibre_link-147">Deployment Verification</a></p>
<p class="calibre1"><a href="#calibre_link-147">265</a></p>
<p class="calibre1"><a href="#calibre_link-148">Dynamic SQL Generation</a></p>
<p class="calibre1"><a href="#calibre_link-148">266</a></p>
<p class="calibre1"><a href="#calibre_link-149">Test Your Knowledge</a></p>
<p class="calibre1"><a href="#calibre_link-149">270</a></p>
<p class="calibre1"><b class="calibre3">Table of Contents | vii</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-284"></a><a href="#calibre_link-150"><b class="calibre3">A. ER Diagram for Example Database  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-150"> 271</a></b></p>
<p class="calibre1"><a href="#calibre_link-151"><b class="calibre3">B. MySQL Extensions to the SQL Language  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-151"> 273</a></b></p>
<p class="calibre1"><a href="#calibre_link-152"><b class="calibre3">C. Solutions to Exercises  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-152"> 287</a></b></p>
<p class="calibre1"><a href="#calibre_link-153"><b class="calibre3">Index  </b></a><b class="calibre3">. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . <a href="#calibre_link-153"> 309</a></b></p>
<p class="calibre1"><b class="calibre3">viii | Table of Contents</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-1"></a><b class="calibre3">Preface</b></p>
<p class="calibre1">Programming languages come and go constantly, and very few languages in use today have roots going back more than a decade or so. Some examples are Cobol, which is still used quite heavily in mainframe environments, and C, which is still quite popular for operating system and server development and for embedded systems. In the database arena, we have SQL, whose roots go all the way back to the 1970s. </p>
<p class="calibre1">SQL is the language for generating, manipulating, and retrieving data from a relational database. One of the reasons for the popularity of relational databases is that properly designed relational databases can handle huge amounts of data. When working with large data sets, SQL is akin to one of those snazzy digital cameras with the high-power zoom lens in that you can use SQL to look at large sets of data, or you can zoom in on individual rows (or anywhere in between). Other database management systems tend to break down under heavy loads because their focus is too narrow (the zoom lens is stuck on maximum), which is why attempts to dethrone relational databases and SQL</p>
<p class="calibre1">have largely failed. Therefore, even though SQL is an old language, it is going to be around for a lot longer and has a bright future in store. </p>
<p class="calibre1"><b class="calibre3">Why Learn SQL? </b></p>
<p class="calibre1">If you are going to work with a relational database, whether you are writing applications, performing administrative tasks, or generating reports, you will need to know how to interact with the data in your database. Even if you are using a tool that generates SQL for you, such as a reporting tool, there may be times when you need to bypass the automatic generation feature and write your own SQL statements. </p>
<p class="calibre1">Learning SQL has the added benefit of forcing you to confront and understand the data structures used to store information about your organization. As you become comfortable with the tables in your database, you may find yourself proposing modifications or additions to your database schema. </p>
<p class="calibre1"><b class="calibre3">ix</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-200"></a><b class="calibre3">Why Use This Book to Do It? </b></p>
<p class="calibre1">The SQL language is broken into several categories. Statements used to create database objects (tables, indexes, constraints, etc.) are collectively known as SQL  <i class="calibre4">schema statements</i>. The statements used to create, manipulate, and retrieve the data stored in a database are known as the SQL  <i class="calibre4">data statements</i>. If you are an administrator, you will be using both SQL schema and SQL data statements. If you are a programmer or report writer, you may only need to use (or be  <i class="calibre4">allowed</i> to use) SQL data statements. While this book demonstrates many of the SQL schema statements, the main focus of this book is on programming features. </p>
<p class="calibre1">With only a handful of commands, the SQL data statements look deceptively simple. </p>
<p class="calibre1">In my opinion, many of the available SQL books help to foster this notion by only skimming the surface of what is possible with the language. However, if you are going to work with SQL, it behooves you to understand fully the capabilities of the language and how different features can be combined to produce powerful results. I feel that this is the only book that provides detailed coverage of the SQL language without the added benefit of doubling as a “door stop” (you know, those 1,250-page “complete references” that tend to gather dust on people’s cubicle shelves). </p>
<p class="calibre1">While the examples in this book run on MySQL, Oracle Database, and SQL Server, I had to pick one of those products to host my sample database and to format the result sets returned by the example queries. Of the three, I chose MySQL because it is freely obtainable, easy to install, and simple to administer. For those readers using a different server, I ask that you download and install MySQL and load the sample database so that you can run the examples and experiment with the data. </p>
<p class="calibre1"><b class="calibre3">Structure of This Book</b></p>
<p class="calibre1">This book is divided into 15 chapters and 3 appendixes:</p>
<p class="calibre1"><a href="#calibre_link-2">Chapter 1,  <i class="calibre4">A Little Background</i></a>, explores the history of computerized databases, including the rise of the relational model and the SQL language. </p>
<p class="calibre1"><a href="#calibre_link-11">Chapter  2,  <i class="calibre4">Creating  and  Populating  a  Database</i>, </a>demonstrates  how  to  create  a MySQL database, create the tables used for the examples in this book, and populate the tables with data. </p>
<p class="calibre1"><a href="#calibre_link-25">Chapter  3,  <i class="calibre4">Query  Primer</i></a>,  introduces  the  select statement and further demonstrates the most common clauses (select, from, where). </p>
<p class="calibre1"><a href="#calibre_link-39">Chapter 4,  <i class="calibre4">Filtering</i>, </a>demonstrates the different types of conditions that can be used in the where clause of a select, update, or delete statement. </p>
<p class="calibre1"><a href="#calibre_link-48">Chapter 5,  <i class="calibre4">Querying Multiple Tables</i>, </a>shows how queries can utilize multiple tables via table joins. </p>
<p class="calibre1"><b class="calibre3">x | Preface</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-241"></a><a href="#calibre_link-59">Chapter 6,  <i class="calibre4">Working with Sets</i></a>, is all about data sets and how they can interact within queries. </p>
<p class="calibre1"><a href="#calibre_link-67">Chapter 7,  <i class="calibre4">Data Generation, Conversion, and Manipulation</i>, demonstrates several</a></p>
<p class="calibre1">built-in functions used for manipulating or converting data. </p>
<p class="calibre1"><a href="#calibre_link-78">Chapter 8,  <i class="calibre4">Grouping and Aggregates</i>, shows how data can be aggregated. </a></p>
<p class="calibre1"><a href="#calibre_link-88">Chapter 9,  <i class="calibre4">Subqueries</i></a>, introduces the subquery (a personal favorite) and shows how and where they can be utilized. </p>
<p class="calibre1"><a href="#calibre_link-100">Chapter 10,  <i class="calibre4">Joins Revisited</i>, further explores the various types of table joins. </a></p>
<p class="calibre1"><a href="#calibre_link-107">Chapter 11,  <i class="calibre4">Conditional Logic</i>, </a>explores how conditional logic (i.e., if-then-else) can be utilized in select, insert, update, and delete statements. </p>
<p class="calibre1"><a href="#calibre_link-119">Chapter 12,  <i class="calibre4">Transactions</i></a>, introduces transactions and shows how to use them. </p>
<p class="calibre1"><a href="#calibre_link-126">Chapter 13,  <i class="calibre4">Indexes and Constraints</i></a>, explores indexes and constraints. </p>
<p class="calibre1"><a href="#calibre_link-135">Chapter  14,  <i class="calibre4">Views</i></a>,  shows  how  to  build  an  interface  to  shield  users  from  data complexities. </p>
<p class="calibre1"><a href="#calibre_link-143">Chapter 15,  <i class="calibre4">Metadata</i>, demonstrates the utility of the data dictionary. </a></p>
<p class="calibre1"><a href="#calibre_link-150">Appendix A,  <i class="calibre4">ER Diagram for Example Database</i></a>, shows the database schema used for all examples in the book. </p>
<p class="calibre1"><a href="#calibre_link-151">Appendix B,  <i class="calibre4">MySQL Extensions to the SQL Language</i>, </a>demonstrates some of the interesting non-ANSI features of MySQL’s SQL implementation. </p>
<p class="calibre1"><a href="#calibre_link-152">Appendix C,  <i class="calibre4">Solutions to Exercises</i></a>, shows solutions to the chapter exercises. </p>
<p class="calibre1"><b class="calibre3">Conventions Used in This Book</b></p>
<p class="calibre1">The following typographical conventions are used in this book: <i class="calibre4">Italic</i></p>
<p class="calibre1">Used for filenames, directory names, and URLs. Also used for emphasis and to indicate the first use of a technical term. </p>
<p class="calibre1">Constant width</p>
<p class="calibre1">Used for code examples and to indicate SQL keywords within text. </p>
<p class="calibre1"> <i class="calibre4">Constant width italic</i></p>
<p class="calibre1">Used to indicate user-defined terms. </p>
<p class="calibre1">UPPERCASE</p>
<p class="calibre1">Used to indicate SQL keywords within example code. </p>
<p class="calibre1"><b class="calibre3">Constant width bold</b></p>
<p class="calibre1">Indicates user input in examples showing an interaction. Also indicates empha-sized code elements to which you should pay particular attention. </p>
<p class="calibre1"><b class="calibre3">Preface | xi</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-180"></a><img src="images/000008.png" alt="Image 2" class="calibre2" /></p>
<p class="calibre1"><img src="images/000009.png" alt="Image 3" class="calibre2" /></p>
<p class="calibre1">Indicates a tip, suggestion, or general note. For example, I use notes to point you to useful new features in Oracle9 <i class="calibre4">i</i>. </p>
<p class="calibre1">Indicates a warning or caution. For example, I’ll tell you if a certain SQL</p>
<p class="calibre1">clause might have unintended consequences if not used carefully. </p>
<p class="calibre1"><b class="calibre3">How to Contact Us</b></p>
<p class="calibre1">Please address comments and questions concerning this book to the publisher: O’Reilly Media, Inc. </p>
<p class="calibre1">1005 Gravenstein Highway North</p>
<p class="calibre1">Sebastopol, CA 95472</p>
<p class="calibre1">800-998-9938 (in the United States or Canada)</p>
<p class="calibre1">707-829-0515 (international or local)</p>
<p class="calibre1">707-829-0104 (fax)</p>
<p class="calibre1">O’Reilly maintains a web page for this book, which lists errata, examples, and any additional information. You can access this page at:</p>
<p class="calibre1"><a href="http://www.oreilly.com/catalog/9780596520830"> <i class="calibre4">http://www.oreilly.com/catalog/9780596520830</i></a></p>
<p class="calibre1">To comment or ask technical questions about this book, send email to: <i class="calibre4">bookquestions@oreilly.com</i></p>
<p class="calibre1">For more information about O’Reilly books, conferences, Resource Centers, and the O’Reilly Network, see the website at:</p>
<p class="calibre1"><a href="http://www.oreilly.com"> <i class="calibre4">http://www.oreilly.com</i></a></p>
<p class="calibre1"><b class="calibre3">Using Code Examples</b></p>
<p class="calibre1">This book is here to help you get your job done. In general, you may use the code in this book in your programs and documentation. You do not need to contact us for permission unless you’re reproducing a significant portion of the code. For example, writing a program that uses several chunks of code from this book does not require permission. Selling or distributing a CD-ROM of examples from O’Reilly books does require permission. Answering a question by citing this book and quoting example code does not require permission. Incorporating a significant amount of example code from this book into your product’s documentation does require permission. </p>
<p class="calibre1">We appreciate, but do not require, attribution. An attribution usually includes the title, author, publisher, and ISBN. For example, “<i class="calibre4">Learning SQL</i>, Second Edition, by Alan Beaulieu. Copyright 2009 O’Reilly Media, Inc., 978-0-596-52083-0.” </p>
<p class="calibre1"><b class="calibre3">xii | Preface</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-242"></a>If you feel your use of code examples falls outside fair use or the permission given above, feel free to contact us at  <i class="calibre4">permissions@oreilly.com. </i></p>
<p class="calibre1"><b class="calibre3">Safari® Books Online</b></p>
<p class="calibre1">When you see a Safari® Books Online icon on the cover of your favorite technology  book,  that  means  the  book  is  available  online  through  the O’Reilly Network Safari Bookshelf. </p>
<p class="calibre1">Safari offers a solution that’s better than e-books. It’s a virtual library that lets you easily search thousands of top tech books, cut and paste code samples, download chapters, and find quick answers when you need the most accurate, current information. Try it for free at <a href="http://my.safaribooksonline.com/?portal=oreilly"> <i class="calibre4">http://my.safaribooksonline.com</i></a>. </p>
<p class="calibre1"><b class="calibre3">Acknowledgments</b></p>
<p class="calibre1">I would like to thank my editor, Mary Treseler, for helping to make this second edition a reality, and many thanks to Kevin Kline, Roy Owens, Richard Sonen, and Matthew Russell, who were kind enough to review the book for me over the Christmas/New Year holidays. I would also like to thank the many readers of my first edition who were kind enough to send questions, comments, and corrections. Lastly, I thank my wife, Nancy,  and  my  daughters,  Michelle  and  Nicole,  for  their  encouragement  and inspiration. </p>
<p class="calibre1"><b class="calibre3">Preface | xiii</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-285"></a>D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-2"></a><b class="calibre3">CHAPTER 1</b></p>
<p class="calibre1"><b class="calibre3">A Little Background</b></p>
<p class="calibre1">Before we roll up our sleeves and get to work, it might be beneficial to introduce some basic  database  concepts  and  look  at  the  history  of  computerized  data  storage  and retrieval. </p>
<p class="calibre1"><b class="calibre3">Introduction to Databases</b></p>
<p class="calibre1">A  <i class="calibre4">database</i> is nothing more than a set of related information. A telephone book, for example, is a database of the names, phone numbers, and addresses of all people living in a particular region. While a telephone book is certainly a ubiquitous and frequently used database, it suffers from the following:</p>
<p class="calibre1">• Finding  a  person’s  telephone  number  can  be  time-consuming,  especially  if  the telephone book contains a large number of entries. </p>
<p class="calibre1">• A telephone book is indexed only by last/first names, so finding the names of the people living at a particular address, while possible in theory, is not a practical use for this database. </p>
<p class="calibre1">• From the moment the telephone book is printed, the information becomes less and less accurate as people move into or out of a region, change their telephone numbers, or move to another location within the same region. </p>
<p class="calibre1">The same drawbacks attributed to telephone books can also apply to any manual data storage system, such as patient records stored in a filing cabinet. Because of the cum-bersome nature of paper databases, some of the first computer applications developed were  <i class="calibre4">database systems</i>, which are computerized data storage and retrieval mechanisms. </p>
<p class="calibre1">Because a database system stores data electronically rather than on paper, a database system is able to retrieve data more quickly, index data in multiple ways, and deliver up-to-the-minute information to its user community. </p>
<p class="calibre1">Early database systems managed data stored on magnetic tapes. Because there were generally far more tapes than tape readers, technicians were tasked with loading and unloading tapes as specific data was requested. Because the computers of that era had very little memory, multiple requests for the same data generally required the data to <b class="calibre3">1</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-3"></a><img src="images/000021.png" alt="Image 4" class="calibre2" /></p>
<p class="calibre1">be read from the tape multiple times. While these database systems were a significant improvement over paper databases, they are a far cry from what is possible with today’s technology. (Modern database systems can manage terabytes of data spread across many fast-access disk drives, holding tens of gigabytes of that data in high-speed memory, but I’m getting a bit ahead of myself.)</p>
<p class="calibre1"><b class="calibre3">Nonrelational Database Systems</b></p>
<p class="calibre1">This  section  contains  some  background  information  about  pre-relational database systems. For those readers eager to dive into SQL, feel free to skip ahead a couple of pages to the next section. </p>
<p class="calibre1">Over the first several decades of computerized database systems, data was stored and represented to users in various ways. In a  <i class="calibre4">hierarchical database system</i>, for example, data is represented as one or more tree <a href="#calibre_link-3">structures. Figure 1-1 shows how data relating</a></p>
<p class="calibre1">to  George  Blake’s  and  Sue  Smith’s  bank  accounts  might  be  represented  via  tree structures. </p>
<p class="calibre1">George Blake</p>
<p class="calibre1">Sue Smith</p>
<p class="calibre1"> <i class="calibre4">Customers</i></p>
<p class="calibre1">Checking</p>
<p class="calibre1">Savings</p>
<p class="calibre1">Checking</p>
<p class="calibre1">MoneyMkt</p>
<p class="calibre1">Line of credit</p>
<p class="calibre1"> <i class="calibre4">Accounts</i></p>
<p class="calibre1">Debit of $100.00</p>
<p class="calibre1">Debit of $250.00</p>
<p class="calibre1">Debit of $1000.00</p>
<p class="calibre1">Debit of $500.00</p>
<p class="calibre1">on 2004-01-22</p>
<p class="calibre1">on 2004-03-09</p>
<p class="calibre1">on 2004-03-25</p>
<p class="calibre1">on 2004-03-27</p>
<p class="calibre1">Credit of $25.00</p>
<p class="calibre1">Credit of $138.50</p>
<p class="calibre1">on 2004-02-05</p>
<p class="calibre1">on 2004-04-02</p>
<p class="calibre1">Credit of $77.86</p>
<p class="calibre1">on 2004-04-04</p>
<p class="calibre1"> <i class="calibre4">Transactions</i></p>
<p class="calibre1"> <i class="calibre4">Figure 1-1. Hierarchical view of account data</i></p>
<p class="calibre1">George and Sue each have their own tree containing their accounts and the transactions on those accounts. The hierarchical database system provides tools for locating a particular customer’s tree and then traversing the tree to find the desired accounts and/or <b class="calibre3">2 | Chapter 1:</b> <b class="calibre3">A Little Background</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-154"></a>transactions. Each node in the tree may have either zero or one parent and zero, one, or many children. This configuration is known as a  <i class="calibre4">single-parent hierarchy</i>. </p>
<p class="calibre1">Another common approach, called the  <i class="calibre4">network database system</i>, exposes sets of records and sets of links that define relationships between different records. <a href="#calibre_link-154">Figure 1-2 shows</a></p>
<p class="calibre1">how George’s and Sue’s same accounts might look in such a system. </p>
<p class="calibre1"> <i class="calibre4">Customers</i></p>
<p class="calibre1"> <i class="calibre4">Accounts</i></p>
<p class="calibre1"> <i class="calibre4">Transactions</i></p>
<p class="calibre1"> <i class="calibre4">Products</i></p>
<p class="calibre1">Debit of $100.00</p>
<p class="calibre1">Checking</p>
<p class="calibre1">on 2004-01-22</p>
<p class="calibre1">Checking</p>
<p class="calibre1">George Blake</p>
<p class="calibre1">Credit of $25.00</p>
<p class="calibre1">on 2004-02-05</p>
<p class="calibre1">Savings</p>
<p class="calibre1">Debit of $250.00</p>
<p class="calibre1">on 2004-03-09</p>
<p class="calibre1">Savings</p>
<p class="calibre1">Debit of $1000.00</p>
<p class="calibre1">on 2004-03-25</p>
<p class="calibre1">MoneyMkt</p>
<p class="calibre1">Checking</p>
<p class="calibre1">Credit of $138.50</p>
<p class="calibre1">on 2004-04-02</p>
<p class="calibre1">Sue Smith</p>
<p class="calibre1">MoneyMkt</p>
<p class="calibre1">Credit of $77.86</p>
<p class="calibre1">on 2004-04-04</p>
<p class="calibre1">Line of credit</p>
<p class="calibre1">Line of credit</p>
<p class="calibre1">Debit of $500.00</p>
<p class="calibre1">on 2004-03-27</p>
<p class="calibre1"> <i class="calibre4">Figure 1-2. Network view of account data</i></p>
<p class="calibre1">In order to find the transactions posted to Sue’s money market account, you would need to perform the following steps:</p>
<p class="calibre1">1. Find the customer record for Sue Smith. </p>
<p class="calibre1">2. Follow the link from Sue Smith’s customer record to her list of accounts. </p>
<p class="calibre1">3. Traverse the chain of accounts until you find the money market account. </p>
<p class="calibre1">4. Follow the link from the money market record to its list of transactions. </p>
<p class="calibre1">One  interesting  feature  of  network  database  systems  is  demonstrated  by  the  set  of product records on the far right <a href="#calibre_link-154">of Figure 1-2</a>. Notice that each product record (Checking,  Savings,  etc.)  points  to  a  list  of  account  records  that  are  of  that  product  type. </p>
<p class="calibre1">Account records, therefore, can be accessed from multiple places (both customer records and product records), allowing a network database to act as a  <i class="calibre4">multiparent hierarchy</i>. </p>
<p class="calibre1"><b class="calibre3">Introduction to Databases | 3</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-4"></a>Both hierarchical and network database systems are alive and well today, although generally in the mainframe world. Additionally, hierarchical database systems have enjoyed a rebirth in the directory services realm, such as Microsoft’s Active Directory and the Red Hat Directory Server, as well as with Extensible Markup Language (XML). </p>
<p class="calibre1">Beginning in the 1970s, however, a new way of representing data began to take root, one that was more rigorous yet easy to understand and implement. </p>
<p class="calibre1"><b class="calibre3">The Relational Model</b></p>
<p class="calibre1">In  1970,  Dr.  E.  F.  Codd  of  IBM’s  research  laboratory  published  a  paper  titled  “A Relational Model of Data for Large Shared Data Banks” that proposed that data be represented as sets of  <i class="calibre4">tables</i>. Rather than using pointers to navigate between related entities, redundant data is used to link records in different <a href="#calibre_link-4">tables. Figure 1-3 </a>shows how George’s and Sue’s account information would appear in this context. </p>
<p class="calibre1"> <i class="calibre4">Customer</i></p>
<p class="calibre1"> <i class="calibre4">Account</i></p>
<p class="calibre1"> <i class="calibre4">cust_id</i></p>
<p class="calibre1"> <i class="calibre4">fname</i></p>
<p class="calibre1"> <i class="calibre4">lname</i></p>
<p class="calibre1"> <i class="calibre4">account_id product_cd</i></p>
<p class="calibre1"> <i class="calibre4">cust_id</i></p>
<p class="calibre1"> <i class="calibre4">balance</i></p>
<p class="calibre1">1</p>
<p class="calibre1">George</p>
<p class="calibre1">Blake</p>
<p class="calibre1">103</p>
<p class="calibre1">CHK</p>
<p class="calibre1">1</p>
<p class="calibre1">$75.00</p>
<p class="calibre1">2</p>
<p class="calibre1">Sue</p>
<p class="calibre1">Smith</p>
<p class="calibre1">104</p>
<p class="calibre1">SAV</p>
<p class="calibre1">1</p>
<p class="calibre1">$250.00</p>
<p class="calibre1">105</p>
<p class="calibre1">CHK</p>
<p class="calibre1">2</p>
<p class="calibre1">$783.64</p>
<p class="calibre1">106</p>
<p class="calibre1">MM</p>
<p class="calibre1">2</p>
<p class="calibre1">$500.00</p>
<p class="calibre1">107</p>
<p class="calibre1">LOC</p>
<p class="calibre1">2</p>
<p class="calibre1">0</p>
<p class="calibre1"> <i class="calibre4">Product</i></p>
<p class="calibre1"> <i class="calibre4">Transaction</i></p>
<p class="calibre1"> <i class="calibre4">product_cd</i></p>
<p class="calibre1"> <i class="calibre4">name</i></p>
<p class="calibre1"> <i class="calibre4">txn_id txn_type_cd</i></p>
<p class="calibre1"> <i class="calibre4">account_id</i></p>
<p class="calibre1"> <i class="calibre4">amount</i></p>
<p class="calibre1"> <i class="calibre4">date</i></p>
<p class="calibre1">CHK</p>
<p class="calibre1">Checking</p>
<p class="calibre1">978</p>
<p class="calibre1">DBT</p>
<p class="calibre1">103</p>
<p class="calibre1">$100.00</p>
<p class="calibre1">2004-01-22</p>
<p class="calibre1">SAV</p>
<p class="calibre1">Savings</p>
<p class="calibre1">979</p>
<p class="calibre1">CDT</p>
<p class="calibre1">103</p>
<p class="calibre1">$25.00</p>
<p class="calibre1">2004-02-05</p>
<p class="calibre1">MM</p>
<p class="calibre1">Money market</p>
<p class="calibre1">980</p>
<p class="calibre1">DBT</p>
<p class="calibre1">104</p>
<p class="calibre1">$250.00</p>
<p class="calibre1">2004-03-09</p>
<p class="calibre1">LOC</p>
<p class="calibre1">Line of credit</p>
<p class="calibre1">981</p>
<p class="calibre1">DBT</p>
<p class="calibre1">105</p>
<p class="calibre1">$1000.00 2004-03-25</p>
<p class="calibre1">982</p>
<p class="calibre1">CDT</p>
<p class="calibre1">105</p>
<p class="calibre1">$138.50</p>
<p class="calibre1">2004-04-02</p>
<p class="calibre1">983</p>
<p class="calibre1">CDT</p>
<p class="calibre1">105</p>
<p class="calibre1">$77.86</p>
<p class="calibre1">2004-04-04</p>
<p class="calibre1">984</p>
<p class="calibre1">DBT</p>
<p class="calibre1">106</p>
<p class="calibre1">$500.00</p>
<p class="calibre1">2004-03-27</p>
<p class="calibre1"> <i class="calibre4">Figure 1-3. Relational view of account data</i></p>
<p class="calibre1">There  are  four  tables  in  <a href="#calibre_link-4">Figure  1-3  </a>representing  the  four  entities  discussed  so  far: customer, product, account, and transaction. Looking across the top of the customer <b class="calibre3">4 | Chapter 1:</b> <b class="calibre3">A Little Background</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-181"></a><img src="images/000025.png" alt="Image 5" class="calibre2" /></p>
<p class="calibre1"><img src="images/000026.png" alt="Image 6" class="calibre2" /></p>
<p class="calibre1">table <a href="#calibre_link-4">in Figure 1-3</a>, you can see three  <i class="calibre4">columns</i>: cust_id (which contains the customer’s ID number), fname (which contains the customer’s first name), and lname (which contains the customer’s last name). Looking down the side of the customer table, you can see two  <i class="calibre4">rows</i>, one containing George Blake’s data and the other containing Sue Smith’s data. The number of columns that a table may contain differs from server to server, but it is generally large enough not to be an issue (Microsoft SQL Server, for example, allows up to 1,024 columns per table). The number of rows that a table may contain is more a matter of physical limits (i.e., how much disk drive space is available) and maintain-ability (i.e., how large a table can get before it becomes difficult to work with) than of database server limitations. </p>
<p class="calibre1">Each table in a relational database includes information that uniquely identifies a row in that table (known as the  <i class="calibre4">primary key</i>), along with additional information needed to describe the entity completely. Looking again at the customer table, the cust_id column holds a different number for each customer; George Blake, for example, can be uniquely identified by customer ID #1. No other customer will ever be assigned that identifier, and no other information is needed to locate George Blake’s data in the customer table. </p>
<p class="calibre1">Every database server provides a mechanism for generating unique sets of numbers to use as primary key values, so you won’t need to worry about keeping track of what numbers have been assigned. </p>
<p class="calibre1">While I might have chosen to use the combination of the fname and lname columns as the  primary  key  (a  primary  key  consisting  of  two  or  more  columns  is  known  as  a <i class="calibre4">compound key</i>), there could easily be two or more people with the same first and last names that have accounts at the bank. Therefore, I chose to include the cust_id column in the customer table specifically for use as a primary key column. </p>
<p class="calibre1">In  this  example,  choosing  fname/lname  as  the  primary  key  would  be referred to as a  <i class="calibre4">natural key</i>, whereas the choice of cust_id would be referred to as a  <i class="calibre4">surrogate key</i>. The decision whether to employ natural or surrogate keys is a topic of widespread debate, but in this particular case the choice is clear, since a person’s last name may change (such as when a person adopts a spouse’s last name), and primary key columns should never be allowed to change once a value has been assigned. </p>
<p class="calibre1">Some of the tables also include information used to navigate to another table; this is where the “redundant data” mentioned earlier comes in. For example, the account table includes a column called cust_id, which contains the unique identifier of the customer who opened the account, along with a column called product_cd, which contains the unique identifier of the product to which the account will conform. These columns are known as  <i class="calibre4">foreign keys</i>, and they serve the same purpose as the lines that connect the entities in the hierarchical and network versions of the account information. If you are <b class="calibre3">Introduction to Databases | 5</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-5"></a>looking at a particular account record and want to know more information about the customer who opened the account, you would take the value of the cust_id column and use it to find the appropriate row in the customer table (this process is known, in relational database lingo, as a  <i class="calibre4">join</i>; joins are introduced <a href="#calibre_link-25">in Chapter 3 </a>and probed deeply</p>
<p class="calibre1"><a href="#calibre_link-48">in Chapters 5 and 10). </a></p>
<p class="calibre1">It might seem wasteful to store the same data many times, but the relational model is quite clear on what redundant data may be stored. For example, it is proper for the account table to include a column for the unique identifier of the customer who opened the account, but it is not proper to include the customer’s first and last names in the account table as well. If a customer were to change her name, for example, you want to make sure that there is only one place in the database that holds the customer’s name; otherwise, the data might be changed in one place but not another, causing the data in the database to be unreliable. The proper place for this data is the customer table, and only the cust_id values should be included in other tables. It is also not proper for a single column to contain multiple pieces of information, such as a name column that contains both a person’s first and last names, or an address column that contains street, city, state, and zip code information. The process of refining a database design to ensure that each independent piece of information is in only one place (except for foreign keys) is known as  <i class="calibre4">normalization</i>. </p>
<p class="calibre1">Getting back to the four tables <a href="#calibre_link-4">in Figure 1-3, </a>you may wonder how you would use these tables  to  find  George  Blake’s  transactions  against  his  checking  account.  First,  you would find George Blake’s unique identifier in the customer table. Then, you would find  the  row  in  the  account  table  whose  cust_id  column  contains  George’s  unique identifier and whose product_cd column matches the row in the product table whose name  column  equals  “Checking.”  Finally,  you  would  locate  the  rows  in  the transaction table whose account_id column matches the unique identifier from the account table. This might sound complicated, but you can do it in a single command, using the SQL language, as you will see shortly. </p>
<p class="calibre1"><b class="calibre3">Some Terminology</b></p>
<p class="calibre1">I introduced some new terminology in the previous sections, so maybe it’s time for some formal definitions. <a href="#calibre_link-5">Table 1-1 </a>shows the terms we use for the remainder of the book along with their definitions. </p>
<p class="calibre1"> <i class="calibre4">Table 1-1. Terms and definitions</i></p>
<p class="calibre1"><b class="calibre3">Term</b></p>
<p class="calibre1"><b class="calibre3">Definition</b></p>
<p class="calibre1">Entity</p>
<p class="calibre1">Something of interest to the database user community. Examples include customers, parts, geographic locations, etc. </p>
<p class="calibre1">Column</p>
<p class="calibre1">An individual piece of data stored in a table. </p>
<p class="calibre1">Row</p>
<p class="calibre1">A set of columns that together completely describe an entity or some action on an entity. Also called a record. </p>
<p class="calibre1">Table</p>
<p class="calibre1">A set of rows, held either in memory (nonpersistent) or on permanent storage (persistent). </p>
<p class="calibre1"><b class="calibre3">6 | Chapter 1:</b> <b class="calibre3">A Little Background</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-6"></a><b class="calibre3">Term</b></p>
<p class="calibre1"><b class="calibre3">Definition</b></p>
<p class="calibre1">Result set</p>
<p class="calibre1">Another name for a nonpersistent table, generally the result of an SQL query. </p>
<p class="calibre1">Primary key</p>
<p class="calibre1">One or more columns that can be used as a unique identifier for each row in a table. </p>
<p class="calibre1">Foreign key</p>
<p class="calibre1">One or more columns that can be used together to identify a single row in another table. </p>
<p class="calibre1"><b class="calibre3">What Is SQL? </b></p>
<p class="calibre1">Along with Codd’s definition of the relational model, he proposed a language called DSL/Alpha for manipulating the data in relational tables. Shortly after Codd’s paper was released, IBM commissioned a group to build a prototype based on Codd’s ideas. </p>
<p class="calibre1">This group created a simplified version of DSL/Alpha that they called SQUARE. Refinements to SQUARE led to a language called SEQUEL, which was, finally, renamed SQL. </p>
<p class="calibre1">SQL is now entering middle age (as is this author, alas), and it has undergone a great deal  of  change  along  the  way.  In  the  mid-1980s,  the  American  National  Standards Institute (ANSI) began working on the first standard for the SQL language, which was published in 1986. Subsequent refinements led to new releases of the SQL standard in 1989, 1992, 1999, 2003, and 2006. Along with refinements to the core language, new features have been added to the SQL language to incorporate object-oriented functionality, among other things. The latest standard, SQL:2006, focuses on the integration of SQL and XML and defines a language called XQuery which is used to query data in XML documents. </p>
<p class="calibre1">SQL goes hand in hand with the relational model because the result of an SQL query is a table (also called, in this context, a  <i class="calibre4">result set</i>). Thus, a new permanent table can be created in a relational database simply by storing the result set of a query. Similarly, a query can use both permanent tables and the result sets from other queries as inputs</p>
<p class="calibre1"><a href="#calibre_link-88">(we explore this in detail in Chapter 9). </a></p>
<p class="calibre1">One final note: SQL is not an acronym for anything (although many people will insist it stands for “Structured Query Language”). When referring to the language, it is equally acceptable to say the letters individually (i.e., S. Q. L.) or to use the word  <i class="calibre4">sequel</i>. </p>
<p class="calibre1"><b class="calibre3">SQL Statement Classes</b></p>
<p class="calibre1">The SQL language is divided into several distinct parts: the parts that we explore in this book  include   <i class="calibre4">SQL  schema  statements</i>,  which  are  used  to  define  the  data  structures stored in the database;  <i class="calibre4">SQL data statements</i>, which are used to manipulate the data structures previously defined using SQL schema statements; and  <i class="calibre4">SQL transaction statements</i>,  which  are  used  to  begin,  end,  and  roll  back  transactions  (covered  in  <a href="#calibre_link-119">Chap-</a></p>
<p class="calibre1"><a href="#calibre_link-119">ter 12). </a>For example, to create a new table in your database, you would use the SQL</p>
<p class="calibre1">schema statement create table, whereas the process of populating your new table with data would require the SQL data statement insert. </p>
<p class="calibre1"><b class="calibre3">What Is SQL? | 7</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-199"></a>To give you a taste of what these statements look like, here’s an SQL schema statement that creates a table called corporation:</p>
<p class="calibre1">CREATE TABLE corporation</p>
<p class="calibre1">(corp_id SMALLINT, </p>
<p class="calibre1">name VARCHAR(30), </p>
<p class="calibre1">CONSTRAINT pk_corporation PRIMARY KEY (corp_id)</p>
<p class="calibre1">); </p>
<p class="calibre1">This statement creates a table with two columns, corp_id and name, with the corp_id column identified as the primary key for the table. We probe the finer details of this statement, such as the different data types available with MySQL, <a href="#calibre_link-11">in Chapter 2</a>. Next, here’s an SQL data statement that inserts a row into the corporation table for Acme Paper Corporation:</p>
<p class="calibre1">INSERT INTO corporation (corp_id, name)</p>
<p class="calibre1">VALUES (27, 'Acme Paper Corporation'); </p>
<p class="calibre1">This statement adds a row to the corporation table with a value of 27 for the corp_id column and a value of Acme Paper Corporation for the name column. </p>
<p class="calibre1">Finally, here’s a simple select statement to retrieve the data that was just created: mysql&lt; <b class="calibre3">SELECT name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM corporation</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE corp_id = 27; </b></p>
<p class="calibre1">+------------------------+</p>
<p class="calibre1">| name                   |</p>
<p class="calibre1">+------------------------+</p>
<p class="calibre1">| Acme Paper Corporation |</p>
<p class="calibre1">+------------------------+</p>
<p class="calibre1">All database elements created via SQL schema statements are stored in a special set of tables called the  <i class="calibre4">data dictionary</i>. This “data about the database” is known collectively as  <i class="calibre4">metadata</i> and is explored <a href="#calibre_link-143">in Chapter 15. </a>Just like tables that you create yourself, data dictionary tables can be queried via a select statement, thereby allowing you to discover the current data structures deployed in the database at runtime. For example, if you are asked to write a report showing the new accounts created last month, you could either hardcode the names of the columns in the account table that were known to you when you wrote the report, or query the data dictionary to determine the current set of columns and dynamically generate the report each time it is executed. </p>
<p class="calibre1">Most  of  this  book  is  concerned  with  the  data  portion  of  the  SQL  language,  which consists of the select, update, insert, and delete commands. SQL schema statements is demonstrated <a href="#calibre_link-11">in Chapter 2</a>, where the sample database used throughout this book is generated. In general, SQL schema statements do not require much discussion apart from their syntax, whereas SQL data statements, while few in number, offer numerous opportunities for detailed study. Therefore, while I try to introduce you to many of the SQL  schema  statements,  most  chapters  in  this  book  concentrate  on  the  SQL  data statements. </p>
<p class="calibre1"><b class="calibre3">8 | Chapter 1:</b> <b class="calibre3">A Little Background</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-7"></a><img src="images/000033.png" alt="Image 7" class="calibre2" /></p>
<p class="calibre1"><b class="calibre3">SQL: A Nonprocedural Language</b></p>
<p class="calibre1">If you have worked with programming languages in the past, you are used to defining variables and data structures, using conditional logic (i.e., if-then-else) and looping constructs (i.e., do while ... end), and breaking your code into small, reusable pieces (i.e., objects, functions, procedures). Your code is handed to a compiler, and the exe-cutable that results does exactly (well, not always  <i class="calibre4">exactly</i>) what you programmed it to do. Whether you work with Java, C#, C, Visual Basic, or some other  <i class="calibre4">procedural</i> language, you are in complete control of what the program does. </p>
<p class="calibre1">A procedural language defines both the desired results and the mechanism, or process, by which the results are generated. Nonprocedural languages also define the desired results, but the process by which the results are generated is left to an external agent. </p>
<p class="calibre1">With SQL, however, you will need to give up some of the control you are used to, because SQL statements define the necessary inputs and outputs, but the manner in which a statement is executed is left to a component of your database engine known as the  <i class="calibre4">optimizer</i>. The optimizer’s job is to look at your SQL statements and, taking into account how your tables are configured and what indexes are available, decide the most efficient execution path (well, not always the  <i class="calibre4">most</i> efficient). Most database engines will allow you to influence the optimizer’s decisions by specifying  <i class="calibre4">optimizer hints</i>, such as suggesting that a particular index be used; most SQL users, however, will never get to this level of sophistication and will leave such tweaking to their database administrator or performance expert. </p>
<p class="calibre1">With SQL, therefore, you will not be able to write complete applications. Unless you are writing a simple script to manipulate certain data, you will need to integrate SQL</p>
<p class="calibre1">with your favorite programming language. Some database vendors have done this for you,  such  as  Oracle’s  PL/SQL  language,  MySQL’s  stored  procedure  language,  and Microsoft’s Transact-SQL language. With these languages, the SQL data statements are  part  of  the  language’s  grammar,  allowing  you  to  seamlessly  integrate  database queries with procedural commands. If you are using a non-database-specific language such as Java, however, you will need to use a toolkit/API to execute SQL statements from your code. Some of these toolkits are provided by your database vendor, whereas others are created by third-party vendors or by open source <a href="#calibre_link-8">providers. Table 1-2</a> shows some of the available options for integrating SQL into a specific language. </p>
<p class="calibre1"><b class="calibre3">What Is SQL? | 9</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-8"></a> <i class="calibre4">Table 1-2. SQL integration toolkits</i></p>
<p class="calibre1"><b class="calibre3">Language</b></p>
<p class="calibre1"><b class="calibre3">Toolkit</b></p>
<p class="calibre1">Java</p>
<p class="calibre1">JDBC (Java Database Connectivity; JavaSoft)</p>
<p class="calibre1">C++</p>
<p class="calibre1">Rogue Wave SourcePro DB (third-party tool to connect to Oracle, SQL Server, MySQL, Informix, DB2, Sybase, and PostgreSQL databases)</p>
<p class="calibre1">C/C++</p>
<p class="calibre1">Pro*C (Oracle), MySQL C API (open source), and DB2 Call Level Interface (IBM) C#</p>
<p class="calibre1">ADO.NET (Microsoft)</p>
<p class="calibre1">Perl</p>
<p class="calibre1">Perl DBI</p>
<p class="calibre1">Python</p>
<p class="calibre1">Python DB</p>
<p class="calibre1">Visual Basic</p>
<p class="calibre1">ADO.NET (Microsoft)</p>
<p class="calibre1">If you only need to execute SQL commands interactively, every database vendor provides at least a simple command-line tool for submitting SQL commands to the database engine and inspecting the results. Most vendors provide a graphical tool as well that includes one window showing your SQL commands and another window showing the results from your SQL commands. Since the examples in this book are executed against a MySQL database, I use the mysql command-line tool that is included as part of the MySQL installation to run the examples and format the results. </p>
<p class="calibre1"><b class="calibre3">SQL Examples</b></p>
<p class="calibre1">Earlier in this chapter, I promised to show you an SQL statement that would return all the transactions against George Blake’s checking account. Without further ado, here it is:</p>
<p class="calibre1">SELECT t.txn_id, t.txn_type_cd, t.txn_date, t.amount</p>
<p class="calibre1">FROM individual i</p>
<p class="calibre1">INNER JOIN account a ON i.cust_id = a.cust_id</p>
<p class="calibre1">INNER JOIN product p ON p.product_cd = a.product_cd</p>
<p class="calibre1">INNER JOIN transaction t ON t.account_id = a.account_id</p>
<p class="calibre1">WHERE i.fname = 'George' AND i.lname = 'Blake' </p>
<p class="calibre1">AND p.name = 'checking account'; </p>
<p class="calibre1">+--------+-------------+---------------------+--------+</p>
<p class="calibre1">| txn_id | txn_type_cd | txn_date            | amount |</p>
<p class="calibre1">+--------+-------------+---------------------+--------+</p>
<p class="calibre1">|     11 | DBT         | 2008-01-05 00:00:00 | 100.00 |</p>
<p class="calibre1">+--------+-------------+---------------------+--------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Without going into too much detail at this point, this query identifies the row in the individual table for George Blake and the row in the product table for the “checking” </p>
<p class="calibre1">product, finds the row in the account table for this individual/product combination, and returns four columns from the transaction table for all transactions posted to this account. If you happen to know that George Blake’s customer ID is 8 and that checking accounts are designated by the code 'CHK', then you can simply find George Blake’s <b class="calibre3">10 | Chapter 1:</b> <b class="calibre3">A Little Background</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-179"></a><img src="images/000038.png" alt="Image 8" class="calibre2" /></p>
<p class="calibre1">checking account in the account table based on the customer ID and use the account ID to find the appropriate transactions:</p>
<p class="calibre1">SELECT t.txn_id, t.txn_type_cd, t.txn_date, t.amount</p>
<p class="calibre1">FROM account a</p>
<p class="calibre1">INNER JOIN transaction t ON t.account_id = a.account_id</p>
<p class="calibre1">WHERE a.cust_id = 8 AND a.product_cd = 'CHK'; </p>
<p class="calibre1">I cover all of the concepts in these queries (plus a lot more) in the following chapters, but I wanted to at least show what they would look like. </p>
<p class="calibre1">The previous queries contain three different  <i class="calibre4">clauses</i>: select, from, and where. Almost every query that you encounter will include at least these three clauses, although there are several more that can be used for more specialized purposes. The role of each of these three clauses is demonstrated by the following:</p>
<p class="calibre1">SELECT /* one or more things */ ... </p>
<p class="calibre1">FROM /* one or more places */ ... </p>
<p class="calibre1">WHERE /* one or more conditions apply */ ... </p>
<p class="calibre1">Most SQL implementations treat any text between the /* and */ tags as comments. </p>
<p class="calibre1">When constructing your query, your first task is generally to determine which table or tables will be needed and then add them to your from clause. Next, you will need to add conditions to your where clause to filter out the data from these tables that you aren’t interested in. Finally, you will decide which columns from the different tables need to be retrieved and add them to your select clause. Here’s a simple example that shows how you would find all customers with the last name “Smith”: SELECT cust_id, fname</p>
<p class="calibre1">FROM individual</p>
<p class="calibre1">WHERE lname = 'Smith'; </p>
<p class="calibre1">This query searches the individual table for all rows whose lname column matches the string 'Smith' and returns the cust_id and fname columns from those rows. </p>
<p class="calibre1">Along with querying your database, you will most likely be involved with populating and modifying the data in your database. Here’s a simple example of how you would insert a new row into the product table:</p>
<p class="calibre1">INSERT INTO product (product_cd, name)</p>
<p class="calibre1">VALUES ('CD', 'Certificate of Depysit')</p>
<p class="calibre1">Whoops, looks like you misspelled “Deposit.” No problem. You can clean that up with an update statement:</p>
<p class="calibre1">UPDATE product</p>
<p class="calibre1">SET name = 'Certificate of Deposit' </p>
<p class="calibre1">WHERE product_cd = 'CD'; </p>
<p class="calibre1"><b class="calibre3">What Is SQL? | 11</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-9"></a>Notice that the update statement also contains a where clause, just like the select statement. This is because an update statement must identify the rows to be modified; in this case, you are specifying that only those rows whose product_cd column matches the string 'CD' should be modified. Since the product_cd column is the primary key for the product table, you should expect your update statement to modify exactly one row (or zero, if the value doesn’t exist in the table). Whenever you execute an SQL data statement, you will receive feedback from the database engine as to how many rows were affected by your statement. If you are using an interactive tool such as the mysql command-line tool mentioned earlier, then you will receive feedback concerning how many rows were either:</p>
<p class="calibre1">• Returned by your select statement</p>
<p class="calibre1">• Created by your insert statement</p>
<p class="calibre1">• Modified by your update statement</p>
<p class="calibre1">• Removed by your delete statement</p>
<p class="calibre1">If you are using a procedural language with one of the toolkits mentioned earlier, the toolkit will include a call to ask for this information after your SQL data statement has executed. In general, it’s a good idea to check this info to make sure your statement didn’t do something unexpected (like when you forget to put a where clause on your delete statement and delete every row in the table!). </p>
<p class="calibre1"><b class="calibre3">What Is MySQL? </b></p>
<p class="calibre1">Relational databases have been available commercially for over two decades. Some of the most mature and popular commercial products include:</p>
<p class="calibre1">• Oracle Database from Oracle Corporation</p>
<p class="calibre1">• SQL Server from Microsoft</p>
<p class="calibre1">• DB2 Universal Database from IBM</p>
<p class="calibre1">• Sybase Adaptive Server from Sybase</p>
<p class="calibre1">All these database servers do approximately the same thing, although some are better equipped to run very large or very-high-throughput databases. Others are better at handling objects or very large files or XML documents, and so on. Additionally, all these servers do a pretty good job of complying with the latest ANSI SQL standard. </p>
<p class="calibre1">This is a good thing, and I make it a point to show you how to write SQL statements that will run on any of these platforms with little or no modification. </p>
<p class="calibre1">Along with the commercial database servers, there has been quite a bit of activity in the open source community in the past five years with the goal of creating a viable alter-native  to  the  commercial  database  servers.  Two  of  the  most  commonly  used  open source database servers are PostgreSQL and MySQL. The MySQL website <a href="http://www.mysql.com">( <i class="calibre4">http://www</i></a></p>
<p class="calibre1"><a href="http://www.mysql.com"> <i class="calibre4">.mysql.com</i></a>) currently claims over 10 million installations, its server is available for free, <b class="calibre3">12 | Chapter 1:</b> <b class="calibre3">A Little Background</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-10"></a>and I have found its server to be extremely simple to download and install. For these reasons, I have decided that all examples for this book be run against a MySQL (version 6.0) database, and that the mysql command-line tool be used to format query results. </p>
<p class="calibre1">Even if you are already using another server and never plan to use MySQL, I urge you to install the latest MySQL server, load the sample schema and data, and experiment with the data and examples in this book. </p>
<p class="calibre1">However, keep in mind the following caveat:</p>
<p class="calibre1"> <i class="calibre4">This is not a book about MySQL’s SQL implementation</i>. </p>
<p class="calibre1">Rather, this book is designed to teach you how to craft SQL statements that will run on MySQL with no modifications, and will run on recent releases of Oracle Database, Sybase Adaptive Server, and SQL Server with few or no modifications. </p>
<p class="calibre1">To keep the code in this book as vendor-independent as possible, I will refrain from demonstrating some of the interesting things that the MySQL SQL language imple-menters have decided to do that can’t be done on other database implementations. </p>
<p class="calibre1">Instead, <a href="#calibre_link-151">Appendix B </a>covers some of these features for readers who are planning to continue using MySQL. </p>
<p class="calibre1"><b class="calibre3">What’s in Store</b></p>
<p class="calibre1">The overall goal of the next four chapters is to introduce the SQL data statements, with a special emphasis on the three main clauses of the select statement. Additionally, you will see many examples that use the bank schema (introduced in the next chapter), which will be used for all examples in the book. It is my hope that familiarity with a single database will allow you to get to the crux of an example without your having to stop and examine the tables being used each time. If it becomes a bit tedious working with the same set of tables, feel free to augment the sample database with additional tables, or invent your own database with which to experiment. </p>
<p class="calibre1">After you have a solid grasp on the basics, the remaining chapters will drill deep into additional concepts, most of which are independent of each other. Thus, if you find yourself getting confused, you can always move ahead and come back later to revisit a chapter. When you have finished the book and worked through all of the examples, you will be well on your way to becoming a seasoned SQL practitioner. </p>
<p class="calibre1">For readers interested in learning more about relational databases, the history of computerized database systems, or the SQL language than was covered in this short introduction, here are a few resources worth checking out:</p>
<p class="calibre1">• C.J. Date’s <a href="http://oreilly.com/catalog/9780596100124/"> <i class="calibre4">Database in Depth: Relational Theory for Practitioners</i></a> <i class="calibre4"> <a href="http://oreilly.com/catalog/9780596100124/">(http://oreilly</a></i></p>
<p class="calibre1"><a href="http://oreilly.com/catalog/9780596100124/"> <i class="calibre4">.com/catalog/9780596100124/)</i></a> (O’Reilly)</p>
<p class="calibre1">• C.J. Date’s  <i class="calibre4">An Introduction to Database Systems</i>, Eighth Edition (Addison-Wesley) <b class="calibre3">What’s in Store | 13</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-286"></a>• C.J. Date’s  <i class="calibre4">The Database Relational Model: A Retrospective Review and Analysis:</i> <i class="calibre4">A Historical Account and Assessment of E. F. Codd’s Contribution to the Field of</i> <i class="calibre4">Database Technology</i> (Addison-Wesley)</p>
<p class="calibre1">• <a href="http://en.wikipedia.org/wiki/Database_management_system"> <i class="calibre4">http://en.wikipedia.org/wiki/Database_management_system</i></a></p>
<p class="calibre1">• <a href="http://www.mcjones.org/System_R/"> <i class="calibre4">http://www.mcjones.org/System_R/</i></a></p>
<p class="calibre1"><b class="calibre3">14 | Chapter 1:</b> <b class="calibre3">A Little Background</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-11"></a><b class="calibre3">CHAPTER 2</b></p>
<p class="calibre1"><b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">This chapter provides you with the information you need to create your first database and to create the tables and associated data used for the examples in this book. You will also learn about various data types and see how to create tables using them. Because the  examples  in  this  book  are  executed  against  a  MySQL  database,  this  chapter  is somewhat skewed toward MySQL’s features and syntax, but most concepts are applicable to any server. </p>
<p class="calibre1"><b class="calibre3">Creating a MySQL Database</b></p>
<p class="calibre1">If you already have a MySQL database server available for your use, you can skip the installation instructions and start with the instructions in <a href="#calibre_link-155">Table 2-1. </a>Keep in mind, however, that this book assumes that you are using MySQL version 6.0 or later, so you may want to consider upgrading your server or installing another server if you are using an earlier release. </p>
<p class="calibre1">The following instructions show you the minimum steps required to install a MySQL</p>
<p class="calibre1">6.0 server on a Windows computer:</p>
<p class="calibre1">1. Go to the download page for the MySQL Database Server <a href="http://dev.mysql.com/downloads">at  <i class="calibre4">http://dev.mysql.com/</i></a></p>
<p class="calibre1"><a href="http://dev.mysql.com/downloads"> <i class="calibre4">downloads</i></a>. If you are loading version 6.0, the full URL is <a href="http://dev.mysql.com/downloads/mysql/6.0.html"> <i class="calibre4">http://dev.mysql.com/</i></a></p>
<p class="calibre1"><a href="http://dev.mysql.com/downloads/mysql/6.0.html"> <i class="calibre4">downloads/mysql/6.0.html</i>. </a></p>
<p class="calibre1">2. Download the Windows Essentials (x86) package, which includes only the commonly used tools. </p>
<p class="calibre1">3. When asked “Do you want to run or save this file?” click Run. </p>
<p class="calibre1">4. The MySQL Server 6.0&mdash;Setup Wizard window appears. Click Next. </p>
<p class="calibre1">5. Activate the Typical Install radio button, and click Next. </p>
<p class="calibre1">6. Click Install. </p>
<p class="calibre1">7. A MySQL Enterprise window appears. Click Next twice. </p>
<p class="calibre1"><b class="calibre3">15</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-155"></a><img src="images/000047.png" alt="Image 9" class="calibre2" /></p>
<p class="calibre1">8. When the installation is complete, make sure the box is checked next to “Configure the MySQL Server now,” and then click Finish. This launches the Configuration Wizard. </p>
<p class="calibre1">9. When the Configuration Wizard launches, activate the Standard Configuration radio button, and then select both the “Install as Windows Service” and “Include Bin Directory in Windows Path” checkboxes. Click Next. </p>
<p class="calibre1">10. Select the Modify Security Settings checkbox and enter a password for the root user (make sure you write down the password, because you will need it shortly!), and click Next. </p>
<p class="calibre1">11. Click Execute. </p>
<p class="calibre1">At this point, if all went well, the MySQL server is installed and running. If not, I suggest you uninstall the server and read the “Troubleshooting a MySQL Installation Under Windows” guide (which you can find at <a href="http://dev.mysql.com/doc/refman/6.0/en/windows-troubleshooting.html"> <i class="calibre4">http://dev.mysql.com/doc/refman/6.0/en/win</i></a></p>
<p class="calibre1"><a href="http://dev.mysql.com/doc/refman/6.0/en/windows-troubleshooting.html"> <i class="calibre4">dows-troubleshooting.html</i>). </a></p>
<p class="calibre1">If you uninstalled an older version of MySQL before loading version 6.0, you may have some further cleanup to do (I had to clean out some old Registry entries) before you can get the Configuration Wizard to run successfully. </p>
<p class="calibre1">Next, you will need to open a Windows command window, launch the mysql tool, and create your database and database <a href="#calibre_link-155">user. Table 2-1 </a>describes the necessary steps. In step 5, feel free to choose your own password for the lrngsql user rather than “xyz” (but don’t forget to write it down!). </p>
<p class="calibre1"> <i class="calibre4">Table 2-1. Creating the sample database</i></p>
<p class="calibre1"><b class="calibre3">Step</b></p>
<p class="calibre1"><b class="calibre3">Description</b></p>
<p class="calibre1"><b class="calibre3">Action</b></p>
<p class="calibre1">1</p>
<p class="calibre1">Open the Run dialog box from the Start menu</p>
<p class="calibre1">Choose Start and then Run</p>
<p class="calibre1">2</p>
<p class="calibre1">Launch a command window</p>
<p class="calibre1">Type <b class="calibre3">cmd</b> and click OK</p>
<p class="calibre1">3</p>
<p class="calibre1">Log in to MySQL as root</p>
<p class="calibre1">mysql -u root -p</p>
<p class="calibre1">4</p>
<p class="calibre1">Create a database for the sample data</p>
<p class="calibre1">create database bank; </p>
<p class="calibre1">5</p>
<p class="calibre1">Create the lrngsql database user with full privileges on the</p>
<p class="calibre1">grant all privileges on bank.* to</p>
<p class="calibre1">bank database</p>
<p class="calibre1">'lrngsql'@'localhost' identified</p>
<p class="calibre1">by 'xyz'; </p>
<p class="calibre1">6</p>
<p class="calibre1">Exit the mysql tool</p>
<p class="calibre1">quit; </p>
<p class="calibre1">7</p>
<p class="calibre1">Log in to MySQL as lrngsql</p>
<p class="calibre1">mysql -u lrngsql -p; </p>
<p class="calibre1">8</p>
<p class="calibre1">Attach to the bank database</p>
<p class="calibre1">use bank; </p>
<p class="calibre1"><b class="calibre3">16 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-12"></a>You now have a MySQL server, a database, and a database user; the only thing left to do is create the database tables and populate them with sample data. To do so, download  the  script  at  <a href="http://examples.oreilly.com/learningsql/"> <i class="calibre4">http://examples.oreilly.com/learningsql/</i></a>  and  run  it  from  the  mysql utility. If you saved the file as  <i class="calibre4">c:\temp\LearningSQLExample.sql</i>, you would need to do the following:</p>
<p class="calibre1">1. If you have logged out of the mysql<a href="#calibre_link-155"> tool, repeat steps 7 and 8 from Table 2-1. </a></p>
<p class="calibre1">2. Type <b class="calibre3">source c:\temp\LearningSQLExample.sql; </b> and press Enter. </p>
<p class="calibre1">You should now have a working database populated with all the data needed for the examples in this book. </p>
<p class="calibre1"><b class="calibre3">Using the mysql Command-Line Tool</b></p>
<p class="calibre1">Whenever you invoke the mysql command-line tool, you can specify the username and database to use, as in the following:</p>
<p class="calibre1">mysql -u lrngsql -p bank</p>
<p class="calibre1">This will save you from having to type use bank; every time you start up the tool. You will be asked for your password, and then the mysql&gt; prompt will appear, via which you will be able to issue SQL statements and view the results. For example, if you want to know the current date and time, you could issue the following query: mysql&gt; <b class="calibre3">SELECT now(); </b></p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">| now()               |</p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">| 2008-02-19 16:48:46 |</p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">The now() function is a built-in MySQL function that returns the current date and time. </p>
<p class="calibre1">As you can see, the mysql command-line tool formats the results of your queries within a rectangle bounded by +, -, and | characters. After the results have been exhausted (in this case, there is only a single row of results), the mysql command-line tool shows how many rows were returned and how long the SQL statement took to execute. </p>
<p class="calibre1"><b class="calibre3">Using the mysql Command-Line Tool | 17</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-13"></a><b class="calibre3">About Missing from Clauses</b></p>
<p class="calibre1">With some database servers, you won’t be able to issue a query without a from clause that names at least one table. Oracle Database is a commonly used server for which this is true. For cases when you only need to call a function, Oracle provides a table called dual, which consists of a single column called dummy that contains a single row of  data.  In  order  to  be  compatible  with  Oracle  Database,  MySQL  also  provides  a dual table. The previous query to determine the current date and time could therefore be written as:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT now()</b></p>
<p class="calibre1"><b class="calibre3">FROM dual; </b></p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">| now()               |</p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">| 2005-05-06 16:48:46 |</p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">If you are not using Oracle and have no need to be compatible with Oracle, you can ignore the dual table altogether and use just a select clause without a from clause. </p>
<p class="calibre1">When you are done with the mysql command-line tool, simply type <b class="calibre3">quit; </b> or <b class="calibre3">exit; </b> to return to the Windows command shell. </p>
<p class="calibre1"><b class="calibre3">MySQL Data Types</b></p>
<p class="calibre1">In general, all the popular database servers have the capacity to store the same types of data, such as strings, dates, and numbers. Where they typically differ is in the specialty data types, such as XML documents or very large text or binary documents. Since this is an introductory book on SQL, and since 98% of the columns you encounter will be simple data types, this book covers only the character, date, and numeric data types. </p>
<p class="calibre1"><b class="calibre3">Character Data</b></p>
<p class="calibre1">Character data can be stored as either fixed-length or variable-length strings; the difference is that fixed-length strings are right-padded with spaces and always consume the same number of bytes, and variable-length strings are not right-padded with spaces and don’t always consume the same number of bytes. When defining a character column, you must specify the maximum size of any string to be stored in the column. For example, if you want to store strings up to 20 characters in length, you could use either of the following definitions:</p>
<p class="calibre1">char(20)    /* fixed-length */</p>
<p class="calibre1">varchar(20) /* variable-length */</p>
<p class="calibre1">The maximum length for char columns is currently 255 bytes, whereas varchar columns can be up to 65,535 bytes. If you need to store longer strings (such as emails, XML</p>
<p class="calibre1"><b class="calibre3">18 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-189"></a><img src="images/000048.png" alt="Image 10" class="calibre2" /></p>
<p class="calibre1">documents,  etc.),  then  you  will  want  to  use  one  of  the  text  types  (mediumtext  and longtext), which I cover later in this section. In general, you should use the char type when all strings to be stored in the column are of the same length, such as state abbre-viations, and the varchar type when strings to be stored in the column are of varying lengths. Both char and varchar are used in a similar fashion in all the major database servers. </p>
<p class="calibre1">Oracle Database is an exception when it comes to the use of varchar. </p>
<p class="calibre1">Oracle users should use the varchar2 type when defining variable-length character columns. </p>
<p class="calibre1"><b class="calibre3">Character sets</b></p>
<p class="calibre1">For languages that use the Latin alphabet, such as English, there is a sufficiently small number of characters such that only a single byte is needed to store each character. </p>
<p class="calibre1">Other languages, such as Japanese and Korean, contain large numbers of characters, thus  requiring  multiple  bytes  of  storage  for  each  character.  Such  character  sets  are therefore called  <i class="calibre4">multibyte character sets</i>. </p>
<p class="calibre1">MySQL can store data using various character sets, both single- and multibyte. To view the supported character sets in your server, you can use the show command, as in: mysql&gt; <b class="calibre3">SHOW CHARACTER SET; </b></p>
<p class="calibre1">+----------+-----------------------------+---------------------+--------+</p>
<p class="calibre1">| Charset  | Description                 | Default collation   | Maxlen |</p>
<p class="calibre1">+----------+-----------------------------+---------------------+--------+</p>
<p class="calibre1">| big5     | Big5 Traditional Chinese    | big5_chinese_ci     |      2 |</p>
<p class="calibre1">| dec8     | DEC West European           | dec8_swedish_ci     |      1 |</p>
<p class="calibre1">| cp850    | DOS West European           | cp850_general_ci    |      1 |</p>
<p class="calibre1">| hp8      | HP West European            | hp8_english_ci      |      1 |</p>
<p class="calibre1">| koi8r    | KOI8-R Relcom Russian       | koi8r_general_ci    |      1 |</p>
<p class="calibre1">| latin1   | cp1252 West European        | latin1_swedish_ci   |      1 |</p>
<p class="calibre1">| latin2   | ISO 8859-2 Central European | latin2_general_ci   |      1 |</p>
<p class="calibre1">| swe7     | 7bit Swedish                | swe7_swedish_ci     |      1 |</p>
<p class="calibre1">| ascii    | US ASCII                    | ascii_general_ci    |      1 |</p>
<p class="calibre1">| ujis     | EUC-JP Japanese             | ujis_japanese_ci    |      3 |</p>
<p class="calibre1">| sjis     | Shift-JIS Japanese          | sjis_japanese_ci    |      2 |</p>
<p class="calibre1">| hebrew   | ISO 8859-8 Hebrew           | hebrew_general_ci   |      1 |</p>
<p class="calibre1">| tis620   | TIS620 Thai                 | tis620_thai_ci      |      1 |</p>
<p class="calibre1">| euckr    | EUC-KR Korean               | euckr_korean_ci     |      2 |</p>
<p class="calibre1">| koi8u    | KOI8-U Ukrainian            | koi8u_general_ci    |      1 |</p>
<p class="calibre1">| gb2312   | GB2312 Simplified Chinese   | gb2312_chinese_ci   |      2 |</p>
<p class="calibre1">| greek    | ISO 8859-7 Greek            | greek_general_ci    |      1 |</p>
<p class="calibre1">| cp1250   | Windows Central European    | cp1250_general_ci   |      1 |</p>
<p class="calibre1">| gbk      | GBK Simplified Chinese      | gbk_chinese_ci      |      2 |</p>
<p class="calibre1">| latin5   | ISO 8859-9 Turkish          | latin5_turkish_ci   |      1 |</p>
<p class="calibre1">| armscii8 | ARMSCII-8 Armenian          | armscii8_general_ci |      1 |</p>
<p class="calibre1">| utf8     | UTF-8 Unicode               | utf8_general_ci     |      3 |</p>
<p class="calibre1">| ucs2     | UCS-2 Unicode               | ucs2_general_ci     |      2 |</p>
<p class="calibre1">| cp866    | DOS Russian                 | cp866_general_ci    |      1 |</p>
<p class="calibre1"><b class="calibre3">MySQL Data Types | 19</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-191"></a>| keybcs2  | DOS Kamenicky Czech-Slovak  | keybcs2_general_ci  |      1 |</p>
<p class="calibre1">| macce    | Mac Central European        | macce_general_ci    |      1 |</p>
<p class="calibre1">| macroman | Mac West European           | macroman_general_ci |      1 |</p>
<p class="calibre1">| cp852    | DOS Central European        | cp852_general_ci    |      1 |</p>
<p class="calibre1">| latin7   | ISO 8859-13 Baltic          | latin7_general_ci   |      1 |</p>
<p class="calibre1">| cp1251   | Windows Cyrillic            | cp1251_general_ci   |      1 |</p>
<p class="calibre1">| cp1256   | Windows Arabic              | cp1256_general_ci   |      1 |</p>
<p class="calibre1">| cp1257   | Windows Baltic              | cp1257_general_ci   |      1 |</p>
<p class="calibre1">| binary   | Binary pseudo charset       | binary              |      1 |</p>
<p class="calibre1">| geostd8  | GEOSTD8 Georgian            | geostd8_general_ci  |      1 |</p>
<p class="calibre1">| cp932    | SJIS for Windows Japanese   | cp932_japanese_ci   |      2 |</p>
<p class="calibre1">| eucjpms  | UJIS for Windows Japanese   | eucjpms_japanese_ci |      3 |</p>
<p class="calibre1">+----------+-----------------------------+---------------------+--------+</p>
<p class="calibre1">36 rows in set (0.11 sec)</p>
<p class="calibre1">If the value in the fourth column, maxlen, is greater than 1, then the character set is a multibyte character set. </p>
<p class="calibre1">When I installed the MySQL server, the latin1 character set was automatically chosen as the default character set. However, you may choose to use a different character set for each character column in your database, and you can even store different character sets within the same table. To choose a character set other than the default when defining a column, simply name one of the supported character sets after the type definition, as in:</p>
<p class="calibre1">varchar(20) character set utf8</p>
<p class="calibre1">With MySQL, you may also set the default character set for your entire database: create database foreign_sales character set utf8; </p>
<p class="calibre1">While this is as much information regarding character sets as I’m willing to discuss in an introductory book, there is a great deal more to the topic of internationalization than what is shown here. If you plan to deal with multiple or unfamiliar character sets, you may want to pick up a book such as Andy Deitsch and David Czarnecki’s <a href="http://oreilly.com/catalog/9780596000196/"> <i class="calibre4">Java</i></a></p>
<p class="calibre1"><a href="http://oreilly.com/catalog/9780596000196/"> <i class="calibre4">Internationalization (http://oreilly.com/catalog/9780596000196/)</i></a> (O’Reilly) or Richard Gillam’s  <i class="calibre4">Unicode Demystified: A Practical Programmer’s Guide to the Encoding Standard</i> (Addison-Wesley). </p>
<p class="calibre1"><b class="calibre3">Text data</b></p>
<p class="calibre1">If you need to store data that might exceed the 64 KB limit for varchar columns, you will need to use one of the text types. </p>
<p class="calibre1"><a href="#calibre_link-14">Table 2-2 shows the available text types and their maximum sizes. </a></p>
<p class="calibre1"><b class="calibre3">20 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-14"></a><img src="images/000049.png" alt="Image 11" class="calibre2" /></p>
<p class="calibre1"> <i class="calibre4">Table 2-2. MySQL text types</i></p>
<p class="calibre1"><b class="calibre3">Text type</b></p>
<p class="calibre1"><b class="calibre3">Maximum number of bytes</b></p>
<p class="calibre1">Tinytext</p>
<p class="calibre1">255</p>
<p class="calibre1">Text</p>
<p class="calibre1">65,535</p>
<p class="calibre1">Mediumtext</p>
<p class="calibre1">16,777,215</p>
<p class="calibre1">Longtext</p>
<p class="calibre1">4,294,967,295</p>
<p class="calibre1">When choosing to use one of the text types, you should be aware of the following:</p>
<p class="calibre1">• If the data being loaded into a text column exceeds the maximum size for that type, the data will be truncated. </p>
<p class="calibre1">• Trailing spaces will not be removed when data is loaded into the column. </p>
<p class="calibre1">• When using text columns for sorting or grouping, only the first 1,024 bytes are used, although this limit may be increased if necessary. </p>
<p class="calibre1">• The different text types are unique to MySQL. SQL Server has a single text type for large character data, whereas DB2 and Oracle use a data type called clob, for Character Large Object. </p>
<p class="calibre1">• Now that MySQL allows up to 65,535 bytes for varchar columns (it was limited to 255 bytes in version 4), there isn’t any particular need to use the tinytext or text type. </p>
<p class="calibre1">If you are creating a column for free-form data entry, such as a notes column to hold data about customer interactions with your company’s customer service department, then varchar will probably be adequate. If you are storing documents, however, you should choose either the mediumtext or longtext type. </p>
<p class="calibre1">Oracle Database allows up to 2,000 bytes for char columns and 4,000</p>
<p class="calibre1">bytes for varchar2 columns. SQL Server can handle up to 8,000 bytes for both char and varchar data. </p>
<p class="calibre1"><b class="calibre3">Numeric Data</b></p>
<p class="calibre1">Although it might seem reasonable to have a single numeric data type called “numeric,” </p>
<p class="calibre1">there are actually several different numeric data types that reflect the various ways in which numbers are used, as illustrated here:</p>
<p class="calibre1"> <i class="calibre4">A column indicating whether a customer order has been shipped</i> This  type  of  column,  referred  to  as  a   <i class="calibre4">Boolean</i>,  would  contain  a  0  to  indicate false and a 1 to indicate true. </p>
<p class="calibre1"> <i class="calibre4">A system-generated primary key for a transaction table</i></p>
<p class="calibre1">This  data  would  generally  start  at  1 and increase in increments of one up to a potentially very large number. </p>
<p class="calibre1"><b class="calibre3">MySQL Data Types | 21</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-156"></a> <i class="calibre4">An item number for a customer’s electronic shopping basket</i> The values for this type of column would be positive whole numbers between 1</p>
<p class="calibre1">and, at most, 200 (for shopaholics). </p>
<p class="calibre1"> <i class="calibre4">Positional data for a circuit board drill machine</i></p>
<p class="calibre1">High-precision scientific or manufacturing data often requires accuracy to eight decimal points. </p>
<p class="calibre1">To handle these types of data (and more), MySQL has several different numeric data types. The most commonly used numeric types are those used to store whole numbers. </p>
<p class="calibre1">When specifying one of these types, you may also specify that the data is  <i class="calibre4">unsigned</i>, which tells the server that all data stored in the column will be greater than or equal to</p>
<p class="calibre1"><a href="#calibre_link-156">zero. Table 2-3 </a>shows the five different data types used to store whole-number integers. </p>
<p class="calibre1"> <i class="calibre4">Table 2-3. MySQL integer types</i></p>
<p class="calibre1"><b class="calibre3">Type</b></p>
<p class="calibre1"><b class="calibre3">Signed range</b></p>
<p class="calibre1"><b class="calibre3">Unsigned range</b></p>
<p class="calibre1">Tinyint</p>
<p class="calibre1">−128 to 127</p>
<p class="calibre1">0 to 255</p>
<p class="calibre1">Smallint</p>
<p class="calibre1">−32,768 to 32,767</p>
<p class="calibre1">0 to 65,535</p>
<p class="calibre1">Mediumint</p>
<p class="calibre1">−8,388,608 to 8,388,607</p>
<p class="calibre1">0 to 16,777,215</p>
<p class="calibre1">Int</p>
<p class="calibre1">−2,147,483,648 to 2,147,483,647</p>
<p class="calibre1">0 to 4,294,967,295</p>
<p class="calibre1">Bigint</p>
<p class="calibre1">−9,223,372,036,854,775,808 to 9,223,372,036,854,775,807</p>
<p class="calibre1">0 to 18,446,744,073,709,551,615</p>
<p class="calibre1">When you create a column using one of the integer types, MySQL will allocate an appropriate  amount  of  space  to  store  the  data,  which  ranges  from  one  byte  for  a tinyint to eight bytes for a bigint. Therefore, you should try to choose a type that will be large enough to hold the biggest number you can envision being stored in the column without needlessly wasting storage space. </p>
<p class="calibre1">For floating-point numbers (such as 3.1415927), you may choose from the numeric</p>
<p class="calibre1"><a href="#calibre_link-156">types shown in Table 2-4. </a></p>
<p class="calibre1"> <i class="calibre4">Table 2-4. MySQL floating-point types</i></p>
<p class="calibre1"><b class="calibre3">Type</b></p>
<p class="calibre1"><b class="calibre3">Numeric range</b></p>
<p class="calibre1">Float( <i class="calibre4">p</i>,  <i class="calibre4">s</i>)</p>
<p class="calibre1">−3.402823466E+38 to −1.175494351E-38</p>
<p class="calibre1">and 1.175494351E-38 to 3.402823466E+38</p>
<p class="calibre1">Double( <i class="calibre4">p</i>,  <i class="calibre4">s</i>)</p>
<p class="calibre1">−1.7976931348623157E+308 to −2.2250738585072014E-308</p>
<p class="calibre1">and 2.2250738585072014E-308 to 1.7976931348623157E+308</p>
<p class="calibre1">When  using  a  floating-point  type,  you  can  specify  a   <i class="calibre4">precision</i>  (the  total  number  of allowable digits both to the left and to the right of the decimal point) and a  <i class="calibre4">scale</i> (the number of allowable digits to the right of the decimal point), but they are not required. </p>
<p class="calibre1">These values are represented <a href="#calibre_link-156">in Table 2-4 </a>as  <i class="calibre4">p</i> and  <i class="calibre4">s</i>. If you specify a precision and scale for your floating-point column, remember that the data stored in the column will be <b class="calibre3">22 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-15"></a>rounded if the number of digits exceeds the scale and/or precision of the column. For example, a column defined as float(4,2) will store a total of four digits, two to the left of the decimal and two to the right of the decimal. Therefore, such a column would handle the numbers 27.44 and 8.19 just fine, but the number 17.8675 would be rounded to 17.87, and attempting to store the number 178.375 in your float(4,2) column would generate an error. </p>
<p class="calibre1">Like the integer types, floating-point columns can be defined as unsigned, but this designation only prevents negative numbers from being stored in the column rather than altering the range of data that may be stored in the column. </p>
<p class="calibre1"><b class="calibre3">Temporal Data</b></p>
<p class="calibre1">Along with strings and numbers, you will almost certainly be working with information about dates and/or times. This type of data is referred to as  <i class="calibre4">temporal</i>, and some examples of temporal data in a database include:</p>
<p class="calibre1">• The future date that a particular event is expected to happen, such as shipping a customer’s order</p>
<p class="calibre1">• The date that a customer’s order was shipped</p>
<p class="calibre1">• The date and time that a user modified a particular row in a table</p>
<p class="calibre1">• An employee’s birth date</p>
<p class="calibre1">• The year corresponding to a row in a yearly_sales fact table in a data warehouse</p>
<p class="calibre1">• The elapsed time needed to complete a wiring harness on an automobile assembly line</p>
<p class="calibre1">MySQL includes data types to handle all of these situations. <a href="#calibre_link-15">Table 2-5 </a>shows the temporal data types supported by MySQL. </p>
<p class="calibre1"> <i class="calibre4">Table 2-5. MySQL temporal types</i></p>
<p class="calibre1"><b class="calibre3">Type</b></p>
<p class="calibre1"><b class="calibre3">Default format</b></p>
<p class="calibre1"><b class="calibre3">Allowable values</b></p>
<p class="calibre1">Date</p>
<p class="calibre1">YYYY-MM-DD</p>
<p class="calibre1">1000-01-01 to 9999-12-31</p>
<p class="calibre1">Datetime</p>
<p class="calibre1">YYYY-MM-DD HH:MI:SS</p>
<p class="calibre1">1000-01-01 00:00:00 to 9999-12-31 23:59:59</p>
<p class="calibre1">Timestamp</p>
<p class="calibre1">YYYY-MM-DD HH:MI:SS</p>
<p class="calibre1">1970-01-01 00:00:00 to 2037-12-31 23:59:59</p>
<p class="calibre1">Year</p>
<p class="calibre1">YYYY</p>
<p class="calibre1">1901 to 2155</p>
<p class="calibre1">Time</p>
<p class="calibre1">HHH:MI:SS</p>
<p class="calibre1">−838:59:59 to 838:59:59</p>
<p class="calibre1">While database servers store temporal data in various ways, the purpose of a format string (second column of <a href="#calibre_link-15">Table 2-5) </a>is to show how the data will be represented when retrieved, along with how a date string should be constructed when inserting or updating a temporal column. Thus, if you wanted to insert the date March 23, 2005 into a  date  column  using  the  default  format  YYYY-MM-DD,  you  would  use  the  string <b class="calibre3">MySQL Data Types | 23</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-157"></a><img src="images/000050.png" alt="Image 12" class="calibre2" /></p>
<p class="calibre1">'2005-03-23'. <a href="#calibre_link-67">Chapter  7  </a>fully  explores  how  temporal  data  is  constructed  and displayed. </p>
<p class="calibre1">Each database server allows a different range of dates for temporal columns. Oracle Database accepts dates ranging from 4712 BC to 9999</p>
<p class="calibre1">AD, while SQL Server only handles dates ranging from 1753 AD to 9999</p>
<p class="calibre1">AD (unless you are using SQL Server 2008’s new datetime2 data type, which allows for dates ranging from 1 AD to 9999 AD). MySQL falls in between Oracle and SQL Server and can store dates from 1000 AD to 9999 AD. Although this might not make any difference for most systems that track current and future events, it is important to keep in mind if you are storing historical dates. </p>
<p class="calibre1"><a href="#calibre_link-157">Table 2-6 describes the various components of the date formats shown in Table 2-5. </a></p>
<p class="calibre1"> <i class="calibre4">Table 2-6. Date format components</i></p>
<p class="calibre1"><b class="calibre3">Component</b></p>
<p class="calibre1"><b class="calibre3">Definition</b></p>
<p class="calibre1"><b class="calibre3">Range</b></p>
<p class="calibre1">YYYY</p>
<p class="calibre1">Year, including century</p>
<p class="calibre1">1000 to 9999</p>
<p class="calibre1">MM</p>
<p class="calibre1">Month</p>
<p class="calibre1">01 (January) to 12 (December)</p>
<p class="calibre1">DD</p>
<p class="calibre1">Day</p>
<p class="calibre1">01 to 31</p>
<p class="calibre1">HH</p>
<p class="calibre1">Hour</p>
<p class="calibre1">00 to 23</p>
<p class="calibre1">HHH</p>
<p class="calibre1">Hours (elapsed)</p>
<p class="calibre1">−838 to 838</p>
<p class="calibre1">MI</p>
<p class="calibre1">Minute</p>
<p class="calibre1">00 to 59</p>
<p class="calibre1">SS</p>
<p class="calibre1">Second</p>
<p class="calibre1">00 to 59</p>
<p class="calibre1">Here’s  how  the  various  temporal  types  would  be  used  to  implement  the  examples shown earlier:</p>
<p class="calibre1">• Columns to hold the expected future shipping date of a customer order and an employee’s birth date would use the date type, since it is unnecessary to know at what time a person was born and unrealistic to schedule a future shipment down to the second. </p>
<p class="calibre1">• A column to hold information about when a customer order was actually shipped would use the datetime type, since it is important to track not only the date that the shipment occurred but the time as well. </p>
<p class="calibre1">• A column that tracks when a user last modified a particular row in a table would use  the  timestamp  type.  The  timestamp  type  holds  the  same  information  as  the datetime type (year, month, day, hour, minute, second), but a timestamp column will automatically be populated with the current date/time by the MySQL server when a row is added to a table or when a row is later modified. </p>
<p class="calibre1">• A column holding just year data would use the year type. </p>
<p class="calibre1"><b class="calibre3">24 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-16"></a>• Columns that hold data regarding the length of time needed to complete a task would use the time type. For this type of data, it would be unnecessary and confusing to store a date component, since you are interested only in the number of hours/minutes/seconds needed to complete the task. This information could be derived using two datetime columns (one for the task start date/time and the other for the task completion date/time) and subtracting one from the other, but it is simpler to use a single time column. </p>
<p class="calibre1"><a href="#calibre_link-67">Chapter 7 explores how to work with each of these temporal data types. </a></p>
<p class="calibre1"><b class="calibre3">Table Creation</b></p>
<p class="calibre1">Now that you have a firm grasp on what data types may be stored in a MySQL database, it’s time to see how to use these types in table definitions. Let’s start by defining a table to hold information about a person. </p>
<p class="calibre1"><b class="calibre3">Step 1: Design</b></p>
<p class="calibre1">A good way to start designing a table is to do a bit of brainstorming to see what kind of information would be helpful to include. Here’s what I came up with after thinking for a short time about the types of information that describe a person:</p>
<p class="calibre1">• Name</p>
<p class="calibre1">• Gender</p>
<p class="calibre1">• Birth date</p>
<p class="calibre1">• Address</p>
<p class="calibre1">• Favorite foods</p>
<p class="calibre1">This is certainly not an exhaustive list, but it’s good enough for now. The next step is</p>
<p class="calibre1"><a href="#calibre_link-16">to assign column names and data types. Table 2-7 shows my initial attempt. </a></p>
<p class="calibre1"> <i class="calibre4">Table 2-7. Person table, first pass</i></p>
<p class="calibre1"><b class="calibre3">Column</b></p>
<p class="calibre1"><b class="calibre3">Type</b></p>
<p class="calibre1"><b class="calibre3">Allowable values</b></p>
<p class="calibre1">Name</p>
<p class="calibre1">Varchar(40)</p>
<p class="calibre1"></p>
<p class="calibre1">Gender</p>
<p class="calibre1">Char(1)</p>
<p class="calibre1">M, F</p>
<p class="calibre1">Birth_date</p>
<p class="calibre1">Date</p>
<p class="calibre1"></p>
<p class="calibre1">Address</p>
<p class="calibre1">Varchar(100)</p>
<p class="calibre1"></p>
<p class="calibre1">Favorite_foods</p>
<p class="calibre1">Varchar(200)</p>
<p class="calibre1"></p>
<p class="calibre1">The name, address, and favorite_foods columns are of type varchar and allow for free-form data entry. The gender column allows a single character which should equal only M or F. The birth_date column is of type date, since a time component is not needed. </p>
<p class="calibre1"><b class="calibre3">Table Creation | 25</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-17"></a><b class="calibre3">Step 2: Refinement</b></p>
<p class="calibre1"><a href="#calibre_link-2">In Chapter 1, </a>you were introduced to the concept of  <i class="calibre4">normalization</i>, which is the process of ensuring that there are no duplicate (other than foreign keys) or compound columns in your database design. In looking at the columns in the person table a second time, the following issues arise:</p>
<p class="calibre1">• The name column is actually a compound object consisting of a first name and a last name. </p>
<p class="calibre1">• Since multiple people can have the same name, gender, birth date, and so forth, there are no columns in the person table that guarantee uniqueness. </p>
<p class="calibre1">• The address column is also a compound object consisting of street, city, state/</p>
<p class="calibre1">province, country, and postal code. </p>
<p class="calibre1">• The favorite_foods column is a list containing 0, 1, or more independent items. It would be best to create a separate table for this data that includes a foreign key to the  person  table  so  that  you  know  to  which  person  a  particular  food  may  be attributed. </p>
<p class="calibre1">After taking these issues into <a href="#calibre_link-17">consideration, Table 2-8 </a>gives a normalized version of the person table. </p>
<p class="calibre1"> <i class="calibre4">Table 2-8. Person table, second pass</i></p>
<p class="calibre1"><b class="calibre3">Column</b></p>
<p class="calibre1"><b class="calibre3">Type</b></p>
<p class="calibre1"><b class="calibre3">Allowable values</b></p>
<p class="calibre1">Person_id</p>
<p class="calibre1">Smallint (unsigned)</p>
<p class="calibre1"></p>
<p class="calibre1">First_name</p>
<p class="calibre1">Varchar(20)</p>
<p class="calibre1"></p>
<p class="calibre1">Last_name</p>
<p class="calibre1">Varchar(20)</p>
<p class="calibre1"></p>
<p class="calibre1">Gender</p>
<p class="calibre1">Char(1)</p>
<p class="calibre1">M, F</p>
<p class="calibre1">Birth_date</p>
<p class="calibre1">Date</p>
<p class="calibre1"></p>
<p class="calibre1">Street</p>
<p class="calibre1">Varchar(30)</p>
<p class="calibre1"></p>
<p class="calibre1">City</p>
<p class="calibre1">Varchar(20)</p>
<p class="calibre1"></p>
<p class="calibre1">State</p>
<p class="calibre1">Varchar(20)</p>
<p class="calibre1"></p>
<p class="calibre1">Country</p>
<p class="calibre1">Varchar(20)</p>
<p class="calibre1"></p>
<p class="calibre1">Postal_code</p>
<p class="calibre1">Varchar(20)</p>
<p class="calibre1"></p>
<p class="calibre1">Now that the person table has a primary key (person_id) to guarantee uniqueness, the next step is to build a favorite_food table that includes a foreign key to the person table. </p>
<p class="calibre1"><a href="#calibre_link-18">Table 2-9 shows the result. </a></p>
<p class="calibre1"><b class="calibre3">26 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-18"></a> <i class="calibre4">Table 2-9. Favorite_food table</i></p>
<p class="calibre1"><b class="calibre3">Column</b></p>
<p class="calibre1"><b class="calibre3">Type</b></p>
<p class="calibre1">Person_id</p>
<p class="calibre1">Smallint (unsigned)</p>
<p class="calibre1">Food</p>
<p class="calibre1">Varchar(20)</p>
<p class="calibre1">The person_id and food columns comprise the primary key of the favorite_food table, and the person_id column is also a foreign key to the person table. </p>
<p class="calibre1"><b class="calibre3">How Much Is Enough? </b></p>
<p class="calibre1">Moving the favorite_foods column out of the person table was definitely a good idea, but are we done yet? What happens, for example, if one person lists “pasta” as a favorite food while another person lists “spaghetti”? Are they the same thing? In order to prevent this problem, you might decide that you want people to choose their favorite foods from a list of options, in which case you should create a food table with food_id and food_name columns, and then change the favorite_food table to contain a foreign key to the food table. While this design would be fully normalized, you might decide that you simply want to store the values that the user has entered, in which case you may leave the table as is. </p>
<p class="calibre1"><b class="calibre3">Step 3: Building SQL Schema Statements</b></p>
<p class="calibre1">Now that the design is complete for the two tables holding information about people and their favorite foods, the next step is to generate SQL statements to create the tables in the database. Here is the statement to create the person table: CREATE TABLE person</p>
<p class="calibre1">(person_id SMALLINT UNSIGNED, </p>
<p class="calibre1">fname VARCHAR(20), </p>
<p class="calibre1">lname VARCHAR(20), </p>
<p class="calibre1">gender CHAR(1), </p>
<p class="calibre1">birth_date DATE, </p>
<p class="calibre1">street VARCHAR(30), </p>
<p class="calibre1">city VARCHAR(20), </p>
<p class="calibre1">state VARCHAR(20), </p>
<p class="calibre1">country VARCHAR(20), </p>
<p class="calibre1">postal_code VARCHAR(20), </p>
<p class="calibre1">CONSTRAINT pk_person PRIMARY KEY (person_id)</p>
<p class="calibre1">); </p>
<p class="calibre1">Everything in this statement should be fairly self-explanatory except for the last item; when you define your table, you need to tell the database server what column or columns will serve as the primary key for the table. You do this by creating a  <i class="calibre4">constraint</i> on the table. You can add several types of constraints to a table definition. This constraint is a  <i class="calibre4">primary key constraint</i>. It is created on the person_id column and given the name pk_person. </p>
<p class="calibre1"><b class="calibre3">Table Creation | 27</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-204"></a>While on the topic of constraints, there is another type of constraint that would be useful for the person table. <a href="#calibre_link-16">In Table 2-7, </a>I added a third column to show the allowable values for certain columns (such as 'M' and 'F' for the gender column). Another type of constraint called a  <i class="calibre4">check constraint</i> constrains the allowable values for a particular column. MySQL allows a check constraint to be attached to a column definition, as in the following:</p>
<p class="calibre1">gender CHAR(1) <b class="calibre3">CHECK (gender IN ('M','F'))</b>, </p>
<p class="calibre1">While check constraints operate as expected on most database servers, the MySQL</p>
<p class="calibre1">server allows check constraints to be defined but does not enforce them. However, MySQL does provide another character data type called enum that merges the check constraint into the data type definition. Here’s what it would look like for the gender column definition:</p>
<p class="calibre1">gender <b class="calibre3">ENUM('M','F')</b>, </p>
<p class="calibre1">Here’s  how  the  person table definition looks with an enum data type for the gender column:</p>
<p class="calibre1">CREATE TABLE person</p>
<p class="calibre1">(person_id SMALLINT UNSIGNED, </p>
<p class="calibre1">fname VARCHAR(20), </p>
<p class="calibre1">lname VARCHAR(20), </p>
<p class="calibre1">gender <b class="calibre3">ENUM('M','F')</b>, </p>
<p class="calibre1">birth_date DATE, </p>
<p class="calibre1">street VARCHAR(30), </p>
<p class="calibre1">city VARCHAR(20), </p>
<p class="calibre1">state VARCHAR(20), </p>
<p class="calibre1">country VARCHAR(20), </p>
<p class="calibre1">postal_code VARCHAR(20), </p>
<p class="calibre1">CONSTRAINT pk_person PRIMARY KEY (person_id)</p>
<p class="calibre1">); </p>
<p class="calibre1">Later in this chapter, you will see what happens if you try to add data to a column that violates its check constraint (or, in the case of MySQL, its enumeration values). </p>
<p class="calibre1">You are now ready to run the create table statement using the mysql command-line tool. Here’s what it looks like:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">CREATE TABLE person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(person_id SMALLINT UNSIGNED, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">fname VARCHAR(20), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">lname VARCHAR(20), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">gender ENUM('M','F'), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">birth_date DATE, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">street VARCHAR(30), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">city VARCHAR(20), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">state VARCHAR(20), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">country VARCHAR(20), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">postal_code VARCHAR(20), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONSTRAINT pk_person PRIMARY KEY (person_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">); </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.27 sec)</p>
<p class="calibre1"><b class="calibre3">28 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-158"></a>After processing the create table statement, the MySQL server returns the message</p>
<p class="calibre1">“Query OK, 0 rows affected,” which tells me that the statement had no syntax errors. </p>
<p class="calibre1">If you want to make sure that the person table does, in fact, exist, you can use the describe command (or desc for short) to look at the table definition: mysql&gt; <b class="calibre3">DESC person; </b></p>
<p class="calibre1">+-------------+----------------------+------+-----+---------+-------+</p>
<p class="calibre1">| Field       | Type                 | Null | Key | Default | Extra |</p>
<p class="calibre1">+-------------+----------------------+------+-----+---------+-------+</p>
<p class="calibre1">| person_id   | smallint(5) unsigned |      | PRI | 0       |       |</p>
<p class="calibre1">| fname       | varchar(20)          | YES  |     | NULL    |       |</p>
<p class="calibre1">| lname       | varchar(20)          | YES  |     | NULL    |       |</p>
<p class="calibre1">| gender      | enum('M','F')        | YES  |     | NULL    |       |</p>
<p class="calibre1">| birth_date  | date                 | YES  |     | NULL    |       |</p>
<p class="calibre1">| street      | varchar(30)          | YES  |     | NULL    |       |</p>
<p class="calibre1">| city        | varchar(20)          | YES  |     | NULL    |       |</p>
<p class="calibre1">| state       | varchar(20)          | YES  |     | NULL    |       |</p>
<p class="calibre1">| country     | varchar(20)          | YES  |     | NULL    |       |</p>
<p class="calibre1">| postal_code | varchar(20)          | YES  |     | NULL    |       |</p>
<p class="calibre1">+-------------+----------------------+------+-----+---------+-------+</p>
<p class="calibre1">10 rows in set (0.06 sec)</p>
<p class="calibre1">Columns 1 and 2 of the describe output are self-explanatory. Column 3 shows whether a particular column can be omitted when data is inserted into the table. I purposefully left  this  topic  out  of  the  discussion  for  now  (see  the  sidebar  <a href="#calibre_link-158">“What  Is</a></p>
<p class="calibre1"><a href="#calibre_link-158">Null?” on page 29 </a>for a short discourse), but we explore it fully in <a href="#calibre_link-39">Chapter 4. </a>The fourth column shows whether a column takes part in any keys (primary or foreign); in this case, the person_id column is marked as the primary key. Column 5 shows whether a particular column will be populated with a default value if you omit the column when inserting data into the table. The person_id column shows a default value of 0, although this would work only once, since each row in the person table must contain a unique value for this column (since it is the primary key). The sixth column (called “Extra”) shows any other pertinent information that might apply to a column. </p>
<p class="calibre1"><b class="calibre3">What Is Null? </b></p>
<p class="calibre1">In some cases, it is not possible or applicable to provide a value for a particular column in  your  table.  For  example,  when  adding  data  about  a  new  customer  order,  the ship_date  column  cannot  yet  be  determined.  In  this  case,  the  column  is  said  to  be <i class="calibre4">null</i> (note that I do not say that it  <i class="calibre4">equals</i> null), which indicates the absence of a value. </p>
<p class="calibre1">Null is used for various cases where a value cannot be supplied, such as:</p>
<p class="calibre1">• Not applicable</p>
<p class="calibre1">• Unknown</p>
<p class="calibre1">• Empty set</p>
<p class="calibre1">When designing a table, you may specify which columns are allowed to be null (the default), and which columns are not allowed to be null (designated by adding the keywords not null after the type definition). </p>
<p class="calibre1"><b class="calibre3">Table Creation | 29</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-19"></a><img src="images/000051.png" alt="Image 13" class="calibre2" /></p>
<p class="calibre1">Now  that  you’ve  created  the  person  table,  your  next  step  is  to  create  the favorite_food table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">CREATE TABLE favorite_food</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(person_id SMALLINT UNSIGNED, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">food VARCHAR(20), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONSTRAINT pk_favorite_food PRIMARY KEY (person_id, food), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONSTRAINT fk_fav_food_person_id FOREIGN KEY (person_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">REFERENCES person (person_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">); </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.10 sec)</p>
<p class="calibre1">This should look very similar to the create table statement for the person table, with the following exceptions:</p>
<p class="calibre1">• Since a person can have more than one favorite food (which is the reason this table was created in the first place), it takes more than just the person_id column to guarantee uniqueness in the table. This table, therefore, has a two-column primary key: person_id and food. </p>
<p class="calibre1">• The favorite_food table contains another type of constraint called a  <i class="calibre4">foreign key</i> <i class="calibre4">constraint</i>.  This  constrains  the  values  of  the  person_id  column  in  the favorite_food table to include  <i class="calibre4">only</i> values found in the person table. With this constraint in place, I will not be able to add a row to the favorite_food table indicating that person_id 27 likes pizza if there isn’t already a row in the person table having a person_id of 27. </p>
<p class="calibre1">If you forget to create the foreign key constraint when you first create the table, you can add it later via the alter table statement. </p>
<p class="calibre1">Describe shows the following after executing the create table statement: mysql&gt; <b class="calibre3">DESC favorite_food; </b></p>
<p class="calibre1">+--------------+----------------------+------+-----+---------+-------+</p>
<p class="calibre1">| Field        | Type                 | Null | Key | Default | Extra |</p>
<p class="calibre1">+--------------+----------------------+------+-----+---------+-------+</p>
<p class="calibre1">| person_id    | smallint(5) unsigned |      | PRI | 0       |       |</p>
<p class="calibre1">| food         | varchar(20)          |      | PRI |         |       |</p>
<p class="calibre1">+--------------+----------------------+------+-----+---------+-------+</p>
<p class="calibre1">Now that the tables are in place, the next logical step is to add some data. </p>
<p class="calibre1"><b class="calibre3">Populating and Modifying Tables</b></p>
<p class="calibre1">With the person and favorite_food tables in place, you can now begin to explore the four SQL data statements: insert, update, delete, and select. </p>
<p class="calibre1"><b class="calibre3">30 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-20"></a><b class="calibre3">Inserting Data</b></p>
<p class="calibre1">Since there is not yet any data in the person and favorite_food tables, the first of the four SQL data statements to be explored will be the insert statement. There are three main components to an insert statement:</p>
<p class="calibre1">• The name of the table into which to add the data</p>
<p class="calibre1">• The names of the columns in the table to be populated</p>
<p class="calibre1">• The values with which to populate the columns</p>
<p class="calibre1">You are not required to provide data for every column in the table (unless all the columns in the table have been defined as not null). In some cases, those columns that are  not  included  in  the  initial  insert  statement  will  be  given  a  value  later  via  an update statement. In other cases, a column may never receive a value for a particular row of data (such as a customer order that is canceled before being shipped, thus ren-dering the ship_date column inapplicable). </p>
<p class="calibre1"><b class="calibre3">Generating numeric key data</b></p>
<p class="calibre1">Before inserting data into the person table, it would be useful to discuss how values are generated for numeric primary keys. Other than picking a number out of thin air, you have a couple of options:</p>
<p class="calibre1">• Look at the largest value currently in the table and add one. </p>
<p class="calibre1">• Let the database server provide the value for you. </p>
<p class="calibre1">Although the first option may seem valid, it proves problematic in a multiuser environment, since two users might look at the table at the same time and generate the same value for the primary key. Instead, all database servers on the market today provide a safe, robust method for generating numeric keys. In some servers, such as the Oracle Database, a separate schema object is used (called a  <i class="calibre4">sequence</i>); in the case of MySQL, however, you simply need to turn on the  <i class="calibre4">auto-increment</i> feature for your primary key column. Normally, you would do this at table creation, but doing it now provides the opportunity to learn another SQL schema statement, alter table, which is used to modify the definition of an existing table:</p>
<p class="calibre1">ALTER TABLE person MODIFY person_id SMALLINT UNSIGNED AUTO_INCREMENT; This statement essentially redefines the person_id column in the person table. If you describe the table, you will now see the auto-increment feature listed under the “Extra” </p>
<p class="calibre1">column for person_id:</p>
<p class="calibre1"><b class="calibre3">Populating and Modifying Tables | 31</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-243"></a>mysql&gt; <b class="calibre3">DESC person; </b></p>
<p class="calibre1">+-------------+----------------------------+------+-----+---------+-----------------+</p>
<p class="calibre1">| Field       | Type                       | Null | Key | Default | Extra           |</p>
<p class="calibre1">+-------------+----------------------------+------+-----+---------+-----------------+</p>
<p class="calibre1">| person_id   | smallint(5) unsigned       |      | PRI | NULL    | <b class="calibre3">auto_increment</b>  |</p>
<p class="calibre1">| .           |                            |      |     |         |                 |</p>
<p class="calibre1">| .           |                            |      |     |         |                 |</p>
<p class="calibre1">| .           |                            |      |     |         |                 |</p>
<p class="calibre1">When you insert data into the person table, simply provide a null value for the per son_id column, and MySQL will populate the column with the next available number (by default, MySQL starts at 1 for auto-increment columns). </p>
<p class="calibre1"><b class="calibre3">The insert statement</b></p>
<p class="calibre1">Now that all the pieces are in place, it’s time to add some data. The following statement creates a row in the person table for William Turner:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(person_id, fname, lname, gender, birth_date)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (null, 'William','Turner', 'M', '1972-05-27');</b> Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">The feedback (“Query OK, 1 row affected”) tells you that your statement syntax was proper, and that one row was added to the database (since it was an insert statement). </p>
<p class="calibre1">You can look at the data just added to the table by issuing a select statement: mysql&gt; <b class="calibre3">SELECT person_id, fname, lname, birth_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM person; </b></p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">| person_id | fname   | lname  | birth_date |</p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">|         1 | William | Turner | 1972-05-27 |</p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">1 row in set (0.06 sec)</p>
<p class="calibre1">As you can see, the MySQL server generated a value of 1 for the primary key. Since there is only a single row in the person table, I neglected to specify which row I am interested in and simply retrieved all the rows in the table. If there were more than one row in the table, however, I could add a where clause to specify that I want to retrieve data only for the row having a value of 1 for the person_id column: mysql&gt; <b class="calibre3">SELECT person_id, fname, lname, birth_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE person_id = 1; </b></p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">| person_id | fname   | lname  | birth_date |</p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">|         1 | William | Turner | 1972-05-27 |</p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">32 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-212"></a>While this query specifies a particular primary key value, you can use any column in the table to search for rows, as shown by the following query, which finds all rows with a value of 'Turner' for the lname column:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT person_id, fname, lname, birth_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE lname = 'Turner'; </b></p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">| person_id | fname   | lname  | birth_date |</p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">|         1 | William | Turner | 1972-05-27 |</p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Before  moving  on,  a  couple  of  things  about  the  earlier  insert  statement  are  worth mentioning:</p>
<p class="calibre1">• Values were not provided for any of the address columns. This is fine, since nulls are allowed for those columns. </p>
<p class="calibre1">• The value provided for the birth_date column was a string. As long as you match the required format shown in <a href="#calibre_link-15">Table 2-5</a>, MySQL will convert the string to a date for you. </p>
<p class="calibre1">• The column names and the values provided must correspond in number and type. </p>
<p class="calibre1">If you name seven columns and provide only six values, or if you provide values that cannot be converted to the appropriate data type for the corresponding column, you will receive an error. </p>
<p class="calibre1">William has also provided information about his favorite three foods, so here are three insert statements to store his food preferences:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO favorite_food (person_id, food)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (1, 'pizza'); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO favorite_food (person_id, food)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (1, 'cookies'); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO favorite_food (person_id, food)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (1, 'nachos'); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">Here’s a query that retrieves William’s favorite foods in alphabetical order using an order by clause:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT food</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM favorite_food</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE person_id = 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY food; </b></p>
<p class="calibre1">+---------+</p>
<p class="calibre1">| food    |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">| cookies |</p>
<p class="calibre1">| nachos  |</p>
<p class="calibre1">| pizza   |</p>
<p class="calibre1"><b class="calibre3">Populating and Modifying Tables | 33</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-225"></a>+---------+</p>
<p class="calibre1">3 rows in set (0.02 sec)</p>
<p class="calibre1">The order by clause tells the server how to sort the data returned by the query. Without the order by clause, there is no guarantee that the data in the table will be retrieved in any particular order. </p>
<p class="calibre1">So that William doesn’t get lonely, you can execute another insert statement to add Susan Smith to the person table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(person_id, fname, lname, gender, birth_date, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">street, city, state, country, postal_code)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (null, 'Susan','Smith', 'F', '1975-11-02', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'23 Maple St.', 'Arlington', 'VA', 'USA', '20220'); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">Since Susan was kind enough to provide her address, we included five more columns than when William’s data was inserted. If you query the table again, you will see that Susan’s row has been assigned the value 2 for its primary key value: mysql&gt; <b class="calibre3">SELECT person_id, fname, lname, birth_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM person; </b></p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">| person_id | fname   | lname  | birth_date |</p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">|         1 | William | Turner | 1972-05-27 |</p>
<p class="calibre1">|         2 | Susan   | Smith  | 1975-11-02 |</p>
<p class="calibre1">+-----------+---------+--------+------------+</p>
<p class="calibre1">2 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">Can I Get That in XML? </b></p>
<p class="calibre1">If you will be working with XML data, you will be happy to know that most database servers provide a simple way to generate XML output from a query. With MySQL, for example, you can use the --xml option when invoking the mysql tool, and all your output will automatically be formatted using XML. Here’s what the favorite-food data looks like as an XML document:</p>
<p class="calibre1">C:\database&gt; mysql -u lrngsql -p --xml bank</p>
<p class="calibre1">Enter password: xxxxxx</p>
<p class="calibre1">Welcome to the MySQL Monitor... </p>
<p class="calibre1">Mysql&gt; SELECT * FROM favorite_food; </p>
<p class="calibre1">&lt;?xml version="1.0"?&gt; </p>
<p class="calibre1">&lt;resultset statement="select * from favorite_food" </p>
<p class="calibre1">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"&gt; </p>
<p class="calibre1">&lt;row&gt; </p>
<p class="calibre1">&lt;field name="person_id"&gt;1&lt;/field&gt; </p>
<p class="calibre1">&lt;field name="food"&gt;cookies&lt;/field&gt; </p>
<p class="calibre1">&lt;/row&gt; </p>
<p class="calibre1">&lt;row&gt; </p>
<p class="calibre1">&lt;field name="person_id"&gt;1&lt;/field&gt; </p>
<p class="calibre1">&lt;field name="food"&gt;nachos&lt;/field&gt; </p>
<p class="calibre1">&lt;/row&gt; </p>
<p class="calibre1"><b class="calibre3">34 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-21"></a>  &lt;row&gt; </p>
<p class="calibre1">&lt;field name="person_id"&gt;1&lt;/field&gt; </p>
<p class="calibre1">&lt;field name="food"&gt;pizza&lt;/field&gt; </p>
<p class="calibre1">&lt;/row&gt; </p>
<p class="calibre1">&lt;/resultset&gt; </p>
<p class="calibre1">3 rows in set (0.00 sec)</p>
<p class="calibre1">With SQL Server, you don’t need to configure your command-line tool; you just need to add the for xml clause to the end of your query, as in:</p>
<p class="calibre1">SELECT * FROM favorite_food</p>
<p class="calibre1">FOR XML AUTO, ELEMENTS</p>
<p class="calibre1"><b class="calibre3">Updating Data</b></p>
<p class="calibre1">When the data for William Turner was initially added to the table, data for the various address columns was omitted from the insert statement. The next statement shows how these columns can be populated via an update statement:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET street = '1225 Tremont St.', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">city = 'Boston', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">state = 'MA', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">country = 'USA', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">postal_code = '02138' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE person_id = 1; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.04 sec)</p>
<p class="calibre1">Rows matched: 1  Changed: 1  Warnings: 0</p>
<p class="calibre1">The server responded with a two-line message: the “Rows matched: 1” item tells you that  the  condition  in  the  where  clause  matched  a  single  row  in  the  table,  and  the</p>
<p class="calibre1">“Changed: 1” item tells you that a single row in the table has been modified. Since the where clause specifies the primary key of William’s row, this is exactly what you would expect to have happen. </p>
<p class="calibre1">Depending on the conditions in your where clause, it is also possible to modify more than one row using a single statement. Consider, for example, what would happen if your where clause looked as follows:</p>
<p class="calibre1">WHERE person_id &lt; 10</p>
<p class="calibre1">Since both William and Susan have a person_id value less than 10, both of their rows would be modified. If you leave off the where clause altogether, your update statement will modify every row in the table. </p>
<p class="calibre1"><b class="calibre3">Deleting Data</b></p>
<p class="calibre1">It seems that William and Susan aren’t getting along very well together, so one of them has got to go. Since William was there first, Susan will get the boot courtesy of the delete statement:</p>
<p class="calibre1"><b class="calibre3">Populating and Modifying Tables | 35</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-22"></a>mysql&gt; <b class="calibre3">DELETE FROM person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE person_id = 2; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">Again, the primary key is being used to isolate the row of interest, so a single row is deleted from the table. Similar to the update statement, more than one row can be deleted depending on the conditions in your where clause, and all rows will be deleted if the where clause is omitted. </p>
<p class="calibre1"><b class="calibre3">When Good Statements Go Bad</b></p>
<p class="calibre1">So far, all of the SQL data statements shown in this chapter have been well formed and have  played  by  the  rules.  Based  on  the  table  definitions  for  the  person  and  favor ite_food tables, however, there are lots of ways that you can run afoul when inserting or modifying data. This section shows you some of the common mistakes that you might come across and how the MySQL server will respond. </p>
<p class="calibre1"><b class="calibre3">Nonunique Primary Key</b></p>
<p class="calibre1">Because the table definitions include the creation of primary key constraints, MySQL</p>
<p class="calibre1">will make sure that duplicate key values are not inserted into the tables. The next statement attempts to bypass the auto-increment feature of the person_id column and create another row in the person table with a person_id of 1:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(person_id, fname, lname, gender, birth_date)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (1, 'Charles','Fulton', 'M', '1968-01-15'); </b></p>
<p class="calibre1">ERROR 1062 (23000): Duplicate entry '1' for key 'PRIMARY' </p>
<p class="calibre1">There is nothing stopping you (with the current schema objects, at least) from creating two rows with identical names, addresses, birth dates, and so on, as long as they have different values for the person_id column. </p>
<p class="calibre1"><b class="calibre3">Nonexistent Foreign Key</b></p>
<p class="calibre1">The table definition for the favorite_food table includes the creation of a foreign key constraint  on  the  person_id  column.  This  constraint  ensures  that  all  values  of person_id entered into the favorite_food table exist in the person table. Here’s what would happen if you tried to create a row that violates this constraint: mysql&gt; <b class="calibre3">INSERT INTO favorite_food (person_id, food)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (999, 'lasagna'); </b></p>
<p class="calibre1">ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails ('bank'.'favorite_food', CONSTRAINT 'fk_fav_food_person_id' FOREIGN KEY</p>
<p class="calibre1">('person_id') REFERENCES 'person' ('person_id'))</p>
<p class="calibre1">In  this  case,  the  favorite_food table is considered the   <i class="calibre4">child</i> and the  person table is considered the  <i class="calibre4">parent</i>, since the favorite_food table is dependent on the person table <b class="calibre3">36 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-23"></a><img src="images/000052.png" alt="Image 14" class="calibre2" /></p>
<p class="calibre1">for some of its data. If you plan to enter data into both tables, you will need to create a row in parent before you can enter data into favorite_food. </p>
<p class="calibre1">Foreign key constraints are enforced only if your tables are created using the  InnoDB  storage  engine.  We  discuss  MySQL’s  storage  engines  in</p>
<p class="calibre1"><a href="#calibre_link-119">Chapter 12. </a></p>
<p class="calibre1"><b class="calibre3">Column Value Violations</b></p>
<p class="calibre1">The gender column in the person table is restricted to the values 'M' for male and 'F' </p>
<p class="calibre1">for female. If you mistakenly attempt to set the value of the column to any other value, you will receive the following response:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET gender = 'Z' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE person_id = 1; </b></p>
<p class="calibre1">ERROR 1265 (01000): Data truncated for column 'gender' at row 1</p>
<p class="calibre1">The error message is a bit confusing, but it gives you the general idea that the server is unhappy about the value provided for the gender column. </p>
<p class="calibre1"><b class="calibre3">Invalid Date Conversions</b></p>
<p class="calibre1">If you construct a string with which to populate a date column, and that string does not match the expected format, you will receive another error. Here’s an example that uses a date format that does not match the default date format of “YYYY-MM-DD”: mysql&gt; <b class="calibre3">UPDATE person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET birth_date = 'DEC-21-1980' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE person_id = 1; </b></p>
<p class="calibre1">ERROR 1292 (22007): Incorrect date value: 'DEC-21-1980' for column 'birth_date' </p>
<p class="calibre1">at row 1</p>
<p class="calibre1">In general, it is always a good idea to explicitly specify the format string rather than relying on the default format. Here’s another version of the statement that uses the str_to_date function to specify which format string to use:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE person</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET birth_date = str_to_date('DEC-21-1980' , '%b-%d-%Y')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE person_id = 1; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.12 sec)</p>
<p class="calibre1">Rows matched: 1  Changed: 1  Warnings: 0</p>
<p class="calibre1">Not only is the database server happy, but William is happy as well (we just made him eight years younger, without the need for expensive cosmetic surgery!). </p>
<p class="calibre1"><b class="calibre3">When Good Statements Go Bad | 37</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-24"></a><img src="images/000053.png" alt="Image 15" class="calibre2" /></p>
<p class="calibre1">Earlier in the chapter, when I discussed the various temporal data types, I  showed  date-formatting  strings  such  as  “YYYY-MM-DD”.  While many database servers use this style of formatting, MySQL uses %Y to indicate a four-character year. Here are a few more formatters that you might need when converting strings to datetimes in MySQL:</p>
<p class="calibre1">%a The short weekday name, such as Sun, Mon, ... </p>
<p class="calibre1">%b The short month name, such as Jan, Feb, ... </p>
<p class="calibre1">%c The numeric month (0..12)</p>
<p class="calibre1">%d The numeric day of the month (00..31)</p>
<p class="calibre1">%f The number of microseconds (000000..999999)</p>
<p class="calibre1">%H The hour of the day, in 24-hour format (00..23)</p>
<p class="calibre1">%h The hour of the day, in 12-hour format (01..12)</p>
<p class="calibre1">%i The minutes within the hour (00..59)</p>
<p class="calibre1">%j The day of year (001..366)</p>
<p class="calibre1">%M The full month name (January..December)</p>
<p class="calibre1">%m The numeric month</p>
<p class="calibre1">%p AM or PM</p>
<p class="calibre1">%s The number of seconds (00..59)</p>
<p class="calibre1">%W The full weekday name (Sunday..Saturday)</p>
<p class="calibre1">%w The numeric day of the week (0=Sunday..6=Saturday)</p>
<p class="calibre1">%Y The four-digit year</p>
<p class="calibre1"><b class="calibre3">The Bank Schema</b></p>
<p class="calibre1">For the remainder of the book, you use a group of tables that model a community bank. </p>
<p class="calibre1">Some of the tables include Employee, Branch, Account, Customer, Product, and Transac tion. The entire schema and example data should have been created when you followed the final steps at the beginning of the chapter for loading the MySQL server and generating the sample data. To see a diagram of the tables and their columns and rela-</p>
<p class="calibre1"><a href="#calibre_link-150">tionships, see Appendix A. </a></p>
<p class="calibre1"><a href="#calibre_link-24">Table 2-10 shows all the tables used in the bank schema along with short definitions. </a></p>
<p class="calibre1"> <i class="calibre4">Table 2-10. Bank schema definitions</i></p>
<p class="calibre1"><b class="calibre3">Table name</b></p>
<p class="calibre1"><b class="calibre3">Definition</b></p>
<p class="calibre1">Account</p>
<p class="calibre1">A particular product opened for a particular customer</p>
<p class="calibre1">Branch</p>
<p class="calibre1">A location at which banking transactions are conducted</p>
<p class="calibre1">Business</p>
<p class="calibre1">A corporate customer (subtype of the Customer table)</p>
<p class="calibre1">Customer</p>
<p class="calibre1">A person or corporation known to the bank</p>
<p class="calibre1">Department</p>
<p class="calibre1">A group of bank employees implementing a particular banking function Employee</p>
<p class="calibre1">A person working for the bank</p>
<p class="calibre1">Individual</p>
<p class="calibre1">A noncorporate customer (subtype of the Customer table)</p>
<p class="calibre1">Officer</p>
<p class="calibre1">A person allowed to transact business for a corporate customer Product</p>
<p class="calibre1">A banking service offered to customers</p>
<p class="calibre1">Product_type</p>
<p class="calibre1">A group of products having a similar function</p>
<p class="calibre1">Transaction</p>
<p class="calibre1">A change made to an account balance</p>
<p class="calibre1"><b class="calibre3">38 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-183"></a>Feel free to experiment with the tables as much as you want, including adding your own tables to expand the bank’s business functions. You can always drop the database and re-create it from the downloaded file if you want to make sure your sample data is intact. </p>
<p class="calibre1">If you want to see the tables available in your database, you can use the show tables command, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SHOW TABLES; </b></p>
<p class="calibre1">+----------------+</p>
<p class="calibre1">| Tables_in_bank |</p>
<p class="calibre1">+----------------+</p>
<p class="calibre1">| account        |</p>
<p class="calibre1">| branch         |</p>
<p class="calibre1">| business       |</p>
<p class="calibre1">| customer       |</p>
<p class="calibre1">| department     |</p>
<p class="calibre1">| employee       |</p>
<p class="calibre1">| favorite_food  |</p>
<p class="calibre1">| individual     |</p>
<p class="calibre1">| officer        |</p>
<p class="calibre1">| person         |</p>
<p class="calibre1">| product        |</p>
<p class="calibre1">| product_type   |</p>
<p class="calibre1">| transaction    |</p>
<p class="calibre1">+----------------+</p>
<p class="calibre1">13 rows in set (0.10 sec)</p>
<p class="calibre1">Along with the 11 tables in the bank schema, the table listing also includes the two tables created in this chapter: person and favorite_food. These tables will not be used in later chapters, so feel free to drop them by issuing the following commands: mysql&gt; <b class="calibre3">DROP TABLE favorite_food; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.56 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DROP TABLE person; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.05 sec)</p>
<p class="calibre1">If you want to look at the columns in a table, you can use the describe command. Here’s an example of the describe output for the customer table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DESC customer; </b></p>
<p class="calibre1">+--------------+------------------+------+-----+---------+----------------+</p>
<p class="calibre1">| Field        | Type             | Null | Key | Default | Extra          |</p>
<p class="calibre1">+--------------+------------------+------+-----+---------+----------------+</p>
<p class="calibre1">| cust_id      | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</p>
<p class="calibre1">| fed_id       | varchar(12)      | NO   |     | NULL    |                |</p>
<p class="calibre1">| cust_type_cd | enum('I','B')    | NO   |     | NULL    |                |</p>
<p class="calibre1">| address      | varchar(30)      | YES  |     | NULL    |                |</p>
<p class="calibre1">| city         | varchar(20)      | YES  |     | NULL    |                |</p>
<p class="calibre1">| state        | varchar(20)      | YES  |     | NULL    |                |</p>
<p class="calibre1">| postal_code  | varchar(10)      | YES  |     | NULL    |                |</p>
<p class="calibre1">+--------------+------------------+------+-----+---------+----------------+</p>
<p class="calibre1">7 rows in set (0.03 sec)</p>
<p class="calibre1"><b class="calibre3">The Bank Schema | 39</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-287"></a>The more comfortable you are with the example database, the better you will understand the examples and, consequently, the concepts in the following chapters. </p>
<p class="calibre1"><b class="calibre3">40 | Chapter 2:</b> <b class="calibre3">Creating and Populating a Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-25"></a><b class="calibre3">CHAPTER 3</b></p>
<p class="calibre1"><b class="calibre3">Query Primer</b></p>
<p class="calibre1">So far, you have seen a few examples of database queries (a.k.a. select statements) sprinkled throughout the first two chapters. Now it’s time to take a closer look at the different parts of the select statement and how they interact. </p>
<p class="calibre1"><b class="calibre3">Query Mechanics</b></p>
<p class="calibre1">Before dissecting the select statement, it might be interesting to look at how queries are executed by the MySQL server (or, for that matter, any database server). If you are using the mysql command-line tool (which I assume you are), then you have already logged in to the MySQL server by providing your username and password (and possibly a hostname if the MySQL server is running on a different computer). Once the server has verified that your username and password are correct, a  <i class="calibre4">database connection</i> is generated for you to use. This connection is held by the application that requested it (which, in this case, is the mysql tool) until the application releases the connection (i.e., as a result of your typing quit) or the server closes the connection (i.e., when the server is shut down). Each connection to the MySQL server is assigned an identifier, which is shown to you when you first log in:</p>
<p class="calibre1">Welcome to the MySQL monitor.  Commands end with ; or \g. </p>
<p class="calibre1"><b class="calibre3">Your MySQL connection id is 11</b></p>
<p class="calibre1">Server version: 6.0.3-alpha-community MySQL Community Server (GPL) Type 'help;' or '\h' for help. Type '\c' to clear the buffer. </p>
<p class="calibre1">In this case, my connection ID is 11. This information might be useful to your database administrator if something goes awry, such as a malformed query that runs for hours, so you might want to jot it down. </p>
<p class="calibre1">Once the server has verified your username and password and issued you a connection, you are ready to execute queries (along with other SQL statements). Each time a query is sent to the server, the server checks the following things prior to statement execution: <b class="calibre3">41</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-226"></a><img src="images/000054.png" alt="Image 16" class="calibre2" /></p>
<p class="calibre1">• Do you have permission to execute the statement? </p>
<p class="calibre1">• Do you have permission to access the desired data? </p>
<p class="calibre1">• Is your statement syntax correct? </p>
<p class="calibre1">If your statement passes these three tests, then your query is handed to the  <i class="calibre4">query optimizer</i>, whose job it is to determine the most efficient way to execute your query. The optimizer will look at such things as the order in which to join the tables named in your from clause and what indexes are available, and then picks an  <i class="calibre4">execution plan</i>, which the server uses to execute your query. </p>
<p class="calibre1">Understanding and influencing how your database server chooses execution plans is a fascinating topic that many of you will wish to explore. </p>
<p class="calibre1">For  those  readers  using  MySQL,  you  might  consider  reading  Baron Schwartz et al.’s <a href="http://oreilly.com/catalog/9780596101718/"> <i class="calibre4">High Performance MySQL (http://oreilly.com/catalog/</i></a></p>
<p class="calibre1"><a href="http://oreilly.com/catalog/9780596101718/"> <i class="calibre4">9780596101718/)</i></a> (O’Reilly). Among other things, you will learn how to generate indexes, analyze execution plans, influence the optimizer via query hints, and tune your server’s startup parameters. If you are using  Oracle  Database  or  SQL  Server,  dozens  of  tuning  books  are available. </p>
<p class="calibre1">Once the server has finished executing your query, the  <i class="calibre4">result set</i> is returned to the calling application (which is, once again, the mysql tool). As I mentioned <a href="#calibre_link-2">in Chapter 1, </a>a result set is just another table containing rows and columns. If your query fails to yield any results, the mysql tool will show you the message found at the end of the following example:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE lname = 'Bkadfl'; </b></p>
<p class="calibre1"><b class="calibre3">Empty set</b>(0.00 sec)</p>
<p class="calibre1">If the query returns one or more rows, the mysql tool will format the results by adding column headers and by constructing boxes around the columns using the -, |, and +</p>
<p class="calibre1">symbols, as shown in the next example:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b></p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">| fname    | lname     |</p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">| Michael  | Smith     |</p>
<p class="calibre1">| Susan    | Barker    |</p>
<p class="calibre1">| Robert   | Tyler     |</p>
<p class="calibre1">| Susan    | Hawthorne |</p>
<p class="calibre1">| John     | Gooding   |</p>
<p class="calibre1">| Helen    | Fleming   |</p>
<p class="calibre1">| Chris    | Tucker    |</p>
<p class="calibre1">| Sarah    | Parker    |</p>
<p class="calibre1">| Jane     | Grossman  |</p>
<p class="calibre1"><b class="calibre3">42 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-26"></a>| Paula    | Roberts   |</p>
<p class="calibre1">| Thomas   | Ziegler   |</p>
<p class="calibre1">| Samantha | Jameson   |</p>
<p class="calibre1">| John     | Blake     |</p>
<p class="calibre1">| Cindy    | Mason     |</p>
<p class="calibre1">| Frank    | Portman   |</p>
<p class="calibre1">| Theresa  | Markham   |</p>
<p class="calibre1">| Beth     | Fowler    |</p>
<p class="calibre1">| Rick     | Tulman    |</p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1">This query returns the first and last names of all the employees in the employee table. </p>
<p class="calibre1">After the last row of data is displayed, the mysql tool displays a message telling you how many rows were returned, which, in this case, is 18. </p>
<p class="calibre1"><b class="calibre3">Query Clauses</b></p>
<p class="calibre1">Several components or  <i class="calibre4">clauses</i> make up the select statement. While only one of them is mandatory when using MySQL (the select clause), you will usually include at least two or three of the six available <a href="#calibre_link-26">clauses. Table 3-1 </a>shows the different clauses and their purposes. </p>
<p class="calibre1"> <i class="calibre4">Table 3-1. Query clauses</i></p>
<p class="calibre1"><b class="calibre3">Clause name</b></p>
<p class="calibre1"><b class="calibre3">Purpose</b></p>
<p class="calibre1">Select</p>
<p class="calibre1">Determines which columns to include in the query’s result set From</p>
<p class="calibre1">Identifies the tables from which to draw data and how the tables should be joined Where</p>
<p class="calibre1">Filters out unwanted data</p>
<p class="calibre1">Group by</p>
<p class="calibre1">Used to group rows together by common column values</p>
<p class="calibre1">Having</p>
<p class="calibre1">Filters out unwanted groups</p>
<p class="calibre1">Order by</p>
<p class="calibre1">Sorts the rows of the final result set by one or more columns All of the clauses shown <a href="#calibre_link-26">in Table 3-1 </a>are included in the ANSI specification; additionally, several other clauses are unique to MySQL that we explore in <a href="#calibre_link-151">Appendix B</a>. The following sections delve into the uses of the six major query clauses. </p>
<p class="calibre1"><b class="calibre3">The select Clause</b></p>
<p class="calibre1">Even though the select clause is the first clause of a select statement, it is one of the last clauses that the database server evaluates. The reason for this is that before you can determine what to include in the final result set, you need to know all of the possible columns that  <i class="calibre4">could</i> be included in the final result set. In order to fully understand the role of the select clause, therefore, you will need to understand a bit about the from clause. Here’s a query to get started:</p>
<p class="calibre1"><b class="calibre3">The select Clause | 43</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-208"></a>mysql&gt; <b class="calibre3">SELECT *</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM department; </b></p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">| dept_id | name           |</p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">|       1 | Operations     |</p>
<p class="calibre1">|       2 | Loans          |</p>
<p class="calibre1">|       3 | Administration |</p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">3 rows in set (0.04 sec)</p>
<p class="calibre1">In this query, the from clause lists a single table (department), and the select clause indicates that  <i class="calibre4">all</i> columns (designated by *) in the department table should be included in the result set. This query could be described in English as follows: <i class="calibre4">Show me all the columns and all the rows in the</i> department  <i class="calibre4">table</i>. </p>
<p class="calibre1">In addition to specifying all the columns via the asterisk character, you can explicitly name the columns you are interested in, such as:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT dept_id, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM department; </b></p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">| dept_id | name           |</p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">|       1 | Operations     |</p>
<p class="calibre1">|       2 | Loans          |</p>
<p class="calibre1">|       3 | Administration |</p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">3 rows in set (0.01 sec)</p>
<p class="calibre1">The results are identical to the first query, since all the columns in the department table (dept_id and name) are named in the select clause. You can choose to include only a subset of the columns in the department table as well:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM department; </b></p>
<p class="calibre1">+----------------+</p>
<p class="calibre1">| name           |</p>
<p class="calibre1">+----------------+</p>
<p class="calibre1">| Operations     |</p>
<p class="calibre1">| Loans          |</p>
<p class="calibre1">| Administration |</p>
<p class="calibre1">+----------------+</p>
<p class="calibre1">3 rows in set (0.00 sec)</p>
<p class="calibre1">The job of the select clause, therefore, is the following:</p>
<p class="calibre1"> <i class="calibre4">The</i> select  <i class="calibre4">clause determines which of all possible columns should be included in the</i> <i class="calibre4">query’s result set</i>. </p>
<p class="calibre1">If you were limited to including only columns from the table or tables named in the from clause, things would be rather dull. However, you can spice things up by including in your select clause such things as:</p>
<p class="calibre1"><b class="calibre3">44 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-206"></a>• Literals, such as numbers or strings</p>
<p class="calibre1">• Expressions, such as transaction.amount * −1</p>
<p class="calibre1">• Built-in function calls, such as ROUND(transaction.amount, 2)</p>
<p class="calibre1">• User-defined function calls</p>
<p class="calibre1">The next query demonstrates the use of a table column, a literal, an expression, and a built-in function call in a single query against the employee table: mysql&gt; <b class="calibre3">SELECT emp_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'ACTIVE', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">emp_id * 3.14159, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">UPPER(lname)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b></p>
<p class="calibre1">+--------+--------+------------------+--------------+</p>
<p class="calibre1">| emp_id | ACTIVE | emp_id * 3.14159 | UPPER(lname) |</p>
<p class="calibre1">+--------+--------+------------------+--------------+</p>
<p class="calibre1">|      1 | ACTIVE |          3.14159 | SMITH        |</p>
<p class="calibre1">|      2 | ACTIVE |          6.28318 | BARKER       |</p>
<p class="calibre1">|      3 | ACTIVE |          9.42477 | TYLER        |</p>
<p class="calibre1">|      4 | ACTIVE |         12.56636 | HAWTHORNE    |</p>
<p class="calibre1">|      5 | ACTIVE |         15.70795 | GOODING      |</p>
<p class="calibre1">|      6 | ACTIVE |         18.84954 | FLEMING      |</p>
<p class="calibre1">|      7 | ACTIVE |         21.99113 | TUCKER       |</p>
<p class="calibre1">|      8 | ACTIVE |         25.13272 | PARKER       |</p>
<p class="calibre1">|      9 | ACTIVE |         28.27431 | GROSSMAN     |</p>
<p class="calibre1">|     10 | ACTIVE |         31.41590 | ROBERTS      |</p>
<p class="calibre1">|     11 | ACTIVE |         34.55749 | ZIEGLER      |</p>
<p class="calibre1">|     12 | ACTIVE |         37.69908 | JAMESON      |</p>
<p class="calibre1">|     13 | ACTIVE |         40.84067 | BLAKE        |</p>
<p class="calibre1">|     14 | ACTIVE |         43.98226 | MASON        |</p>
<p class="calibre1">|     15 | ACTIVE |         47.12385 | PORTMAN      |</p>
<p class="calibre1">|     16 | ACTIVE |         50.26544 | MARKHAM      |</p>
<p class="calibre1">|     17 | ACTIVE |         53.40703 | FOWLER       |</p>
<p class="calibre1">|     18 | ACTIVE |         56.54862 | TULMAN       |</p>
<p class="calibre1">+--------+--------+------------------+--------------+</p>
<p class="calibre1">18 rows in set (0.05 sec)</p>
<p class="calibre1">We cover expressions and built-in functions in detail later, but I wanted to give you a feel for what kinds of things can be included in the select clause. If you only need to execute a built-in function or evaluate a simple expression, you can skip the from clause entirely. Here’s an example:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT VERSION(), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">USER(), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">DATABASE(); </b></p>
<p class="calibre1">+-----------------------+-------------------+------------+</p>
<p class="calibre1">| version()             | user()            | database() |</p>
<p class="calibre1">+-----------------------+-------------------+------------+</p>
<p class="calibre1">| 6.0.3-alpha-community | lrngsql@localhost | bank       |</p>
<p class="calibre1">+-----------------------+-------------------+------------+</p>
<p class="calibre1">1 row in set (0.05 sec)</p>
<p class="calibre1"><b class="calibre3">The select Clause | 45</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-27"></a>Since this query simply calls three built-in functions and doesn’t retrieve data from any tables, there is no need for a from clause. </p>
<p class="calibre1"><b class="calibre3">Column Aliases</b></p>
<p class="calibre1">Although the mysql tool will generate labels for the columns returned by your queries, you may want to assign your own labels. While you might want to assign a new label to a column from a table (if it is poorly or ambiguously named), you will almost certainly want to assign your own labels to those columns in your result set that are generated by expressions or built-in function calls. You can do so by adding a  <i class="calibre4">column alias</i> after each element of your select clause. Here’s the previous query against the employee table with column aliases applied to three of the columns:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'ACTIVE' status, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">emp_id * 3.14159 empid_x_pi, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">UPPER(lname) last_name_upper</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b></p>
<p class="calibre1">+--------+--------+------------+-----------------+</p>
<p class="calibre1">| emp_id | status | empid_x_pi | last_name_upper |</p>
<p class="calibre1">+--------+--------+------------+-----------------+</p>
<p class="calibre1">|      1 | ACTIVE |    3.14159 | SMITH           |</p>
<p class="calibre1">|      2 | ACTIVE |    6.28318 | BARKER          |</p>
<p class="calibre1">|      3 | ACTIVE |    9.42477 | TYLER           |</p>
<p class="calibre1">|      4 | ACTIVE |   12.56636 | HAWTHORNE       |</p>
<p class="calibre1">|      5 | ACTIVE |   15.70795 | GOODING         |</p>
<p class="calibre1">|      6 | ACTIVE |   18.84954 | FLEMING         |</p>
<p class="calibre1">|      7 | ACTIVE |   21.99113 | TUCKER          |</p>
<p class="calibre1">|      8 | ACTIVE |   25.13272 | PARKER          |</p>
<p class="calibre1">|      9 | ACTIVE |   28.27431 | GROSSMAN        |</p>
<p class="calibre1">|     10 | ACTIVE |   31.41590 | ROBERTS         |</p>
<p class="calibre1">|     11 | ACTIVE |   34.55749 | ZIEGLER         |</p>
<p class="calibre1">|     12 | ACTIVE |   37.69908 | JAMESON         |</p>
<p class="calibre1">|     13 | ACTIVE |   40.84067 | BLAKE           |</p>
<p class="calibre1">|     14 | ACTIVE |   43.98226 | MASON           |</p>
<p class="calibre1">|     15 | ACTIVE |   47.12385 | PORTMAN         |</p>
<p class="calibre1">|     16 | ACTIVE |   50.26544 | MARKHAM         |</p>
<p class="calibre1">|     17 | ACTIVE |   53.40703 | FOWLER          |</p>
<p class="calibre1">|     18 | ACTIVE |   56.54862 | TULMAN          |</p>
<p class="calibre1">+--------+--------+------------+-----------------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1">If you look at the column headers, you can see that the second, third, and fourth columns now have reasonable names instead of simply being labeled with the function or expression that generated the column. If you look at the select clause, you can see how the column aliases status, empid_x_pi, and last_name_upper are added after the second, third, and fourth columns. I think you will agree that the output is easier to understand with column aliases in place, and it would be easier to work with programmatically if you were issuing the query from within Java or C# rather than interactively via the <b class="calibre3">46 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-28"></a>mysql tool. In order to make your column aliases stand out even more, you also have the option of using the as keyword before the alias name, as in: mysql&gt; SELECT emp_id, </p>
<p class="calibre1">-&gt;   'ACTIVE' <b class="calibre3">AS</b> status, </p>
<p class="calibre1">-&gt;   emp_id * 3.14159 <b class="calibre3">AS</b> empid_x_pi, </p>
<p class="calibre1">-&gt;   UPPER(lname) <b class="calibre3">AS</b> last_name_upper</p>
<p class="calibre1">-&gt; FROM employee; </p>
<p class="calibre1">Many people feel that including the optional as keyword improves readability, although I have chosen not to use it for the examples in this book. </p>
<p class="calibre1"><b class="calibre3">Removing Duplicates</b></p>
<p class="calibre1">In some cases, a query might return duplicate rows of data. For example, if you were to retrieve the IDs of all customers that have accounts, you would see the following: mysql&gt; <b class="calibre3">SELECT cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+---------+</p>
<p class="calibre1">| cust_id |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       2 |</p>
<p class="calibre1">|       2 |</p>
<p class="calibre1">|       3 |</p>
<p class="calibre1">|       3 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       5 |</p>
<p class="calibre1">|       6 |</p>
<p class="calibre1">|       6 |</p>
<p class="calibre1">|       7 |</p>
<p class="calibre1">|       8 |</p>
<p class="calibre1">|       8 |</p>
<p class="calibre1">|       9 |</p>
<p class="calibre1">|       9 |</p>
<p class="calibre1">|       9 |</p>
<p class="calibre1">|      10 |</p>
<p class="calibre1">|      10 |</p>
<p class="calibre1">|      11 |</p>
<p class="calibre1">|      12 |</p>
<p class="calibre1">|      13 |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">24 rows in set (0.00 sec)</p>
<p class="calibre1">Since some customers have more than one account, you will see the same customer ID</p>
<p class="calibre1">once for each account owned by that customer. What you probably want in this case is the  <i class="calibre4">distinct</i> set of customers that have accounts, instead of seeing the customer ID</p>
<p class="calibre1"><b class="calibre3">The select Clause | 47</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-29"></a><img src="images/000055.png" alt="Image 17" class="calibre2" /></p>
<p class="calibre1">for  each  row  in  the  account  table.  You  can  achieve  this  by  adding  the  keyword distinct directly after the select keyword, as demonstrated by the following: mysql&gt; <b class="calibre3">SELECT DISTINCT cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+---------+</p>
<p class="calibre1">| cust_id |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       2 |</p>
<p class="calibre1">|       3 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       5 |</p>
<p class="calibre1">|       6 |</p>
<p class="calibre1">|       7 |</p>
<p class="calibre1">|       8 |</p>
<p class="calibre1">|       9 |</p>
<p class="calibre1">|      10 |</p>
<p class="calibre1">|      11 |</p>
<p class="calibre1">|      12 |</p>
<p class="calibre1">|      13 |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">13 rows in set (0.01 sec)</p>
<p class="calibre1">The result set now contains 13 rows, one for each distinct customer, rather than 24</p>
<p class="calibre1">rows, one for each account. </p>
<p class="calibre1">If you do not want the server to remove duplicate data, or you are sure there will be no duplicates in your result set, you can specify the ALL keyword instead of specifying DISTINCT. However, the ALL keyword is the default and never needs to be explicitly named, so most programmers do not include ALL in their queries. </p>
<p class="calibre1">Keep in mind that generating a distinct set of results requires the data to be sorted, which can be time-consuming for large result sets. Don’t fall into the trap of using DISTINCT just to be sure there are no duplicates; instead, take the time to understand the data you are working with so that you will know whether duplicates are possible. </p>
<p class="calibre1"><b class="calibre3">The from Clause</b></p>
<p class="calibre1">Thus far, you have seen queries whose from clauses contain a single table. Although most SQL books will define the from clause as simply a list of one or more tables, I would like to broaden the definition as follows:</p>
<p class="calibre1"> <i class="calibre4">The</i> from  <i class="calibre4">clause defines the tables used by a query, along with the means of linking the</i> <i class="calibre4">tables together</i>. </p>
<p class="calibre1">This definition is composed of two separate but related concepts, which we explore in the following sections. </p>
<p class="calibre1"><b class="calibre3">48 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-30"></a><b class="calibre3">Tables</b></p>
<p class="calibre1">When confronted with the term  <i class="calibre4">table</i>, most people think of a set of related rows stored in a database. While this does describe one type of table, I would like to use the word in a more general way by removing any notion of how the data might be stored and concentrating on just the set of related rows. Three different types of tables meet this relaxed definition:</p>
<p class="calibre1">• Permanent tables (i.e., created using the create table statement)</p>
<p class="calibre1">• Temporary tables (i.e., rows returned by a subquery)</p>
<p class="calibre1">• Virtual tables (i.e., created using the create view statement) Each of these table types may be included in a query’s from clause. By now, you should be comfortable with including a permanent table in a from clause, so I briefly describe the other types of tables that can be referenced in a from clause. </p>
<p class="calibre1"><b class="calibre3">Subquery-generated tables</b></p>
<p class="calibre1">A subquery is a query contained within another query. Subqueries are surrounded by parentheses and can be found in various parts of a select statement; within the from clause, however, a subquery serves the role of generating a temporary table that is visible from all other query clauses and can interact with other tables named in the from clause. </p>
<p class="calibre1">Here’s a simple example:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.emp_id, e.fname, e.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM (SELECT emp_id, fname, lname, start_date, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee) e; </b></p>
<p class="calibre1">+--------+----------+-----------+</p>
<p class="calibre1">| emp_id | fname    | lname     |</p>
<p class="calibre1">+--------+----------+-----------+</p>
<p class="calibre1">|      1 | Michael  | Smith     |</p>
<p class="calibre1">|      2 | Susan    | Barker    |</p>
<p class="calibre1">|      3 | Robert   | Tyler     |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne |</p>
<p class="calibre1">|      5 | John     | Gooding   |</p>
<p class="calibre1">|      6 | Helen    | Fleming   |</p>
<p class="calibre1">|      7 | Chris    | Tucker    |</p>
<p class="calibre1">|      8 | Sarah    | Parker    |</p>
<p class="calibre1">|      9 | Jane     | Grossman  |</p>
<p class="calibre1">|     10 | Paula    | Roberts   |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   |</p>
<p class="calibre1">|     12 | Samantha | Jameson   |</p>
<p class="calibre1">|     13 | John     | Blake     |</p>
<p class="calibre1">|     14 | Cindy    | Mason     |</p>
<p class="calibre1">|     15 | Frank    | Portman   |</p>
<p class="calibre1">|     16 | Theresa  | Markham   |</p>
<p class="calibre1">|     17 | Beth     | Fowler    |</p>
<p class="calibre1">|     18 | Rick     | Tulman    |</p>
<p class="calibre1">+--------+----------+-----------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">The from Clause | 49</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-238"></a>In this example, a subquery against the employee table returns five columns, and the <i class="calibre4">containing query</i> references three of the five available columns. The subquery is referenced by the containing query via its alias, which, in this case, is e. This is a simplistic and not particularly useful example of a subquery in a from clause; you will find detailed</p>
<p class="calibre1"><a href="#calibre_link-88">coverage of subqueries in Chapter 9. </a></p>
<p class="calibre1"><b class="calibre3">Views</b></p>
<p class="calibre1">A view is a query that is stored in the data dictionary. It looks and acts like a table, but there is no data associated with a view (this is why I call it a  <i class="calibre4">virtual</i> table). When you issue a query against a view, your query is merged with the view definition to create a final query to be executed. </p>
<p class="calibre1">To demonstrate, here’s a view definition that queries the employee table and includes a call to a built-in function:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">CREATE VIEW employee_vw AS</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT emp_id, fname, lname, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">YEAR(start_date) start_year</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.10 sec)</p>
<p class="calibre1">When the view is created, no additional data is generated or stored: the server simply tucks away the select statement for future use. Now that the view exists, you can issue queries against it, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, start_year</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee_vw; </b></p>
<p class="calibre1">+--------+------------+</p>
<p class="calibre1">| emp_id | start_year |</p>
<p class="calibre1">+--------+------------+</p>
<p class="calibre1">|      1 |       2005 |</p>
<p class="calibre1">|      2 |       2006 |</p>
<p class="calibre1">|      3 |       2005 |</p>
<p class="calibre1">|      4 |       2006 |</p>
<p class="calibre1">|      5 |       2007 |</p>
<p class="calibre1">|      6 |       2008 |</p>
<p class="calibre1">|      7 |       2008 |</p>
<p class="calibre1">|      8 |       2006 |</p>
<p class="calibre1">|      9 |       2006 |</p>
<p class="calibre1">|     10 |       2006 |</p>
<p class="calibre1">|     11 |       2004 |</p>
<p class="calibre1">|     12 |       2007 |</p>
<p class="calibre1">|     13 |       2004 |</p>
<p class="calibre1">|     14 |       2006 |</p>
<p class="calibre1">|     15 |       2007 |</p>
<p class="calibre1">|     16 |       2005 |</p>
<p class="calibre1">|     17 |       2006 |</p>
<p class="calibre1">|     18 |       2006 |</p>
<p class="calibre1">+--------+------------+</p>
<p class="calibre1">18 rows in set (0.07 sec)</p>
<p class="calibre1"><b class="calibre3">50 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-31"></a>Views are created for various reasons, including to hide columns from users and to simplify complex database designs. </p>
<p class="calibre1"><b class="calibre3">Table Links</b></p>
<p class="calibre1">The second deviation from the simple from clause definition is the mandate that if more than one table appears in the from clause, the conditions used to  <i class="calibre4">link</i> the tables must be included as well. This is not a requirement of MySQL or any other database server, but it is the ANSI-approved method of joining multiple tables, and it is the most portable across the various database servers. We explore joining multiple tables in depth in <a href="#calibre_link-48">Chapters 5 </a><a href="#calibre_link-100">and 10, </a>but here’s a simple example in case I have piqued your curiosity: mysql&gt; <b class="calibre3">SELECT employee.emp_id, employee.fname, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">employee.lname, department.name dept_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee INNER JOIN department</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON employee.dept_id = department.dept_id; </b></p>
<p class="calibre1">+--------+----------+-----------+----------------+</p>
<p class="calibre1">| emp_id | fname    | lname     | dept_name      |</p>
<p class="calibre1">+--------+----------+-----------+----------------+</p>
<p class="calibre1">|      1 | Michael  | Smith     | Administration |</p>
<p class="calibre1">|      2 | Susan    | Barker    | Administration |</p>
<p class="calibre1">|      3 | Robert   | Tyler     | Administration |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne | Operations     |</p>
<p class="calibre1">|      5 | John     | Gooding   | Loans          |</p>
<p class="calibre1">|      6 | Helen    | Fleming   | Operations     |</p>
<p class="calibre1">|      7 | Chris    | Tucker    | Operations     |</p>
<p class="calibre1">|      8 | Sarah    | Parker    | Operations     |</p>
<p class="calibre1">|      9 | Jane     | Grossman  | Operations     |</p>
<p class="calibre1">|     10 | Paula    | Roberts   | Operations     |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   | Operations     |</p>
<p class="calibre1">|     12 | Samantha | Jameson   | Operations     |</p>
<p class="calibre1">|     13 | John     | Blake     | Operations     |</p>
<p class="calibre1">|     14 | Cindy    | Mason     | Operations     |</p>
<p class="calibre1">|     15 | Frank    | Portman   | Operations     |</p>
<p class="calibre1">|     16 | Theresa  | Markham   | Operations     |</p>
<p class="calibre1">|     17 | Beth     | Fowler    | Operations     |</p>
<p class="calibre1">|     18 | Rick     | Tulman    | Operations     |</p>
<p class="calibre1">+--------+----------+-----------+----------------+</p>
<p class="calibre1">18 rows in set (0.05 sec)</p>
<p class="calibre1">The previous query displays data from both the employee table (emp_id, fname, lname) and the department table (name), so both tables are included in the from clause. The mechanism for linking the two tables (referred to as a  <i class="calibre4">join</i>) is the employee’s department affiliation stored in the employee table. Thus, the database server is instructed to use the value of the dept_id column in the employee table to look up the associated department name in the department table. Join conditions for two tables are found in the on subclause of the from clause; in this case, the join condition is ON employee.dept_id =</p>
<p class="calibre1">department.dept_id. Again, please refer <a href="#calibre_link-48">to Chapter 5 </a>for a thorough discussion of joining multiple tables. </p>
<p class="calibre1"><b class="calibre3">The from Clause | 51</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-32"></a><b class="calibre3">Defining Table Aliases</b></p>
<p class="calibre1">When multiple tables are joined in a single query, you need a way to identify which table you are referring to when you reference columns in the select, where, group by, having, and order by clauses. You have two choices when referencing a table outside the from clause:</p>
<p class="calibre1">• Use the entire table name, such as employee.emp_id. </p>
<p class="calibre1">• Assign each table an  <i class="calibre4">alias</i> and use the alias throughout the query. </p>
<p class="calibre1">In the previous query, I chose to use the entire table name in the select and on clauses. </p>
<p class="calibre1">Here’s what the same query looks like using table aliases:</p>
<p class="calibre1">SELECT e.emp_id, e.fname, e.lname, </p>
<p class="calibre1">d.name dept_name</p>
<p class="calibre1">FROM employee e INNER JOIN department d</p>
<p class="calibre1">ON e.dept_id = d.dept_id; </p>
<p class="calibre1">If you look closely at the from clause, you will see that the employee table is assigned the alias e, and the department table is assigned the alias d. These aliases are then used in the on clause when defining the join condition as well as in the select clause when specifying the columns to include in the result set. I hope you will agree that using aliases makes for a more compact statement without causing confusion (as long as your choices for alias names are reasonable). Additionally, you may use the as keyword with your table aliases, similar to what was demonstrated earlier for column aliases: SELECT e.emp_id, e.fname, e.lname, </p>
<p class="calibre1">d.name dept_name</p>
<p class="calibre1">FROM employee <b class="calibre3">AS</b> e INNER JOIN department <b class="calibre3">AS</b> d</p>
<p class="calibre1">ON e.dept_id = d.dept_id; </p>
<p class="calibre1">I have found that roughly half of the database developers I have worked with use the as keyword with their column and table aliases, and half do not. </p>
<p class="calibre1"><b class="calibre3">The where Clause</b></p>
<p class="calibre1">The queries shown thus far in the chapter have selected every row from the employee, department, or account table (except for the demonstration of distinct earlier in the chapter). Most of the time, however, you will not wish to retrieve  <i class="calibre4">every</i> row from a table but will want a way to filter out those rows that are not of interest. This is a job for the where clause. </p>
<p class="calibre1"> <i class="calibre4">The</i> where  <i class="calibre4">clause is the mechanism for filtering out unwanted rows from your result set</i>. </p>
<p class="calibre1">For example, perhaps you are interested in retrieving data from the employee table, but only for those employees who are employed as head tellers. The following query employs a where clause to retrieve  <i class="calibre4">only</i> the four head tellers: <b class="calibre3">52 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-288"></a>mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE title = 'Head Teller'; </b></p>
<p class="calibre1">+--------+---------+---------+------------+-------------+</p>
<p class="calibre1">| emp_id | fname   | lname   | start_date | title       |</p>
<p class="calibre1">+--------+---------+---------+------------+-------------+</p>
<p class="calibre1">|      6 | Helen   | Fleming | 2008-03-17 | Head Teller |</p>
<p class="calibre1">|     10 | Paula   | Roberts | 2006-07-27 | Head Teller |</p>
<p class="calibre1">|     13 | John    | Blake   | 2004-05-11 | Head Teller |</p>
<p class="calibre1">|     16 | Theresa | Markham | 2005-03-15 | Head Teller |</p>
<p class="calibre1">+--------+---------+---------+------------+-------------+</p>
<p class="calibre1">4 rows in set (1.17 sec)</p>
<p class="calibre1">In this case the where clause filtered out 14 of the 18 employee rows. This where clause contains a single  <i class="calibre4">filter condition</i>, but you can include as many conditions as required; individual conditions are separated using operators such as and, or, and not <a href="#calibre_link-39">(see Chap-</a></p>
<p class="calibre1"><a href="#calibre_link-39">ter 4 </a>for a complete discussion of the where clause and filter conditions). Here’s an extension of the previous query that includes a second condition stating that only those employees with a start date later than January 1, 2006 should be included: mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE title = 'Head Teller' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND start_date &gt; '2006-01-01'; </b></p>
<p class="calibre1">+--------+-------+---------+------------+-------------+</p>
<p class="calibre1">| emp_id | fname | lname   | start_date | title       |</p>
<p class="calibre1">+--------+-------+---------+------------+-------------+</p>
<p class="calibre1">|      6 | Helen | Fleming | 2008-03-17 | Head Teller |</p>
<p class="calibre1">|     10 | Paula | Roberts | 2006-07-27 | Head Teller |</p>
<p class="calibre1">+--------+-------+---------+------------+-------------+</p>
<p class="calibre1">2 rows in set (0.01 sec)</p>
<p class="calibre1">The first condition (title = 'Head Teller') filtered out 14 of 18 employee rows, and the second condition (start_date &gt; '2006-01-01') filtered out an additional 2 rows, leaving 2 rows in the final result set. Let’s see what would happen if you change the operator separating the two conditions from and to or:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE title = 'Head Teller' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">OR start_date &gt; '2006-01-01'; </b></p>
<p class="calibre1">+--------+----------+-----------+------------+--------------------+</p>
<p class="calibre1">| emp_id | fname    | lname     | start_date | title              |</p>
<p class="calibre1">+--------+----------+-----------+------------+--------------------+</p>
<p class="calibre1">|      2 | Susan    | Barker    | 2006-09-12 | Vice President     |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne | 2006-04-24 | Operations Manager |</p>
<p class="calibre1">|      5 | John     | Gooding   | 2007-11-14 | Loan Manager       |</p>
<p class="calibre1">|      6 | Helen    | Fleming   | 2008-03-17 | Head Teller        |</p>
<p class="calibre1">|      7 | Chris    | Tucker    | 2008-09-15 | Teller             |</p>
<p class="calibre1">|      8 | Sarah    | Parker    | 2006-12-02 | Teller             |</p>
<p class="calibre1">|      9 | Jane     | Grossman  | 2006-05-03 | Teller             |</p>
<p class="calibre1">|     10 | Paula    | Roberts   | 2006-07-27 | Head Teller        |</p>
<p class="calibre1">|     12 | Samantha | Jameson   | 2007-01-08 | Teller             |</p>
<p class="calibre1">|     13 | John     | Blake     | 2004-05-11 | Head Teller        |</p>
<p class="calibre1"><b class="calibre3">The where Clause | 53</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-33"></a>|     14 | Cindy    | Mason     | 2006-08-09 | Teller             |</p>
<p class="calibre1">|     15 | Frank    | Portman   | 2007-04-01 | Teller             |</p>
<p class="calibre1">|     16 | Theresa  | Markham   | 2005-03-15 | Head Teller        |</p>
<p class="calibre1">|     17 | Beth     | Fowler    | 2006-06-29 | Teller             |</p>
<p class="calibre1">|     18 | Rick     | Tulman    | 2006-12-12 | Teller             |</p>
<p class="calibre1">+--------+----------+-----------+------------+--------------------+</p>
<p class="calibre1">15 rows in set (0.00 sec)</p>
<p class="calibre1">Looking at the output, you can see that all four head tellers are included in the result set, along with any other employee who started working for the bank after January 1, 2006.  At  least  one  of  the  two  conditions  is  true  for  15  of  the  18  employees  in  the employee table. Thus, when you separate conditions using the and operator,  <i class="calibre4">all</i> conditions must evaluate to true to be included in the result set; when you use or, however, only  <i class="calibre4">one</i> of the conditions needs to evaluate to true for a row to be included. </p>
<p class="calibre1">So, what should you do if you need to use both and and or operators in your where clause? Glad you asked. You should use parentheses to group conditions together. The next query specifies that only those employees who are head tellers  <i class="calibre4">and</i> began working for the company after January 1, 2006  <i class="calibre4">or</i> those employees who are tellers  <i class="calibre4">and</i> began working after January 1, 2007 be included in the result set:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE (title = 'Head Teller' AND start_date &gt; '2006-01-01')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">OR (title = 'Teller' AND start_date &gt; '2007-01-01'); </b></p>
<p class="calibre1">+--------+----------+---------+------------+-------------+</p>
<p class="calibre1">| emp_id | fname    | lname   | start_date | title       |</p>
<p class="calibre1">+--------+----------+---------+------------+-------------+</p>
<p class="calibre1">|      6 | Helen    | Fleming | 2008-03-17 | Head Teller |</p>
<p class="calibre1">|      7 | Chris    | Tucker  | 2008-09-15 | Teller      |</p>
<p class="calibre1">|     10 | Paula    | Roberts | 2006-07-27 | Head Teller |</p>
<p class="calibre1">|     12 | Samantha | Jameson | 2007-01-08 | Teller      |</p>
<p class="calibre1">|     15 | Frank    | Portman | 2007-04-01 | Teller      |</p>
<p class="calibre1">+--------+----------+---------+------------+-------------+</p>
<p class="calibre1">5 rows in set (0.00 sec)</p>
<p class="calibre1">You should always use parentheses to separate groups of conditions when mixing different operators so that you, the database server, and anyone who comes along later to modify your code will be on the same page. </p>
<p class="calibre1"><b class="calibre3">The group by and having Clauses</b></p>
<p class="calibre1">All the queries thus far have retrieved raw data without any manipulation. Sometimes, however, you will want to find trends in your data that will require the database server to cook the data a bit before you retrieve your result set. One such mechanism is the group by clause, which is used to group data by column values. For example, rather than looking at a list of employees and the departments to which they are assigned, you might want to look at a list of departments along with the number of employees assigned to each department. When using the group by clause, you may also use the having <b class="calibre3">54 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-34"></a>clause, which allows you to filter group data in the same way the where clause lets you filter raw data. </p>
<p class="calibre1">Here’s a quick look at a query that counts all the employees in each department and returns the names of those departments having more than two employees: mysql&gt; <b class="calibre3">SELECT d.name, count(e.emp_id) num_employees</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM department d INNER JOIN employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON d.dept_id = e.dept_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY d.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">HAVING count(e.emp_id) &gt; 2; </b></p>
<p class="calibre1">+----------------+---------------+</p>
<p class="calibre1">| name           | num_employees |</p>
<p class="calibre1">+----------------+---------------+</p>
<p class="calibre1">| Administration |             3 |</p>
<p class="calibre1">| Operations     |            14 |</p>
<p class="calibre1">+----------------+---------------+</p>
<p class="calibre1">2 rows in set (0.00 sec)</p>
<p class="calibre1">I wanted to briefly mention these two clauses so that they don’t catch you by surprise later in the book, but they are a bit more advanced than the other four select clauses. </p>
<p class="calibre1">Therefore, I ask that you wait until <a href="#calibre_link-78">Chapter 8 </a>for a full description of how and when to use group by and having. </p>
<p class="calibre1"><b class="calibre3">The order by Clause</b></p>
<p class="calibre1">In general, the rows in a result set returned from a query are not in any particular order. </p>
<p class="calibre1">If you want your result set in a particular order, you will need to instruct the server to sort the results using the order by clause:</p>
<p class="calibre1"> <i class="calibre4">The</i> order by  <i class="calibre4">clause is the mechanism for sorting your result set using either raw column</i> <i class="calibre4">data or expressions based on column data</i>. </p>
<p class="calibre1">For example, here’s another look at an earlier query against the account table: mysql&gt; <b class="calibre3">SELECT open_emp_id, product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">| open_emp_id | product_cd |</p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">|          10 | CHK        |</p>
<p class="calibre1">|          10 | SAV        |</p>
<p class="calibre1">|          10 | CD         |</p>
<p class="calibre1">|          10 | CHK        |</p>
<p class="calibre1">|          10 | SAV        |</p>
<p class="calibre1">|          13 | CHK        |</p>
<p class="calibre1">|          13 | MM         |</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | SAV        |</p>
<p class="calibre1">|           1 | MM         |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | CD         |</p>
<p class="calibre1"><b class="calibre3">The order by Clause | 55</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-289"></a>|          10 | CD         |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | SAV        |</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | MM         |</p>
<p class="calibre1">|           1 | CD         |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | BUS        |</p>
<p class="calibre1">|          10 | BUS        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          13 | SBL        |</p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">24 rows in set (0.00 sec)</p>
<p class="calibre1">If you are trying to analyze data for each employee, it would be helpful to sort the results by the open_emp_id column; to do so, simply add this column to the order by clause: mysql&gt; <b class="calibre3">SELECT open_emp_id, product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY open_emp_id; </b></p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">| open_emp_id | product_cd |</p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | SAV        |</p>
<p class="calibre1">|           1 | MM         |</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | CD         |</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | MM         |</p>
<p class="calibre1">|           1 | CD         |</p>
<p class="calibre1">|          10 | CHK        |</p>
<p class="calibre1">|          10 | SAV        |</p>
<p class="calibre1">|          10 | CD         |</p>
<p class="calibre1">|          10 | CHK        |</p>
<p class="calibre1">|          10 | SAV        |</p>
<p class="calibre1">|          10 | CD         |</p>
<p class="calibre1">|          10 | BUS        |</p>
<p class="calibre1">|          13 | CHK        |</p>
<p class="calibre1">|          13 | MM         |</p>
<p class="calibre1">|          13 | SBL        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | SAV        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | BUS        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">24 rows in set (0.00 sec)</p>
<p class="calibre1">It is now easier to see what types of accounts each employee opened. However, it might be even better if you could ensure that the account types were shown in the same order for each distinct employee; you can accomplish this by adding the product_cd column after the open_emp_id column in the order by clause:</p>
<p class="calibre1"><b class="calibre3">56 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-35"></a>mysql&gt; <b class="calibre3">SELECT open_emp_id, product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY open_emp_id, product_cd; </b></p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">| open_emp_id | product_cd |</p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">|           1 | CD         |</p>
<p class="calibre1">|           1 | CD         |</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | CHK        |</p>
<p class="calibre1">|           1 | MM         |</p>
<p class="calibre1">|           1 | MM         |</p>
<p class="calibre1">|           1 | SAV        |</p>
<p class="calibre1">|          10 | BUS        |</p>
<p class="calibre1">|          10 | CD         |</p>
<p class="calibre1">|          10 | CD         |</p>
<p class="calibre1">|          10 | CHK        |</p>
<p class="calibre1">|          10 | CHK        |</p>
<p class="calibre1">|          10 | SAV        |</p>
<p class="calibre1">|          10 | SAV        |</p>
<p class="calibre1">|          13 | CHK        |</p>
<p class="calibre1">|          13 | MM         |</p>
<p class="calibre1">|          13 | SBL        |</p>
<p class="calibre1">|          16 | BUS        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | CHK        |</p>
<p class="calibre1">|          16 | SAV        |</p>
<p class="calibre1">+-------------+------------+</p>
<p class="calibre1">24 rows in set (0.00 sec)</p>
<p class="calibre1">The result set has now been sorted first by employee ID and then by account type. The order in which columns appear in your order by clause does make a difference. </p>
<p class="calibre1"><b class="calibre3">Ascending Versus Descending Sort Order</b></p>
<p class="calibre1">When sorting, you have the option of specifying  <i class="calibre4">ascending</i> or  <i class="calibre4">descending</i> order via the asc and desc keywords. The default is ascending, so you will need to add the  desc keyword, only if you want to use a descending sort. For example, the following query lists all accounts sorted by available balance with the highest balance listed at the top: mysql&gt; <b class="calibre3">SELECT account_id, product_cd, open_date, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY avail_balance DESC; </b></p>
<p class="calibre1">+------------+------------+------------+---------------+</p>
<p class="calibre1">| account_id | product_cd | open_date  | avail_balance |</p>
<p class="calibre1">+------------+------------+------------+---------------+</p>
<p class="calibre1">|         29 | SBL        | 2004-02-22 |      50000.00 |</p>
<p class="calibre1">|         28 | CHK        | 2003-07-30 |      38552.05 |</p>
<p class="calibre1">|         24 | CHK        | 2002-09-30 |      23575.12 |</p>
<p class="calibre1">|         15 | CD         | 2004-12-28 |      10000.00 |</p>
<p class="calibre1">|         27 | BUS        | 2004-03-22 |       9345.55 |</p>
<p class="calibre1"><b class="calibre3">The order by Clause | 57</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-36"></a>|         22 | MM         | 2004-10-28 |       9345.55 |</p>
<p class="calibre1">|         12 | MM         | 2004-09-30 |       5487.09 |</p>
<p class="calibre1">|         17 | CD         | 2004-01-12 |       5000.00 |</p>
<p class="calibre1">|         18 | CHK        | 2001-05-23 |       3487.19 |</p>
<p class="calibre1">|          3 | CD         | 2004-06-30 |       3000.00 |</p>
<p class="calibre1">|          4 | CHK        | 2001-03-12 |       2258.02 |</p>
<p class="calibre1">|         13 | CHK        | 2004-01-27 |       2237.97 |</p>
<p class="calibre1">|          8 | MM         | 2002-12-15 |       2212.50 |</p>
<p class="calibre1">|         23 | CD         | 2004-06-30 |       1500.00 |</p>
<p class="calibre1">|          1 | CHK        | 2000-01-15 |       1057.75 |</p>
<p class="calibre1">|          7 | CHK        | 2002-11-23 |       1057.75 |</p>
<p class="calibre1">|         11 | SAV        | 2000-01-15 |        767.77 |</p>
<p class="calibre1">|         10 | CHK        | 2003-09-12 |        534.12 |</p>
<p class="calibre1">|          2 | SAV        | 2000-01-15 |        500.00 |</p>
<p class="calibre1">|         19 | SAV        | 2001-05-23 |        387.99 |</p>
<p class="calibre1">|          5 | SAV        | 2001-03-12 |        200.00 |</p>
<p class="calibre1">|         21 | CHK        | 2003-07-30 |        125.67 |</p>
<p class="calibre1">|         14 | CHK        | 2002-08-24 |        122.37 |</p>
<p class="calibre1">|         25 | BUS        | 2002-10-01 |          0.00 |</p>
<p class="calibre1">+------------+------------+------------+---------------+</p>
<p class="calibre1">24 rows in set (0.05 sec)</p>
<p class="calibre1">Descending sorts are commonly used for ranking queries, such as “show me the top five account balances.” MySQL includes a limit clause that allows you to sort your data and then discard all but the first  <i class="calibre4">X</i> rows; see <a href="#calibre_link-151">Appendix B </a>for a discussion of the limit clause, along with other non-ANSI extensions. </p>
<p class="calibre1"><b class="calibre3">Sorting via Expressions</b></p>
<p class="calibre1">Sorting your results using column data is all well and good, but sometimes you might need to sort by something that is not stored in the database, and possibly doesn’t appear anywhere in your query. You can add an expression to your order by clause to handle such situations. For example, perhaps you would like to sort your customer data by the last three digits of the customer’s federal ID number (which is either a Social Security number for individuals or a corporate ID for businesses):</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id, cust_type_cd, city, state, fed_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY RIGHT(fed_id, 3); </b></p>
<p class="calibre1">+---------+--------------+------------+-------+-------------+</p>
<p class="calibre1">| cust_id | cust_type_cd | city       | state | fed_id      |</p>
<p class="calibre1">+---------+--------------+------------+-------+-------------+</p>
<p class="calibre1">|       1 | I            | Lynnfield  | MA    | 111-11-1111 |</p>
<p class="calibre1">|      10 | B            | Salem      | NH    | 04-1111111  |</p>
<p class="calibre1">|       2 | I            | Woburn     | MA    | 222-22-2222 |</p>
<p class="calibre1">|      11 | B            | Wilmington | MA    | 04-2222222  |</p>
<p class="calibre1">|       3 | I            | Quincy     | MA    | 333-33-3333 |</p>
<p class="calibre1">|      12 | B            | Salem      | NH    | 04-3333333  |</p>
<p class="calibre1">|      13 | B            | Quincy     | MA    | 04-4444444  |</p>
<p class="calibre1">|       4 | I            | Waltham    | MA    | 444-44-4444 |</p>
<p class="calibre1">|       5 | I            | Salem      | NH    | 555-55-5555 |</p>
<p class="calibre1">|       6 | I            | Waltham    | MA    | 666-66-6666 |</p>
<p class="calibre1">|       7 | I            | Wilmington | MA    | 777-77-7777 |</p>
<p class="calibre1"><b class="calibre3">58 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-37"></a>|       8 | I            | Salem      | NH    | 888-88-8888 |</p>
<p class="calibre1">|       9 | I            | Newton     | MA    | 999-99-9999 |</p>
<p class="calibre1">+---------+--------------+------------+-------+-------------+</p>
<p class="calibre1">13 rows in set (0.24 sec)</p>
<p class="calibre1">This query uses the built-in function right() to extract the last three characters of the fed_id column and then sorts the rows based on this value. </p>
<p class="calibre1"><b class="calibre3">Sorting via Numeric Placeholders</b></p>
<p class="calibre1">If you are sorting using the columns in your select clause, you can opt to reference the columns by their  <i class="calibre4">position</i> in the select clause rather than by name. For example, if you want to sort using the second and fifth columns returned by a query, you could do the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, title, start_date, fname, lnam</b>e</p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 2, 5; </b></p>
<p class="calibre1">+--------+--------------------+------------+----------+-----------+</p>
<p class="calibre1">| emp_id | title              | start_date | fname    | lname     |</p>
<p class="calibre1">+--------+--------------------+------------+----------+-----------+</p>
<p class="calibre1">|     13 | Head Teller        | 2004-05-11 | John     | Blake     |</p>
<p class="calibre1">|      6 | Head Teller        | 2008-03-17 | Helen    | Fleming   |</p>
<p class="calibre1">|     16 | Head Teller        | 2005-03-15 | Theresa  | Markham   |</p>
<p class="calibre1">|     10 | Head Teller        | 2006-07-27 | Paula    | Roberts   |</p>
<p class="calibre1">|      5 | Loan Manager       | 2007-11-14 | John     | Gooding   |</p>
<p class="calibre1">|      4 | Operations Manager | 2006-04-24 | Susan    | Hawthorne |</p>
<p class="calibre1">|      1 | President          | 2005-06-22 | Michael  | Smith     |</p>
<p class="calibre1">|     17 | Teller             | 2006-06-29 | Beth     | Fowler    |</p>
<p class="calibre1">|      9 | Teller             | 2006-05-03 | Jane     | Grossman  |</p>
<p class="calibre1">|     12 | Teller             | 2007-01-08 | Samantha | Jameson   |</p>
<p class="calibre1">|     14 | Teller             | 2006-08-09 | Cindy    | Mason     |</p>
<p class="calibre1">|      8 | Teller             | 2006-12-02 | Sarah    | Parker    |</p>
<p class="calibre1">|     15 | Teller             | 2007-04-01 | Frank    | Portman   |</p>
<p class="calibre1">|      7 | Teller             | 2008-09-15 | Chris    | Tucker    |</p>
<p class="calibre1">|     18 | Teller             | 2006-12-12 | Rick     | Tulman    |</p>
<p class="calibre1">|     11 | Teller             | 2004-10-23 | Thomas   | Ziegler   |</p>
<p class="calibre1">|      3 | Treasurer          | 2005-02-09 | Robert   | Tyler     |</p>
<p class="calibre1">|      2 | Vice President     | 2006-09-12 | Susan    | Barker    |</p>
<p class="calibre1">+--------+--------------------+------------+----------+-----------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1">You might want to use this feature sparingly, since adding a column to the select clause without changing the numbers in the order by clause can lead to unexpected results. </p>
<p class="calibre1">Personally, I may reference columns positionally when writing ad hoc queries, but I always reference columns by name when writing code. </p>
<p class="calibre1"><b class="calibre3">The order by Clause | 59</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-38"></a><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">The following exercises are designed to strengthen your understanding of the select</p>
<p class="calibre1"><a href="#calibre_link-152">statement and its various clauses. Please see Appendix C for solutions. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 3-1</b></p>
<p class="calibre1">Retrieve the employee ID, first name, and last name for all bank employees. Sort by last name and then by first name. </p>
<p class="calibre1"><b class="calibre3">Exercise 3-2</b></p>
<p class="calibre1">Retrieve the account ID, customer ID, and available balance for all accounts whose status equals 'ACTIVE' and whose available balance is greater than $2,500. </p>
<p class="calibre1"><b class="calibre3">Exercise 3-3</b></p>
<p class="calibre1">Write a query against the account table that returns the IDs of the employees who opened the accounts (use the account.open_emp_id column). Include a single row for each distinct employee. </p>
<p class="calibre1"><b class="calibre3">Exercise 3-4</b></p>
<p class="calibre1">Fill in the blanks (denoted by &lt;  <i class="calibre4">#</i>&gt;) for this multi-data-set query to achieve the results shown here:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT p.product_cd, a.cust_id, a.avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product p INNER JOIN account &lt;1&gt; </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON p.product_cd = &lt;2&gt; </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.&lt;3&gt; = 'ACCOUNT' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY &lt;4&gt;, &lt;5&gt;; </b></p>
<p class="calibre1">+------------+---------+---------------+</p>
<p class="calibre1">| product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+---------+---------------+</p>
<p class="calibre1">| CD         |       1 |       3000.00 |</p>
<p class="calibre1">| CD         |       6 |      10000.00 |</p>
<p class="calibre1">| CD         |       7 |       5000.00 |</p>
<p class="calibre1">| CD         |       9 |       1500.00 |</p>
<p class="calibre1">| CHK        |       1 |       1057.75 |</p>
<p class="calibre1">| CHK        |       2 |       2258.02 |</p>
<p class="calibre1">| CHK        |       3 |       1057.75 |</p>
<p class="calibre1">| CHK        |       4 |        534.12 |</p>
<p class="calibre1">| CHK        |       5 |       2237.97 |</p>
<p class="calibre1">| CHK        |       6 |        122.37 |</p>
<p class="calibre1">| CHK        |       8 |       3487.19 |</p>
<p class="calibre1">| CHK        |       9 |        125.67 |</p>
<p class="calibre1">| CHK        |      10 |      23575.12 |</p>
<p class="calibre1">| CHK        |      12 |      38552.05 |</p>
<p class="calibre1">| MM         |       3 |       2212.50 |</p>
<p class="calibre1"><b class="calibre3">60 | Chapter 3:</b> <b class="calibre3">Query Primer</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-290"></a>| MM         |       4 |       5487.09 |</p>
<p class="calibre1">| MM         |       9 |       9345.55 |</p>
<p class="calibre1">| SAV        |       1 |        500.00 |</p>
<p class="calibre1">| SAV        |       2 |        200.00 |</p>
<p class="calibre1">| SAV        |       4 |        767.77 |</p>
<p class="calibre1">| SAV        |       8 |        387.99 |</p>
<p class="calibre1">+------------+---------+---------------+</p>
<p class="calibre1">21 rows in set (0.09 sec)</p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 61</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-291"></a>D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-39"></a><b class="calibre3">CHAPTER 4</b></p>
<p class="calibre1"><b class="calibre3">Filtering</b></p>
<p class="calibre1">Sometimes you will want to work with every row in a table, such as:</p>
<p class="calibre1">• Purging all data from a table used to stage new data warehouse feeds</p>
<p class="calibre1">• Modifying all rows in a table after a new column has been added</p>
<p class="calibre1">• Retrieving all rows from a message queue table</p>
<p class="calibre1">In cases like these, your SQL statements won’t need to have a where clause, since you don’t need to exclude any rows from consideration. Most of the time, however, you will want to narrow your focus to a subset of a table’s rows. Therefore, all the SQL data statements (except the insert statement) include an optional where clause to house <i class="calibre4">filter conditions</i> used to restrict the number of rows acted on by the SQL statement. </p>
<p class="calibre1">Additionally, the select statement includes a having clause in which filter conditions pertaining to grouped data may be included. This chapter explores the various types of filter conditions that you can employ in the where clauses of select, update, and delete  statements;  we  explore  the  use  of  filter  conditions  in  the  having  clause  of  a select<a href="#calibre_link-78"> statement in Chapter 8. </a></p>
<p class="calibre1"><b class="calibre3">Condition Evaluation</b></p>
<p class="calibre1">A where clause may contain one or more  <i class="calibre4">conditions</i>, separated by the operators and and or. If multiple conditions are separated only by the and operator, then all the conditions must evaluate to true for the row to be included in the result set. Consider the following where clause:</p>
<p class="calibre1">WHERE title = 'Teller' AND start_date &lt; '2007-01-01' </p>
<p class="calibre1">Given these two conditions, only tellers who began working for the bank prior to 2007</p>
<p class="calibre1">will be included (or, to look at it another way, any employee who is either not a teller or began working for the bank in 2007 or later will be removed from consideration). </p>
<p class="calibre1">Although this example uses only two conditions, no matter how many conditions are in your where clause, if they are separated by the and operator they must  <i class="calibre4">all</i> evaluate to true for the row to be included in the result set. </p>
<p class="calibre1"><b class="calibre3">63</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-40"></a>If all conditions in the where clause are separated by the or operator, however, only <i class="calibre4">one</i> of the conditions must evaluate to true for the row to be included in the result set. </p>
<p class="calibre1">Consider the following two conditions:</p>
<p class="calibre1">WHERE title = 'Teller' OR start_date &lt; '2007-01-01' </p>
<p class="calibre1">There are now various ways for a given employee row to be included in the result set:</p>
<p class="calibre1">• The employee is a teller and was employed prior to 2007. </p>
<p class="calibre1">• The employee is a teller and was employed after January 1, 2007. </p>
<p class="calibre1">• The employee is something other than a teller but was employed prior to 2007. </p>
<p class="calibre1"><a href="#calibre_link-40">Table 4-1 </a>shows the possible outcomes for a where clause containing two conditions separated by the or operator. </p>
<p class="calibre1"> <i class="calibre4">Table 4-1. Two-condition evaluation using or</i></p>
<p class="calibre1"><b class="calibre3">Intermediate result</b></p>
<p class="calibre1"><b class="calibre3">Final result</b></p>
<p class="calibre1">WHERE true OR true</p>
<p class="calibre1">True</p>
<p class="calibre1">WHERE true OR false</p>
<p class="calibre1">True</p>
<p class="calibre1">WHERE false OR true</p>
<p class="calibre1">True</p>
<p class="calibre1">WHERE false OR false</p>
<p class="calibre1">False</p>
<p class="calibre1">In the case of the preceding example, the only way for a row to be excluded from the result set is if the employee is not a teller and was employed on or after January 1, 2007. </p>
<p class="calibre1"><b class="calibre3">Using Parentheses</b></p>
<p class="calibre1">If your where clause includes three or more conditions using both the and and or operators, you should use parentheses to make your intent clear, both to the database server and to anyone else reading your code. Here’s a where clause that extends the previous example by checking to make sure that the employee is still employed by the bank: WHERE end_date IS NULL</p>
<p class="calibre1">AND (title = 'Teller' OR start_date &lt; '2007-01-01')</p>
<p class="calibre1">There are now three conditions; for a row to make it to the final result set, the first condition must evaluate to true, and either the second  <i class="calibre4">or</i> third condition (or both) must evaluate to true<a href="#calibre_link-40">. Table 4-2 shows the possible outcomes for this </a>where clause. </p>
<p class="calibre1"> <i class="calibre4">Table 4-2. Three-condition evaluation using and, or</i></p>
<p class="calibre1"><b class="calibre3">Intermediate result</b></p>
<p class="calibre1"><b class="calibre3">Final result</b></p>
<p class="calibre1">WHERE true AND (true OR true)</p>
<p class="calibre1">True</p>
<p class="calibre1">WHERE true AND (true OR false)</p>
<p class="calibre1">True</p>
<p class="calibre1">WHERE true AND (false OR true)</p>
<p class="calibre1">True</p>
<p class="calibre1">WHERE true AND (false OR false)</p>
<p class="calibre1">False</p>
<p class="calibre1"><b class="calibre3">64 | Chapter 4:</b> <b class="calibre3">Filtering</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-41"></a><b class="calibre3">Intermediate result</b></p>
<p class="calibre1"><b class="calibre3">Final result</b></p>
<p class="calibre1">WHERE false AND (true OR true)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE false AND (true OR false)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE false AND (false OR true)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE false AND (false OR false)</p>
<p class="calibre1">False</p>
<p class="calibre1">As you can see, the more conditions you have in your where clause, the more combinations there are for the server to evaluate. In this case, only three of the eight combinations yield a final result of true. </p>
<p class="calibre1"><b class="calibre3">Using the not Operator</b></p>
<p class="calibre1">Hopefully, the previous three-condition example is fairly easy to understand. Consider the following modification, however:</p>
<p class="calibre1">WHERE end_date IS NULL</p>
<p class="calibre1">AND <b class="calibre3">NOT</b> (title = 'Teller' OR start_date &lt; '2007-01-01') Did you spot the change from the previous example? I added the not operator after the and operator on the second line. Now, instead of looking for nonterminated employees who either are tellers or began working for the bank prior to 2007, I am looking for nonterminated employees who both are nontellers and began working for the bank in</p>
<p class="calibre1"><a href="#calibre_link-41">2007 or later. Table 4-3 shows the possible outcomes for this example. </a></p>
<p class="calibre1"> <i class="calibre4">Table 4-3. Three-condition evaluation using and, or, and not</i> <b class="calibre3">Intermediate result</b></p>
<p class="calibre1"><b class="calibre3">Final result</b></p>
<p class="calibre1">WHERE true AND NOT (true OR true)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE true AND NOT (true OR false)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE true AND NOT (false OR true)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE true AND NOT (false OR false)</p>
<p class="calibre1">True</p>
<p class="calibre1">WHERE false AND NOT (true OR true)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE false AND NOT (true OR false)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE false AND NOT (false OR true)</p>
<p class="calibre1">False</p>
<p class="calibre1">WHERE false AND NOT (false OR false)</p>
<p class="calibre1">False</p>
<p class="calibre1">While it is easy for the database server to handle, it is typically difficult for a person to evaluate a where clause that includes the not operator, which is why you won’t encounter it very often. In this case, you can rewrite the where clause to avoid using the not operator:</p>
<p class="calibre1">WHERE end_date IS NULL</p>
<p class="calibre1">AND title != 'Teller' AND start_date &gt;= '2007-01-01' </p>
<p class="calibre1"><b class="calibre3">Condition Evaluation | 65</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-42"></a>While I’m sure that the server doesn’t have a preference, you probably have an easier time understanding this version of the where clause. </p>
<p class="calibre1"><b class="calibre3">Building a Condition</b></p>
<p class="calibre1">Now that you have seen how the server evaluates multiple conditions, let’s take a step back and look at what comprises a single condition. A condition is made up of one or more  <i class="calibre4">expressions</i> coupled with one or more  <i class="calibre4">operators</i>. An expression can be any of the following:</p>
<p class="calibre1">• A number</p>
<p class="calibre1">• A column in a table or view</p>
<p class="calibre1">• A string literal, such as 'Teller' </p>
<p class="calibre1">• A built-in function, such as concat('Learning', ' ', 'SQL')</p>
<p class="calibre1">• A subquery</p>
<p class="calibre1">• A list of expressions, such as ('Teller', 'Head Teller', 'Operations Manager') The operators used within conditions include:</p>
<p class="calibre1">• Comparison operators, such as =, !=, &lt;, &gt;, &lt;&gt;, LIKE, IN, and BETWEEN</p>
<p class="calibre1">• Arithmetic operators, such as +, −, *, and /</p>
<p class="calibre1">The following section demonstrates how you can combine these expressions and operators to manufacture the various types of conditions. </p>
<p class="calibre1"><b class="calibre3">Condition Types</b></p>
<p class="calibre1">There are many different ways to filter out unwanted data. You can look for specific values, sets of values, or ranges of values to include or exclude, or you can use various pattern-searching techniques to look for partial matches when dealing with string data. </p>
<p class="calibre1">The next four subsections explore each of these condition types in detail. </p>
<p class="calibre1"><b class="calibre3">Equality Conditions</b></p>
<p class="calibre1">A large percentage of the filter conditions that you write or come across will be of the form '  <i class="calibre4">column</i> =  <i class="calibre4">expression</i>' as in:</p>
<p class="calibre1">title = 'Teller' </p>
<p class="calibre1">fed_id = '111-11-1111' </p>
<p class="calibre1">amount = 375.25</p>
<p class="calibre1">dept_id = (SELECT dept_id FROM department WHERE name = 'Loans') Conditions such as these are called  <i class="calibre4">equality conditions</i> because they equate one expression to another. The first three examples equate a column to a literal (two strings and a number), and the fourth example equates a column to the value returned from <b class="calibre3">66 | Chapter 4:</b> <b class="calibre3">Filtering</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-170"></a>a subquery. The following query uses two equality conditions; one in the on clause (a join condition), and the other in the where clause (a filter condition): mysql&gt; <b class="calibre3">SELECT pt.name product_type, p.name product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product p INNER JOIN product_type pt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON p.product_type_cd = pt.product_type_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE pt.name = 'Customer Accounts'; </b></p>
<p class="calibre1">+-------------------+------------------------+</p>
<p class="calibre1">| product_type      | product                |</p>
<p class="calibre1">+-------------------+------------------------+</p>
<p class="calibre1">| Customer Accounts | certificate of deposit |</p>
<p class="calibre1">| Customer Accounts | checking account       |</p>
<p class="calibre1">| Customer Accounts | money market account   |</p>
<p class="calibre1">| Customer Accounts | savings account        |</p>
<p class="calibre1">+-------------------+------------------------+</p>
<p class="calibre1">4 rows in set (0.08 sec)</p>
<p class="calibre1">This query shows all products that are  <i class="calibre4">customer account</i> types. </p>
<p class="calibre1"><b class="calibre3">Inequality conditions</b></p>
<p class="calibre1">Another fairly common type of condition is the  <i class="calibre4">inequality condition</i>, which asserts that two expressions are  <i class="calibre4">not</i> equal. Here’s the previous query with the filter condition in the where clause changed to an inequality condition:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT pt.name product_type, p.name product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product p INNER JOIN product_type pt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON p.product_type_cd = pt.product_type_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE pt.name &lt;&gt; 'Customer Accounts'; </b></p>
<p class="calibre1">+-------------------------------+-------------------------+</p>
<p class="calibre1">| product_type                  | product                 |</p>
<p class="calibre1">+-------------------------------+-------------------------+</p>
<p class="calibre1">| Individual and Business Loans | auto loan               |</p>
<p class="calibre1">| Individual and Business Loans | business line of credit |</p>
<p class="calibre1">| Individual and Business Loans | home mortgage           |</p>
<p class="calibre1">| Individual and Business Loans | small business loan     |</p>
<p class="calibre1">+-------------------------------+-------------------------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">This query shows all products that are  <i class="calibre4">not</i> customer account types. When building inequality conditions, you may choose to use either the != or &lt;&gt; operator. </p>
<p class="calibre1"><b class="calibre3">Data modification using equality conditions</b></p>
<p class="calibre1">Equality/inequality conditions are commonly used when modifying data. For example, let’s say that the bank has a policy of removing old account rows once per year. Your task is to remove rows from the account table that were closed in 2002. Here’s one way to tackle it:</p>
<p class="calibre1">DELETE FROM account</p>
<p class="calibre1">WHERE status = 'CLOSED' AND YEAR(close_date) = 2002; </p>
<p class="calibre1">This statement includes two equality conditions: one to find only closed accounts, and another to check for those accounts closed in 2002. </p>
<p class="calibre1"><b class="calibre3">Condition Types | 67</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-43"></a><img src="images/000056.png" alt="Image 18" class="calibre2" /></p>
<p class="calibre1">When crafting examples of delete and update statements, I try to write each statement such that no rows are modified. That way, when you execute  the  statements,  your  data  will  remain  unchanged,  and  your output from select statements will always match that shown in this book. </p>
<p class="calibre1">Since MySQL sessions are in auto-commit mode by default <a href="#calibre_link-119">(see Chap-</a></p>
<p class="calibre1"><a href="#calibre_link-119">ter 12</a>), you would not be able to roll back (undo) any changes made to the example data if one of my statements modified the data. You may, of course, do whatever you want with the example data, including wip-ing it clean and rerunning the scripts I have provided, but I try to leave it intact. </p>
<p class="calibre1"><b class="calibre3">Range Conditions</b></p>
<p class="calibre1">Along with checking that an expression is equal to (or not equal to) another expression, you can build conditions that check whether an expression falls within a certain range. </p>
<p class="calibre1">This type of condition is common when working with numeric or temporal data. Consider the following query:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE start_date &lt; '2007-01-01'; </b></p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1">| emp_id | fname   | lname     | start_date |</p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1">|      1 | Michael | Smith     | 2005-06-22 |</p>
<p class="calibre1">|      2 | Susan   | Barker    | 2006-09-12 |</p>
<p class="calibre1">|      3 | Robert  | Tyler     | 2005-02-09 |</p>
<p class="calibre1">|      4 | Susan   | Hawthorne | 2006-04-24 |</p>
<p class="calibre1">|      8 | Sarah   | Parker    | 2006-12-02 |</p>
<p class="calibre1">|      9 | Jane    | Grossman  | 2006-05-03 |</p>
<p class="calibre1">|     10 | Paula   | Roberts   | 2006-07-27 |</p>
<p class="calibre1">|     11 | Thomas  | Ziegler   | 2004-10-23 |</p>
<p class="calibre1">|     13 | John    | Blake     | 2004-05-11 |</p>
<p class="calibre1">|     14 | Cindy   | Mason     | 2006-08-09 |</p>
<p class="calibre1">|     16 | Theresa | Markham   | 2005-03-15 |</p>
<p class="calibre1">|     17 | Beth    | Fowler    | 2006-06-29 |</p>
<p class="calibre1">|     18 | Rick    | Tulman    | 2006-12-12 |</p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1">13 rows in set (0.15 sec)</p>
<p class="calibre1">This query finds all employees hired prior to 2007. Along with specifying an upper limit for the start date, you may also want to specify a lower range for the start date: mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE start_date &lt; '2007-01-01' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND start_date &gt;= '2005-01-01'; </b></p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1">| emp_id | fname   | lname     | start_date |</p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1"><b class="calibre3">68 | Chapter 4:</b> <b class="calibre3">Filtering</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-182"></a>|      1 | Michael | Smith     | 2005-06-22 |</p>
<p class="calibre1">|      2 | Susan   | Barker    | 2006-09-12 |</p>
<p class="calibre1">|      3 | Robert  | Tyler     | 2005-02-09 |</p>
<p class="calibre1">|      4 | Susan   | Hawthorne | 2006-04-24 |</p>
<p class="calibre1">|      8 | Sarah   | Parker    | 2006-12-02 |</p>
<p class="calibre1">|      9 | Jane    | Grossman  | 2006-05-03 |</p>
<p class="calibre1">|     10 | Paula   | Roberts   | 2006-07-27 |</p>
<p class="calibre1">|     14 | Cindy   | Mason     | 2006-08-09 |</p>
<p class="calibre1">|     16 | Theresa | Markham   | 2005-03-15 |</p>
<p class="calibre1">|     17 | Beth    | Fowler    | 2006-06-29 |</p>
<p class="calibre1">|     18 | Rick    | Tulman    | 2006-12-12 |</p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1">11 rows in set (0.00 sec)</p>
<p class="calibre1">This version of the query retrieves all employees hired in 2005 or 2006. </p>
<p class="calibre1"><b class="calibre3">The between operator</b></p>
<p class="calibre1">When you have  <i class="calibre4">both</i> an upper and lower limit for your range, you may choose to use a single condition that utilizes the between operator rather than using two separate conditions, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE start_date BETWEEN '2005-01-01' AND '2007-01-01'; </b></p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1">| emp_id | fname   | lname     | start_date |</p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1">|      1 | Michael | Smith     | 2005-06-22 |</p>
<p class="calibre1">|      2 | Susan   | Barker    | 2006-09-12 |</p>
<p class="calibre1">|      3 | Robert  | Tyler     | 2005-02-09 |</p>
<p class="calibre1">|      4 | Susan   | Hawthorne | 2006-04-24 |</p>
<p class="calibre1">|      8 | Sarah   | Parker    | 2006-12-02 |</p>
<p class="calibre1">|      9 | Jane    | Grossman  | 2006-05-03 |</p>
<p class="calibre1">|     10 | Paula   | Roberts   | 2006-07-27 |</p>
<p class="calibre1">|     14 | Cindy   | Mason     | 2006-08-09 |</p>
<p class="calibre1">|     16 | Theresa | Markham   | 2005-03-15 |</p>
<p class="calibre1">|     17 | Beth    | Fowler    | 2006-06-29 |</p>
<p class="calibre1">|     18 | Rick    | Tulman    | 2006-12-12 |</p>
<p class="calibre1">+--------+---------+-----------+------------+</p>
<p class="calibre1">11 rows in set (0.03 sec)</p>
<p class="calibre1">When using the between operator, there are a couple of things to keep in mind. You should always specify the lower limit of the range first (after between) and the upper limit of the range second (after and). Here’s what happens if you mistakenly specify the upper limit first:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE start_date BETWEEN '2007-01-01' AND '2005-01-01';</b> Empty set (0.00 sec)</p>
<p class="calibre1">As you can see, no data is returned. This is because the server is, in effect, generating two conditions from your single condition using the &lt;= and &gt;= operators, as in: <b class="calibre3">Condition Types | 69</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-224"></a>mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE start_date &gt;= '2007-01-01' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND start_date &lt;= '2005-01-01'; </b></p>
<p class="calibre1">Empty set (0.00 sec)</p>
<p class="calibre1">Since it is impossible to have a date that is  <i class="calibre4">both</i> greater than January 1, 2007 and less than January 1, 2005, the query returns an empty set. This brings me to the second pitfall when using between, which is to remember that your upper and lower limits are <i class="calibre4">inclusive</i>, meaning that the values you provide are included in the range limits. In this case, I want to specify 2005-01-01 as the lower end of the range and 2006-12-31 as the upper end, rather than 2007-01-01. Even though there probably weren’t any employees who started working for the bank on New Year’s Day 2007, it is best to specify exactly what you want. </p>
<p class="calibre1">Along with dates, you can also build conditions to specify ranges of numbers. Numeric ranges are fairly easy to grasp, as demonstrated by the following: mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE avail_balance BETWEEN 3000 AND 5000; </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|          3 | CD         |       1 |       3000.00 |</p>
<p class="calibre1">|         17 | CD         |       7 |       5000.00 |</p>
<p class="calibre1">|         18 | CHK        |       8 |       3487.19 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">3 rows in set (0.10 sec)</p>
<p class="calibre1">All accounts with between $3,000 and $5,000 of an available balance are returned. </p>
<p class="calibre1">Again, make sure that you specify the lower amount first. </p>
<p class="calibre1"><b class="calibre3">String ranges</b></p>
<p class="calibre1">While ranges of dates and numbers are easy to understand, you can also build conditions that search for ranges of strings, which are a bit harder to visualize. Say, for example, you are searching for customers having a Social Security number that falls within a certain range. The format for a Social Security number is “XXX-XX-XXXX,” where X</p>
<p class="calibre1">is a number from 0 to 9, and you want to find every customer whose Social Security number lies between “500-00-0000” and “999-99-9999.” Here’s what the statement would look like:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id, fed_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE cust_type_cd = 'I' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND fed_id BETWEEN '500-00-0000' AND '999-99-9999'; </b></p>
<p class="calibre1">+---------+-------------+</p>
<p class="calibre1">| cust_id | fed_id      |</p>
<p class="calibre1">+---------+-------------+</p>
<p class="calibre1">|       5 | 555-55-5555 |</p>
<p class="calibre1">|       6 | 666-66-6666 |</p>
<p class="calibre1"><b class="calibre3">70 | Chapter 4:</b> <b class="calibre3">Filtering</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-44"></a>|       7 | 777-77-7777 |</p>
<p class="calibre1">|       8 | 888-88-8888 |</p>
<p class="calibre1">|       9 | 999-99-9999 |</p>
<p class="calibre1">+---------+-------------+</p>
<p class="calibre1">5 rows in set (0.01 sec)</p>
<p class="calibre1">To work with string ranges, you need to know the order of the characters within your character set (the order in which the characters within a character set are sorted is called a  <i class="calibre4">collation</i>). </p>
<p class="calibre1"><b class="calibre3">Membership Conditions</b></p>
<p class="calibre1">In some cases, you will not be restricting an expression to a single value or range of values, but rather to a finite set of values. For example, you might want to locate all accounts whose product code is either 'CHK', 'SAV', 'CD', or 'MM': mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd = 'CHK' OR product_cd = 'SAV' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">OR product_cd = 'CD' OR product_cd = 'MM'; </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|          1 | CHK        |       1 |       1057.75 |</p>
<p class="calibre1">|          2 | SAV        |       1 |        500.00 |</p>
<p class="calibre1">|          3 | CD         |       1 |       3000.00 |</p>
<p class="calibre1">|          4 | CHK        |       2 |       2258.02 |</p>
<p class="calibre1">|          5 | SAV        |       2 |        200.00 |</p>
<p class="calibre1">|          7 | CHK        |       3 |       1057.75 |</p>
<p class="calibre1">|          8 | MM         |       3 |       2212.50 |</p>
<p class="calibre1">|         10 | CHK        |       4 |        534.12 |</p>
<p class="calibre1">|         11 | SAV        |       4 |        767.77 |</p>
<p class="calibre1">|         12 | MM         |       4 |       5487.09 |</p>
<p class="calibre1">|         13 | CHK        |       5 |       2237.97 |</p>
<p class="calibre1">|         14 | CHK        |       6 |        122.37 |</p>
<p class="calibre1">|         15 | CD         |       6 |      10000.00 |</p>
<p class="calibre1">|         17 | CD         |       7 |       5000.00 |</p>
<p class="calibre1">|         18 | CHK        |       8 |       3487.19 |</p>
<p class="calibre1">|         19 | SAV        |       8 |        387.99 |</p>
<p class="calibre1">|         21 | CHK        |       9 |        125.67 |</p>
<p class="calibre1">|         22 | MM         |       9 |       9345.55 |</p>
<p class="calibre1">|         23 | CD         |       9 |       1500.00 |</p>
<p class="calibre1">|         24 | CHK        |      10 |      23575.12 |</p>
<p class="calibre1">|         28 | CHK        |      12 |      38552.05 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">21 rows in set (0.28 sec)</p>
<p class="calibre1">While this where clause (four conditions or‘d together) wasn’t too tedious to generate, imagine if the set of expressions contained 10 or 20 members. For these situations, you can use the in operator instead:</p>
<p class="calibre1">SELECT account_id, product_cd, cust_id, avail_balance</p>
<p class="calibre1">FROM account</p>
<p class="calibre1">WHERE product_cd IN ('CHK','SAV','CD','MM'); </p>
<p class="calibre1"><b class="calibre3">Condition Types | 71</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-220"></a>With the in operator, you can write a single condition no matter how many expressions are in the set. </p>
<p class="calibre1"><b class="calibre3">Using subqueries</b></p>
<p class="calibre1">Along with writing your own set of expressions, such as ('CHK','SAV','CD','MM'), you can use a subquery to generate a set for you on the fly. For example, all four product types used in the previous query have a product_type_cd of 'ACCOUNT', so why not use a subquery against the product table to retrieve the four product codes instead of explicitly naming them:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd IN (SELECT product_cd FROM product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_type_cd = 'ACCOUNT'); </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|          3 | CD         |       1 |       3000.00 |</p>
<p class="calibre1">|         15 | CD         |       6 |      10000.00 |</p>
<p class="calibre1">|         17 | CD         |       7 |       5000.00 |</p>
<p class="calibre1">|         23 | CD         |       9 |       1500.00 |</p>
<p class="calibre1">|          1 | CHK        |       1 |       1057.75 |</p>
<p class="calibre1">|          4 | CHK        |       2 |       2258.02 |</p>
<p class="calibre1">|          7 | CHK        |       3 |       1057.75 |</p>
<p class="calibre1">|         10 | CHK        |       4 |        534.12 |</p>
<p class="calibre1">|         13 | CHK        |       5 |       2237.97 |</p>
<p class="calibre1">|         14 | CHK        |       6 |        122.37 |</p>
<p class="calibre1">|         18 | CHK        |       8 |       3487.19 |</p>
<p class="calibre1">|         21 | CHK        |       9 |        125.67 |</p>
<p class="calibre1">|         24 | CHK        |      10 |      23575.12 |</p>
<p class="calibre1">|         28 | CHK        |      12 |      38552.05 |</p>
<p class="calibre1">|          8 | MM         |       3 |       2212.50 |</p>
<p class="calibre1">|         12 | MM         |       4 |       5487.09 |</p>
<p class="calibre1">|         22 | MM         |       9 |       9345.55 |</p>
<p class="calibre1">|          2 | SAV        |       1 |        500.00 |</p>
<p class="calibre1">|          5 | SAV        |       2 |        200.00 |</p>
<p class="calibre1">|         11 | SAV        |       4 |        767.77 |</p>
<p class="calibre1">|         19 | SAV        |       8 |        387.99 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">21 rows in set (0.11 sec)</p>
<p class="calibre1">The subquery returns a set of four values, and the main query checks to see whether the value of the product_cd column can be found in the set that the subquery returned. </p>
<p class="calibre1"><b class="calibre3">Using not in</b></p>
<p class="calibre1">Sometimes you want to see whether a particular expression exists within a set of expressions, and sometimes you want to see whether the expression does  <i class="calibre4">not</i> exist. For these situations, you can use the not in operator:</p>
<p class="calibre1"><b class="calibre3">72 | Chapter 4:</b> <b class="calibre3">Filtering</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-45"></a>mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd NOT IN ('CHK','SAV','CD','MM'); </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|         25 | BUS        |      10 |          0.00 |</p>
<p class="calibre1">|         27 | BUS        |      11 |       9345.55 |</p>
<p class="calibre1">|         29 | SBL        |      13 |      50000.00 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">3 rows in set (0.09 sec)</p>
<p class="calibre1">This query finds all accounts that are  <i class="calibre4">not</i> checking, savings, certificate of deposit, or money market accounts. </p>
<p class="calibre1"><b class="calibre3">Matching Conditions</b></p>
<p class="calibre1">So far, you have been introduced to conditions that identify an exact string, a range of strings, or a set of strings; the final condition type deals with partial string matches. </p>
<p class="calibre1">You may, for example, want to find all employees whose last name begins with  <i class="calibre4">T</i>. You could use a built-in function to strip off the first letter of the lname column, as in: mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE LEFT(lname, 1) = 'T'; </b></p>
<p class="calibre1">+--------+--------+--------+</p>
<p class="calibre1">| emp_id | fname  | lname  |</p>
<p class="calibre1">+--------+--------+--------+</p>
<p class="calibre1">|      3 | Robert | Tyler  |</p>
<p class="calibre1">|      7 | Chris  | Tucker |</p>
<p class="calibre1">|     18 | Rick   | Tulman |</p>
<p class="calibre1">+--------+--------+--------+</p>
<p class="calibre1">3 rows in set (0.01 sec)</p>
<p class="calibre1">While the built-in function left() does the job, it doesn’t give you much flexibility. </p>
<p class="calibre1">Instead, you can use wildcard characters to build search expressions, as demonstrated in the next section. </p>
<p class="calibre1"><b class="calibre3">Using wildcards</b></p>
<p class="calibre1">When searching for partial string matches, you might be interested in:</p>
<p class="calibre1">• Strings beginning/ending with a certain character</p>
<p class="calibre1">• Strings beginning/ending with a substring</p>
<p class="calibre1">• Strings containing a certain character anywhere within the string</p>
<p class="calibre1">• Strings containing a substring anywhere within the string</p>
<p class="calibre1">• Strings with a specific format, regardless of individual characters You  can  build  search  expressions  to  identify  these  and  many  other  partial  string</p>
<p class="calibre1"><a href="#calibre_link-159">matches by using the wildcard characters shown in Table 4-4. </a></p>
<p class="calibre1"><b class="calibre3">Condition Types | 73</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-159"></a> <i class="calibre4">Table 4-4. Wildcard characters</i></p>
<p class="calibre1"><b class="calibre3">Wildcard character</b></p>
<p class="calibre1"><b class="calibre3">Matches</b></p>
<p class="calibre1">_</p>
<p class="calibre1">Exactly one character</p>
<p class="calibre1">%</p>
<p class="calibre1">Any number of characters (including 0)</p>
<p class="calibre1">The underscore character takes the place of a single character, while the percent sign can take the place of a variable number of characters. When building conditions that utilize search expressions, you use the like operator, as in: mysql&gt; <b class="calibre3">SELECT lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE lname LIKE '_a%e%'; </b></p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">| lname     |</p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">| Barker    |</p>
<p class="calibre1">| Hawthorne |</p>
<p class="calibre1">| Parker    |</p>
<p class="calibre1">| Jameson   |</p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">The search expression in the previous example specifies strings containing an  <i class="calibre4">a</i> in the second position and followed by an  <i class="calibre4">e</i> at any other position in the string (including the last <a href="#calibre_link-159">position). Table 4-5 </a>shows some more search expressions and their interpretations. </p>
<p class="calibre1"> <i class="calibre4">Table 4-5. Sample search expressions</i></p>
<p class="calibre1"><b class="calibre3">Search expression</b></p>
<p class="calibre1"><b class="calibre3">Interpretation</b></p>
<p class="calibre1">F%</p>
<p class="calibre1">Strings beginning with  <i class="calibre4">F</i></p>
<p class="calibre1">%t</p>
<p class="calibre1">Strings ending with  <i class="calibre4">t</i></p>
<p class="calibre1">%bas%</p>
<p class="calibre1">Strings containing the substring 'bas' </p>
<p class="calibre1">_ _t_</p>
<p class="calibre1">Four-character strings with a  <i class="calibre4">t</i> in the third position _ _ _-_ _-_ _ _ _</p>
<p class="calibre1">11-character strings with dashes in the fourth and seventh positions You could use the last example <a href="#calibre_link-159">in Table 4-5 </a>to find customers whose federal ID matches the format used for Social Security numbers, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id, fed_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE fed_id LIKE '___-__-____'; </b></p>
<p class="calibre1">+---------+-------------+</p>
<p class="calibre1">| cust_id | fed_id      |</p>
<p class="calibre1">+---------+-------------+</p>
<p class="calibre1">|       1 | 111-11-1111 |</p>
<p class="calibre1">|       2 | 222-22-2222 |</p>
<p class="calibre1">|       3 | 333-33-3333 |</p>
<p class="calibre1">|       4 | 444-44-4444 |</p>
<p class="calibre1">|       5 | 555-55-5555 |</p>
<p class="calibre1"><b class="calibre3">74 | Chapter 4:</b> <b class="calibre3">Filtering</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-219"></a>|       6 | 666-66-6666 |</p>
<p class="calibre1">|       7 | 777-77-7777 |</p>
<p class="calibre1">|       8 | 888-88-8888 |</p>
<p class="calibre1">|       9 | 999-99-9999 |</p>
<p class="calibre1">+---------+-------------+</p>
<p class="calibre1">9 rows in set (0.02 sec)</p>
<p class="calibre1">The wildcard characters work fine for building simple search expressions; if your needs are  a  bit  more  sophisticated,  however,  you  can  use  multiple  search  expressions,  as demonstrated by the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE lname LIKE 'F%' OR lname LIKE 'G%'; </b></p>
<p class="calibre1">+--------+-------+----------+</p>
<p class="calibre1">| emp_id | fname | lname    |</p>
<p class="calibre1">+--------+-------+----------+</p>
<p class="calibre1">|      5 | John  | Gooding  |</p>
<p class="calibre1">|      6 | Helen | Fleming  |</p>
<p class="calibre1">|      9 | Jane  | Grossman |</p>
<p class="calibre1">|     17 | Beth  | Fowler   |</p>
<p class="calibre1">+--------+-------+----------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">This query finds all employees whose last name begins with  <i class="calibre4">F</i> or  <i class="calibre4">G</i>. </p>
<p class="calibre1"><b class="calibre3">Using regular expressions</b></p>
<p class="calibre1">If you find that the wildcard characters don’t provide enough flexibility, you can use regular expressions to build search expressions. A regular expression is, in essence, a search expression on steroids. If you are new to SQL but have coded using programming languages such as Perl, then you might already be intimately familiar with regular expressions. If you have never used regular expressions, then you may want to consult Jeffrey  E.F.  Friedl’s  <a href="http://oreilly.com/catalog/9780596528126/"> <i class="calibre4">Mastering  Regular  Expressions  </i></a> <i class="calibre4">(<a href="http://oreilly.com/catalog/9780596528126/">http://oreilly.com/catalog/</a></i></p>
<p class="calibre1"><a href="http://oreilly.com/catalog/9780596528126/"> <i class="calibre4">9780596528126/)</i></a> (O’Reilly), since it is far too large a topic to try to cover in this book. </p>
<p class="calibre1">Here’s what the previous query (find all employees whose last name starts with  <i class="calibre4">F</i> or <i class="calibre4">G</i>) would look like using the MySQL implementation of regular expressions: mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE lname REGEXP '^[FG]'; </b></p>
<p class="calibre1">+--------+-------+----------+</p>
<p class="calibre1">| emp_id | fname | lname    |</p>
<p class="calibre1">+--------+-------+----------+</p>
<p class="calibre1">|      5 | John  | Gooding  |</p>
<p class="calibre1">|      6 | Helen | Fleming  |</p>
<p class="calibre1">|      9 | Jane  | Grossman |</p>
<p class="calibre1">|     17 | Beth  | Fowler   |</p>
<p class="calibre1">+--------+-------+----------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">The regexp operator takes a regular expression ('^[FG]' in this example) and applies it to the expression on the lefthand side of the condition (the column lname). The query <b class="calibre3">Condition Types | 75</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-46"></a><img src="images/000057.png" alt="Image 19" class="calibre2" /></p>
<p class="calibre1">now contains a single condition using a regular expression rather than two conditions using wildcard characters. </p>
<p class="calibre1">Oracle  Database  and  Microsoft  SQL  Server  also  support  regular  expressions.  With Oracle Database, you would use the regexp_like function instead of the regexp operator shown in the previous example, whereas SQL Server allows regular expressions to be used with the like operator. </p>
<p class="calibre1"><b class="calibre3">Null: That Four-Letter Word</b></p>
<p class="calibre1">I put it off as long as I could, but it’s time to broach a topic that tends to be met with fear, uncertainty, and dread: the null value. Null is the absence of a value; before an employee is terminated, for example, her end_date column in the employee table should be null. There is no value that can be assigned to the end_date column that would make sense in this situation. Null is a bit slippery, however, as there are various flavors of null: <i class="calibre4">Not applicable</i></p>
<p class="calibre1">Such  as  the  employee  ID  column  for  a  transaction  that  took  place  at  an  ATM</p>
<p class="calibre1">machine</p>
<p class="calibre1"> <i class="calibre4">Value not yet known</i></p>
<p class="calibre1">Such as when the federal ID is not known at the time a customer row is created <i class="calibre4">Value undefined</i></p>
<p class="calibre1">Such as when an account is created for a product that has not yet been added to the database</p>
<p class="calibre1">Some theorists argue that there should be a different expression to cover each of these (and more) situations, but most practitioners would agree that having multiple null values would be far too confusing. </p>
<p class="calibre1">When working with null, you should remember:</p>
<p class="calibre1">• An expression can  <i class="calibre4">be</i> null, but it can never  <i class="calibre4">equal</i> null. </p>
<p class="calibre1">• Two nulls are never equal to each other. </p>
<p class="calibre1">To test whether an expression is null, you need to use the is null operator, as demonstrated by the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE superior_emp_id IS NULL; </b></p>
<p class="calibre1">+--------+---------+-------+-----------------+</p>
<p class="calibre1">| emp_id | fname   | lname | superior_emp_id |</p>
<p class="calibre1">+--------+---------+-------+-----------------+</p>
<p class="calibre1">|      1 | Michael | Smith |            NULL |</p>
<p class="calibre1">+--------+---------+-------+-----------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">76 | Chapter 4:</b> <b class="calibre3">Filtering</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-173"></a>This query returns all employees who do not have a boss (wouldn’t that be nice?). </p>
<p class="calibre1">Here’s the same query using = null instead of is null:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE superior_emp_id = NULL; </b></p>
<p class="calibre1">Empty set (0.01 sec)</p>
<p class="calibre1">As you can see, the query parses and executes but does not return any rows. This is a common mistake made by inexperienced SQL programmers, and the database server will not alert you to your error, so be careful when constructing conditions that test for null. </p>
<p class="calibre1">If you want to see whether a value has been assigned to a column, you can use the is not null operator, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE superior_emp_id IS NOT NULL; </b></p>
<p class="calibre1">+--------+----------+-----------+-----------------+</p>
<p class="calibre1">| emp_id | fname    | lname     | superior_emp_id |</p>
<p class="calibre1">+--------+----------+-----------+-----------------+</p>
<p class="calibre1">|      2 | Susan    | Barker    |               1 |</p>
<p class="calibre1">|      3 | Robert   | Tyler     |               1 |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne |               3 |</p>
<p class="calibre1">|      5 | John     | Gooding   |               4 |</p>
<p class="calibre1">|      6 | Helen    | Fleming   |               4 |</p>
<p class="calibre1">|      7 | Chris    | Tucker    |               6 |</p>
<p class="calibre1">|      8 | Sarah    | Parker    |               6 |</p>
<p class="calibre1">|      9 | Jane     | Grossman  |               6 |</p>
<p class="calibre1">|     10 | Paula    | Roberts   |               4 |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   |              10 |</p>
<p class="calibre1">|     12 | Samantha | Jameson   |              10 |</p>
<p class="calibre1">|     13 | John     | Blake     |               4 |</p>
<p class="calibre1">|     14 | Cindy    | Mason     |              13 |</p>
<p class="calibre1">|     15 | Frank    | Portman   |              13 |</p>
<p class="calibre1">|     16 | Theresa  | Markham   |               4 |</p>
<p class="calibre1">|     17 | Beth     | Fowler    |              16 |</p>
<p class="calibre1">|     18 | Rick     | Tulman    |              16 |</p>
<p class="calibre1">+--------+----------+-----------+-----------------+</p>
<p class="calibre1">17 rows in set (0.00 sec)</p>
<p class="calibre1">This version of the query returns the other 17 employees who, unlike Michael Smith, have a boss. </p>
<p class="calibre1">Before putting null aside for a while, it would be helpful to investigate one more potential pitfall. Suppose that you have been asked to identify all employees who are <i class="calibre4">not</i> managed by Helen Fleming (whose employee ID is 6). Your first instinct might be to do the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE superior_emp_id != 6; </b></p>
<p class="calibre1"></p>
<p class="calibre1"><b class="calibre3">Null: That Four-Letter Word | 77</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-292"></a>+--------+----------+-----------+-----------------+</p>
<p class="calibre1">| emp_id | fname    | lname     | superior_emp_id |</p>
<p class="calibre1">+--------+----------+-----------+-----------------+</p>
<p class="calibre1">|      2 | Susan    | Barker    |               1 |</p>
<p class="calibre1">|      3 | Robert   | Tyler     |               1 |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne |               3 |</p>
<p class="calibre1">|      5 | John     | Gooding   |               4 |</p>
<p class="calibre1">|      6 | Helen    | Fleming   |               4 |</p>
<p class="calibre1">|     10 | Paula    | Roberts   |               4 |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   |              10 |</p>
<p class="calibre1">|     12 | Samantha | Jameson   |              10 |</p>
<p class="calibre1">|     13 | John     | Blake     |               4 |</p>
<p class="calibre1">|     14 | Cindy    | Mason     |              13 |</p>
<p class="calibre1">|     15 | Frank    | Portman   |              13 |</p>
<p class="calibre1">|     16 | Theresa  | Markham   |               4 |</p>
<p class="calibre1">|     17 | Beth     | Fowler    |              16 |</p>
<p class="calibre1">|     18 | Rick     | Tulman    |              16 |</p>
<p class="calibre1">+--------+----------+-----------+-----------------+</p>
<p class="calibre1">14 rows in set (0.00 sec)</p>
<p class="calibre1">While it is true that these 14 employees do not work for Helen Fleming, if you look carefully at the data, you will see that there is one more employee who doesn’t work for  Helen  who  is  not  listed  here.  That  employee  is  Michael  Smith,  and  his superior_emp_id column is null (because he’s the big cheese). To answer the question correctly, therefore, you need to account for the possibility that some rows might contain a null in the superior_emp_id column:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE superior_emp_id != 6 OR superior_emp_id IS NULL; </b></p>
<p class="calibre1">+--------+----------+-----------+-----------------+</p>
<p class="calibre1">| emp_id | fname    | lname     | superior_emp_id |</p>
<p class="calibre1">+--------+----------+-----------+-----------------+</p>
<p class="calibre1">|      1 | Michael  | Smith     |            NULL |</p>
<p class="calibre1">|      2 | Susan    | Barker    |               1 |</p>
<p class="calibre1">|      3 | Robert   | Tyler     |               1 |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne |               3 |</p>
<p class="calibre1">|      5 | John     | Gooding   |               4 |</p>
<p class="calibre1">|      6 | Helen    | Fleming   |               4 |</p>
<p class="calibre1">|     10 | Paula    | Roberts   |               4 |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   |              10 |</p>
<p class="calibre1">|     12 | Samantha | Jameson   |              10 |</p>
<p class="calibre1">|     13 | John     | Blake     |               4 |</p>
<p class="calibre1">|     14 | Cindy    | Mason     |              13 |</p>
<p class="calibre1">|     15 | Frank    | Portman   |              13 |</p>
<p class="calibre1">|     16 | Theresa  | Markham   |               4 |</p>
<p class="calibre1">|     17 | Beth     | Fowler    |              16 |</p>
<p class="calibre1">|     18 | Rick     | Tulman    |              16 |</p>
<p class="calibre1">+--------+----------+-----------+-----------------+</p>
<p class="calibre1">15 rows in set (0.00 sec)</p>
<p class="calibre1">The result set now includes all 15 employees who don’t work for Helen. When working with a database that you are not familiar with, it is a good idea to find out which columns <b class="calibre3">78 | Chapter 4:</b> <b class="calibre3">Filtering</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-47"></a>in a table allow nulls so that you can take appropriate measures with your filter conditions to keep data from slipping through the cracks. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">The following exercises test your understanding of filter conditions. Please <a href="#calibre_link-152">see Appen-</a></p>
<p class="calibre1"><a href="#calibre_link-152">dix C for solutions. </a></p>
<p class="calibre1">The following transaction data is used for the first two exercises: <b class="calibre3">Txn_id</b></p>
<p class="calibre1"><b class="calibre3">Txn_date</b></p>
<p class="calibre1"><b class="calibre3">Account_id</b></p>
<p class="calibre1"><b class="calibre3">Txn_type_cd</b></p>
<p class="calibre1"><b class="calibre3">Amount</b></p>
<p class="calibre1">1</p>
<p class="calibre1">2005-02-22</p>
<p class="calibre1">101</p>
<p class="calibre1">CDT</p>
<p class="calibre1">1000.00</p>
<p class="calibre1">2</p>
<p class="calibre1">2005-02-23</p>
<p class="calibre1">102</p>
<p class="calibre1">CDT</p>
<p class="calibre1">525.75</p>
<p class="calibre1">3</p>
<p class="calibre1">2005-02-24</p>
<p class="calibre1">101</p>
<p class="calibre1">DBT</p>
<p class="calibre1">100.00</p>
<p class="calibre1">4</p>
<p class="calibre1">2005-02-24</p>
<p class="calibre1">103</p>
<p class="calibre1">CDT</p>
<p class="calibre1">55</p>
<p class="calibre1">5</p>
<p class="calibre1">2005-02-25</p>
<p class="calibre1">101</p>
<p class="calibre1">DBT</p>
<p class="calibre1">50</p>
<p class="calibre1">6</p>
<p class="calibre1">2005-02-25</p>
<p class="calibre1">103</p>
<p class="calibre1">DBT</p>
<p class="calibre1">25</p>
<p class="calibre1">7</p>
<p class="calibre1">2005-02-25</p>
<p class="calibre1">102</p>
<p class="calibre1">CDT</p>
<p class="calibre1">125.37</p>
<p class="calibre1">8</p>
<p class="calibre1">2005-02-26</p>
<p class="calibre1">103</p>
<p class="calibre1">DBT</p>
<p class="calibre1">10</p>
<p class="calibre1">9</p>
<p class="calibre1">2005-02-27</p>
<p class="calibre1">101</p>
<p class="calibre1">CDT</p>
<p class="calibre1">75</p>
<p class="calibre1"><b class="calibre3">Exercise 4-1</b></p>
<p class="calibre1">Which of the transaction IDs would be returned by the following filter conditions? </p>
<p class="calibre1">txn_date &lt; '2005-02-26' AND (txn_type_cd = 'DBT' OR amount &gt; 100) <b class="calibre3">Exercise 4-2</b></p>
<p class="calibre1">Which of the transaction IDs would be returned by the following filter conditions? </p>
<p class="calibre1">account_id IN (101,103) AND NOT (txn_type_cd = 'DBT' OR amount &gt; 100) <b class="calibre3">Exercise 4-3</b></p>
<p class="calibre1">Construct a query that retrieves all accounts opened in 2002. </p>
<p class="calibre1"><b class="calibre3">Exercise 4-4</b></p>
<p class="calibre1">Construct a query that finds all nonbusiness customers whose last name contains an <i class="calibre4">a</i> in the second position and an  <i class="calibre4">e</i> anywhere after the  <i class="calibre4">a</i>. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 79</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-293"></a>D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-48"></a><b class="calibre3">CHAPTER 5</b></p>
<p class="calibre1"><b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">Back <a href="#calibre_link-11">in Chapter 2, </a>I demonstrated how related concepts are broken into separate pieces through a process known as normalization. The end result of this exercise was two tables: person and favorite_food. If, however, you want to generate a single report showing a person’s name, address,  <i class="calibre4">and</i> favorite foods, you will need a mechanism to bring the data from these two tables back together again; this mechanism is known as a  <i class="calibre4">join</i>, and this chapter concentrates on the simplest and most common join, the  <i class="calibre4">inner</i> <i class="calibre4">join</i><a href="#calibre_link-100">. Chapter 10 demonstrates all of the different join types. </a></p>
<p class="calibre1"><b class="calibre3">What Is a Join? </b></p>
<p class="calibre1">Queries against a single table are certainly not rare, but you will find that most of your queries will require two, three, or even more tables. To illustrate, let’s look at the definitions for the employee and department tables and then define a query that retrieves data from both tables:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DESC employee; </b></p>
<p class="calibre1">+--------------------+----------------------+------+-----+---------+</p>
<p class="calibre1">| Field              | Type                 | Null | Key | Default |</p>
<p class="calibre1">+--------------------+----------------------+------+-----+---------+</p>
<p class="calibre1">| emp_id             | smallint(5) unsigned | NO   | PRI | NULL    |</p>
<p class="calibre1">| fname              | varchar(20)          | NO   |     | NULL    |</p>
<p class="calibre1">| lname              | varchar(20)          | NO   |     | NULL    |</p>
<p class="calibre1">| start_date         | date                 | NO   |     | NULL    |</p>
<p class="calibre1">| end_date           | date                 | YES  |     | NULL    |</p>
<p class="calibre1">| superior_emp_id    | smallint(5) unsigned | YES  | MUL | NULL    |</p>
<p class="calibre1">| <b class="calibre3">dept_id</b>            | smallint(5) unsigned | YES  | MUL | NULL    |</p>
<p class="calibre1">| title              | varchar(20)          | YES  |     | NULL    |</p>
<p class="calibre1">| assigned_branch_id | smallint(5) unsigned | YES  | MUL | NULL    |</p>
<p class="calibre1">+--------------------+----------------------+------+-----+---------+</p>
<p class="calibre1">9 rows in set (0.11 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DESC department; </b></p>
<p class="calibre1">+---------+----------------------+------+-----+---------+</p>
<p class="calibre1">| Field   | Type                 | Null | Key | Default |</p>
<p class="calibre1">+---------+----------------------+------+-----+---------+</p>
<p class="calibre1">| dept_id | smallint(5) unsigned | No   | PRI | NULL    |</p>
<p class="calibre1"><b class="calibre3">81</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-49"></a>| name    | varchar(20)          | No   |     | NULL    |</p>
<p class="calibre1">+---------+----------------------+------+-----+---------+</p>
<p class="calibre1">2 rows in set (0.03 sec)</p>
<p class="calibre1">Let’s say you want to retrieve the first and last names of each employee along with the name of the department to which each employee is assigned. Your query will therefore need to retrieve the employee.fname, employee.lname, and department.name columns. </p>
<p class="calibre1">But how can you retrieve data from both tables in the same query? The answer lies in the employee.dept_id column, which holds the ID of the department to which each employee is assigned (in more formal terms, the employee.dept_id column is the  <i class="calibre4">foreign</i> <i class="calibre4">key</i> to the department table). The query, which you will see shortly, instructs the server to  use  the  employee.dept_id  column  as  the   <i class="calibre4">bridge</i>  between  the  employee  and department tables, thereby allowing columns from both tables to be included in the query’s result set. This type of operation is known as a join. </p>
<p class="calibre1"><b class="calibre3">Cartesian Product</b></p>
<p class="calibre1">The easiest way to start is to put the employee and department tables into the from clause of a query and see what happens. Here’s a query that retrieves the employee’s first and last names along with the department name, with a from clause naming both tables separated by the join keyword:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, d.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e JOIN department d; </b></p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| fname    | lname     | name           |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| Michael  | Smith     | Operations     |</p>
<p class="calibre1">| Michael  | Smith     | Loans          |</p>
<p class="calibre1">| Michael  | Smith     | Administration |</p>
<p class="calibre1">| Susan    | Barker    | Operations     |</p>
<p class="calibre1">| Susan    | Barker    | Loans          |</p>
<p class="calibre1">| Susan    | Barker    | Administration |</p>
<p class="calibre1">| Robert   | Tyler     | Operations     |</p>
<p class="calibre1">| Robert   | Tyler     | Loans          |</p>
<p class="calibre1">| Robert   | Tyler     | Administration |</p>
<p class="calibre1">| Susan    | Hawthorne | Operations     |</p>
<p class="calibre1">| Susan    | Hawthorne | Loans          |</p>
<p class="calibre1">| Susan    | Hawthorne | Administration |</p>
<p class="calibre1">| John     | Gooding   | Operations     |</p>
<p class="calibre1">| John     | Gooding   | Loans          |</p>
<p class="calibre1">| John     | Gooding   | Administration |</p>
<p class="calibre1">| Helen    | Fleming   | Operations     |</p>
<p class="calibre1">| Helen    | Fleming   | Loans          |</p>
<p class="calibre1">| Helen    | Fleming   | Administration |</p>
<p class="calibre1">| Chris    | Tucker    | Operations     |</p>
<p class="calibre1">| Chris    | Tucker    | Loans          |</p>
<p class="calibre1">| Chris    | Tucker    | Administration |</p>
<p class="calibre1">| Sarah    | Parker    | Operations     |</p>
<p class="calibre1">| Sarah    | Parker    | Loans          |</p>
<p class="calibre1">| Sarah    | Parker    | Administration |</p>
<p class="calibre1">| Jane     | Grossman  | Operations     |</p>
<p class="calibre1"><b class="calibre3">82 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-50"></a>| Jane     | Grossman  | Loans          |</p>
<p class="calibre1">| Jane     | Grossman  | Administration |</p>
<p class="calibre1">| Paula    | Roberts   | Operations     |</p>
<p class="calibre1">| Paula    | Roberts   | Loans          |</p>
<p class="calibre1">| Paula    | Roberts   | Administration |</p>
<p class="calibre1">| Thomas   | Ziegler   | Operations     |</p>
<p class="calibre1">| Thomas   | Ziegler   | Loans          |</p>
<p class="calibre1">| Thomas   | Ziegler   | Administration |</p>
<p class="calibre1">| Samantha | Jameson   | Operations     |</p>
<p class="calibre1">| Samantha | Jameson   | Loans          |</p>
<p class="calibre1">| Samantha | Jameson   | Administration |</p>
<p class="calibre1">| John     | Blake     | Operations     |</p>
<p class="calibre1">| John     | Blake     | Loans          |</p>
<p class="calibre1">| John     | Blake     | Administration |</p>
<p class="calibre1">| Cindy    | Mason     | Operations     |</p>
<p class="calibre1">| Cindy    | Mason     | Loans          |</p>
<p class="calibre1">| Cindy    | Mason     | Administration |</p>
<p class="calibre1">| Frank    | Portman   | Operations     |</p>
<p class="calibre1">| Frank    | Portman   | Loans          |</p>
<p class="calibre1">| Frank    | Portman   | Administration |</p>
<p class="calibre1">| Theresa  | Markham   | Operations     |</p>
<p class="calibre1">| Theresa  | Markham   | Loans          |</p>
<p class="calibre1">| Theresa  | Markham   | Administration |</p>
<p class="calibre1">| Beth     | Fowler    | Operations     |</p>
<p class="calibre1">| Beth     | Fowler    | Loans          |</p>
<p class="calibre1">| Beth     | Fowler    | Administration |</p>
<p class="calibre1">| Rick     | Tulman    | Operations     |</p>
<p class="calibre1">| Rick     | Tulman    | Loans          |</p>
<p class="calibre1">| Rick     | Tulman    | Administration |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">54 rows in set (0.23 sec)</p>
<p class="calibre1">Hmmm…there are only 18 employees and 3 different departments, so how did the result set end up with 54 rows? Looking more closely, you can see that the set of 18 employees is repeated three times, with all the data identical except for the department name. </p>
<p class="calibre1">Because the query didn’t specify  <i class="calibre4">how</i> the two tables should be joined, the database server generated the  <i class="calibre4">Cartesian product</i>, which is  <i class="calibre4">every</i> permutation of the two tables (18 employees × 3 departments = 54 permutations). This type of join is known as a <i class="calibre4">cross join</i>, and it is rarely used (on purpose, at least). Cross joins are one of the join</p>
<p class="calibre1"><a href="#calibre_link-100">types that we study in Chapter 10. </a></p>
<p class="calibre1"><b class="calibre3">Inner Joins</b></p>
<p class="calibre1">To modify the previous query so that only 18 rows are included in the result set (one for each employee), you need to describe how the two tables are related. Earlier, I showed that the employee.dept_id column serves as the link between the two tables, so this information needs to be added to the on subclause of the from clause: mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, d.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e JOIN department d</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.dept_id = d.dept_id; </b></p>
<p class="calibre1"></p>
<p class="calibre1"><b class="calibre3">What Is a Join? | 83</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-205"></a>+----------+-----------+----------------+</p>
<p class="calibre1">| fname    | lname     | name           |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| Michael  | Smith     | Administration |</p>
<p class="calibre1">| Susan    | Barker    | Administration |</p>
<p class="calibre1">| Robert   | Tyler     | Administration |</p>
<p class="calibre1">| Susan    | Hawthorne | Operations     |</p>
<p class="calibre1">| John     | Gooding   | Loans          |</p>
<p class="calibre1">| Helen    | Fleming   | Operations     |</p>
<p class="calibre1">| Chris    | Tucker    | Operations     |</p>
<p class="calibre1">| Sarah    | Parker    | Operations     |</p>
<p class="calibre1">| Jane     | Grossman  | Operations     |</p>
<p class="calibre1">| Paula    | Roberts   | Operations     |</p>
<p class="calibre1">| Thomas   | Ziegler   | Operations     |</p>
<p class="calibre1">| Samantha | Jameson   | Operations     |</p>
<p class="calibre1">| John     | Blake     | Operations     |</p>
<p class="calibre1">| Cindy    | Mason     | Operations     |</p>
<p class="calibre1">| Frank    | Portman   | Operations     |</p>
<p class="calibre1">| Theresa  | Markham   | Operations     |</p>
<p class="calibre1">| Beth     | Fowler    | Operations     |</p>
<p class="calibre1">| Rick     | Tulman    | Operations     |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1">Instead of 54 rows, you now have the expected 18 rows due to the addition of the on subclause, which instructs the server to join the employee and department tables by using the dept_id column to traverse from one table to the other. For example, Susan Hawthorne’s row in the employee table contains a value of 1 in the dept_id column (not shown  in  the  example).  The  server  uses  this  value  to  look  up  the  row  in  the department table having a value of 1 in its dept_id column and then retrieves the value</p>
<p class="calibre1">'Operations' from the name column in that row. </p>
<p class="calibre1">If a value exists for the dept_id column in one table but  <i class="calibre4">not</i> the other, then the join fails for the rows containing that value and those rows are excluded from the result set. This type of join is known as an  <i class="calibre4">inner join</i>, and it is the most commonly used type of join. </p>
<p class="calibre1">To clarify, if the department table contains a fourth row for the marketing department, but no employees have been assigned to that department, then the marketing department would not be included in the result set. Likewise, if some of the employees had been assigned to department ID 99, which doesn’t exist in the department table, then these employees would be left out of the result set. If you want to include all rows from one table or the other regardless of whether a match exists, you need to specify an  <i class="calibre4">outer</i> <i class="calibre4">join</i>, but we cover this later in the book. </p>
<p class="calibre1">In the previous example, I did not specify in the from clause which type of join to use. </p>
<p class="calibre1">However, when you wish to join two tables using an inner join, you should explicitly specify this in your from clause; here’s the same example, with the addition of the join type (note the keyword INNER):</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, d.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN department d</b></p>
<p class="calibre1"><b class="calibre3">84 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-207"></a>    -&gt; <b class="calibre3">ON e.dept_id = d.dept_id; </b></p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| fname    | lname     | name           |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| Michael  | Smith     | Administration |</p>
<p class="calibre1">| Susan    | Barker    | Administration |</p>
<p class="calibre1">| Robert   | Tyler     | Administration |</p>
<p class="calibre1">| Susan    | Hawthorne | Operations     |</p>
<p class="calibre1">| John     | Gooding   | Loans          |</p>
<p class="calibre1">| Helen    | Fleming   | Operations     |</p>
<p class="calibre1">| Chris    | Tucker    | Operations     |</p>
<p class="calibre1">| Sarah    | Parker    | Operations     |</p>
<p class="calibre1">| Jane     | Grossman  | Operations     |</p>
<p class="calibre1">| Paula    | Roberts   | Operations     |</p>
<p class="calibre1">| Thomas   | Ziegler   | Operations     |</p>
<p class="calibre1">| Samantha | Jameson   | Operations     |</p>
<p class="calibre1">| John     | Blake     | Operations     |</p>
<p class="calibre1">| Cindy    | Mason     | Operations     |</p>
<p class="calibre1">| Frank    | Portman   | Operations     |</p>
<p class="calibre1">| Theresa  | Markham   | Operations     |</p>
<p class="calibre1">| Beth     | Fowler    | Operations     |</p>
<p class="calibre1">| Rick     | Tulman    | Operations     |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1">If you do not specify the type of join, then the server will do an inner join by default. </p>
<p class="calibre1">As you will see later in the book, however, there are several types of joins, so you should get in the habit of specifying the exact type of join that you require. </p>
<p class="calibre1">If the names of the columns used to join the two tables are identical, which is true in the previous query, you can use the using subclause instead of the on subclause, as in: mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, d.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN department d</b></p>
<p class="calibre1">-&gt; <b class="calibre3">USING (dept_id); </b></p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| fname    | lname     | name           |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| Michael  | Smith     | Administration |</p>
<p class="calibre1">| Susan    | Barker    | Administration |</p>
<p class="calibre1">| Robert   | Tyler     | Administration |</p>
<p class="calibre1">| Susan    | Hawthorne | Operations     |</p>
<p class="calibre1">| John     | Gooding   | Loans          |</p>
<p class="calibre1">| Helen    | Fleming   | Operations     |</p>
<p class="calibre1">| Chris    | Tucker    | Operations     |</p>
<p class="calibre1">| Sarah    | Parker    | Operations     |</p>
<p class="calibre1">| Jane     | Grossman  | Operations     |</p>
<p class="calibre1">| Paula    | Roberts   | Operations     |</p>
<p class="calibre1">| Thomas   | Ziegler   | Operations     |</p>
<p class="calibre1">| Samantha | Jameson   | Operations     |</p>
<p class="calibre1">| John     | Blake     | Operations     |</p>
<p class="calibre1">| Cindy    | Mason     | Operations     |</p>
<p class="calibre1">| Frank    | Portman   | Operations     |</p>
<p class="calibre1">| Theresa  | Markham   | Operations     |</p>
<p class="calibre1">| Beth     | Fowler    | Operations     |</p>
<p class="calibre1"><b class="calibre3">What Is a Join? | 85</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-51"></a>| Rick     | Tulman    | Operations     |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">18 rows in set (0.01 sec)</p>
<p class="calibre1">Since using is a shorthand notation that you can use in only a specific situation, I prefer always to use the on subclause to avoid confusion. </p>
<p class="calibre1"><b class="calibre3">The ANSI Join Syntax</b></p>
<p class="calibre1">The notation used throughout this book for joining tables was introduced in the SQL92</p>
<p class="calibre1">version  of  the  ANSI  SQL  standard.  All  the  major  databases  (Oracle  Database, Microsoft SQL Server, MySQL, IBM DB2 Universal Database, and Sybase Adaptive Server) have adopted the SQL92 join syntax. Because most of these servers have been around since before the release of the SQL92 specification, they all include an older join  syntax  as  well.  For  example,  all  these  servers  would  understand  the  following variation of the previous query:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, d.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e, department d</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e.dept_id = d.dept_id; </b></p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| fname    | lname     | name           |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">| Michael  | Smith     | Administration |</p>
<p class="calibre1">| Susan    | Barker    | Administration |</p>
<p class="calibre1">| Robert   | Tyler     | Administration |</p>
<p class="calibre1">| Susan    | Hawthorne | Operations     |</p>
<p class="calibre1">| John     | Gooding   | Loans          |</p>
<p class="calibre1">| Helen    | Fleming   | Operations     |</p>
<p class="calibre1">| Chris    | Tucker    | Operations     |</p>
<p class="calibre1">| Sarah    | Parker    | Operations     |</p>
<p class="calibre1">| Jane     | Grossman  | Operations     |</p>
<p class="calibre1">| Paula    | Roberts   | Operations     |</p>
<p class="calibre1">| Thomas   | Ziegler   | Operations     |</p>
<p class="calibre1">| Samantha | Jameson   | Operations     |</p>
<p class="calibre1">| John     | Blake     | Operations     |</p>
<p class="calibre1">| Cindy    | Mason     | Operations     |</p>
<p class="calibre1">| Frank    | Portman   | Operations     |</p>
<p class="calibre1">| Theresa  | Markham   | Operations     |</p>
<p class="calibre1">| Beth     | Fowler    | Operations     |</p>
<p class="calibre1">| Rick     | Tulman    | Operations     |</p>
<p class="calibre1">+----------+-----------+----------------+</p>
<p class="calibre1">18 rows in set (0.01 sec)</p>
<p class="calibre1">This older method of specifying joins does not include the on subclause; instead, tables are named in the from clause separated by commas, and join conditions are included in the where clause. While you may decide to ignore the SQL92 syntax in favor of the older join syntax, the ANSI join syntax has the following advantages:</p>
<p class="calibre1">• Join conditions and filter conditions are separated into two different clauses (the on  subclause  and  the  where  clause,  respectively),  making  a  query  easier  to understand. </p>
<p class="calibre1"><b class="calibre3">86 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-294"></a>• The join conditions for each pair of tables are contained in their own on clause, making it less likely that part of a join will be mistakenly omitted. </p>
<p class="calibre1">• Queries  that  use  the  SQL92  join  syntax  are  portable  across  database  servers, whereas the older syntax is slightly different across the different servers. </p>
<p class="calibre1">The benefits of the SQL92 join syntax are easier to identify for complex queries that include both join and filter conditions. Consider the following query, which returns all accounts opened by experienced tellers (hired prior to 2007) currently assigned to the Woburn branch:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.cust_id, a.open_date, a.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a, branch b, employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE a.open_emp_id = e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND e.start_date &lt; '2007-01-01' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND e.assigned_branch_id = b.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND (e.title = 'Teller' OR e.title = 'Head Teller')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND b.name = 'Woburn Branch'; </b></p>
<p class="calibre1">+------------+---------+------------+------------+</p>
<p class="calibre1">| account_id | cust_id | open_date  | product_cd |</p>
<p class="calibre1">+------------+---------+------------+------------+</p>
<p class="calibre1">|          1 |       1 | 2000-01-15 | CHK        |</p>
<p class="calibre1">|          2 |       1 | 2000-01-15 | SAV        |</p>
<p class="calibre1">|          3 |       1 | 2004-06-30 | CD         |</p>
<p class="calibre1">|          4 |       2 | 2001-03-12 | CHK        |</p>
<p class="calibre1">|          5 |       2 | 2001-03-12 | SAV        |</p>
<p class="calibre1">|         17 |       7 | 2004-01-12 | CD         |</p>
<p class="calibre1">|         27 |      11 | 2004-03-22 | BUS        |</p>
<p class="calibre1">+------------+---------+------------+------------+</p>
<p class="calibre1">7 rows in set (0.00 sec)</p>
<p class="calibre1">With this query, it is not so easy to determine which conditions in the where clause are join conditions and which are filter conditions. It is also not readily apparent which type of join is being employed (to identify the type of join, you would need to look closely at the join conditions in the where clause to see whether any special characters are employed), nor is it easy to determine whether any join conditions have been mistakenly left out. Here’s the same query using the SQL92 join syntax: mysql&gt; <b class="calibre3">SELECT a.account_id, a.cust_id, a.open_date, a.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_emp_id = e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.assigned_branch_id = b.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e.start_date &lt; '2007-01-01' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND (e.title = 'Teller' OR e.title = 'Head Teller')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND b.name = 'Woburn Branch'; </b></p>
<p class="calibre1">+------------+---------+------------+------------+</p>
<p class="calibre1">| account_id | cust_id | open_date  | product_cd |</p>
<p class="calibre1">+------------+---------+------------+------------+</p>
<p class="calibre1">|          1 |       1 | 2000-01-15 | CHK        |</p>
<p class="calibre1">|          2 |       1 | 2000-01-15 | SAV        |</p>
<p class="calibre1">|          3 |       1 | 2004-06-30 | CD         |</p>
<p class="calibre1">|          4 |       2 | 2001-03-12 | CHK        |</p>
<p class="calibre1">|          5 |       2 | 2001-03-12 | SAV        |</p>
<p class="calibre1"><b class="calibre3">What Is a Join? | 87</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-52"></a>|         17 |       7 | 2004-01-12 | CD         |</p>
<p class="calibre1">|         27 |      11 | 2004-03-22 | BUS        |</p>
<p class="calibre1">+------------+---------+------------+------------+</p>
<p class="calibre1">7 rows in set (0.05 sec)</p>
<p class="calibre1">Hopefully,  you  will  agree  that  the  version  using  SQL92  join  syntax  is  easier  to understand. </p>
<p class="calibre1"><b class="calibre3">Joining Three or More Tables</b></p>
<p class="calibre1">Joining three tables is similar to joining two tables, but with one slight wrinkle. With a two-table join, there are two tables and one join type in the from clause, and a single on subclause to define how the tables are joined. With a three-table join, there are three tables and two join types in the from clause, and two on subclauses. Here’s another example of a query with a two-table join:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, c.fed_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE c.cust_type_cd = 'B'; </b></p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">| account_id | fed_id     |</p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">|         24 | 04-1111111 |</p>
<p class="calibre1">|         25 | 04-1111111 |</p>
<p class="calibre1">|         27 | 04-2222222 |</p>
<p class="calibre1">|         28 | 04-3333333 |</p>
<p class="calibre1">|         29 | 04-4444444 |</p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">5 rows in set (0.15 sec)</p>
<p class="calibre1">This query, which returns the account ID and federal tax number for all business accounts, should look fairly straightforward by now. If, however, you add the employee table to the query to also retrieve the name of the teller who opened each account, it looks as follows:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, c.fed_id, e.fname, e.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_emp_id = e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE c.cust_type_cd = 'B'; </b></p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">| account_id | fed_id     | fname   | lname   |</p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">|         24 | 04-1111111 | Theresa | Markham |</p>
<p class="calibre1">|         25 | 04-1111111 | Theresa | Markham |</p>
<p class="calibre1">|         27 | 04-2222222 | Paula   | Roberts |</p>
<p class="calibre1">|         28 | 04-3333333 | Theresa | Markham |</p>
<p class="calibre1">|         29 | 04-4444444 | John    | Blake   |</p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">5 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">88 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-221"></a>Now three tables, two join types, and two on subclauses are listed in the from clause, so things have gotten quite a bit busier. At first glance, the order in which the tables are  named  might  cause  you  to  think  that  the  employee  table  is  being  joined  to  the customer table, since the account table is named first, followed by the customer table, and then the employee table. If you switch the order in which the first two tables appear, however, you will get the exact same results:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, c.fed_id, e.fname, e.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c INNER JOIN account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_emp_id = e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE c.cust_type_cd = 'B'; </b></p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">| account_id | fed_id     | fname   | lname   |</p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">|         24 | 04-1111111 | Theresa | Markham |</p>
<p class="calibre1">|         25 | 04-1111111 | Theresa | Markham |</p>
<p class="calibre1">|         27 | 04-2222222 | Paula   | Roberts |</p>
<p class="calibre1">|         28 | 04-3333333 | Theresa | Markham |</p>
<p class="calibre1">|         29 | 04-4444444 | John    | Blake   |</p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">5 rows in set (0.09 sec)</p>
<p class="calibre1">The  customer  table  is  now  listed  first,  followed  by  the  account  table  and  then  the employee table. Since the on subclauses haven’t changed, the results are the same. For the sake of completeness, here’s the same query one last time, but with the table order completely reversed (employee to account to customer):</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, c.fed_id, e.fname, e.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.emp_id = a.open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE c.cust_type_cd = 'B'; </b></p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">| account_id | fed_id     | fname   | lname   |</p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">|         24 | 04-1111111 | Theresa | Markham |</p>
<p class="calibre1">|         25 | 04-1111111 | Theresa | Markham |</p>
<p class="calibre1">|         27 | 04-2222222 | Paula   | Roberts |</p>
<p class="calibre1">|         28 | 04-3333333 | Theresa | Markham |</p>
<p class="calibre1">|         29 | 04-4444444 | John    | Blake   |</p>
<p class="calibre1">+------------+------------+---------+---------+</p>
<p class="calibre1">5 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">Joining Three or More Tables | 89</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-53"></a><b class="calibre3">Does Join Order Matter? </b></p>
<p class="calibre1">If you are confused about why all three versions of the account/employee/customer query yield the same results, keep in mind that SQL is a nonprocedural language, meaning that you describe what you want to retrieve and which database objects need to be involved, but it is up to the database server to determine how best to execute your query. Using statistics gathered from your database objects, the server must pick one of three tables as a starting point (the chosen table is thereafter known as the  <i class="calibre4">driving</i> <i class="calibre4">table</i>), and then decide in which order to join the remaining tables. Therefore, the order in which tables appear in your from clause is not significant. </p>
<p class="calibre1">If, however, you believe that the tables in your query should always be joined in a particular order, you can place the tables in the desired order and then specify the keyword STRAIGHT_JOIN in MySQL, request the FORCE ORDER option in SQL Server, or use either the ORDERED or the LEADING optimizer hint in Oracle Database. For example, to tell the MySQL server to use the customer table as the driving table and to then join the account and employee tables, you could do the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT STRAIGHT_JOIN a.account_id, c.fed_id, e.fname, e.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c INNER JOIN account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_emp_id = e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE c.cust_type_cd = 'B'; </b></p>
<p class="calibre1">One way to think of a query that uses three or more tables is as a snowball rolling down a hill. The first two tables get the ball rolling, and each subsequent table gets tacked on to the snowball as it heads downhill. You can think of the snowball as the  <i class="calibre4">intermediate</i> <i class="calibre4">result set</i>, which is picking up more and more columns as subsequent tables are joined. </p>
<p class="calibre1">Therefore, the employee table is not really being joined to the account table, but rather the intermediate result set created when the customer and account tables were joined. </p>
<p class="calibre1">(In case you were wondering why I chose a snowball analogy, I wrote this chapter in the midst of a New England winter: 110 inches so far, and more coming tomorrow. Oh joy.)</p>
<p class="calibre1"><b class="calibre3">Using Subqueries As Tables</b></p>
<p class="calibre1">You have already seen several examples of queries that use three tables, but there is one variation worth mentioning: what to do if some of the data sets are generated by subqueries. Subqueries is the focus of <a href="#calibre_link-88">Chapter 9</a>, but I already introduced the concept of a subquery in the from clause in the previous chapter. Here’s another version of an earlier query (find all accounts opened by experienced tellers currently assigned to the Woburn  branch)  that  joins  the  account  table  to  subqueries  against  the  branch  and employee tables:</p>
<p class="calibre1">1 SELECT a.account_id, a.cust_id, a.open_date, a.product_cd</p>
<p class="calibre1">2 FROM account a INNER JOIN</p>
<p class="calibre1">3   (SELECT emp_id, assigned_branch_id</p>
<p class="calibre1"><b class="calibre3">90 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-295"></a>4     FROM employee</p>
<p class="calibre1">5     WHERE start_date &lt; '2007-01-01' </p>
<p class="calibre1">6       AND (title = 'Teller' OR title = 'Head Teller')) e</p>
<p class="calibre1">7   ON a.open_emp_id = e.emp_id</p>
<p class="calibre1">8   INNER JOIN</p>
<p class="calibre1">9    (SELECT branch_id</p>
<p class="calibre1">10     FROM branch</p>
<p class="calibre1">11     WHERE name = 'Woburn Branch') b</p>
<p class="calibre1">12   ON e.assigned_branch_id = b.branch_id; </p>
<p class="calibre1">The first subquery, which starts on line 3 and is given the alias e, finds all experienced tellers. The second subquery, which starts on line 9 and is given the alias b, finds the ID of the Woburn branch. First, the account table is joined to the experienced-teller subquery using the employee ID and then the table that results is joined to the Woburn branch subquery using the branch ID. The results are the same as those of the previous version of the query (try it and see for yourself), but the queries look very different from one another. </p>
<p class="calibre1">There isn’t really anything shocking here, but it might take a minute to figure out what’s going on. Notice, for example, the lack of a where clause in the main query; since all the filter conditions are against the employee and branch tables, the filter conditions are all inside the subqueries, so there is no need for any filter conditions in the main query. </p>
<p class="calibre1">One way to visualize what is going on is to run the subqueries and look at the result sets. Here are the results of the first subquery against the employee table: mysql&gt; <b class="calibre3">SELECT emp_id, assigned_branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE start_date &lt; '2007-01-01' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND (title = 'Teller' OR title = 'Head Teller'); </b></p>
<p class="calibre1">+--------+--------------------+</p>
<p class="calibre1">| emp_id | assigned_branch_id |</p>
<p class="calibre1">+--------+--------------------+</p>
<p class="calibre1">|      8 |                  1 |</p>
<p class="calibre1">|      9 |                  1 |</p>
<p class="calibre1">|     10 |                  2 |</p>
<p class="calibre1">|     11 |                  2 |</p>
<p class="calibre1">|     13 |                  3 |</p>
<p class="calibre1">|     14 |                  3 |</p>
<p class="calibre1">|     16 |                  4 |</p>
<p class="calibre1">|     17 |                  4 |</p>
<p class="calibre1">|     18 |                  4 |</p>
<p class="calibre1">+--------+--------------------+</p>
<p class="calibre1">9 rows in set (0.03 sec)</p>
<p class="calibre1">Thus, this result set consists of a set of employee IDs and their corresponding branch IDs. When they are joined to the account table via the emp_id column, you now have an intermediate result set consisting of all rows from the account table with the additional column holding the branch ID of the employee that opened each account. Here are the results of the second subquery against the branch table: mysql&gt; <b class="calibre3">SELECT branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM branch</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE name = 'Woburn Branch'; </b></p>
<p class="calibre1"><b class="calibre3">Joining Three or More Tables | 91</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-54"></a>+-----------+</p>
<p class="calibre1">| branch_id |</p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">|         2 |</p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">1 row in set (0.02 sec)</p>
<p class="calibre1">This query returns a single row containing a single column: the ID of the Woburn branch. This table is joined to the assigned_branch_id column of the intermediate result set, causing all accounts opened by non-Woburn-based employees to be filtered out of the final result set. </p>
<p class="calibre1"><b class="calibre3">Using the Same Table Twice</b></p>
<p class="calibre1">If you are joining multiple tables, you might find that you need to join the same table more than once. In the sample database, for example, there are foreign keys to the branch table from both the account table (the branch at which the account was opened) and the employee table (the branch at which the employee works). If you want to include <i class="calibre4">both</i> branches in your result set, you can include the branch table twice in the from clause, joined once to the employee table and once to the account table. For this to work, you will need to give each instance of the branch table a different alias so that the server knows which one you are referring to in the various clauses, as in: mysql&gt; <b class="calibre3">SELECT a.account_id, e.emp_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">b_a.name open_branch, b_e.name emp_branch</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN branch b_a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_branch_id = b_a.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_emp_id = e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN branch b_e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.assigned_branch_id = b_e.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE a.product_cd = 'CHK'; </b></p>
<p class="calibre1">+------------+--------+---------------+---------------+</p>
<p class="calibre1">| account_id | emp_id | open_branch   | emp_branch    |</p>
<p class="calibre1">+------------+--------+---------------+---------------+</p>
<p class="calibre1">|         10 |      1 | Headquarters  | Headquarters  |</p>
<p class="calibre1">|         14 |      1 | Headquarters  | Headquarters  |</p>
<p class="calibre1">|         21 |      1 | Headquarters  | Headquarters  |</p>
<p class="calibre1">|          1 |     10 | Woburn Branch | Woburn Branch |</p>
<p class="calibre1">|          4 |     10 | Woburn Branch | Woburn Branch |</p>
<p class="calibre1">|          7 |     13 | Quincy Branch | Quincy Branch |</p>
<p class="calibre1">|         13 |     16 | So. NH Branch | So. NH Branch |</p>
<p class="calibre1">|         18 |     16 | So. NH Branch | So. NH Branch |</p>
<p class="calibre1">|         24 |     16 | So. NH Branch | So. NH Branch |</p>
<p class="calibre1">|         28 |     16 | So. NH Branch | So. NH Branch |</p>
<p class="calibre1">+------------+--------+---------------+---------------+</p>
<p class="calibre1">10 rows in set (0.16 sec)</p>
<p class="calibre1">This query shows who opened each checking account, what branch it was opened at, and to which branch the employee who opened the account is currently assigned. The branch table is included twice, with aliases b_a and b_e. By assigning different aliases <b class="calibre3">92 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-55"></a>to each instance of the branch table, the server is able to understand which instance you are referring to: the one joined to the account table, or the one joined to the employee table. Therefore, this is one example of a query that  <i class="calibre4">requires</i> the use of table aliases. </p>
<p class="calibre1"><b class="calibre3">Self-Joins</b></p>
<p class="calibre1">Not only can you include the same table more than once in the same query, but you can actually join a table to itself. This might seem like a strange thing to do at first, but there are valid reasons for doing so. The employee table, for example, includes a  <i class="calibre4">self-referencing foreign key</i>, which means that it includes a column (superior_emp_id) that points to the primary key within the same table. This column points to the employee’s manager (unless the employee is the head honcho, in which case the column is null). </p>
<p class="calibre1">Using a  <i class="calibre4">self-join</i>, you can write a query that lists every employee’s name along with the name of his or her manager:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">e_mgr.fname mgr_fname, e_mgr.lname mgr_lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN employee e_mgr</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.superior_emp_id = e_mgr.emp_id; </b></p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">| fname    | lname     | mgr_fname | mgr_lname |</p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">| Susan    | Barker    | Michael   | Smith     |</p>
<p class="calibre1">| Robert   | Tyler     | Michael   | Smith     |</p>
<p class="calibre1">| Susan    | Hawthorne | Robert    | Tyler     |</p>
<p class="calibre1">| John     | Gooding   | Susan     | Hawthorne |</p>
<p class="calibre1">| Helen    | Fleming   | Susan     | Hawthorne |</p>
<p class="calibre1">| Chris    | Tucker    | Helen     | Fleming   |</p>
<p class="calibre1">| Sarah    | Parker    | Helen     | Fleming   |</p>
<p class="calibre1">| Jane     | Grossman  | Helen     | Fleming   |</p>
<p class="calibre1">| Paula    | Roberts   | Susan     | Hawthorne |</p>
<p class="calibre1">| Thomas   | Ziegler   | Paula     | Roberts   |</p>
<p class="calibre1">| Samantha | Jameson   | Paula     | Roberts   |</p>
<p class="calibre1">| John     | Blake     | Susan     | Hawthorne |</p>
<p class="calibre1">| Cindy    | Mason     | John      | Blake     |</p>
<p class="calibre1">| Frank    | Portman   | John      | Blake     |</p>
<p class="calibre1">| Theresa  | Markham   | Susan     | Hawthorne |</p>
<p class="calibre1">| Beth     | Fowler    | Theresa   | Markham   |</p>
<p class="calibre1">| Rick     | Tulman    | Theresa   | Markham   |</p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">17 rows in set (0.00 sec)</p>
<p class="calibre1">This query includes two instances of the employee table: one to provide employee names (with the table alias e), and the other to provide manager names (with the table alias e_mgr). The on subclause uses these aliases to join the employee table to itself via the superior_emp_id foreign key. This is another example of a query for which table aliases are required; otherwise, the server wouldn’t know whether you are referring to an employee or an employee’s manager. </p>
<p class="calibre1"><b class="calibre3">Self-Joins | 93</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-56"></a>While there are 18 rows in the employee table, the query returned only 17 rows; the president of the bank, Michael Smith, has no superior (his superior_emp_id column is null), so the join failed for his row. To include Michael Smith in the result set, you</p>
<p class="calibre1"><a href="#calibre_link-100">would need to use an outer join, which we cover in Chapter 10. </a></p>
<p class="calibre1"><b class="calibre3">Equi-Joins Versus Non-Equi-Joins</b></p>
<p class="calibre1">All of the multitable queries shown thus far have employed  <i class="calibre4">equi-joins</i>, meaning that values from the two tables must match for the join to succeed. An equi-join always employs an equals sign, as in:</p>
<p class="calibre1">ON e.assigned_branch_id = b.branch_id</p>
<p class="calibre1">While the majority of your queries will employ equi-joins, you can also join your tables via ranges of values, which are referred to as  <i class="calibre4">non-equi-joins</i>. Here’s an example of a query that joins by a range of values:</p>
<p class="calibre1">SELECT e.emp_id, e.fname, e.lname, e.start_date</p>
<p class="calibre1">FROM employee e INNER JOIN product p</p>
<p class="calibre1"><b class="calibre3">ON e.start_date &gt;= p.date_offered</b></p>
<p class="calibre1"><b class="calibre3">AND e.start_date &lt;= p.date_retired</b></p>
<p class="calibre1">WHERE p.name = 'no-fee checking'; </p>
<p class="calibre1">This query joins two tables that have no foreign key relationships. The intent is to find all employees who began working for the bank while the No-Fee Checking product was being offered. Thus, an employee’s start date must be between the date the product was offered and the date the product was retired. </p>
<p class="calibre1">You may also find a need for a  <i class="calibre4">self-non-equi-join</i>, meaning that a table is joined to itself using a non-equi-join. For example, let’s say that the operations manager has decided to have a chess tournament for all bank tellers. You have been asked to create a list of all the pairings. You might try joining the employee table to itself for all tellers (title =</p>
<p class="calibre1">'Teller') and return all rows where the emp_ids don’t match (since a person can’t play chess against himself):</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e1.fname, e1.lname, 'VS' vs, e2.fname, e2.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e1 INNER JOIN employee e2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e1.emp_id != e2.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e1.title = 'Teller' AND e2.title = 'Teller'; </b></p>
<p class="calibre1">+----------+----------+----+----------+----------+</p>
<p class="calibre1">| fname    | lname    | vs | fname    | lname    |</p>
<p class="calibre1">+----------+----------+----+----------+----------+</p>
<p class="calibre1">| Sarah    | Parker   | VS | Chris    | Tucker   |</p>
<p class="calibre1">| Jane     | Grossman | VS | Chris    | Tucker   |</p>
<p class="calibre1">| Thomas   | Ziegler  | VS | Chris    | Tucker   |</p>
<p class="calibre1">| Samantha | Jameson  | VS | Chris    | Tucker   |</p>
<p class="calibre1">| Cindy    | Mason    | VS | Chris    | Tucker   |</p>
<p class="calibre1">| Frank    | Portman  | VS | Chris    | Tucker   |</p>
<p class="calibre1">| Beth     | Fowler   | VS | Chris    | Tucker   |</p>
<p class="calibre1">| Rick     | Tulman   | VS | Chris    | Tucker   |</p>
<p class="calibre1">| Chris    | Tucker   | VS | Sarah    | Parker   |</p>
<p class="calibre1"><b class="calibre3">94 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-296"></a>| Jane     | Grossman | VS | Sarah    | Parker   |</p>
<p class="calibre1">| Thomas   | Ziegler  | VS | Sarah    | Parker   |</p>
<p class="calibre1">| Samantha | Jameson  | VS | Sarah    | Parker   |</p>
<p class="calibre1">| Cindy    | Mason    | VS | Sarah    | Parker   |</p>
<p class="calibre1">| Frank    | Portman  | VS | Sarah    | Parker   |</p>
<p class="calibre1">| Beth     | Fowler   | VS | Sarah    | Parker   |</p>
<p class="calibre1">| Rick     | Tulman   | VS | Sarah    | Parker   |</p>
<p class="calibre1">... </p>
<p class="calibre1">| Chris    | Tucker   | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Sarah    | Parker   | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Jane     | Grossman | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Thomas   | Ziegler  | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Samantha | Jameson  | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Cindy    | Mason    | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Frank    | Portman  | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Beth     | Fowler   | VS | Rick     | Tulman   |</p>
<p class="calibre1">+----------+----------+----+----------+----------+</p>
<p class="calibre1">72 rows in set (0.01 sec)</p>
<p class="calibre1">You’re on the right track, but the problem here is that for each pairing (e.g., Sarah Parker versus Chris Tucker), there is also a reverse pairing (e.g., Chris Tucker versus Sarah  Parker).  One  way  to  achieve  the  desired  results  is  to  use  the  join  condition e1.emp_id &lt; e2.emp_id so that each teller is paired only with those tellers having a higher employee ID (you can also use e1.emp_id &gt; e2.emp_id if you wish): mysql&gt; <b class="calibre3">SELECT e1.fname, e1.lname, 'VS' vs, e2.fname, e2.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e1 INNER JOIN employee e2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e1.emp_id &lt; e2.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e1.title = 'Teller' AND e2.title = 'Teller'; </b></p>
<p class="calibre1">+----------+----------+----+----------+----------+</p>
<p class="calibre1">| fname    | lname    | vs | fname    | lname    |</p>
<p class="calibre1">+----------+----------+----+----------+----------+</p>
<p class="calibre1">| Chris    | Tucker   | VS | Sarah    | Parker   |</p>
<p class="calibre1">| Chris    | Tucker   | VS | Jane     | Grossman |</p>
<p class="calibre1">| Sarah    | Parker   | VS | Jane     | Grossman |</p>
<p class="calibre1">| Chris    | Tucker   | VS | Thomas   | Ziegler  |</p>
<p class="calibre1">| Sarah    | Parker   | VS | Thomas   | Ziegler  |</p>
<p class="calibre1">| Jane     | Grossman | VS | Thomas   | Ziegler  |</p>
<p class="calibre1">| Chris    | Tucker   | VS | Samantha | Jameson  |</p>
<p class="calibre1">| Sarah    | Parker   | VS | Samantha | Jameson  |</p>
<p class="calibre1">| Jane     | Grossman | VS | Samantha | Jameson  |</p>
<p class="calibre1">| Thomas   | Ziegler  | VS | Samantha | Jameson  |</p>
<p class="calibre1">| Chris    | Tucker   | VS | Cindy    | Mason    |</p>
<p class="calibre1">| Sarah    | Parker   | VS | Cindy    | Mason    |</p>
<p class="calibre1">| Jane     | Grossman | VS | Cindy    | Mason    |</p>
<p class="calibre1">| Thomas   | Ziegler  | VS | Cindy    | Mason    |</p>
<p class="calibre1">| Samantha | Jameson  | VS | Cindy    | Mason    |</p>
<p class="calibre1">| Chris    | Tucker   | VS | Frank    | Portman  |</p>
<p class="calibre1">| Sarah    | Parker   | VS | Frank    | Portman  |</p>
<p class="calibre1">| Jane     | Grossman | VS | Frank    | Portman  |</p>
<p class="calibre1">| Thomas   | Ziegler  | VS | Frank    | Portman  |</p>
<p class="calibre1">| Samantha | Jameson  | VS | Frank    | Portman  |</p>
<p class="calibre1">| Cindy    | Mason    | VS | Frank    | Portman  |</p>
<p class="calibre1">| Chris    | Tucker   | VS | Beth     | Fowler   |</p>
<p class="calibre1">| Sarah    | Parker   | VS | Beth     | Fowler   |</p>
<p class="calibre1"><b class="calibre3">Equi-Joins Versus Non-Equi-Joins | 95</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-57"></a>| Jane     | Grossman | VS | Beth     | Fowler   |</p>
<p class="calibre1">| Thomas   | Ziegler  | VS | Beth     | Fowler   |</p>
<p class="calibre1">| Samantha | Jameson  | VS | Beth     | Fowler   |</p>
<p class="calibre1">| Cindy    | Mason    | VS | Beth     | Fowler   |</p>
<p class="calibre1">| Frank    | Portman  | VS | Beth     | Fowler   |</p>
<p class="calibre1">| Chris    | Tucker   | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Sarah    | Parker   | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Jane     | Grossman | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Thomas   | Ziegler  | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Samantha | Jameson  | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Cindy    | Mason    | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Frank    | Portman  | VS | Rick     | Tulman   |</p>
<p class="calibre1">| Beth     | Fowler   | VS | Rick     | Tulman   |</p>
<p class="calibre1">+----------+----------+----+----------+----------+</p>
<p class="calibre1">36 rows in set (0.00 sec)</p>
<p class="calibre1">You now have a list of 36 pairings, which is the correct number when choosing pairs of 9 distinct things. </p>
<p class="calibre1"><b class="calibre3">Join Conditions Versus Filter Conditions</b></p>
<p class="calibre1">You are now familiar with the concept that join conditions belong in the on subclause, while filter conditions belong in the where clause. However, SQL is flexible as to where you place your conditions, so you will need to take care when constructing your queries. </p>
<p class="calibre1">For example, the following query joins two tables using a single join condition, and also includes a single filter condition in the where clause:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.product_cd, c.fed_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE c.cust_type_cd = 'B'; </b></p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">| account_id | product_cd | fed_id     |</p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">|         24 | CHK        | 04-1111111 |</p>
<p class="calibre1">|         25 | BUS        | 04-1111111 |</p>
<p class="calibre1">|         27 | BUS        | 04-2222222 |</p>
<p class="calibre1">|         28 | CHK        | 04-3333333 |</p>
<p class="calibre1">|         29 | SBL        | 04-4444444 |</p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">5 rows in set (0.01 sec)</p>
<p class="calibre1">That was pretty straightforward, but what happens if you mistakenly put the filter condition in the on subclause instead of in the where clause? </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.product_cd, c.fed_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND c.cust_type_cd = 'B'; </b></p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">| account_id | product_cd | fed_id     |</p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">|         24 | CHK        | 04-1111111 |</p>
<p class="calibre1"><b class="calibre3">96 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-58"></a>|         25 | BUS        | 04-1111111 |</p>
<p class="calibre1">|         27 | BUS        | 04-2222222 |</p>
<p class="calibre1">|         28 | CHK        | 04-3333333 |</p>
<p class="calibre1">|         29 | SBL        | 04-4444444 |</p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">5 rows in set (0.01 sec)</p>
<p class="calibre1">As you can see, the second version, which has  <i class="calibre4">both</i> conditions in the on subclause and has no where clause, generates the same results. What if both conditions are placed in the where clause but the from clause still uses the ANSI join syntax? </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.product_cd, c.fed_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND c.cust_type_cd = 'B'; </b></p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">| account_id | product_cd | fed_id     |</p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">|         24 | CHK        | 04-1111111 |</p>
<p class="calibre1">|         25 | BUS        | 04-1111111 |</p>
<p class="calibre1">|         27 | BUS        | 04-2222222 |</p>
<p class="calibre1">|         28 | CHK        | 04-3333333 |</p>
<p class="calibre1">|         29 | SBL        | 04-4444444 |</p>
<p class="calibre1">+------------+------------+------------+</p>
<p class="calibre1">5 rows in set (0.01 sec)</p>
<p class="calibre1">Once again, the MySQL server has generated the same result set. It will be up to you to put your conditions in the proper place so that your queries are easy to understand and maintain. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">The following exercises are designed to test your understanding of inner joins. Please</p>
<p class="calibre1"><a href="#calibre_link-152">see Appendix C for the solutions to these exercises. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 5-1</b></p>
<p class="calibre1">Fill in the blanks (denoted by &lt;  <i class="calibre4">#</i>&gt;) for the following query to obtain the results that follow:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.emp_id, e.fname, e.lname, b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN &lt;1&gt; b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.assigned_branch_id = b.&lt;2&gt;; </b></p>
<p class="calibre1">+--------+----------+-----------+---------------+</p>
<p class="calibre1">| emp_id | fname    | lname     | name          |</p>
<p class="calibre1">+--------+----------+-----------+---------------+</p>
<p class="calibre1">|      1 | Michael  | Smith     | Headquarters  |</p>
<p class="calibre1">|      2 | Susan    | Barker    | Headquarters  |</p>
<p class="calibre1">|      3 | Robert   | Tyler     | Headquarters  |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne | Headquarters  |</p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 97</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-244"></a>|      5 | John     | Gooding   | Headquarters  |</p>
<p class="calibre1">|      6 | Helen    | Fleming   | Headquarters  |</p>
<p class="calibre1">|      7 | Chris    | Tucker    | Headquarters  |</p>
<p class="calibre1">|      8 | Sarah    | Parker    | Headquarters  |</p>
<p class="calibre1">|      9 | Jane     | Grossman  | Headquarters  |</p>
<p class="calibre1">|     10 | Paula    | Roberts   | Woburn Branch |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   | Woburn Branch |</p>
<p class="calibre1">|     12 | Samantha | Jameson   | Woburn Branch |</p>
<p class="calibre1">|     13 | John     | Blake     | Quincy Branch |</p>
<p class="calibre1">|     14 | Cindy    | Mason     | Quincy Branch |</p>
<p class="calibre1">|     15 | Frank    | Portman   | Quincy Branch |</p>
<p class="calibre1">|     16 | Theresa  | Markham   | So. NH Branch |</p>
<p class="calibre1">|     17 | Beth     | Fowler    | So. NH Branch |</p>
<p class="calibre1">|     18 | Rick     | Tulman    | So. NH Branch |</p>
<p class="calibre1">+--------+----------+-----------+---------------+</p>
<p class="calibre1">18 rows in set (0.03 sec)</p>
<p class="calibre1"><b class="calibre3">Exercise 5-2</b></p>
<p class="calibre1">Write  a  query  that  returns  the  account  ID  for  each  nonbusiness  customer (customer.cust_type_cd = 'I') with the customer’s federal ID (customer.fed_id) and the name of the product on which the account is based (product.name). </p>
<p class="calibre1"><b class="calibre3">Exercise 5-3</b></p>
<p class="calibre1">Construct a query that finds all employees whose supervisor is assigned to a different department. Retrieve the employees’ ID, first name, and last name. </p>
<p class="calibre1"><b class="calibre3">98 | Chapter 5:</b> <b class="calibre3">Querying Multiple Tables</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-59"></a><b class="calibre3">CHAPTER 6</b></p>
<p class="calibre1"><b class="calibre3">Working with Sets</b></p>
<p class="calibre1">Although you can interact with the data in a database one row at a time, relational databases are really all about sets. You have seen how you can create tables via queries or subqueries, make them persistent via insert statements, and bring them together via joins; this chapter explores how you can combine multiple tables using various set operators. </p>
<p class="calibre1"><b class="calibre3">Set Theory Primer</b></p>
<p class="calibre1">In many parts of the world, basic set theory is included in elementary-level math cur-</p>
<p class="calibre1"><a href="#calibre_link-59">riculums. Perhaps you recall looking at something like what is shown in Figure 6-1. </a></p>
<p class="calibre1">A</p>
<p class="calibre1">B</p>
<p class="calibre1">= A union B</p>
<p class="calibre1"> <i class="calibre4">Figure 6-1. The union operation</i></p>
<p class="calibre1">The shaded area in <a href="#calibre_link-59">Figure 6-1 represents the </a> <i class="calibre4">union</i> of sets A and B, which is the combination  of  the  two  sets  (with  any  overlapping  regions  included  only  once).  Is  this starting to look familiar? If so, then you’ll finally get a chance to put that knowledge to use; if not, don’t worry, because it’s easy to visualize using a couple of diagrams. </p>
<p class="calibre1"><b class="calibre3">99</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-160"></a>Using circles to represent two data sets (A and B), imagine a subset of data that is common to both sets; this common data is represented by the overlapping area shown</p>
<p class="calibre1"><a href="#calibre_link-59">in Figure 6-1</a>. Since set theory is rather uninteresting without an overlap between data sets, I use the same diagram to illustrate each set operation. There is another set operation that is concerned  <i class="calibre4">only</i> with the overlap between two data sets; this operation is known as the  <i class="calibre4">intersection</i><a href="#calibre_link-160"> and is demonstrated in Figure 6-2. </a></p>
<p class="calibre1">A</p>
<p class="calibre1">B</p>
<p class="calibre1">= A intersect B</p>
<p class="calibre1"> <i class="calibre4">Figure 6-2. The intersection operation</i></p>
<p class="calibre1">The data set generated by the intersection of sets A and B is just the area of overlap between the two sets. If the two sets have no overlap, then the intersection operation yields the empty set. </p>
<p class="calibre1">The third and final set operation, which is demonstrated <a href="#calibre_link-160">in Figure 6-3, </a>is known as the <i class="calibre4">except</i> operation. </p>
<p class="calibre1">A</p>
<p class="calibre1">B</p>
<p class="calibre1">= A except B</p>
<p class="calibre1"> <i class="calibre4">Figure 6-3. The except operation</i></p>
<p class="calibre1"><b class="calibre3">100 | Chapter 6:</b> <b class="calibre3">Working with Sets</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-60"></a><a href="#calibre_link-160">Figure 6-3 </a>shows the results of A except B, which is the whole of set A minus any overlap with set B. If the two sets have no overlap, then the operation A except B yields the whole of set A. </p>
<p class="calibre1">Using these three operations, or by combining different operations together, you can generate whatever results you need. For example, imagine that you want to build a set</p>
<p class="calibre1"><a href="#calibre_link-60">demonstrated by Figure 6-4. </a></p>
<p class="calibre1">A</p>
<p class="calibre1">B</p>
<p class="calibre1">= ???? </p>
<p class="calibre1"> <i class="calibre4">Figure 6-4. Mystery data set</i></p>
<p class="calibre1">The data set you are looking for includes all of sets A and B  <i class="calibre4">without</i> the overlapping region. You can’t achieve this outcome with just one of the three operations shown earlier; instead, you will need to first build a data set that encompasses all of sets A and B, and then utilize a second operation to remove the overlapping region. If the combined set is described as A union B, and the overlapping region is described as A intersect B<a href="#calibre_link-60">, then the operation needed to generate the data set represented by Figure 6-4</a> would look as follows:</p>
<p class="calibre1">(A union B) except (A intersect B)</p>
<p class="calibre1">Of course, there are often multiple ways to achieve the same results; you could reach a similar outcome using the following operation:</p>
<p class="calibre1">(A except B) union (B except A)</p>
<p class="calibre1">While these concepts are fairly easy to understand using diagrams, the next sections show you how these concepts are applied to a relational database using the SQL set operators. </p>
<p class="calibre1"><b class="calibre3">Set Theory in Practice</b></p>
<p class="calibre1">The circles used in the previous section’s diagrams to represent data sets don’t convey anything about what the data sets comprise. When dealing with actual data, however, <b class="calibre3">Set Theory in Practice | 101</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-232"></a>there is a need to describe the composition of the data sets involved if they are to be combined. Imagine, for example, what would happen if you tried to generate the union of the product table and the customer table, whose table definitions are as follows: mysql&gt; <b class="calibre3">DESC product; </b></p>
<p class="calibre1">+-----------------+-------------+------+-----+---------+-------+</p>
<p class="calibre1">| Field           | Type        | Null | Key | Default | Extra |</p>
<p class="calibre1">+-----------------+-------------+------+-----+---------+-------+</p>
<p class="calibre1">| product_cd      | varchar(10) | NO   | PRI | NULL    |       |</p>
<p class="calibre1">| name            | varchar(50) | NO   |     | NULL    |       |</p>
<p class="calibre1">| product_type_cd | varchar(10) | NO   | MUL | NULL    |       |</p>
<p class="calibre1">| date_offered    | date        | YES  |     | NULL    |       |</p>
<p class="calibre1">| date_retired    | date        | YES  |     | NULL    |       |</p>
<p class="calibre1">+-----------------+-------------+------+-----+---------+-------+</p>
<p class="calibre1">5 rows in set (0.23 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DESC customer; </b></p>
<p class="calibre1">+--------------+------------------+------+-----+---------+----------------+</p>
<p class="calibre1">| Field        | Type             | Null | Key | Default | Extra          |</p>
<p class="calibre1">+--------------+------------------+------+-----+---------+----------------+</p>
<p class="calibre1">| cust_id      | int(10) unsigned | NO   | PRI | NULL    | auto_increment |</p>
<p class="calibre1">| fed_id       | varchar(12)      | NO   |     | NULL    |                |</p>
<p class="calibre1">| cust_type_cd | enum('I','B')    | NO   |     | NULL    |                |</p>
<p class="calibre1">| address      | varchar(30)      | YES  |     | NULL    |                |</p>
<p class="calibre1">| city         | varchar(20)      | YES  |     | NULL    |                |</p>
<p class="calibre1">| state        | varchar(20)      | YES  |     | NULL    |                |</p>
<p class="calibre1">| postal_code  | varchar(10)      | YES  |     | NULL    |                |</p>
<p class="calibre1">+--------------+------------------+------+-----+---------+----------------+</p>
<p class="calibre1">7 rows in set (0.04 sec)</p>
<p class="calibre1">When combined, the first column in the table that results would be the combination of the product.product_cd and customer.cust_id columns, the second column would be the combination of the product.name and customer.fed_id columns, and so forth. </p>
<p class="calibre1">While some of the column pairs are easy to combine (e.g., two numeric columns), it is unclear how other column pairs should be combined, such as a numeric column with a string column or a string column with a date column. Additionally, the sixth and seventh columns of the combined tables would include data from only the customer table’s  sixth  and  seventh  columns,  since  the  product  table  has  only  five  columns. </p>
<p class="calibre1">Clearly, there needs to be some commonality between two tables that you wish to combine. </p>
<p class="calibre1">Therefore, when performing set operations on two data sets, the following guidelines must apply:</p>
<p class="calibre1">• Both data sets must have the same number of columns. </p>
<p class="calibre1">• The data types of each column across the two data sets must be the same (or the server must be able to convert one to the other). </p>
<p class="calibre1">With these rules in place, it is easier to envision what “overlapping data” means in practice; each column pair from the two sets being combined must contain the same string, number, or date for rows in the two tables to be considered the same. </p>
<p class="calibre1"><b class="calibre3">102 | Chapter 6:</b> <b class="calibre3">Working with Sets</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-61"></a>You perform a set operation by placing a  <i class="calibre4">set operator</i> between two select statements, as demonstrated by the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT 1 num, 'abc' str</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 9 num, 'xyz' str; </b></p>
<p class="calibre1">+-----+-----+</p>
<p class="calibre1">| num | str |</p>
<p class="calibre1">+-----+-----+</p>
<p class="calibre1">|   1 | abc |</p>
<p class="calibre1">|   9 | xyz |</p>
<p class="calibre1">+-----+-----+</p>
<p class="calibre1">2 rows in set (0.02 sec)</p>
<p class="calibre1">Each  of  the  individual  queries  yields  a  data  set  consisting  of  a  single  row  having  a numeric column and a string column. The set operator, which in this case is union, tells the database server to combine all rows from the two sets. Thus, the final set includes two rows of two columns. This query is known as a  <i class="calibre4">compound query</i> because it comprises multiple, otherwise-independent queries. As you will see later, compound queries may include  <i class="calibre4">more</i> than two queries if multiple set operations are needed to attain the final results. </p>
<p class="calibre1"><b class="calibre3">Set Operators</b></p>
<p class="calibre1">The SQL language includes three set operators that allow you to perform each of the various set operations described earlier in the chapter. Additionally, each set operator has two flavors, one that includes duplicates and another that removes duplicates (but not necessarily  <i class="calibre4">all</i> of the duplicates). The following subsections define each operator and demonstrate how they are used. </p>
<p class="calibre1"><b class="calibre3">The union Operator</b></p>
<p class="calibre1">The union and union all operators allow you to combine multiple data sets. The difference between the two is that union sorts the combined set and removes duplicates, whereas union all does not. With union all, the number of rows in the final data set will always equal the sum of the number of rows in the sets being combined. This operation is the simplest set operation to perform (from the server’s point of view), since there is no need for the server to check for overlapping data. The following example demonstrates how you can use the union all operator to generate a full set of customer data from the two customer subtype tables:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT 'IND' type_cd, cust_id, lname name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM individual</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'BUS' type_cd, cust_id, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM business; </b></p>
<p class="calibre1">+---------+---------+------------------------+</p>
<p class="calibre1">| type_cd | cust_id | name                   |</p>
<p class="calibre1">+---------+---------+------------------------+</p>
<p class="calibre1"><b class="calibre3">Set Operators | 103</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-203"></a>| IND     |       1 | Hadley                 |</p>
<p class="calibre1">| IND     |       2 | Tingley                |</p>
<p class="calibre1">| IND     |       3 | Tucker                 |</p>
<p class="calibre1">| IND     |       4 | Hayward                |</p>
<p class="calibre1">| IND     |       5 | Frasier                |</p>
<p class="calibre1">| IND     |       6 | Spencer                |</p>
<p class="calibre1">| IND     |       7 | Young                  |</p>
<p class="calibre1">| IND     |       8 | Blake                  |</p>
<p class="calibre1">| IND     |       9 | Farley                 |</p>
<p class="calibre1">| BUS     |      10 | Chilton Engineering    |</p>
<p class="calibre1">| BUS     |      11 | Northeast Cooling Inc. |</p>
<p class="calibre1">| BUS     |      12 | Superior Auto Body     |</p>
<p class="calibre1">| BUS     |      13 | AAA Insurance Inc.     |</p>
<p class="calibre1">+---------+---------+------------------------+</p>
<p class="calibre1">13 rows in set (0.04 sec)</p>
<p class="calibre1">The query returns all 13 customers, with nine rows coming from the individual table and the other four coming from the business table. While the business table includes a single column to hold the company name, the individual table includes two name columns, one each for the person’s first and last names. In this case, I chose to include only the last name from the individual table. </p>
<p class="calibre1">Just to drive home the point that the union all operator doesn’t remove duplicates, here’s the same query as the previous example but with an additional query against the business table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT 'IND' type_cd, cust_id, lname name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM individual</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'BUS' type_cd, cust_id, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM business</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'BUS' type_cd, cust_id, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM business</b>; </p>
<p class="calibre1">+---------+---------+------------------------+</p>
<p class="calibre1">| type_cd | cust_id | name                   |</p>
<p class="calibre1">+---------+---------+------------------------+</p>
<p class="calibre1">| IND     |       1 | Hadley                 |</p>
<p class="calibre1">| IND     |       2 | Tingley                |</p>
<p class="calibre1">| IND     |       3 | Tucker                 |</p>
<p class="calibre1">| IND     |       4 | Hayward                |</p>
<p class="calibre1">| IND     |       5 | Frasier                |</p>
<p class="calibre1">| IND     |       6 | Spencer                |</p>
<p class="calibre1">| IND     |       7 | Young                  |</p>
<p class="calibre1">| IND     |       8 | Blake                  |</p>
<p class="calibre1">| IND     |       9 | Farley                 |</p>
<p class="calibre1">| BUS     |      10 | Chilton Engineering    |</p>
<p class="calibre1">| BUS     |      11 | Northeast Cooling Inc. |</p>
<p class="calibre1">| BUS     |      12 | Superior Auto Body     |</p>
<p class="calibre1">| BUS     |      13 | AAA Insurance Inc.     |</p>
<p class="calibre1">| BUS     |      10 | Chilton Engineering    |</p>
<p class="calibre1">| BUS     |      11 | Northeast Cooling Inc. |</p>
<p class="calibre1">| BUS     |      12 | Superior Auto Body     |</p>
<p class="calibre1">| BUS     |      13 | AAA Insurance Inc.     |</p>
<p class="calibre1"><b class="calibre3">104 | Chapter 6:</b> <b class="calibre3">Working with Sets</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-202"></a>+---------+---------+------------------------+</p>
<p class="calibre1">17 rows in set (0.01 sec)</p>
<p class="calibre1">This compound query includes three select statements, two of which are identical. As you can see by the results, the four rows from the business table are included twice (customer IDs 10, 11, 12, and 13). </p>
<p class="calibre1">While you are unlikely to repeat the same query twice in a compound query, here is another compound query that returns duplicate data:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE assigned_branch_id = 2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND (title = 'Teller' OR title = 'Head Teller')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT DISTINCT open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE open_branch_id = 2; </b></p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">|     11 |</p>
<p class="calibre1">|     12 |</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">4 rows in set (0.01 sec)</p>
<p class="calibre1">The first query in the compound statement retrieves all tellers assigned to the Woburn branch, whereas the second query returns the distinct set of tellers who opened accounts at the Woburn branch. Of the four rows in the result set, one of them is a duplicate (employee ID 10). If you would like your combined table to  <i class="calibre4">exclude</i> duplicate rows, you need to use the union operator instead of union all: mysql&gt; <b class="calibre3">SELECT emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE assigned_branch_id = 2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND (title = 'Teller' OR title = 'Head Teller')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT DISTINCT open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE open_branch_id = 2; </b></p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">|     11 |</p>
<p class="calibre1">|     12 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">3 rows in set (0.01 sec)</p>
<p class="calibre1">For this version of the query, only the three distinct rows are included in the result set, rather than the four rows (three distinct, one duplicate) returned when using union all. </p>
<p class="calibre1"><b class="calibre3">Set Operators | 105</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-62"></a><b class="calibre3">The intersect Operator</b></p>
<p class="calibre1">The ANSI SQL specification includes the intersect operator for performing intersec-tions. Unfortunately, version 6.0 of MySQL does not implement the intersect operator. If you are using Oracle or SQL Server 2008, you will be able to use intersect; since I am using MySQL for all examples in this book, however, the result sets for the example queries in this section are fabricated and cannot be executed with any versions up to and including version 6.0. I also refrain from showing the MySQL prompt (mysql&gt;), since the statements are not being executed by the MySQL server. </p>
<p class="calibre1">If  the  two  queries  in  a  compound  query  return  nonoverlapping  data  sets,  then  the intersection will be an empty set. Consider the following query: <b class="calibre3">SELECT emp_id, fname, lname</b></p>
<p class="calibre1"><b class="calibre3">FROM employee</b></p>
<p class="calibre1"><b class="calibre3">INTERSECT</b></p>
<p class="calibre1"><b class="calibre3">SELECT cust_id, fname, lname</b></p>
<p class="calibre1"><b class="calibre3">FROM individual; </b></p>
<p class="calibre1">Empty set (0.04 sec)</p>
<p class="calibre1">The first query returns the ID and name of each employee, while the second query returns the ID and name of each customer. These sets are completely nonoverlapping, so the intersection of the two sets yields the empty set. </p>
<p class="calibre1">The next step is to identify two queries that  <i class="calibre4">do</i> have overlapping data and then apply the intersect operator. For this purpose, I use the same query used to demonstrate the difference between union and union all, except this time using intersect: <b class="calibre3">SELECT emp_id</b></p>
<p class="calibre1"><b class="calibre3">FROM employee</b></p>
<p class="calibre1"><b class="calibre3">WHERE assigned_branch_id = 2</b></p>
<p class="calibre1"><b class="calibre3">  AND (title = 'Teller' OR title = 'Head Teller')</b></p>
<p class="calibre1"><b class="calibre3">INTERSECT</b></p>
<p class="calibre1"><b class="calibre3">SELECT DISTINCT open_emp_id</b></p>
<p class="calibre1"><b class="calibre3">FROM account</b></p>
<p class="calibre1"><b class="calibre3">WHERE open_branch_id = 2; </b></p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">The intersection of these two queries yields employee ID 10, which is the only value found in both queries’ result sets. </p>
<p class="calibre1">Along with the intersect operator, which removes any duplicate rows found in the overlapping region, the ANSI SQL specification calls for an intersect all operator, which does not remove duplicates. The only database server that currently implements the intersect all operator is IBM’s DB2 Universal Server. </p>
<p class="calibre1"><b class="calibre3">106 | Chapter 6:</b> <b class="calibre3">Working with Sets</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-63"></a><img src="images/000001.png" alt="Image 20" class="calibre2" /></p>
<p class="calibre1"><b class="calibre3">The except Operator</b></p>
<p class="calibre1">The ANSI SQL specification includes the except operator for performing the except operation. Once again, unfortunately, version 6.0 of MySQL does not implement the except operator, so the same rules apply for this section as for the previous section. </p>
<p class="calibre1">If you are using Oracle Database, you will need to use the non-ANSI-compliant minus operator instead. </p>
<p class="calibre1">The except operator returns the first table minus any overlap with the second table. </p>
<p class="calibre1">Here’s the example from the previous section, but using except instead of intersect: <b class="calibre3">SELECT emp_id</b></p>
<p class="calibre1"><b class="calibre3">FROM employee</b></p>
<p class="calibre1"><b class="calibre3">WHERE assigned_branch_id = 2</b></p>
<p class="calibre1"><b class="calibre3">  AND (title = 'Teller' OR title = 'Head Teller')</b></p>
<p class="calibre1"><b class="calibre3">EXCEPT</b></p>
<p class="calibre1"><b class="calibre3">SELECT DISTINCT open_emp_id</b></p>
<p class="calibre1"><b class="calibre3">FROM account</b></p>
<p class="calibre1"><b class="calibre3">WHERE open_branch_id = 2; </b></p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     11 |</p>
<p class="calibre1">|     12 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">2 rows in set (0.01 sec)</p>
<p class="calibre1">In this version of the query, the result set consists of the three rows from the first query minus employee ID 10, which is found in the result sets from both queries. There is also an except all operator specified in the ANSI SQL specification, but once again, only IBM’s DB2 Universal Server has implemented the except all operator. </p>
<p class="calibre1">The except all operator is a bit tricky, so here’s an example to demonstrate how duplicate data is handled. Let’s say you have two data sets that look as follows: <i class="calibre4">Set A</i></p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">|     11 |</p>
<p class="calibre1">|     12 |</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1"><b class="calibre3">Set Operators | 107</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-64"></a> <i class="calibre4">Set B</i></p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">The operation A except B yields the following:</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     11 |</p>
<p class="calibre1">|     12 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">If you change the operation to A except all B, you will see the following:</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     10 |</p>
<p class="calibre1">|     11 |</p>
<p class="calibre1">|     12 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">Therefore, the difference between the two operations is that except removes all occurrences of duplicate data from set A, whereas except all only removes one occurrence of duplicate data from set A for every occurrence in set B. </p>
<p class="calibre1"><b class="calibre3">Set Operation Rules</b></p>
<p class="calibre1">The following sections outline some rules that you must follow when working with compound queries. </p>
<p class="calibre1"><b class="calibre3">Sorting Compound Query Results</b></p>
<p class="calibre1">If you want the results of your compound query to be sorted, you can add an order by clause after the last query. When specifying column names in the order by clause, you will need to choose from the column names in the first query of the compound query. Frequently, the column names are the same for both queries in a compound query, but this does not need to be the case, as demonstrated by the following: mysql&gt; <b class="calibre3">SELECT emp_id, assigned_branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE title = 'Teller' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT open_emp_id, open_branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd = 'SAV' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY emp_id; </b></p>
<p class="calibre1"><b class="calibre3">108 | Chapter 6:</b> <b class="calibre3">Working with Sets</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-65"></a>+--------+--------------------+</p>
<p class="calibre1">| emp_id | assigned_branch_id |</p>
<p class="calibre1">+--------+--------------------+</p>
<p class="calibre1">|      1 |                  1 |</p>
<p class="calibre1">|      7 |                  1 |</p>
<p class="calibre1">|      8 |                  1 |</p>
<p class="calibre1">|      9 |                  1 |</p>
<p class="calibre1">|     10 |                  2 |</p>
<p class="calibre1">|     11 |                  2 |</p>
<p class="calibre1">|     12 |                  2 |</p>
<p class="calibre1">|     14 |                  3 |</p>
<p class="calibre1">|     15 |                  3 |</p>
<p class="calibre1">|     16 |                  4 |</p>
<p class="calibre1">|     17 |                  4 |</p>
<p class="calibre1">|     18 |                  4 |</p>
<p class="calibre1">+--------+--------------------+</p>
<p class="calibre1">12 rows in set (0.04 sec)</p>
<p class="calibre1">The column names specified in the two queries are different in this example. If you specify a column name from the second query in your order by clause, you will see the following error:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, assigned_branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE title = 'Teller' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT open_emp_id, open_branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd = 'SAV' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY open_emp_id; </b></p>
<p class="calibre1">ERROR 1054 (42S22): Unknown column 'open_emp_id' in 'order clause' </p>
<p class="calibre1">I recommend giving the columns in both queries identical column aliases in order to avoid this issue. </p>
<p class="calibre1"><b class="calibre3">Set Operation Precedence</b></p>
<p class="calibre1">If your compound query contains more than two queries using different set operators, you need to think about the order in which to place the queries in your compound statement to achieve the desired results. Consider the following three-query compound statement:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd IN ('SAV', 'MM')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT a.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_branch_id = b.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE b.name = 'Woburn Branch' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE avail_balance BETWEEN 500 AND 2500; </b></p>
<p class="calibre1"><b class="calibre3">Set Operation Rules | 109</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-237"></a>+---------+</p>
<p class="calibre1">| cust_id |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       2 |</p>
<p class="calibre1">|       3 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       8 |</p>
<p class="calibre1">|       9 |</p>
<p class="calibre1">|       7 |</p>
<p class="calibre1">|      11 |</p>
<p class="calibre1">|       5 |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">9 rows in set (0.00 sec)</p>
<p class="calibre1">This compound query includes three queries that return sets of nonunique customer IDs; the first and second queries are separated with the union all operator, while the second and third queries are separated with the union operator. While it might not seem to make much difference where the union and union all operators are placed, it does, in fact, make a difference. Here’s the same compound query with the set operators reversed:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd IN ('SAV', 'MM')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT a.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_branch_id = b.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE b.name = 'Woburn Branch' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE avail_balance BETWEEN 500 AND 2500; </b></p>
<p class="calibre1">+---------+</p>
<p class="calibre1">| cust_id |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       2 |</p>
<p class="calibre1">|       3 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       8 |</p>
<p class="calibre1">|       9 |</p>
<p class="calibre1">|       7 |</p>
<p class="calibre1">|      11 |</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       2 |</p>
<p class="calibre1">|       3 |</p>
<p class="calibre1">|       3 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       5 |</p>
<p class="calibre1">|       9 |</p>
<p class="calibre1"><b class="calibre3">110 | Chapter 6:</b> <b class="calibre3">Working with Sets</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-66"></a>+---------+</p>
<p class="calibre1">17 rows in set (0.00 sec)</p>
<p class="calibre1">Looking at the results, it’s obvious that it  <i class="calibre4">does</i> make a difference how the compound query is arranged when using different set operators. In general, compound queries containing three or more queries are evaluated in order from top to bottom, but with the following caveats:</p>
<p class="calibre1">• The ANSI SQL specification calls for the intersect operator to have precedence over the other set operators. </p>
<p class="calibre1">• You may dictate the order in which queries are combined by enclosing multiple queries in parentheses. </p>
<p class="calibre1">However,  since  MySQL  does  not  yet  implement  intersect  or  allow  parentheses  in compound queries, you will need to carefully arrange the queries in your compound query so that you achieve the desired results. If you are using a different database server, you can wrap adjoining queries in parentheses to override the default top-to-bottom processing of compound queries, as in:</p>
<p class="calibre1">(SELECT cust_id</p>
<p class="calibre1">FROM account</p>
<p class="calibre1">WHERE product_cd IN ('SAV', 'MM')</p>
<p class="calibre1">UNION ALL</p>
<p class="calibre1">SELECT a.cust_id</p>
<p class="calibre1">FROM account a INNER JOIN branch b</p>
<p class="calibre1">ON a.open_branch_id = b.branch_id</p>
<p class="calibre1">WHERE b.name = 'Woburn Branch')</p>
<p class="calibre1">INTERSECT</p>
<p class="calibre1">(SELECT cust_id</p>
<p class="calibre1">FROM account</p>
<p class="calibre1">WHERE avail_balance BETWEEN 500 AND 2500</p>
<p class="calibre1">EXCEPT</p>
<p class="calibre1">SELECT cust_id</p>
<p class="calibre1">FROM account</p>
<p class="calibre1">WHERE product_cd = 'CD' </p>
<p class="calibre1">AND avail_balance &lt; 1000); </p>
<p class="calibre1">For this compound query, the first and second queries would be combined using the union all operator, then the third and fourth queries would be combined using the except operator, and finally, the results from these two operations would be combined using the intersect operator to generate the final result set. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">The following exercises are designed to test your understanding of set operations. See</p>
<p class="calibre1"><a href="#calibre_link-152">Appendix C for answers to these exercises. </a></p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 111</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-245"></a><b class="calibre3">Exercise 6-1</b></p>
<p class="calibre1">If set A = {L M N O P} and set B = {P Q R S T}, what sets are generated by the following operations? </p>
<p class="calibre1">• A union B</p>
<p class="calibre1">• A union all B</p>
<p class="calibre1">• A intersect B</p>
<p class="calibre1">• A except B</p>
<p class="calibre1"><b class="calibre3">Exercise 6-2</b></p>
<p class="calibre1">Write a compound query that finds the first and last names of all individual customers along with the first and last names of all employees. </p>
<p class="calibre1"><b class="calibre3">Exercise 6-3</b></p>
<p class="calibre1">Sort the results from Exercise 6-2 by the lname column. </p>
<p class="calibre1"><b class="calibre3">112 | Chapter 6:</b> <b class="calibre3">Working with Sets</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-67"></a><b class="calibre3">CHAPTER 7</b></p>
<p class="calibre1"><b class="calibre3">Data Generation, Conversion, </b></p>
<p class="calibre1"><b class="calibre3">and Manipulation</b></p>
<p class="calibre1">As I mentioned in the Preface, this book strives to teach generic SQL techniques that can be applied across multiple database servers. This chapter, however, deals with the generation, conversion, and manipulation of string, numeric, and temporal data, and the SQL language does not include commands covering this functionality. Rather, built-in functions are used to facilitate data generation, conversion, and manipulation, and while the SQL standard does specify some functions, the database vendors often do not comply with the function specifications. </p>
<p class="calibre1">Therefore, my approach for this chapter is to show you some of the common ways in which data is manipulated within SQL statements, and then demonstrate some of the built-in  functions  implemented  by  Microsoft  SQL  Server,  Oracle  Database,  and MySQL. Along with reading this chapter, I strongly recommend you purchase a reference guide covering all the functions implemented by your server. If you work with more than one database server, there are several reference guides that cover multiple servers,  such  as  Kevin  Kline  et  al.’s  <a href="http://oreilly.com/catalog/9780596518844/"> <i class="calibre4">SQL  in  a  Nutshell</i></a>  (<a href="http://oreilly.com/catalog/9780596518844/"> <i class="calibre4">http://oreilly.com/catalog/</i></a></p>
<p class="calibre1"><a href="http://oreilly.com/catalog/9780596518844/"> <i class="calibre4">9780596518844/</i>) </a>and Jonathan Gennick’s <a href="http://oreilly.com/catalog/9780596526887/"> <i class="calibre4">SQL Pocket Guide (http://oreilly.com/cata</i></a></p>
<p class="calibre1"><a href="http://oreilly.com/catalog/9780596526887/"> <i class="calibre4">log/9780596526887/)</i></a>, both from O’Reilly. </p>
<p class="calibre1"><b class="calibre3">Working with String Data</b></p>
<p class="calibre1">When working with string data, you will be using one of the following character data types:</p>
<p class="calibre1">CHAR</p>
<p class="calibre1">Holds fixed-length, blank-padded strings. MySQL allows CHAR values up to 255</p>
<p class="calibre1">characters in length, Oracle Database permits up to 2,000 characters, and SQL</p>
<p class="calibre1">Server allows up to 8,000 characters. </p>
<p class="calibre1"><b class="calibre3">113</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-68"></a>varchar</p>
<p class="calibre1">Holds  variable-length  strings.  MySQL  permits  up  to  65,535  characters  in  a varchar column, Oracle Database (via the varchar2 type) allows up to 4,000 characters, and SQL Server allows up to 8,000 characters. </p>
<p class="calibre1">text <i class="calibre4"> (MySQL and SQL Server) or </i> CLOB <i class="calibre4"> (Character Large Object; Oracle Database)</i> Holds very large variable-length strings (generally referred to as documents in this context). MySQL has multiple text types (tinytext, text, mediumtext, and long text)  for  documents  up  to  4  GB  in  size.  SQL  Server  has  a  single  text  type  for documents up to 2 GB in size, and Oracle Database includes the CLOB data type, which can hold documents up to a whopping 128 TB. SQL Server 2005 also includes the varchar(max) data type and recommends its use instead of the text type, which will be removed from the server in some future release. </p>
<p class="calibre1">To demonstrate how you can use these various types, I use the following table for some of the examples in this section:</p>
<p class="calibre1">CREATE TABLE string_tbl</p>
<p class="calibre1">(char_fld CHAR(30), </p>
<p class="calibre1">vchar_fld VARCHAR(30), </p>
<p class="calibre1">text_fld TEXT</p>
<p class="calibre1">); </p>
<p class="calibre1">The next two subsections show how you can generate and manipulate string data. </p>
<p class="calibre1"><b class="calibre3">String Generation</b></p>
<p class="calibre1">The simplest way to populate a character column is to enclose a string in quotes, as in: mysql&gt; <b class="calibre3">INSERT INTO string_tbl (char_fld, vchar_fld, text_fld)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES ('This is char data', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'This is varchar data', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'This is text data'); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">When inserting string data into a table, remember that if the length of the string exceeds the maximum size for the character column (either the designated maximum or the maximum allowed for the data type), the server will throw an exception. Although this is the default behavior for all three servers, you can configure MySQL and SQL Server to silently truncate the string instead of throwing an exception. To demonstrate how MySQL handles this situation, the following update statement attempts to modify the vchar_fld column, whose maximum length is defined as 30, with a string that is 46</p>
<p class="calibre1">characters in length:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE string_tbl</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET vchar_fld = 'This is a piece of extremely long varchar data';</b> ERROR 1406 (22001): Data too long for column 'vchar_fld' at row 1</p>
<p class="calibre1">With MySQL 6.0, the default behavior is now “strict” mode, which means that exceptions are thrown when problems arise, whereas in older versions of the server the string would have been truncated and a warning issued. If you would rather have the engine <b class="calibre3">114 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-176"></a>truncate the string and issue a warning instead of raising an exception, you can opt to be in ANSI mode. The following example shows how to check which mode you are in, and then how to change the mode using the SET command:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT @@session.sql_mode; </b></p>
<p class="calibre1">+----------------------------------------------------------------+</p>
<p class="calibre1">| @@session.sql_mode                                             |</p>
<p class="calibre1">+----------------------------------------------------------------+</p>
<p class="calibre1">| STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |</p>
<p class="calibre1">+----------------------------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SET sql_mode='ansi'; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.08 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT @@session.sql_mode; </b></p>
<p class="calibre1">+-------------------------------------------------------------+</p>
<p class="calibre1">| @@session.sql_mode                                          |</p>
<p class="calibre1">+-------------------------------------------------------------+</p>
<p class="calibre1">| REAL_AS_FLOAT,PIPES_AS_CONCAT,ANSI_QUOTES,IGNORE_SPACE,ANSI |</p>
<p class="calibre1">+-------------------------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">If you rerun the previous UPDATE statement, you will find that the column has been modified, but the following warning is generated:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SHOW WARNINGS; </b></p>
<p class="calibre1">+---------+------+------------------------------------------------+</p>
<p class="calibre1">| Level   | Code | Message                                        |</p>
<p class="calibre1">+---------+------+------------------------------------------------+</p>
<p class="calibre1">| Warning | 1265 | Data truncated for column 'vchar_fld' at row 1 |</p>
<p class="calibre1">+---------+------+------------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">If  you  retrieve  the  vchar_fld  column,  you  will  see  that  the  string  has  indeed  been truncated:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT vchar_fld</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM string_tbl; </b></p>
<p class="calibre1">+--------------------------------+</p>
<p class="calibre1">| vchar_fld                      |</p>
<p class="calibre1">+--------------------------------+</p>
<p class="calibre1">| This is a piece of extremely l |</p>
<p class="calibre1">+--------------------------------+</p>
<p class="calibre1">1 row in set (0.05 sec)</p>
<p class="calibre1">As you can see, only the first 30 characters of the 46-character string made it into the vchar_fld column. The best way to avoid string truncation (or exceptions, in the case of Oracle Database or MySQL in strict mode) when working with varchar columns is to set the upper limit of a column to a high enough value to handle the longest strings that might be stored in the column (keeping in mind that the server allocates only enough  space  to  store  the  string,  so  it  is  not  wasteful  to  set  a  high  upper  limit  for varchar columns). </p>
<p class="calibre1"><b class="calibre3">Working with String Data | 115</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-169"></a><img src="images/000002.png" alt="Image 21" class="calibre2" /></p>
<p class="calibre1"><b class="calibre3">Including single quotes</b></p>
<p class="calibre1">Since strings are demarcated by single quotes, you will need to be alert for strings that include single quotes or apostrophes. For example, you won’t be able to insert the following string because the server will think that the apostrophe in the word  <i class="calibre4">doesn’t</i> marks the end of the string:</p>
<p class="calibre1">UPDATE string_tbl</p>
<p class="calibre1">SET text_fld = 'This string doesn't work'; </p>
<p class="calibre1">To make the server ignore the apostrophe in the word  <i class="calibre4">doesn’t</i>, you will need to add an <i class="calibre4">escape</i> to the string so that the server treats the apostrophe like any other character in the string. All three servers allow you to escape a single quote by adding another single quote directly before, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE string_tbl</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET text_fld = 'This string didn''t work, but it does now';</b> Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">Rows matched: 1  Changed: 1  Warnings: 0</p>
<p class="calibre1">Oracle Database and MySQL users may also choose to escape a single quote by adding a backslash character immediately before, as in: UPDATE string_tbl SET text_fld =</p>
<p class="calibre1">'This string didn\'t work, but it does now' </p>
<p class="calibre1">If you retrieve a string for use in a screen or report field, you don’t need to do anything special to handle embedded quotes:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT text_fld</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM string_tbl; </b></p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">| text_fld                                 |</p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">| This string didn't work, but it does now |</p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">However, if you are retrieving the string to add to a file that another program will read, you may want to include the escape as part of the retrieved string. If you are using MySQL, you can use the built-in function quote(), which places quotes around the entire string  <i class="calibre4">and</i> adds escapes to any single quotes/apostrophes within the string. Here’s what our string looks like when retrieved via the quote() function: mysql&gt; <b class="calibre3">SELECT quote(text_fld)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM string_tbl; </b></p>
<p class="calibre1">+---------------------------------------------+</p>
<p class="calibre1">| QUOTE(text_fld)                             |</p>
<p class="calibre1">+---------------------------------------------+</p>
<p class="calibre1">| 'This string didn\'t work, but it does now' |</p>
<p class="calibre1">+---------------------------------------------+</p>
<p class="calibre1">1 row in set (0.04 sec)</p>
<p class="calibre1"><b class="calibre3">116 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-177"></a>When retrieving data for data export, you may want to use the quote() function for all non-system-generated character columns, such as a customer_notes column. </p>
<p class="calibre1"><b class="calibre3">Including special characters</b></p>
<p class="calibre1">If your application is multinational in scope, you might find yourself working with strings that include characters that do not appear on your keyboard. When working with the French and German languages, for example, you might need to include accented characters such as é and ö. The SQL Server and MySQL servers include the built-in function char() so that you can build strings from any of the 255 characters in the ASCII character set (Oracle Database users can use the chr() function). To demonstrate, the next example retrieves a typed string and its equivalent built via individual characters:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT 'abcdefg', CHAR(97,98,99,100,101,102,103); </b></p>
<p class="calibre1">+---------+--------------------------------+</p>
<p class="calibre1">| abcdefg | CHAR(97,98,99,100,101,102,103) |</p>
<p class="calibre1">+---------+--------------------------------+</p>
<p class="calibre1">| abcdefg | abcdefg                        |</p>
<p class="calibre1">+---------+--------------------------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">Thus, the 97th character in the ASCII character set is the letter  <i class="calibre4">a</i>. While the characters shown in the preceding example are not special, the following examples show the location of the accented characters along with other special characters, such as currency symbols:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CHAR(128,129,130,131,132,133,134,135,136,137); </b></p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">| CHAR(128,129,130,131,132,133,134,135,136,137) |</p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">| Çüéâäàåçêë                                    |</p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CHAR(138,139,140,141,142,143,144,145,146,147); </b></p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">| CHAR(138,139,140,141,142,143,144,145,146,147) |</p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">| èïîìÄÅÉæÆô                                    |</p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CHAR(148,149,150,151,152,153,154,155,156,157); </b></p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">| CHAR(148,149,150,151,152,153,154,155,156,157) |</p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">| öòÛùÿ...Ü¢£¥                                  |</p>
<p class="calibre1">+-----------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CHAR(158,159,160,161,162,163,164,165); </b></p>
<p class="calibre1">+---------------------------------------+</p>
<p class="calibre1"><b class="calibre3">Working with String Data | 117</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-178"></a><img src="images/000003.png" alt="Image 22" class="calibre2" /></p>
<p class="calibre1"><img src="images/000004.png" alt="Image 23" class="calibre2" /></p>
<p class="calibre1">| CHAR(158,159,160,161,162,163,164,165) |</p>
<p class="calibre1">+---------------------------------------+</p>
<p class="calibre1">| fáíóúñÑ                              |</p>
<p class="calibre1">+---------------------------------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">I am using the latin1 character set for the examples in this section. If your session is configured for a different character set, you will see a different set of characters than what is shown here. The same concepts apply, but you will need to familiarize yourself with the layout of your character set to locate specific characters. </p>
<p class="calibre1">Building strings character by character can be quite tedious, especially if only a few of the characters in the string are accented. Fortunately, you can use the concat() function to concatenate individual strings, some of which you can type while others you can generate via the char() function. For example, the following shows how to build the phrase  <i class="calibre4">danke schön</i> using the concat() and char() functions: mysql&gt; <b class="calibre3">SELECT CONCAT('danke sch', CHAR(148), 'n'); </b></p>
<p class="calibre1">+-------------------------------------+</p>
<p class="calibre1">| CONCAT('danke sch', CHAR(148), 'n') |</p>
<p class="calibre1">+-------------------------------------+</p>
<p class="calibre1">| danke schön                         |</p>
<p class="calibre1">+-------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Oracle Database users can use the concatenation operator (||) instead of the concat() function, as in:</p>
<p class="calibre1">SELECT 'danke sch' || CHR(148) || 'n' </p>
<p class="calibre1">FROM dual; </p>
<p class="calibre1">SQL Server does not include a concat() function, so you will need to use the concatenation operator (+), as in:</p>
<p class="calibre1">SELECT 'danke sch' + CHAR(148) + 'n' </p>
<p class="calibre1">If you have a character and need to find its ASCII equivalent, you can use the ascii() function, which takes the leftmost character in the string and returns a number: mysql&gt; <b class="calibre3">SELECT ASCII('ö'); </b></p>
<p class="calibre1">+------------+</p>
<p class="calibre1">| ASCII('ö') |</p>
<p class="calibre1">+------------+</p>
<p class="calibre1">|        148 |</p>
<p class="calibre1">+------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Using the char(), ascii(), and concat() functions (or concatenation operators), you should be able to work with any Roman language even if you are using a keyboard that does not include accented or special characters. </p>
<p class="calibre1"><b class="calibre3">118 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-69"></a><b class="calibre3">String Manipulation</b></p>
<p class="calibre1">Each database server includes many built-in functions for manipulating strings. This section explores two types of string functions: those that return numbers and those that return strings. Before I begin, however, I reset the data in the string_tbl table to the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DELETE FROM string_tbl; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.02 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO string_tbl (char_fld, vchar_fld, text_fld)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES ('This string is 28 characters', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'This string is 28 characters', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'This string is 28 characters'); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">String functions that return numbers</b></p>
<p class="calibre1">Of the string functions that return numbers, one of the most commonly used is the length() function, which returns the number of characters in the string (SQL Server users will need to use the len() function). The following query applies the length() function to each column in the string_tbl table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT LENGTH(char_fld) char_length, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">LENGTH(vchar_fld) varchar_length, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">LENGTH(text_fld) text_length</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM string_tbl; </b></p>
<p class="calibre1">+-------------+----------------+-------------+</p>
<p class="calibre1">| char_length | varchar_length | text_length |</p>
<p class="calibre1">+-------------+----------------+-------------+</p>
<p class="calibre1">|          28 |             28 |          28 |</p>
<p class="calibre1">+-------------+----------------+-------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">While the lengths of the varchar and text columns are as expected, you might have expected the length of the char column to be 30, since I told you that strings stored in char columns are right-padded with spaces. The MySQL server removes trailing spaces from char data when it is retrieved, however, so you will see the same results from all string functions regardless of the type of column in which the strings are stored. </p>
<p class="calibre1">Along with finding the length of a string, you might want to find the location of a substring within a string. For example, if you want to find the position at which the string 'characters' appears in the vchar_fld column, you could use the position() function, as demonstrated by the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT POSITION('characters' IN vchar_fld)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM string_tbl; </b></p>
<p class="calibre1">+-------------------------------------+</p>
<p class="calibre1">| POSITION('characters' IN vchar_fld) |</p>
<p class="calibre1">+-------------------------------------+</p>
<p class="calibre1">|                                  19 |</p>
<p class="calibre1">+-------------------------------------+</p>
<p class="calibre1">1 row in set (0.12 sec)</p>
<p class="calibre1"><b class="calibre3">Working with String Data | 119</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-218"></a><img src="images/000005.png" alt="Image 24" class="calibre2" /></p>
<p class="calibre1"><img src="images/000006.png" alt="Image 25" class="calibre2" /></p>
<p class="calibre1">If the substring cannot be found, the position() function returns 0. </p>
<p class="calibre1">For those of you who program in a language such as C or C++, where the first element of an array is at position 0, remember when working with databases that the first character in a string is at position 1. A return value of  0 from position() indicates that the substring could not be found, not that the substring was found at the first position in the string. </p>
<p class="calibre1">If you want to start your search at something other than the first character of your target string, you will need to use the locate() function, which is similar to the position() function except that it allows an optional third parameter, which is used to define the search’s  start  position.  The  locate()  function  is  also  proprietary,  whereas  the position() function is part of the SQL:2003 standard. Here’s an example asking for the position of the string 'is' starting at the fifth character in the vchar_fld column: mysql&gt; <b class="calibre3">SELECT LOCATE('is', vchar_fld, 5)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM string_tbl; </b></p>
<p class="calibre1">+----------------------------+</p>
<p class="calibre1">| LOCATE('is', vchar_fld, 5) |</p>
<p class="calibre1">+----------------------------+</p>
<p class="calibre1">|                         13 |</p>
<p class="calibre1">+----------------------------+</p>
<p class="calibre1">1 row in set (0.02 sec)</p>
<p class="calibre1">Oracle Database does not include the position() or locate() function, but it does include the instr() function, which mimics the position() function when provided with two arguments and mimics the locate() function when provided with three arguments. SQL Server also doesn’t include  a  position()  or  locate()  function,  but  it  does  include  the charindx() function, which also accepts either two or three arguments similar to Oracle’s instr() function. </p>
<p class="calibre1">Another function that takes strings as arguments and returns numbers is the string comparison function strcmp(). Strcmp(), which is implemented only by MySQL and has no analog in Oracle Database or SQL Server, takes two strings as arguments, and returns one of the following:</p>
<p class="calibre1">• −1 if the first string comes before the second string in sort order</p>
<p class="calibre1">• 0 if the strings are identical</p>
<p class="calibre1">• 1 if the first string comes after the second string in sort order To illustrate how the function works, I first show the sort order of five strings using a query, and then show how the strings compare to one another using strcmp(). Here are the five strings that I insert into the string_tbl table: mysql&gt; <b class="calibre3">DELETE FROM string_tbl; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">120 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-297"></a>mysql&gt; <b class="calibre3">INSERT INTO string_tbl(vchar_fld) VALUES ('abcd');</b> Query OK, 1 row affected (0.03 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO string_tbl(vchar_fld) VALUES ('xyz');</b> Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO string_tbl(vchar_fld) VALUES ('QRSTUV');</b> Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO string_tbl(vchar_fld) VALUES ('qrstuv');</b> Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO string_tbl(vchar_fld) VALUES ('12345');</b> Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">Here are the five strings in their sort order:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT vchar_fld</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM string_tbl</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY vchar_fld; </b></p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">| vchar_fld |</p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">| 12345     |</p>
<p class="calibre1">| abcd      |</p>
<p class="calibre1">| QRSTUV    |</p>
<p class="calibre1">| qrstuv    |</p>
<p class="calibre1">| xyz       |</p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">5 rows in set (0.00 sec)</p>
<p class="calibre1">The next query makes six comparisons among the five different strings: mysql&gt; <b class="calibre3">SELECT STRCMP('12345','12345') 12345_12345, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">STRCMP('abcd','xyz') abcd_xyz, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">STRCMP('abcd','QRSTUV') abcd_QRSTUV, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">STRCMP('qrstuv','QRSTUV') qrstuv_QRSTUV, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">STRCMP('12345','xyz') 12345_xyz, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">STRCMP('xyz','qrstuv') xyz_qrstuv; </b></p>
<p class="calibre1">+-------------+----------+-------------+---------------+-----------+------------+</p>
<p class="calibre1">| 12345_12345 | abcd_xyz | abcd_QRSTUV | qrstuv_QRSTUV | 12345_xyz | xyz_qrstuv |</p>
<p class="calibre1">+-------------+----------+-------------+---------------+-----------+------------+</p>
<p class="calibre1">|           0 |       −1 |          −1 |             0 |        −1 |          1 |</p>
<p class="calibre1">+-------------+----------+-------------+---------------+-----------+------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">The first comparison yields 0, which is to be expected since I compared a string to itself. </p>
<p class="calibre1">The fourth comparison also yields 0, which is a bit surprising, since the strings are composed of the same letters, with one string all uppercase and the other all lowercase. </p>
<p class="calibre1">The reason for this result is that MySQL’s strcmp() function is case-insensitive, which is something to remember when using the function. The other four comparisons yield either −1 or 1 depending on whether the first string comes before or after the second string  in  sort  order.  For  example,  strcmp('abcd','xyz')  yields  −1,  since  the  string</p>
<p class="calibre1">'abcd' comes before the string 'xyz'. </p>
<p class="calibre1"><b class="calibre3">Working with String Data | 121</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-217"></a><img src="images/000007.png" alt="Image 26" class="calibre2" /></p>
<p class="calibre1">Along with the strcmp() function, MySQL also allows you to use the like and regexp operators to compare strings in the select clause. Such comparisons will yield 1 (for true) or 0 (for false). Therefore, these operators allow you to build expressions that return a number, much like the functions described in this section. Here’s an example using like:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT name, name LIKE '%ns' ends_in_ns</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM department; </b></p>
<p class="calibre1">+----------------+------------+</p>
<p class="calibre1">| name           | ends_in_ns |</p>
<p class="calibre1">+----------------+------------+</p>
<p class="calibre1">| Operations     |          1 |</p>
<p class="calibre1">| Loans          |          1 |</p>
<p class="calibre1">| Administration |          0 |</p>
<p class="calibre1">+----------------+------------+</p>
<p class="calibre1">3 rows in set (0.25 sec)</p>
<p class="calibre1">This example retrieves all the department names, along with an expression that returns 1 if the department name ends in “ns” or 0 otherwise. If you want to perform more complex pattern matches, you can use the regexp operator, as demonstrated by the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id, cust_type_cd, fed_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">fed_id REGEXP '.{3}-.{2}-.{4}' is_ss_no_format</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer; </b></p>
<p class="calibre1">+---------+--------------+-------------+-----------------+</p>
<p class="calibre1">| cust_id | cust_type_cd | fed_id      | is_ss_no_format |</p>
<p class="calibre1">+---------+--------------+-------------+-----------------+</p>
<p class="calibre1">|       1 | I            | 111-11-1111 |               1 |</p>
<p class="calibre1">|       2 | I            | 222-22-2222 |               1 |</p>
<p class="calibre1">|       3 | I            | 333-33-3333 |               1 |</p>
<p class="calibre1">|       4 | I            | 444-44-4444 |               1 |</p>
<p class="calibre1">|       5 | I            | 555-55-5555 |               1 |</p>
<p class="calibre1">|       6 | I            | 666-66-6666 |               1 |</p>
<p class="calibre1">|       7 | I            | 777-77-7777 |               1 |</p>
<p class="calibre1">|       8 | I            | 888-88-8888 |               1 |</p>
<p class="calibre1">|       9 | I            | 999-99-9999 |               1 |</p>
<p class="calibre1">|      10 | B            | 04-1111111  |               0 |</p>
<p class="calibre1">|      11 | B            | 04-2222222  |               0 |</p>
<p class="calibre1">|      12 | B            | 04-3333333  |               0 |</p>
<p class="calibre1">|      13 | B            | 04-4444444  |               0 |</p>
<p class="calibre1">+---------+--------------+-------------+-----------------+</p>
<p class="calibre1">13 rows in set (0.00 sec)</p>
<p class="calibre1">The fourth column of this query returns 1 if the value stored in the fed_id column matches the format for a Social Security number. </p>
<p class="calibre1">SQL Server and Oracle Database users can achieve similar results by building case<a href="#calibre_link-107"> expressions, which I describe in detail in Chapter 11. </a></p>
<p class="calibre1"><b class="calibre3">122 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-187"></a><b class="calibre3">String functions that return strings</b></p>
<p class="calibre1">In some cases, you will need to modify existing strings, either by extracting part of the string or by adding additional text to the string. Every database server includes multiple functions to help with these tasks. Before I begin, I once again reset the data in the string_tbl table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DELETE FROM string_tbl; </b></p>
<p class="calibre1">Query OK, 5 rows affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO string_tbl (text_fld)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES ('This string was 29 characters'); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">Earlier in the chapter, I demonstrated the use of the concat() function to help build words that include accented characters. The concat() function is useful in many other situations, including when you need to append additional characters to a stored string. </p>
<p class="calibre1">For instance, the following example modifies the string stored in the text_fld column by tacking an additional phrase on the end:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE string_tbl</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET text_fld = CONCAT(text_fld, ', but now it is longer');</b> Query OK, 1 row affected (0.03 sec)</p>
<p class="calibre1">Rows matched: 1  Changed: 1  Warnings: 0</p>
<p class="calibre1">The contents of the text_fld column are now as follows:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT text_fld</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM string_tbl; </b></p>
<p class="calibre1">+-----------------------------------------------------+</p>
<p class="calibre1">| text_fld                                            |</p>
<p class="calibre1">+-----------------------------------------------------+</p>
<p class="calibre1">| This string was 29 characters, but now it is longer |</p>
<p class="calibre1">+-----------------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Thus, like all functions that return a string, you can use concat() to replace the data stored in a character column. </p>
<p class="calibre1">Another common use for the concat() function is to build a string from individual pieces of data. For example, the following query generates a narrative string for each bank teller:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CONCAT(fname, ' ', lname, ' has been a ', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">title, ' since ', start_date) emp_narrative</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE title = 'Teller' OR title = 'Head Teller'; </b></p>
<p class="calibre1">+---------------------------------------------------------+</p>
<p class="calibre1">| emp_narrative                                           |</p>
<p class="calibre1">+---------------------------------------------------------+</p>
<p class="calibre1">| Helen Fleming has been a Head Teller since 2008-03-17   |</p>
<p class="calibre1">| Chris Tucker has been a Teller since 2008-09-15         |</p>
<p class="calibre1">| Sarah Parker has been a Teller since 2006-12-02         |</p>
<p class="calibre1">| Jane Grossman has been a Teller since 2006-05-03        |</p>
<p class="calibre1">| Paula Roberts has been a Head Teller since 2006-07-27   |</p>
<p class="calibre1"><b class="calibre3">Working with String Data | 123</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-215"></a>| Thomas Ziegler has been a Teller since 2004-10-23       |</p>
<p class="calibre1">| Samantha Jameson has been a Teller since 2007-01-08     |</p>
<p class="calibre1">| John Blake has been a Head Teller since 2004-05-11      |</p>
<p class="calibre1">| Cindy Mason has been a Teller since 2006-08-09          |</p>
<p class="calibre1">| Frank Portman has been a Teller since 2007-04-01        |</p>
<p class="calibre1">| Theresa Markham has been a Head Teller since 2005-03-15 |</p>
<p class="calibre1">| Beth Fowler has been a Teller since 2006-06-29          |</p>
<p class="calibre1">| Rick Tulman has been a Teller since 2006-12-12          |</p>
<p class="calibre1">+---------------------------------------------------------+</p>
<p class="calibre1">13 rows in set (0.30 sec)</p>
<p class="calibre1">The concat() function can handle any expression that returns a string, and will even convert  numbers  and  dates  to  string  format,  as  evidenced  by  the  date  column (start_date) used as an argument. Although Oracle Database includes the concat() function, it will accept only two string arguments, so the previous query will not work on Oracle. Instead, you would need to use the concatenation operator (||) rather than a function call, as in:</p>
<p class="calibre1">SELECT fname || ' ' || lname || ' has been a ' ||</p>
<p class="calibre1">title || ' since ' || start_date emp_narrative</p>
<p class="calibre1">FROM employee</p>
<p class="calibre1">WHERE title = 'Teller' OR title = 'Head Teller'; </p>
<p class="calibre1">SQL Server does not include a concat() function, so you would need to use the same approach as the previous query, except that you would use SQL Server’s concatenation operator (+) instead of ||. </p>
<p class="calibre1">While concat() is useful for adding characters to the beginning or end of a string, you may also have a need to add or replace characters in the  <i class="calibre4">middle</i> of a string. All three database servers provide functions for this purpose, but all of them are different, so I demonstrate the MySQL function and then show the functions from the other two servers. </p>
<p class="calibre1">MySQL includes the insert() function, which takes four arguments: the original string, the position at which to start, the number of characters to replace, and the replacement string. Depending on the value of the third argument, the function may be used to either insert or replace characters in a string. With a value of 0 for the third argument, the replacement string is inserted and any trailing characters are pushed to the right, as in: mysql&gt; <b class="calibre3">SELECT INSERT('goodbye world', 9, 0, 'cruel ') string; </b></p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">| string              |</p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">| goodbye cruel world |</p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">In this example, all characters starting from position 9 are pushed to the right and the string 'cruel' is inserted. If the third argument is greater than zero, then that number of characters is replaced with the replacement string, as in: <b class="calibre3">124 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-227"></a>mysql&gt; <b class="calibre3">SELECT INSERT('goodbye world', 1, 7, 'hello') string; </b></p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">| string      |</p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">| hello world |</p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">For this example, the first seven characters are replaced with the string 'hello'. Oracle Database does not provide a single function with the flexibility of MySQL’s insert() function, but Oracle does provide the replace() function, which is useful for replacing one substring with another. Here’s the previous example reworked to use replace(): SELECT REPLACE('goodbye world', 'goodbye', 'hello')</p>
<p class="calibre1">FROM dual; </p>
<p class="calibre1">All instances of the string 'goodbye' will be replaced with the string 'hello', resulting in the string 'hello world'. The replace() function will replace  <i class="calibre4">every</i> instance of the search string with the replacement string, so you need to be careful that you don’t end up with more replacements than you anticipated. </p>
<p class="calibre1">SQL Server also includes a replace() function with the same functionality as Oracle’s, but SQL Server also includes a function called stuff() with similar functionality to MySQL’s insert() function. Here’s an example:</p>
<p class="calibre1">SELECT STUFF('hello world', 1, 5, 'goodbye cruel')</p>
<p class="calibre1">When executed, five characters are removed starting at position 1, and then the string</p>
<p class="calibre1">'goodbye cruel'  is  inserted  at  the  starting  position,  resulting  in  the  string  'goodbye cruel world'. </p>
<p class="calibre1">Along with inserting characters into a string, you may have a need to  <i class="calibre4">extract</i> a substring from a string. For this purpose, all three servers include the substring() function (although Oracle Database’s version is called substr()), which extracts a specified number of characters starting at a specified position. The following example extracts five characters from a string starting at the ninth position:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT SUBSTRING('goodbye cruel world', 9, 5); </b></p>
<p class="calibre1">+----------------------------------------+</p>
<p class="calibre1">| SUBSTRING('goodbye cruel world', 9, 5) |</p>
<p class="calibre1">+----------------------------------------+</p>
<p class="calibre1">| cruel                                  |</p>
<p class="calibre1">+----------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Along with the functions demonstrated here, all three servers include many more built-in functions for manipulating string data. While many of them are designed for very specific  purposes,  such  as  generating  the  string  equivalent  of  octal  or  hexadecimal numbers, there are many other general-purpose functions as well, such as functions that remove or add trailing spaces. For more information, consult your server’s SQL</p>
<p class="calibre1">reference guide, or a general-purpose SQL reference guide such as  <i class="calibre4">SQL in a Nutshell</i> (O’Reilly). </p>
<p class="calibre1"><b class="calibre3">Working with String Data | 125</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-70"></a><b class="calibre3">Working with Numeric Data</b></p>
<p class="calibre1">Unlike string data (and temporal data, as you will see shortly), numeric data generation is quite straightforward. You can type a number, retrieve it from another column, or generate it via a calculation. All the usual arithmetic operators (+, -, *, /) are available for performing calculations, and parentheses may be used to dictate precedence, as in: mysql&gt; <b class="calibre3">SELECT (37 * 59) / (78 - (8 * 6)); </b></p>
<p class="calibre1">+----------------------------+</p>
<p class="calibre1">| (37 * 59) / (78 - (8 * 6)) |</p>
<p class="calibre1">+----------------------------+</p>
<p class="calibre1">|                      72.77 |</p>
<p class="calibre1">+----------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">As  I  mentioned  in  <a href="#calibre_link-11">Chapter  2, </a>the  main  concern  when  storing  numeric  data  is  that numbers might be rounded if they are larger than the specified size for a numeric column. For example, the number 9.96 will be rounded to 10.0 if stored in a column defined as float(3,1). </p>
<p class="calibre1"><b class="calibre3">Performing Arithmetic Functions</b></p>
<p class="calibre1">Most of the built-in numeric functions are used for specific arithmetic purposes, such as determining the square root of a number. <a href="#calibre_link-70">Table 7-1</a> lists some of the common numeric functions that take a single numeric argument and return a number. </p>
<p class="calibre1"> <i class="calibre4">Table 7-1. Single-argument numeric functions</i></p>
<p class="calibre1"><b class="calibre3">Function name</b></p>
<p class="calibre1"><b class="calibre3">Description</b></p>
<p class="calibre1">Acos( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the arc cosine of  <i class="calibre4">x</i></p>
<p class="calibre1">Asin( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the arc sine of  <i class="calibre4">x</i></p>
<p class="calibre1">Atan( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the arc tangent of  <i class="calibre4">x</i></p>
<p class="calibre1">Cos( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the cosine of  <i class="calibre4">x</i></p>
<p class="calibre1">Cot( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the cotangent of  <i class="calibre4">x</i></p>
<p class="calibre1">Exp( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates ex</p>
<p class="calibre1">Ln( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the natural log of  <i class="calibre4">x</i></p>
<p class="calibre1">Sin( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the sine of  <i class="calibre4">x</i></p>
<p class="calibre1">Sqrt( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the square root of  <i class="calibre4">x</i></p>
<p class="calibre1">Tan( <i class="calibre4">x</i>)</p>
<p class="calibre1">Calculates the tangent of  <i class="calibre4">x</i></p>
<p class="calibre1">These functions perform very specific tasks, and I refrain from showing examples for these functions (if you don’t recognize a function by name or description, then you probably don’t need it). Other numeric functions used for calculations, however, are a bit more flexible and deserve some explanation. </p>
<p class="calibre1"><b class="calibre3">126 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-222"></a><img src="images/000010.png" alt="Image 27" class="calibre2" /></p>
<p class="calibre1">For example, the modulo operator, which calculates the remainder when one number is divided into another number, is implemented in MySQL and Oracle Database via the mod() function. The following example calculates the remainder when 4 is divided into 10:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT MOD(10,4); </b></p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">| MOD(10,4) |</p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">|         2 |</p>
<p class="calibre1">+-----------+</p>
<p class="calibre1">1 row in set (0.02 sec)</p>
<p class="calibre1">While the mod() function is typically used with integer arguments, with MySQL you can also use real numbers, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT MOD(22.75, 5); </b></p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">| MOD(22.75, 5) |</p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">|          2.75 |</p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">1 row in set (0.02 sec)</p>
<p class="calibre1">SQL Server does not have a mod() function. Instead, the operator % is used for finding remainders. The expression 10 % 4 will therefore yield the value 2. </p>
<p class="calibre1">Another numeric function that takes two numeric arguments is the pow() function (or power() if you are using Oracle Database or SQL Server), which returns one number raised to the power of a second number, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT POW(2,8); </b></p>
<p class="calibre1">+----------+</p>
<p class="calibre1">| POW(2,8) |</p>
<p class="calibre1">+----------+</p>
<p class="calibre1">|      256 |</p>
<p class="calibre1">+----------+</p>
<p class="calibre1">1 row in set (0.03 sec)</p>
<p class="calibre1">Thus, pow(2,8) is the MySQL equivalent of specifying 28. Since computer memory is allocated in chunks of 2x bytes, the pow() function can be a handy way to determine the exact number of bytes in a certain amount of memory:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT POW(2,10) kilobyte, POW(2,20) megabyte, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">POW(2,30) gigabyte, POW(2,40) terabyte; </b></p>
<p class="calibre1">+----------+----------+------------+---------------+</p>
<p class="calibre1">| kilobyte | megabyte | gigabyte   | terabyte      |</p>
<p class="calibre1">+----------+----------+------------+---------------+</p>
<p class="calibre1">|     1024 |  1048576 | 1073741824 | 1099511627776 |</p>
<p class="calibre1">+----------+----------+------------+---------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">Working with Numeric Data | 127</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-71"></a>I don’t know about you, but I find it easier to remember that a gigabyte is 230 bytes than to remember the number 1,073,741,824. </p>
<p class="calibre1"><b class="calibre3">Controlling Number Precision</b></p>
<p class="calibre1">When working with floating-point numbers, you may not always want to interact with or  display  a  number  with  its  full  precision.  For  example,  you  may  store  monetary transaction data with a precision to six decimal places, but you might want to round to the nearest hundredth for display purposes. Four functions are useful when limiting the precision of floating-point numbers: ceil(), floor(), round(), and truncate(). All three servers include these functions, although Oracle Database includes trunc() instead of truncate(), and SQL Server includes ceiling() instead of ceil(). </p>
<p class="calibre1">The ceil() and floor() functions are used to round either up or down to the closest integer, as demonstrated by the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CEIL(72.445), FLOOR(72.445); </b></p>
<p class="calibre1">+--------------+---------------+</p>
<p class="calibre1">| CEIL(72.445) | FLOOR(72.445) |</p>
<p class="calibre1">+--------------+---------------+</p>
<p class="calibre1">|           73 |            72 |</p>
<p class="calibre1">+--------------+---------------+</p>
<p class="calibre1">1 row in set (0.06 sec)</p>
<p class="calibre1">Thus, any number between 72 and 73 will be evaluated as 73 by the ceil() function and 72 by the floor() function. Remember that ceil() will round up even if the decimal portion of a number is very small, and floor() will round down even if the decimal portion is quite significant, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CEIL(72.000000001), FLOOR(72.999999999); </b></p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">| CEIL(72.000000001) | FLOOR(72.999999999) |</p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">|                 73 |                  72 |</p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">If this is a bit too severe for your application, you can use the round() function to round up or down from the  <i class="calibre4">midpoint</i> between two integers, as in: mysql&gt; <b class="calibre3">SELECT ROUND(72.49999), ROUND(72.5), ROUND(72.50001); </b></p>
<p class="calibre1">+-----------------+-------------+-----------------+</p>
<p class="calibre1">| ROUND(72.49999) | ROUND(72.5) | ROUND(72.50001) |</p>
<p class="calibre1">+-----------------+-------------+-----------------+</p>
<p class="calibre1">|              72 |          73 |              73 |</p>
<p class="calibre1">+-----------------+-------------+-----------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Using round(), any number whose decimal portion is halfway or more between two integers will be rounded up, whereas the number will be rounded down if the decimal portion is anything less than halfway between the two integers. </p>
<p class="calibre1"><b class="calibre3">128 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-235"></a><img src="images/000011.png" alt="Image 28" class="calibre2" /></p>
<p class="calibre1">Most of the time, you will want to keep at least some part of the decimal portion of a number rather than rounding to the nearest integer; the round() function allows an optional second argument to specify how many digits to the right of the decimal place to round to. The next example shows how you can use the second argument to round the number 72.0909 to one, two, and three decimal places:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT ROUND(72.0909, 1), ROUND(72.0909, 2), ROUND(72.0909, 3); </b></p>
<p class="calibre1">+-------------------+-------------------+-------------------+</p>
<p class="calibre1">| ROUND(72.0909, 1) | ROUND(72.0909, 2) | ROUND(72.0909, 3) |</p>
<p class="calibre1">+-------------------+-------------------+-------------------+</p>
<p class="calibre1">|              72.1 |             72.09 |            72.091 |</p>
<p class="calibre1">+-------------------+-------------------+-------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Like the round() function, the truncate() function allows an optional second argument to specify the number of digits to the right of the decimal, but truncate() simply discards the unwanted digits without rounding. The next example shows how the number 72.0909 would be truncated to one, two, and three decimal places: mysql&gt; <b class="calibre3">SELECT TRUNCATE(72.0909, 1), TRUNCATE(72.0909, 2), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">TRUNCATE(72.0909, 3); </b></p>
<p class="calibre1">+----------------------+----------------------+----------------------+</p>
<p class="calibre1">| TRUNCATE(72.0909, 1) | TRUNCATE(72.0909, 2) | TRUNCATE(72.0909, 3) |</p>
<p class="calibre1">+----------------------+----------------------+----------------------+</p>
<p class="calibre1">|                 72.0 |                72.09 |               72.090 |</p>
<p class="calibre1">+----------------------+----------------------+----------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">SQL  Server  does  not  include  a  truncate()  function.  Instead,  the round() function allows for an optional third argument which, if present and nonzero, calls for the number to be truncated rather than rounded. </p>
<p class="calibre1">Both  truncate()  and  round()  also  allow  a   <i class="calibre4">negative</i>  value  for  the  second  argument, meaning that numbers to the  <i class="calibre4">left</i> of the decimal place are truncated or rounded. This might  seem  like  a  strange  thing  to  do  at  first,  but  there  are  valid  applications.  For example, you might sell a product that can be purchased only in units of 10. If a customer were to order 17 units, you could choose from one of the following methods to modify the customer’s order quantity:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT ROUND(17, −1), TRUNCATE(17, −1); </b></p>
<p class="calibre1">+---------------+------------------+</p>
<p class="calibre1">| ROUND(17, −1) | TRUNCATE(17, −1) |</p>
<p class="calibre1">+---------------+------------------+</p>
<p class="calibre1">|            20 |               10 |</p>
<p class="calibre1">+---------------+------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">If the product in question is thumbtacks, then it might not make much difference to your bottom line whether you sold the customer 10 or 20 thumbtacks when only 17</p>
<p class="calibre1"><b class="calibre3">Working with Numeric Data | 129</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-72"></a>were requested; if you are selling Rolex watches, however, your business may fare better by rounding. </p>
<p class="calibre1"><b class="calibre3">Handling Signed Data</b></p>
<p class="calibre1">If you are working with numeric columns that allow negative values (in <a href="#calibre_link-11">Chapter 2, </a>I showed how a numeric column may be labeled  <i class="calibre4">unsigned</i>, meaning that only positive numbers are allowed), several numeric functions might be of use. Let’s say, for example, that you are asked to generate a report showing the current status of each bank account. </p>
<p class="calibre1">The following query returns three columns useful for generating the report: mysql&gt; <b class="calibre3">SELECT account_id, SIGN(avail_balance), ABS(avail_balance)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+------------+---------------------+--------------------+</p>
<p class="calibre1">| account_id | SIGN(avail_balance) | ABS(avail_balance) |</p>
<p class="calibre1">+------------+---------------------+--------------------+</p>
<p class="calibre1">|          1 |                   1 |            1057.75 |</p>
<p class="calibre1">|          2 |                   1 |             500.00 |</p>
<p class="calibre1">|          3 |                   1 |            3000.00 |</p>
<p class="calibre1">|          4 |                   1 |            2258.02 |</p>
<p class="calibre1">|          5 |                   1 |             200.00 |</p>
<p class="calibre1">| ...                                                   |</p>
<p class="calibre1">|         19 |                   1 |            1500.00 |</p>
<p class="calibre1">|         20 |                   1 |           23575.12 |</p>
<p class="calibre1">|         21 |                   0 |               0.00 |</p>
<p class="calibre1">|         22 |                   1 |            9345.55 |</p>
<p class="calibre1">|         23 |                   1 |           38552.05 |</p>
<p class="calibre1">|         24 |                   1 |           50000.00 |</p>
<p class="calibre1">+------------+---------------------+--------------------+</p>
<p class="calibre1">24 rows in set (0.00 sec)</p>
<p class="calibre1">The second column uses the  sign() function to return −1 if the account balance is negative, 0 if the account balance is zero, and 1 if the account balance is positive. The third column returns the absolute value of the account balance via the abs() function. </p>
<p class="calibre1"><b class="calibre3">Working with Temporal Data</b></p>
<p class="calibre1">Of the three types of data discussed in this chapter (character, numeric, and temporal), temporal data is the most involved when it comes to data generation and manipulation. </p>
<p class="calibre1">Some of the complexity of temporal data is caused by the myriad ways in which a single date and time can be described. For example, the date on which I wrote this paragraph can be described in all the following ways:</p>
<p class="calibre1">• Wednesday, September 17, 2008</p>
<p class="calibre1">• 9/17/2008 2:14:56 P.M. EST</p>
<p class="calibre1">• 9/17/2008 19:14:56 GMT</p>
<p class="calibre1">• 2612008 (Julian format)</p>
<p class="calibre1">• Star date [−4] 85712.03 14:14:56 ( <i class="calibre4">Star Trek</i> format) <b class="calibre3">130 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-73"></a>While some of these differences are purely a matter of formatting, most of the complexity has to do with your frame of reference, which we explore in the next section. </p>
<p class="calibre1"><b class="calibre3">Dealing with Time Zones</b></p>
<p class="calibre1">Because people around the world prefer that noon coincides roughly with the sun’s peak at their location, there has never been a serious attempt to coerce everyone to use a universal clock. Instead, the world has been sliced into 24 imaginary sections, called <i class="calibre4">time zones</i>; within a particular time zone, everyone agrees on the current time, whereas people in different time zones do not. While this seems simple enough, some geographic regions  shift  their  time  by  one  hour  twice  a  year  (implementing  what  is  known  as <i class="calibre4">daylight saving time</i>) and some do not, so the time difference between two points on Earth might be four hours for one half of the year and five hours for the other half of the year. Even within a single time zone, different regions may or may not adhere to daylight saving time, causing different clocks in the same time zone to agree for one half of the year but be one hour different for the rest of the year. </p>
<p class="calibre1">While the computer age has exacerbated the issue, people have been dealing with time zone differences since the early days of naval exploration. To ensure a common point of reference for timekeeping, fifteenth-century navigators set their clocks to the time of day in Greenwich, England. This became known as  <i class="calibre4">Greenwich Mean Time</i>, or GMT. </p>
<p class="calibre1">All other time zones can be described by the number of hours’ difference from GMT; for example, the time zone for the Eastern United States, known as  <i class="calibre4">Eastern Standard</i> <i class="calibre4">Time</i>, can be described as GMT −5:00, or five hours earlier than GMT. </p>
<p class="calibre1">Today, we use a variation of GMT called  <i class="calibre4">Coordinated Universal Time</i>, or UTC, which is based on an atomic clock (or, to be more precise, the average time of 200 atomic clocks in 50 locations worldwide, which is referred to as  <i class="calibre4">Universal Time</i>). Both SQL</p>
<p class="calibre1">Server  and  MySQL  provide  functions  that  will  return  the  current  UTC  timestamp (getutcdate() for SQL Server and utc_timestamp() for MySQL). </p>
<p class="calibre1">Most database servers default to the time zone setting of the server on which it resides and provide tools for modifying the time zone if needed. For example, a database used to store stock exchange transactions from around the world would generally be configured to use UTC time, whereas a database used to store transactions at a particular retail establishment might use the server’s time zone. </p>
<p class="calibre1">MySQL keeps two different time zone settings: a global time zone, and a session time zone, which may be different for each user logged in to a database. You can see both settings via the following query:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT @@global.time_zone, @@session.time_zone; </b></p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">| @@global.time_zone | @@session.time_zone |</p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">| SYSTEM             | SYSTEM              |</p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">Working with Temporal Data | 131</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-74"></a><img src="images/000012.png" alt="Image 29" class="calibre2" /></p>
<p class="calibre1">A value of system tells you that the server is using the time zone setting from the server on which the database resides. </p>
<p class="calibre1">If you are sitting at a computer in Zurich, Switzerland, and you open a session across the network to a MySQL server situated in New York, you may want to change the time zone setting for your session, which you can do via the following command: mysql&gt; <b class="calibre3">SET time_zone = 'Europe/Zurich'; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.18 sec)</p>
<p class="calibre1">If you check the time zone settings again, you will see the following: mysql&gt; <b class="calibre3">SELECT @@global.time_zone, @@session.time_zone; </b></p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">| @@global.time_zone | @@session.time_zone |</p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">| SYSTEM             | Europe/Zurich       |</p>
<p class="calibre1">+--------------------+---------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">All dates displayed in your session will now conform to Zurich time. </p>
<p class="calibre1">Oracle Database users can change the time zone setting for a session via the following command:</p>
<p class="calibre1">ALTER SESSION TIMEZONE = 'Europe/Zurich' </p>
<p class="calibre1"><b class="calibre3">Generating Temporal Data</b></p>
<p class="calibre1">You can generate temporal data via any of the following means:</p>
<p class="calibre1">• Copying data from an existing date, datetime, or time column</p>
<p class="calibre1">• Executing a built-in function that returns a date, datetime, or time</p>
<p class="calibre1">• Building a string representation of the temporal data to be evaluated by the server To use the last method, you will need to understand the various components used in formatting dates. </p>
<p class="calibre1"><b class="calibre3">String representations of temporal data</b></p>
<p class="calibre1"><a href="#calibre_link-15">Table 2-5 in </a><a href="#calibre_link-11">Chapter 2</a> presented the more popular date components; to refresh your</p>
<p class="calibre1"><a href="#calibre_link-161">memory, Table 7-2 shows these same components. </a></p>
<p class="calibre1"><b class="calibre3">Loading MySQL Time Zone Data</b></p>
<p class="calibre1">If you are running the MySQL server on a Windows platform, you will need to load time zone data manually before you can set global or session time zones. To do so, you need to follow these steps:</p>
<p class="calibre1"><b class="calibre3">132 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-233"></a>1. Download  the  time  zone  data  from  <a href="http://dev.mysql.com/downloads/timezones.html"> <i class="calibre4">http://dev.mysql.com/downloads/timezones</i></a></p>
<p class="calibre1"><a href="http://dev.mysql.com/downloads/timezones.html"> <i class="calibre4">.html</i>. </a></p>
<p class="calibre1">2. Shut down your MySQL server. </p>
<p class="calibre1">3. Extract  the  files  from  the  downloaded  ZIP  file  (in  my  case,  the  file  was  called <i class="calibre4">timezone-2006p.zip</i>)  and  place  them  in  your  MySQL  installation  directory  under   <i class="calibre4">/data/mysql</i>  (the  full  path  for  my  installation  was   <i class="calibre4">/Program  Files/MySQL/</i></p>
<p class="calibre1"> <i class="calibre4">MySQL Server 6.0/data/mysql</i>). </p>
<p class="calibre1">4. Restart your MySQL server. </p>
<p class="calibre1">To look at the time zone data, change to the  <i class="calibre4">mysql</i> database via the use mysql command, and execute the following query:</p>
<p class="calibre1">mysql&gt; SELECT name FROM time_zone_name; </p>
<p class="calibre1">+----------------------------------+</p>
<p class="calibre1">| name                             |</p>
<p class="calibre1">+----------------------------------+</p>
<p class="calibre1">| Africa/Abidjan                   |</p>
<p class="calibre1">| Africa/Accra                     |</p>
<p class="calibre1">| Africa/Addis_Ababa               |</p>
<p class="calibre1">| Africa/Algiers                   |</p>
<p class="calibre1">| Africa/Asmera                    |</p>
<p class="calibre1">| Africa/Bamako                    |</p>
<p class="calibre1">| Africa/Bangui                    |</p>
<p class="calibre1">| Africa/Banjul                    |</p>
<p class="calibre1">| Africa/Bissau                    |</p>
<p class="calibre1">| Africa/Blantyre                  |</p>
<p class="calibre1">| Africa/Brazzaville               |</p>
<p class="calibre1">| Africa/Bujumbura                 |</p>
<p class="calibre1">... </p>
<p class="calibre1">| US/Alaska                        |</p>
<p class="calibre1">| US/Aleutian                      |</p>
<p class="calibre1">| US/Arizona                       |</p>
<p class="calibre1">| US/Central                       |</p>
<p class="calibre1">| US/East-Indiana                  |</p>
<p class="calibre1">| US/Eastern                       |</p>
<p class="calibre1">| US/Hawaii                        |</p>
<p class="calibre1">| US/Indiana-Starke                |</p>
<p class="calibre1">| US/Michigan                      |</p>
<p class="calibre1">| US/Mountain                      |</p>
<p class="calibre1">| US/Pacific                       |</p>
<p class="calibre1">| US/Pacific-New                   |</p>
<p class="calibre1">| US/Samoa                         |</p>
<p class="calibre1">| UTC                              |</p>
<p class="calibre1">| W-SU                             |</p>
<p class="calibre1">| WET                              |</p>
<p class="calibre1">| Zulu                             |</p>
<p class="calibre1">+----------------------------------+</p>
<p class="calibre1">546 rows in set (0.01 sec)</p>
<p class="calibre1">To change your time zone setting, choose one of the names from the previous query that best matches your location. </p>
<p class="calibre1"><b class="calibre3">Working with Temporal Data | 133</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-161"></a> <i class="calibre4">Table 7-2. Date format components</i></p>
<p class="calibre1"><b class="calibre3">Component</b></p>
<p class="calibre1"><b class="calibre3">Definition</b></p>
<p class="calibre1"><b class="calibre3">Range</b></p>
<p class="calibre1">YYYY</p>
<p class="calibre1">Year, including century</p>
<p class="calibre1">1000 to 9999</p>
<p class="calibre1">MM</p>
<p class="calibre1">Month</p>
<p class="calibre1">01 (January) to 12 (December)</p>
<p class="calibre1">DD</p>
<p class="calibre1">Day</p>
<p class="calibre1">01 to 31</p>
<p class="calibre1">HH</p>
<p class="calibre1">Hour</p>
<p class="calibre1">00 to 23</p>
<p class="calibre1">HHH</p>
<p class="calibre1">Hours (elapsed)</p>
<p class="calibre1">−838 to 838</p>
<p class="calibre1">MI</p>
<p class="calibre1">Minute</p>
<p class="calibre1">00 to 59</p>
<p class="calibre1">SS</p>
<p class="calibre1">Second</p>
<p class="calibre1">00 to 59</p>
<p class="calibre1">To build a string that the server can interpret as a date, datetime, or time, you need to</p>
<p class="calibre1"><a href="#calibre_link-161">put the various components together in the order shown in Table 7-3. </a></p>
<p class="calibre1"> <i class="calibre4">Table 7-3. Required date components</i></p>
<p class="calibre1"><b class="calibre3">Type</b></p>
<p class="calibre1"><b class="calibre3">Default format</b></p>
<p class="calibre1">Date</p>
<p class="calibre1">YYYY-MM-DD</p>
<p class="calibre1">Datetime</p>
<p class="calibre1">YYYY-MM-DD HH:MI:SS</p>
<p class="calibre1">Timestamp</p>
<p class="calibre1">YYYY-MM-DD HH:MI:SS</p>
<p class="calibre1">Time</p>
<p class="calibre1">HHH:MI:SS</p>
<p class="calibre1">Thus, to populate a datetime column with 3:30 P.M. on September 17, 2008, you will need to build the following string:</p>
<p class="calibre1">'2008-09-17 15:30:00' </p>
<p class="calibre1">If the server is expecting a datetime value, such as when updating a datetime column or when calling a built-in function that takes a datetime argument, you can provide a properly formatted string with the required date components, and the server will do the conversion for you. For example, here’s a statement used to modify the date of a bank transaction:</p>
<p class="calibre1">UPDATE transaction</p>
<p class="calibre1">SET txn_date = '2008-09-17 15:30:00' </p>
<p class="calibre1">WHERE txn_id = 99999; </p>
<p class="calibre1">The server determines that the string provided in the set clause must be a datetime value, since the string is being used to populate a datetime column. Therefore, the server will attempt to convert the string for you by parsing the string into the six components (year, month, day, hour, minute, second) included in the default datetime format. </p>
<p class="calibre1"><b class="calibre3">String-to-date conversions</b></p>
<p class="calibre1">If the server is  <i class="calibre4">not</i> expecting a datetime value, or if you would like to represent the datetime using a nondefault format, you will need to tell the server to convert the string <b class="calibre3">134 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-188"></a>to a datetime. For example, here is a simple query that returns a datetime value using the cast() function:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CAST('2008-09-17 15:30:00' AS DATETIME); </b></p>
<p class="calibre1">+-----------------------------------------+</p>
<p class="calibre1">| CAST('2008-09-17 15:30:00' AS DATETIME) |</p>
<p class="calibre1">+-----------------------------------------+</p>
<p class="calibre1">| 2008-09-17 15:30:00                     |</p>
<p class="calibre1">+-----------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">We cover the cast() function at the end of this chapter. While this example demonstrates how to build datetime values, the same logic applies to the date and time types as well. The following query uses the cast() function to generate a date value and a time value:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT CAST('2008-09-17' AS DATE) date_field, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CAST('108:17:57' AS TIME) time_field; </b></p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">| date_field | time_field |</p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">| 2008-09-17 | 108:17:57  |</p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">You may, of course, explicitly convert your strings even when the server is expecting a date, datetime, or time value, rather than letting the server do an implicit conversion. </p>
<p class="calibre1">When strings are converted to temporal values&mdash;whether explicitly or implicitly&mdash;you must provide all the date components in the required order. While some servers are quite  strict  regarding  the  date  format,  the  MySQL  server  is  quite  lenient  about  the separators used between the components. For example, MySQL will accept all of the following strings as valid representations of 3:30 P.M. on September 17, 2008:</p>
<p class="calibre1">'2008-09-17 15:30:00' </p>
<p class="calibre1">'2008/09/17 15:30:00' </p>
<p class="calibre1">'2008,09,17,15,30,00' </p>
<p class="calibre1">'20080917153000' </p>
<p class="calibre1">Although this gives you a bit more flexibility, you may find yourself trying to generate a temporal value  <i class="calibre4">without</i> the default date components; the next section demonstrates a built-in function that is far more flexible than the cast() function. </p>
<p class="calibre1"><b class="calibre3">Functions for generating dates</b></p>
<p class="calibre1">If you need to generate temporal data from a string, and the string is not in the proper form to use the cast() function, you can use a built-in function that allows you to provide  a  format  string  along  with  the  date  string.  MySQL  includes  the str_to_date()  function  for  this  purpose.  Say,  for  example,  that  you  pull  the  string</p>
<p class="calibre1">'September 17, 2008' from a file and need to use it to update a date column. Since the string is not in the required YYYY-MM-DD format, you can use str_to_date() instead of reformatting the string so that you can use the cast() function, as in: <b class="calibre3">Working with Temporal Data | 135</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-162"></a><img src="images/000013.png" alt="Image 30" class="calibre2" /></p>
<p class="calibre1">UPDATE individual</p>
<p class="calibre1">SET birth_date = <b class="calibre3">STR_TO_DATE('September 17, 2008', '%M %d, %Y')</b> WHERE cust_id = 9999; </p>
<p class="calibre1">The second argument in the call to str_to_date() defines the format of the date string, with, in this case, a month name (%M), a numeric day (%d), and a four-digit numeric year (%Y). While there are over 30 recognized format components, <a href="#calibre_link-162">Table 7-4 </a>defines the dozen or so most commonly used components. </p>
<p class="calibre1"> <i class="calibre4">Table 7-4. Date format components</i></p>
<p class="calibre1"><b class="calibre3">Format component</b></p>
<p class="calibre1"><b class="calibre3">Description</b></p>
<p class="calibre1">%M</p>
<p class="calibre1">Month name (January to December)</p>
<p class="calibre1">%m</p>
<p class="calibre1">Month numeric (01 to 12)</p>
<p class="calibre1">%d</p>
<p class="calibre1">Day numeric (01 to 31)</p>
<p class="calibre1">%j</p>
<p class="calibre1">Day of year (001 to 366)</p>
<p class="calibre1">%W</p>
<p class="calibre1">Weekday name (Sunday to Saturday)</p>
<p class="calibre1">%Y</p>
<p class="calibre1">Year, four-digit numeric</p>
<p class="calibre1">%y</p>
<p class="calibre1">Year, two-digit numeric</p>
<p class="calibre1">%H</p>
<p class="calibre1">Hour (00 to 23)</p>
<p class="calibre1">%h</p>
<p class="calibre1">Hour (01 to 12)</p>
<p class="calibre1">%i</p>
<p class="calibre1">Minutes (00 to 59)</p>
<p class="calibre1">%s</p>
<p class="calibre1">Seconds (00 to 59)</p>
<p class="calibre1">%f</p>
<p class="calibre1">Microseconds (000000 to 999999)</p>
<p class="calibre1">%p</p>
<p class="calibre1">A.M. or P.M. </p>
<p class="calibre1">The str_to_date() function returns a datetime, date, or time value depending on the contents of the format string. For example, if the format string includes only %H, %i, and</p>
<p class="calibre1">%s, then a time value will be returned. </p>
<p class="calibre1">Oracle Database users can use the to_date() function in the same manner  as  MySQL’s  str_to_date()  function.  SQL  Server  includes  a convert() function that is not quite as flexible as MySQL and Oracle Database; rather than supplying a custom format string, your date string must conform to one of 21 predefined formats. </p>
<p class="calibre1">If you are trying to generate the  <i class="calibre4">current</i> date/time, then you won’t need to build a string, because the following built-in functions will access the system clock and return the current date and/or time as a string for you:</p>
<p class="calibre1"><b class="calibre3">136 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-75"></a>mysql&gt; <b class="calibre3">SELECT CURRENT_DATE(), CURRENT_TIME(), CURRENT_TIMESTAMP(); </b></p>
<p class="calibre1">+----------------+----------------+---------------------+</p>
<p class="calibre1">| CURRENT_DATE() | CURRENT_TIME() | CURRENT_TIMESTAMP() |</p>
<p class="calibre1">+----------------+----------------+---------------------+</p>
<p class="calibre1">| 2008-09-18     | 19:53:12       | 2008-09-18 19:53:12 |</p>
<p class="calibre1">+----------------+----------------+---------------------+</p>
<p class="calibre1">1 row in set (0.12 sec)</p>
<p class="calibre1">The values returned by these functions are in the default format for the temporal type being returned. Oracle Database includes current_date() and current_timestamp() but not current_time(), and SQL Server includes only the current_timestamp() function. </p>
<p class="calibre1"><b class="calibre3">Manipulating Temporal Data</b></p>
<p class="calibre1">This section explores the built-in functions that take date arguments and return dates, strings, or numbers. </p>
<p class="calibre1"><b class="calibre3">Temporal functions that return dates</b></p>
<p class="calibre1">Many of the built-in temporal functions take one date as an argument and return another date. MySQL’s date_add() function, for example, allows you to add any kind of interval (e.g., days, months, years) to a specified date to generate another date. Here’s an example that demonstrates how to add five days to the current date: mysql&gt; <b class="calibre3">SELECT DATE_ADD(CURRENT_DATE(), INTERVAL 5 DAY); </b></p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">| DATE_ADD(CURRENT_DATE(), INTERVAL 5 DAY) |</p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">| 2008-09-22                               |</p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">1 row in set (0.06 sec)</p>
<p class="calibre1">The second argument is composed of three elements: the interval keyword, the desired quantity, and the type of <a href="#calibre_link-75">interval. Table 7-5 </a>shows some of the commonly used interval types. </p>
<p class="calibre1"> <i class="calibre4">Table 7-5. Common interval types</i></p>
<p class="calibre1"><b class="calibre3">Interval name</b></p>
<p class="calibre1"><b class="calibre3">Description</b></p>
<p class="calibre1">Second</p>
<p class="calibre1">Number of seconds</p>
<p class="calibre1">Minute</p>
<p class="calibre1">Number of minutes</p>
<p class="calibre1">Hour</p>
<p class="calibre1">Number of hours</p>
<p class="calibre1">Day</p>
<p class="calibre1">Number of days</p>
<p class="calibre1">Month</p>
<p class="calibre1">Number of months</p>
<p class="calibre1">Year</p>
<p class="calibre1">Number of years</p>
<p class="calibre1">Minute_second</p>
<p class="calibre1">Number of minutes and seconds, separated by “:” </p>
<p class="calibre1">Hour_second</p>
<p class="calibre1">Number of hours, minutes, and seconds, separated by “:” </p>
<p class="calibre1">Year_month</p>
<p class="calibre1">Number of years and months, separated by “-” </p>
<p class="calibre1"><b class="calibre3">Working with Temporal Data | 137</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-216"></a><img src="images/000014.png" alt="Image 31" class="calibre2" /></p>
<p class="calibre1">While the first six types listed in <a href="#calibre_link-75">Table 7-5 </a>are pretty straightforward, the last three types require a bit more explanation since they have multiple elements. For example, if you are told that transaction ID 9999 actually occurred 3 hours, 27 minutes, and 11</p>
<p class="calibre1">seconds later than what was posted to the transaction table, you can fix it via the following:</p>
<p class="calibre1">UPDATE transaction</p>
<p class="calibre1">SET txn_date = DATE_ADD(txn_date, <b class="calibre3">INTERVAL '3:27:11' HOUR_SECOND</b>) WHERE txn_id = 9999; </p>
<p class="calibre1">In this example, the date_add() function takes the value in the txn_date column, adds 3 hours, 27 minutes, and 11 seconds to it, and uses the value that results to modify the txn_date column. </p>
<p class="calibre1">Or, if you work in HR and found out that employee ID 4789 claimed to be younger than he actually is, you could add 9 years and 11 months to his birth date, as in: UPDATE employee</p>
<p class="calibre1">SET birth_date = DATE_ADD(birth_date, <b class="calibre3">INTERVAL '9-11' YEAR_MONTH</b>) WHERE emp_id = 4789; </p>
<p class="calibre1">SQL  Server  users  can  accomplish  the  previous  example  using  the dateadd() function:</p>
<p class="calibre1">UPDATE employee</p>
<p class="calibre1">SET birth_date =</p>
<p class="calibre1">DATEADD(MONTH, 119, birth_date)</p>
<p class="calibre1">WHERE emp_id = 4789</p>
<p class="calibre1">SQL Server doesn’t have combined intervals (i.e., year_month), so I converted 9 years, 11 months to 119 months. </p>
<p class="calibre1">Oracle Database users can use the add_months() function for this example, as in:</p>
<p class="calibre1">UPDATE employee</p>
<p class="calibre1">SET birth_date = ADD_MONTHS(birth_date, 119)</p>
<p class="calibre1">WHERE emp_id = 4789; </p>
<p class="calibre1">There are some cases where you want to add an interval to a date, and you know where you want to arrive but not how many days it takes to get there. For example, let’s say that a bank customer logs on to the online banking system and schedules a transfer for the end of the month. Rather than writing some code that figures out what month you are  currently  in  and  looks  up  the  number  of  days  in  that  month,  you  can  call  the last_day() function, which does the work for you (both MySQL and Oracle Database include the last_day() function; SQL Server has no comparable function). If the customer asks for the transfer on September 17, 2008, you could find the last day of September via the following:</p>
<p class="calibre1"><b class="calibre3">138 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-192"></a>mysql&gt; <b class="calibre3">SELECT LAST_DAY('2008-09-17'); </b></p>
<p class="calibre1">+------------------------+</p>
<p class="calibre1">| LAST_DAY('2008-09-17') |</p>
<p class="calibre1">+------------------------+</p>
<p class="calibre1">| 2008-09-30             |</p>
<p class="calibre1">+------------------------+</p>
<p class="calibre1">1 row in set (0.10 sec)</p>
<p class="calibre1">Whether you provide a date or datetime value, the last_day() function always returns a date. Although this function may not seem like an enormous timesaver, the underlying logic can be tricky if you’re trying to find the last day of February and need to figure out whether the current year is a leap year. </p>
<p class="calibre1">Another temporal function that returns a date is one that converts a datetime value from one time zone to another. For this purpose, MySQL includes the convert_tz() function and Oracle Database includes the new_time() function. If I want to convert my current local time to UTC, for example, I could do the following: mysql&gt; <b class="calibre3">SELECT CURRENT_TIMESTAMP() current_est, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONVERT_TZ(CURRENT_TIMESTAMP(), 'US/Eastern', 'UTC') current_utc; </b></p>
<p class="calibre1">+---------------------+---------------------+</p>
<p class="calibre1">| current_est         | current_utc         |</p>
<p class="calibre1">+---------------------+---------------------+</p>
<p class="calibre1">| 2008-09-18 20:01:25 | 2008-09-19 00:01:25 |</p>
<p class="calibre1">+---------------------+---------------------+</p>
<p class="calibre1">1 row in set (0.76 sec)</p>
<p class="calibre1">This function comes in handy when receiving dates in a different time zone than what is stored in your database. </p>
<p class="calibre1"><b class="calibre3">Temporal functions that return strings</b></p>
<p class="calibre1">Most of the temporal functions that return string values are used to extract a portion of a date or time. For example, MySQL includes the dayname() function to determine which day of the week a certain date falls on, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT DAYNAME('2008-09-18'); </b></p>
<p class="calibre1">+-----------------------+</p>
<p class="calibre1">| DAYNAME('2008-09-18') |</p>
<p class="calibre1">+-----------------------+</p>
<p class="calibre1">| Thursday              |</p>
<p class="calibre1">+-----------------------+</p>
<p class="calibre1">1 row in set (0.08 sec)</p>
<p class="calibre1">Many such functions are included with MySQL for extracting information from date values, but I recommend that you use the extract() function instead, since it’s easier to remember a few variations of one function than to remember a dozen different functions. Additionally, the extract() function is part of the SQL:2003 standard and has been implemented by Oracle Database as well as MySQL. </p>
<p class="calibre1"><b class="calibre3">Working with Temporal Data | 139</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-195"></a><img src="images/000015.png" alt="Image 32" class="calibre2" /></p>
<p class="calibre1">The extract() function uses the same interval types as the date_add() function (see</p>
<p class="calibre1"><a href="#calibre_link-75">Table 7-5</a>) to define which element of the date interests you. For example, if you want to extract just the year portion of a datetime value, you can do the following: mysql&gt; <b class="calibre3">SELECT EXTRACT(YEAR FROM '2008-09-18 22:19:05'); </b></p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">| EXTRACT(YEAR FROM '2008-09-18 22:19:05') |</p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">|                                     2008 |</p>
<p class="calibre1">+------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">SQL Server doesn’t include an implementation of extract(), but it does include the datepart() function. Here’s how you would extract the year from a datetime value using datepart():</p>
<p class="calibre1">SELECT DATEPART(YEAR, GETDATE())</p>
<p class="calibre1"><b class="calibre3">Temporal functions that return numbers</b></p>
<p class="calibre1">Earlier in this chapter, I showed you a function used to add a given interval to a date value, thus generating another date value. Another common activity when working with dates is to take  <i class="calibre4">two</i> date values and determine the number of intervals (days, weeks, years)   <i class="calibre4">between</i>  the  two  dates.  For  this  purpose,  MySQL  includes  the  function datediff(), which returns the number of full days between two dates. For example, if I want to know the number of days that my kids will be out of school this summer, I can do the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT DATEDIFF('2009-09-03', '2009-06-24'); </b></p>
<p class="calibre1">+--------------------------------------+</p>
<p class="calibre1">| DATEDIFF('2009-09-03', '2009-06-24') |</p>
<p class="calibre1">+--------------------------------------+</p>
<p class="calibre1">|                                   71 |</p>
<p class="calibre1">+--------------------------------------+</p>
<p class="calibre1">1 row in set (0.05 sec)</p>
<p class="calibre1">Thus, I will have to endure 71 days of poison ivy, mosquito bites, and scraped knees before the kids are safely back at school. The datediff() function ignores the time of day in its arguments. Even if I include a time-of-day, setting it to one second until midnight for the first date and to one second after midnight for the second date, those times will have no effect on the calculation:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT DATEDIFF('2009-09-03 23:59:59', '2009-06-24 00:00:01'); </b></p>
<p class="calibre1">+--------------------------------------------------------+</p>
<p class="calibre1">| DATEDIFF('2009-09-03 23:59:59', '2009-06-24 00:00:01') |</p>
<p class="calibre1">+--------------------------------------------------------+</p>
<p class="calibre1">|                                                     71 |</p>
<p class="calibre1">+--------------------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">140 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-76"></a><img src="images/000016.png" alt="Image 33" class="calibre2" /></p>
<p class="calibre1">If I switch the arguments and have the earlier date first, datediff() will return a negative number, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT DATEDIFF('2009-06-24', '2009-09-03'); </b></p>
<p class="calibre1">+--------------------------------------+</p>
<p class="calibre1">| DATEDIFF('2009-06-24', '2009-09-03') |</p>
<p class="calibre1">+--------------------------------------+</p>
<p class="calibre1">|                                  −71 |</p>
<p class="calibre1">+--------------------------------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">SQL Server also includes the datediff() function, but it is more flexible than the MySQL implementation in that you can specify the interval type (i.e., year, month, day, hour) instead of counting only the number of days between two dates. Here’s how SQL Server would accomplish the previous example:</p>
<p class="calibre1">SELECT DATEDIFF(DAY, '2009-06-24', '2009-09-03')</p>
<p class="calibre1">Oracle Database allows you to determine the number of days between two dates simply by subtracting one date from another. </p>
<p class="calibre1"><b class="calibre3">Conversion Functions</b></p>
<p class="calibre1">Earlier in this chapter, I showed you how to use the cast() function to convert a string to  a  datetime  value.  While  every  database  server  includes  a  number  of  proprietary functions  used  to  convert  data  from  one  type  to  another,  I  recommend  using  the cast() function, which is included in the SQL:2003 standard and has been implemented by MySQL, Oracle Database, and Microsoft SQL Server. </p>
<p class="calibre1">To use cast(), you provide a value or expression, the as keyword, and the type to which you want the value converted. Here’s an example that converts a string to an integer: mysql&gt; <b class="calibre3">SELECT CAST('1456328' AS SIGNED INTEGER); </b></p>
<p class="calibre1">+-----------------------------------+</p>
<p class="calibre1">| CAST('1456328' AS SIGNED INTEGER) |</p>
<p class="calibre1">+-----------------------------------+</p>
<p class="calibre1">|                           1456328 |</p>
<p class="calibre1">+-----------------------------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">When converting a string to a number, the cast() function will attempt to convert the entire string from left to right; if any non-numeric characters are found in the string, the conversion halts without an error. Consider the following example: mysql&gt; <b class="calibre3">SELECT CAST('999ABC111' AS UNSIGNED INTEGER); </b></p>
<p class="calibre1">+---------------------------------------+</p>
<p class="calibre1">| CAST('999ABC111' AS UNSIGNED INTEGER) |</p>
<p class="calibre1">+---------------------------------------+</p>
<p class="calibre1">|                                   999 |</p>
<p class="calibre1">+---------------------------------------+</p>
<p class="calibre1">1 row in set, <b class="calibre3">1 warning</b> (0.08 sec)</p>
<p class="calibre1"><b class="calibre3">Conversion Functions | 141</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-77"></a>mysql&gt; show warnings; </p>
<p class="calibre1">+---------+------+------------------------------------------------+</p>
<p class="calibre1">| Level   | Code | Message                                        |</p>
<p class="calibre1">+---------+------+------------------------------------------------+</p>
<p class="calibre1">| Warning | 1292 | Truncated incorrect INTEGER value: '999ABC111' |</p>
<p class="calibre1">+---------+------+------------------------------------------------+</p>
<p class="calibre1">1 row in set (0.07 sec)</p>
<p class="calibre1">In this case, the first three digits of the string are converted, whereas the rest of the string is discarded, resulting in a value of 999. The server did, however, issue a warning to let you know that not all the string was converted. </p>
<p class="calibre1">If you are converting a string to a date, time, or datetime value, then you will need to stick with the default formats for each type, since you can’t provide the cast() function with a format string. If your date string is not in the default format (i.e., YYYY-MM-DD HH:MI:SS for datetime types), then you will need to resort to using another function, such as MySQL’s str_to_date() function described earlier in the chapter. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">These exercises are designed to test your understanding of some of the built-in functions</p>
<p class="calibre1"><a href="#calibre_link-152">shown in this chapter. See Appendix C for the answers. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 7-1</b></p>
<p class="calibre1">Write a query that returns the 17th through 25th characters of the string 'Please find the substring in this string'. </p>
<p class="calibre1"><b class="calibre3">Exercise 7-2</b></p>
<p class="calibre1">Write a query that returns the absolute value and sign (−1, 0, or 1) of the number −25. </p>
<p class="calibre1">76823. Also return the number rounded to the nearest hundredth. </p>
<p class="calibre1"><b class="calibre3">Exercise 7-3</b></p>
<p class="calibre1">Write a query to return just the month portion of the current date. </p>
<p class="calibre1"><b class="calibre3">142 | Chapter 7:</b> <b class="calibre3">Data Generation, Conversion, and Manipulation</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-78"></a><b class="calibre3">CHAPTER 8</b></p>
<p class="calibre1"><b class="calibre3">Grouping and Aggregates</b></p>
<p class="calibre1">Data is generally stored at the lowest level of granularity needed by any of a database’s users; if Chuck in accounting needs to look at individual customer transactions, then there needs to be a table in the database that stores individual transactions. That doesn’t mean, however, that all users must deal with the data as it is stored in the database. </p>
<p class="calibre1">The focus of this chapter is on how data can be grouped and aggregated to allow users to interact with it at some higher level of granularity than what is stored in the database. </p>
<p class="calibre1"><b class="calibre3">Grouping Concepts</b></p>
<p class="calibre1">Sometimes you will want to find trends in your data that will require the database server to  cook  the  data  a  bit  before  you  can  generate  the  results  you  are  looking  for.  For example, let’s say that you are in charge of operations at the bank, and you would like to find out how many accounts are being opened by each bank teller. You could issue a simple query to look at the raw data:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">| open_emp_id |</p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          13 |</p>
<p class="calibre1"><b class="calibre3">143</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-171"></a>|          13 |</p>
<p class="calibre1">|          13 |</p>
<p class="calibre1">|          16 |</p>
<p class="calibre1">|          16 |</p>
<p class="calibre1">|          16 |</p>
<p class="calibre1">|          16 |</p>
<p class="calibre1">|          16 |</p>
<p class="calibre1">|          16 |</p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">24 rows in set (0.01 sec)</p>
<p class="calibre1">With only 24 rows in the account table, it is relatively easy to see that four different employees opened accounts and that employee ID 16 has opened six accounts; however, if the bank has dozens of employees and thousands of accounts, this approach would prove tedious and error-prone. </p>
<p class="calibre1">Instead, you can ask the database server to group the data for you by using the group by clause. Here’s the same query but employing a group by clause to group the account data by employee ID:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id; </b></p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">| open_emp_id |</p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          13 |</p>
<p class="calibre1">|          16 |</p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">The  result  set  contains  one  row  for  each  distinct  value  in  the  open_emp_id column, resulting in four rows instead of the full 24 rows. The reason for the smaller result set is that each of the four employees opened more than one account. To see how many accounts each teller opened, you can use an  <i class="calibre4">aggregate function</i> in the select clause to count the number of rows in each group:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id; </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|           1 |        8 |</p>
<p class="calibre1">|          10 |        7 |</p>
<p class="calibre1">|          13 |        3 |</p>
<p class="calibre1">|          16 |        6 |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">The aggregate function count() counts the number of rows in each group, and the asterisk tells the server to count everything in the group. Using the combination of a <b class="calibre3">144 | Chapter 8:</b> <b class="calibre3">Grouping and Aggregates</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-79"></a>group by clause and the count() aggregate function, you are able to generate exactly the data needed to answer the business question without having to look at the raw data. </p>
<p class="calibre1">When grouping data, you may need to filter out undesired data from your result set based on groups of data rather than based on the raw data. Since the group by clause runs  <i class="calibre4">after</i> the where clause has been evaluated, you cannot add filter conditions to your where clause for this purpose. For example, here’s an attempt to filter out any cases where an employee has opened fewer than five accounts:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE COUNT(*) &gt; 4</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id; </b></p>
<p class="calibre1">ERROR 1111 (HY000): Invalid use of group function</p>
<p class="calibre1">You cannot refer to the aggregate function count(*) in your where clause, because the groups have not yet been generated at the time the where clause is evaluated. Instead, you must put your group filter conditions in the having clause. Here’s what the query would look like using having:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">HAVING COUNT(*) &gt; 4; </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|           1 |        8 |</p>
<p class="calibre1">|          10 |        7 |</p>
<p class="calibre1">|          16 |        6 |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">3 rows in set (0.00 sec)</p>
<p class="calibre1">Because those groups containing fewer than five members have been filtered out via the having clause, the result set now contains only those employees who have opened five or more accounts, thus eliminating employee ID 13 from the results. </p>
<p class="calibre1"><b class="calibre3">Aggregate Functions</b></p>
<p class="calibre1">Aggregate functions perform a specific operation over all rows in a group. Although every database server has its own set of specialty aggregate functions, the common aggregate functions implemented by all major servers include: Max()</p>
<p class="calibre1">Returns the maximum value within a set</p>
<p class="calibre1">Min()</p>
<p class="calibre1">Returns the minimum value within a set</p>
<p class="calibre1">Avg()</p>
<p class="calibre1">Returns the average value across a set</p>
<p class="calibre1"><b class="calibre3">Aggregate Functions | 145</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-80"></a>Sum()</p>
<p class="calibre1">Returns the sum of the values across a set</p>
<p class="calibre1">Count()</p>
<p class="calibre1">Returns the number of values in a set</p>
<p class="calibre1">Here’s a query that uses all of the common aggregate functions to analyze the available balances for all checking accounts:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT MAX(avail_balance) max_balance, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">MIN(avail_balance) min_balance, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AVG(avail_balance) avg_balance, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(avail_balance) tot_balance, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">COUNT(*) num_accounts</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd = 'CHK'; </b></p>
<p class="calibre1">+-------------+-------------+-------------+-------------+--------------+</p>
<p class="calibre1">| max_balance | min_balance | avg_balance | tot_balance | num_accounts |</p>
<p class="calibre1">+-------------+-------------+-------------+-------------+--------------+</p>
<p class="calibre1">|    38552.05 |      122.37 | 7300.800985 |    73008.01 |           10 |</p>
<p class="calibre1">+-------------+-------------+-------------+-------------+--------------+</p>
<p class="calibre1">1 row in set (0.09 sec)</p>
<p class="calibre1">The  results  from  this  query  tell  you  that,  across  the  10  checking  accounts  in  the account  table,  there  is  a  maximum  balance  of  $38,552.05,  a  minimum  balance  of $122.37, an average balance of $7,300.80, and a total balance across all 10 accounts of $73,008.01. Hopefully, this gives you an appreciation for the role of these aggregate functions; the next subsections further clarify how you can utilize these functions. </p>
<p class="calibre1"><b class="calibre3">Implicit Versus Explicit Groups</b></p>
<p class="calibre1">In the previous example, every value returned by the query is generated by an aggregate function, and the aggregate functions are applied across the group of rows specified by the filter condition product_cd = 'CHK'. Since there is no group by clause, there is a single,  <i class="calibre4">implicit</i> group (all rows returned by the query). </p>
<p class="calibre1">In most cases, however, you will want to retrieve additional columns along with columns generated by aggregate functions. What if, for example, you wanted to extend the previous query to execute the same five aggregate functions for  <i class="calibre4">each</i> product type, instead of just for checking accounts? For this query, you would want to retrieve the product_cd column along with the five aggregate functions, as in: SELECT <b class="calibre3">product_cd, </b></p>
<p class="calibre1">MAX(avail_balance) max_balance, </p>
<p class="calibre1">MIN(avail_balance) min_balance, </p>
<p class="calibre1">AVG(avail_balance) avg_balance, </p>
<p class="calibre1">SUM(avail_balance) tot_balance, </p>
<p class="calibre1">COUNT(*) num_accounts</p>
<p class="calibre1">FROM account; </p>
<p class="calibre1">However, if you try to execute the query, you will receive the following error: <b class="calibre3">146 | Chapter 8:</b> <b class="calibre3">Grouping and Aggregates</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-81"></a>ERROR 1140 (42000): Mixing of GROUP columns (MIN(),MAX(),COUNT(),...) with no GROUP</p>
<p class="calibre1">columns is illegal if there is no GROUP BY clause</p>
<p class="calibre1">While it may be obvious to you that you want the aggregate functions applied to each set of products found in the account table, this query fails because you have not  <i class="calibre4">explicitly</i> specified how the data should be grouped. Therefore, you will need to add a group by clause to specify over which group of rows the aggregate functions should be applied:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_cd, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">MAX(avail_balance) max_balance, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">MIN(avail_balance) min_balance, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AVG(avail_balance) avg_balance, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(avail_balance) tot_balance, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">COUNT(*) num_accts</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd; </b></p>
<p class="calibre1">+------------+-------------+-------------+--------------+-------------+-----------+</p>
<p class="calibre1">| product_cd | max_balance | min_balance | avg_balance  | tot_balance | num_accts |</p>
<p class="calibre1">+------------+-------------+-------------+--------------+-------------+-----------+</p>
<p class="calibre1">| BUS        |     9345.55 |        0.00 |  4672.774902 |     9345.55 |         2 |</p>
<p class="calibre1">| CD         |    10000.00 |     1500.00 |  4875.000000 |    19500.00 |         4 |</p>
<p class="calibre1">| CHK        |    38552.05 |      122.37 |  7300.800985 |    73008.01 |        10 |</p>
<p class="calibre1">| MM         |     9345.55 |     2212.50 |  5681.713216 |    17045.14 |         3 |</p>
<p class="calibre1">| SAV        |      767.77 |      200.00 |   463.940002 |     1855.76 |         4 |</p>
<p class="calibre1">| SBL        |    50000.00 |    50000.00 | 50000.000000 |    50000.00 |         1 |</p>
<p class="calibre1">+------------+-------------+-------------+--------------+-------------+-----------+</p>
<p class="calibre1">6 rows in set (0.00 sec)</p>
<p class="calibre1">With the inclusion of the group by clause, the server knows to group together rows having the same value in the product_cd column first and then to apply the five aggregate functions to each of the six groups. </p>
<p class="calibre1"><b class="calibre3">Counting Distinct Values</b></p>
<p class="calibre1">When using the count() function to determine the number of members in each group, you  have  your  choice  of  counting   <i class="calibre4">all</i>  members  in  the  group,  or  counting  only  the <i class="calibre4">distinct</i> values for a column across all members of the group. For example, consider the following data, which shows the employee responsible for opening each account: mysql&gt; <b class="calibre3">SELECT account_id, open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY open_emp_id; </b></p>
<p class="calibre1">+------------+-------------+</p>
<p class="calibre1">| account_id | open_emp_id |</p>
<p class="calibre1">+------------+-------------+</p>
<p class="calibre1">|          8 |           1 |</p>
<p class="calibre1">|          9 |           1 |</p>
<p class="calibre1">|         10 |           1 |</p>
<p class="calibre1">|         12 |           1 |</p>
<p class="calibre1">|         13 |           1 |</p>
<p class="calibre1">|         17 |           1 |</p>
<p class="calibre1">|         18 |           1 |</p>
<p class="calibre1"><b class="calibre3">Aggregate Functions | 147</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-298"></a>|         19 |           1 |</p>
<p class="calibre1">|          1 |          10 |</p>
<p class="calibre1">|          2 |          10 |</p>
<p class="calibre1">|          3 |          10 |</p>
<p class="calibre1">|          4 |          10 |</p>
<p class="calibre1">|          5 |          10 |</p>
<p class="calibre1">|         14 |          10 |</p>
<p class="calibre1">|         22 |          10 |</p>
<p class="calibre1">|          6 |          13 |</p>
<p class="calibre1">|          7 |          13 |</p>
<p class="calibre1">|         24 |          13 |</p>
<p class="calibre1">|         11 |          16 |</p>
<p class="calibre1">|         15 |          16 |</p>
<p class="calibre1">|         16 |          16 |</p>
<p class="calibre1">|         20 |          16 |</p>
<p class="calibre1">|         21 |          16 |</p>
<p class="calibre1">|         23 |          16 |</p>
<p class="calibre1">+------------+-------------+</p>
<p class="calibre1">24 rows in set (0.00 sec)</p>
<p class="calibre1">As you can see, multiple accounts were opened by four different employees (employee IDs 1, 10, 13, and 16). Let’s say that, instead of performing a manual count, you want to create a query that counts the number of employees who have opened accounts. If you apply the count() function to the open_emp_id column, you will see the following results:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT COUNT(open_emp_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+--------------------+</p>
<p class="calibre1">| COUNT(open_emp_id) |</p>
<p class="calibre1">+--------------------+</p>
<p class="calibre1">|                 24 |</p>
<p class="calibre1">+--------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">In this case, specifying the open_emp_id column as the column to be counted generates the same results as specifying count(*). If you want to count  <i class="calibre4">distinct</i> values in the group rather than just counting the number of rows in the group, you need to specify the distinct keyword, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT COUNT(DISTINCT open_emp_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+-----------------------------+</p>
<p class="calibre1">| COUNT(DISTINCT open_emp_id) |</p>
<p class="calibre1">+-----------------------------+</p>
<p class="calibre1">|                           4 |</p>
<p class="calibre1">+-----------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">By specifying distinct, therefore, the count() function examines the values of a column for each member of the group in order to find and remove duplicates, rather than simply counting the number of values in the group. </p>
<p class="calibre1"><b class="calibre3">148 | Chapter 8:</b> <b class="calibre3">Grouping and Aggregates</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-82"></a><b class="calibre3">Using Expressions</b></p>
<p class="calibre1">Along with using columns as arguments to aggregate functions, you can build expressions to use as arguments. For example, you may want to find the maximum value of pending deposits across all accounts, which is calculated by subtracting the available balance from the pending balance. You can achieve this via the following query: mysql&gt; <b class="calibre3">SELECT MAX(pending_balance - avail_balance) max_uncleared</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">| max_uncleared |</p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">|        660.00 |</p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">While this example uses a fairly simple expression, expressions used as arguments to aggregate functions can be as complex as needed, as long as they return a number, string,  or  date.  In  <a href="#calibre_link-107">Chapter  11, </a>I  show  you  how  you  can  use  case  expressions  with aggregate functions to determine whether a particular row should or should not be included in an aggregation. </p>
<p class="calibre1"><b class="calibre3">How Nulls Are Handled</b></p>
<p class="calibre1">When performing aggregations, or, indeed, any type of numeric calculation, you should always  consider  how  null  values  might  affect  the  outcome  of  your  calculation.  To illustrate, I will build a simple table to hold numeric data and populate it with the set</p>
<p class="calibre1">{1, 3, 5}:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">CREATE TABLE number_tbl</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(val SMALLINT); </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.01 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO number_tbl VALUES (1); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO number_tbl VALUES (3); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO number_tbl VALUES (5); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.00 sec)</p>
<p class="calibre1">Consider the following query, which performs five aggregate functions on the set of numbers:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT COUNT(*) num_rows, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">COUNT(val) num_vals, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(val) total, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">MAX(val) max_val, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AVG(val) avg_val</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM number_tbl; </b></p>
<p class="calibre1">+----------+----------+-------+---------+---------+</p>
<p class="calibre1"><b class="calibre3">Aggregate Functions | 149</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-83"></a>| num_rows | num_vals | total | max_val | avg_val |</p>
<p class="calibre1">+----------+----------+-------+---------+---------+</p>
<p class="calibre1">|        3 |        3 |     9 |       5 |  3.0000 |</p>
<p class="calibre1">+----------+----------+-------+---------+---------+</p>
<p class="calibre1">1 row in set (0.08 sec)</p>
<p class="calibre1">The results are as you would expect: both count(*) and count(val) return the value 3, sum(val) returns the value 9, max(val) returns 5, and avg(val) returns 3. Next, I will add a null value to the number_tbl table and run the query again: mysql&gt; <b class="calibre3">INSERT INTO number_tbl VALUES (NULL); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT COUNT(*) num_rows, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">COUNT(val) num_vals, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(val) total, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">MAX(val) max_val, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AVG(val) avg_val</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM number_tbl; </b></p>
<p class="calibre1">+----------+----------+-------+---------+---------+</p>
<p class="calibre1">| num_rows | num_vals | total | max_val | avg_val |</p>
<p class="calibre1">+----------+----------+-------+---------+---------+</p>
<p class="calibre1">|        4 |        3 |     9 |       5 |  3.0000 |</p>
<p class="calibre1">+----------+----------+-------+---------+---------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Even with the addition of the null value to the table, the sum(), max(), and avg() functions all return the same values, indicating that they ignore any null values encountered. </p>
<p class="calibre1">The count(*) function now returns the value 4, which is valid since the number_tbl table contains four rows, while the count(val) function still returns the value 3. The difference is that count(*) counts the number of rows, whereas count(val) counts the number of  <i class="calibre4">values</i> contained in the val column and ignores any null values encountered. </p>
<p class="calibre1"><b class="calibre3">Generating Groups</b></p>
<p class="calibre1">People are rarely interested in looking at raw data; instead, people engaging in data analysis will want to manipulate the raw data to better suit their needs. Examples of common data manipulations include:</p>
<p class="calibre1">• Generating totals for a geographic region, such as total European sales</p>
<p class="calibre1">• Finding outliers, such as the top salesperson for 2005</p>
<p class="calibre1">• Determining frequencies, such as the number of new accounts opened for each branch</p>
<p class="calibre1">To answer these types of queries, you will need to ask the database server to group rows together by one or more columns or expressions. As you have seen already in several examples, the group by clause is the mechanism for grouping data within a query. In this section, you will see how to group data by one or more columns, how to group data using expressions, and how to generate rollups within groups. </p>
<p class="calibre1"><b class="calibre3">150 | Chapter 8:</b> <b class="calibre3">Grouping and Aggregates</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-84"></a><b class="calibre3">Single-Column Grouping</b></p>
<p class="calibre1">Single-column groups are the simplest and most-often-used type of grouping. If you want to find the total balances for each product, for example, you need only group on the account.product_cd column, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_cd, SUM(avail_balance) prod_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd; </b></p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">| product_cd | prod_balance |</p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">| BUS        |      9345.55 |</p>
<p class="calibre1">| CD         |     19500.00 |</p>
<p class="calibre1">| CHK        |     73008.01 |</p>
<p class="calibre1">| MM         |     17045.14 |</p>
<p class="calibre1">| SAV        |      1855.76 |</p>
<p class="calibre1">| SBL        |     50000.00 |</p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">6 rows in set (0.00 sec)</p>
<p class="calibre1">This query generates six groups, one for each product, and then sums the available balances for each member of the group. </p>
<p class="calibre1"><b class="calibre3">Multicolumn Grouping</b></p>
<p class="calibre1">In some cases, you may want to generate groups that span  <i class="calibre4">more</i> than one column. </p>
<p class="calibre1">Expanding on the previous example, imagine that you want to find the total balances not just for each product, but for both products and branches (e.g., what’s the total balance for all checking accounts opened at the Woburn branch?). The following example shows how you can accomplish this:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_cd, open_branch_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(avail_balance) tot_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd, open_branch_id; </b></p>
<p class="calibre1">+------------+----------------+-------------+</p>
<p class="calibre1">| product_cd | open_branch_id | tot_balance |</p>
<p class="calibre1">+------------+----------------+-------------+</p>
<p class="calibre1">| BUS        |              2 |     9345.55 |</p>
<p class="calibre1">| BUS        |              4 |        0.00 |</p>
<p class="calibre1">| CD         |              1 |    11500.00 |</p>
<p class="calibre1">| CD         |              2 |     8000.00 |</p>
<p class="calibre1">| CHK        |              1 |      782.16 |</p>
<p class="calibre1">| CHK        |              2 |     3315.77 |</p>
<p class="calibre1">| CHK        |              3 |     1057.75 |</p>
<p class="calibre1">| CHK        |              4 |    67852.33 |</p>
<p class="calibre1">| MM         |              1 |    14832.64 |</p>
<p class="calibre1">| MM         |              3 |     2212.50 |</p>
<p class="calibre1">| SAV        |              1 |      767.77 |</p>
<p class="calibre1">| SAV        |              2 |      700.00 |</p>
<p class="calibre1">| SAV        |              4 |      387.99 |</p>
<p class="calibre1">| SBL        |              3 |    50000.00 |</p>
<p class="calibre1"><b class="calibre3">Generating Groups | 151</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-85"></a>+------------+----------------+-------------+</p>
<p class="calibre1">14 rows in set (0.00 sec)</p>
<p class="calibre1">This version of the query generates 14 groups, one for each combination of product and branch found in the account table. Along with adding the open_branch_id column to the select clause, I also added it to the group by clause, since open_branch_id is retrieved from a table and is not generated via an aggregate function. </p>
<p class="calibre1"><b class="calibre3">Grouping via Expressions</b></p>
<p class="calibre1">Along with using columns to group data, you can build groups based on the values generated by expressions. Consider the following query, which groups employees by the year they began working for the bank:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT EXTRACT(YEAR FROM start_date) year, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY EXTRACT(YEAR FROM start_date); </b></p>
<p class="calibre1">+------+----------+</p>
<p class="calibre1">| year | how_many |</p>
<p class="calibre1">+------+----------+</p>
<p class="calibre1">| 2004 |        2 |</p>
<p class="calibre1">| 2005 |        3 |</p>
<p class="calibre1">| 2006 |        8 |</p>
<p class="calibre1">| 2007 |        3 |</p>
<p class="calibre1">| 2008 |        2 |</p>
<p class="calibre1">+------+----------+</p>
<p class="calibre1">5 rows in set (0.15 sec)</p>
<p class="calibre1">This query employs a fairly simple expression, which uses the extract() function to return only the year portion of a date, to group the rows in the employee table. </p>
<p class="calibre1"><b class="calibre3">Generating Rollups</b></p>
<p class="calibre1">In <a href="#calibre_link-84">“Multicolumn Grouping” on page 151, </a>I showed an example that generates total account balances for each product and branch. Let’s say, however, that along with the total balances for each product/branch combination, you also want total balances for each distinct product. You could run an additional query and merge the results, you could load the results of the query into a spreadsheet, or you could build a Perl script, Java program, or some other mechanism to take that data and perform the additional calculations. Better yet, you could use the with rollup option to have the database server do the work for you. Here’s the revised query using with rollup in the group by clause:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_cd, open_branch_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(avail_balance) tot_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd, open_branch_id WITH ROLLUP; </b></p>
<p class="calibre1">+------------+----------------+-------------+</p>
<p class="calibre1">| product_cd | open_branch_id | tot_balance |</p>
<p class="calibre1"><b class="calibre3">152 | Chapter 8:</b> <b class="calibre3">Grouping and Aggregates</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-228"></a><img src="images/000017.png" alt="Image 34" class="calibre2" /></p>
<p class="calibre1">+------------+----------------+-------------+</p>
<p class="calibre1">| BUS        |              2 |     9345.55 |</p>
<p class="calibre1">| BUS        |              4 |        0.00 |</p>
<p class="calibre1">| BUS        |           NULL |     9345.55 |</p>
<p class="calibre1">| CD         |              1 |    11500.00 |</p>
<p class="calibre1">| CD         |              2 |     8000.00 |</p>
<p class="calibre1">| CD         |           NULL |    19500.00 |</p>
<p class="calibre1">| CHK        |              1 |      782.16 |</p>
<p class="calibre1">| CHK        |              2 |     3315.77 |</p>
<p class="calibre1">| CHK        |              3 |     1057.75 |</p>
<p class="calibre1">| CHK        |              4 |    67852.33 |</p>
<p class="calibre1">| CHK        |           NULL |    73008.01 |</p>
<p class="calibre1">| MM         |              1 |    14832.64 |</p>
<p class="calibre1">| MM         |              3 |     2212.50 |</p>
<p class="calibre1">| MM         |           NULL |    17045.14 |</p>
<p class="calibre1">| SAV        |              1 |      767.77 |</p>
<p class="calibre1">| SAV        |              2 |      700.00 |</p>
<p class="calibre1">| SAV        |              4 |      387.99 |</p>
<p class="calibre1">| SAV        |           NULL |     1855.76 |</p>
<p class="calibre1">| SBL        |              3 |    50000.00 |</p>
<p class="calibre1">| SBL        |           NULL |    50000.00 |</p>
<p class="calibre1">| NULL       |           NULL |   170754.46 |</p>
<p class="calibre1">+------------+----------------+-------------+</p>
<p class="calibre1">21 rows in set (0.02 sec)</p>
<p class="calibre1">There are now seven additional rows in the result set, one for each of the six distinct products  and  one  for  the  grand  total  (all  products  combined).  For  the  six  product rollups, a null value is provided for the open_branch_id column, since the rollup is being performed across all branches. Looking at the third line of the output, for example, you will see that a total of $9,345.55 was deposited in BUS accounts across all branches. </p>
<p class="calibre1">For  the  grand  total  row,  a  null  value  is  provided  for  both  the  product_cd  and open_branch_id columns; the last line of output shows a total of $170,754.46 across all products and branches. </p>
<p class="calibre1">If you are using Oracle Database, you need to use a slightly different syntax to indicate that you want a rollup performed. The group by clause for the previous query would look as follows when using Oracle: GROUP BY ROLLUP(product_cd, open_branch_id)</p>
<p class="calibre1">The advantage of this syntax is that it allows you to perform rollups on a subset of the columns in the group by clause. If you are grouping by columns a, b, and c, for example, you could indicate that the server should perform rollups on only b and c via the following:</p>
<p class="calibre1">GROUP BY a, ROLLUP(b, c)</p>
<p class="calibre1">If, along with totals by product, you also want to calculate totals per branch, then you can use the with cube option, which generates summary rows for  <i class="calibre4">all</i> possible combinations of the grouping columns. Unfortunately, with cube is not available in version 6.0 of MySQL, but it is available with SQL Server and Oracle Database. Here’s an <b class="calibre3">Generating Groups | 153</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-197"></a><img src="images/000018.png" alt="Image 35" class="calibre2" /></p>
<p class="calibre1">example using with cube, but I have removed the mysql&gt; prompt to show that the query cannot yet be performed with MySQL:</p>
<p class="calibre1">SELECT product_cd, open_branch_id, </p>
<p class="calibre1">SUM(avail_balance) tot_balance</p>
<p class="calibre1">FROM account</p>
<p class="calibre1">GROUP BY product_cd, open_branch_id <b class="calibre3">WITH CUBE</b>; </p>
<p class="calibre1">+------------+----------------+-------------+</p>
<p class="calibre1">| product_cd | open_branch_id | tot_balance |</p>
<p class="calibre1">+------------+----------------+-------------+</p>
<p class="calibre1">| NULL       |           NULL |   170754.46 |</p>
<p class="calibre1">| NULL       |              1 |    27882.57 |</p>
<p class="calibre1">| NULL       |              2 |    21361.32 |</p>
<p class="calibre1">| NULL       |              3 |    53270.25 |</p>
<p class="calibre1">| NULL       |              4 |    68240.32 |</p>
<p class="calibre1">| BUS        |              2 |     9345.55 |</p>
<p class="calibre1">| BUS        |              4 |        0.00 |</p>
<p class="calibre1">| BUS        |           NULL |     9345.55 |</p>
<p class="calibre1">| CD         |              1 |    11500.00 |</p>
<p class="calibre1">| CD         |              2 |     8000.00 |</p>
<p class="calibre1">| CD         |           NULL |    19500.00 |</p>
<p class="calibre1">| CHK        |              1 |      782.16 |</p>
<p class="calibre1">| CHK        |              2 |     3315.77 |</p>
<p class="calibre1">| CHK        |              3 |     1057.75 |</p>
<p class="calibre1">| CHK        |              4 |    67852.33 |</p>
<p class="calibre1">| CHK        |           NULL |    73008.01 |</p>
<p class="calibre1">| MM         |              1 |    14832.64 |</p>
<p class="calibre1">| MM         |              3 |     2212.50 |</p>
<p class="calibre1">| MM         |           NULL |    17045.14 |</p>
<p class="calibre1">| SAV        |              1 |      767.77 |</p>
<p class="calibre1">| SAV        |              2 |      700.00 |</p>
<p class="calibre1">| SAV        |              4 |      387.99 |</p>
<p class="calibre1">| SAV        |           NULL |     1855.76 |</p>
<p class="calibre1">| SBL        |              3 |    50000.00 |</p>
<p class="calibre1">| SBL        |           NULL |    50000.00 |</p>
<p class="calibre1">+------------+----------------+-------------+</p>
<p class="calibre1">25 rows in set (0.02 sec)</p>
<p class="calibre1">Using with cube generates four more rows than the with rollup version of the query, one for each of the four branch IDs. Similar to with rollup, null values are placed in the product_cd column to indicate that a branch summary is being performed. </p>
<p class="calibre1">Once again, if you are using Oracle Database, you need to use a slightly different syntax to indicate that you want a cube operation performed. </p>
<p class="calibre1">The group by clause for the previous query would look as follows when using Oracle:</p>
<p class="calibre1">GROUP BY CUBE(product_cd, open_branch_id)</p>
<p class="calibre1"><b class="calibre3">154 | Chapter 8:</b> <b class="calibre3">Grouping and Aggregates</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-86"></a><img src="images/000019.png" alt="Image 36" class="calibre2" /></p>
<p class="calibre1"><b class="calibre3">Group Filter Conditions</b></p>
<p class="calibre1">In <a href="#calibre_link-39">Chapter 4, </a>I introduced you to various types of filter conditions and showed how you can use them in the where clause. When grouping data, you also can apply filter conditions to the data  <i class="calibre4">after</i> the groups have been generated. The having clause is where you should place these types of filter conditions. Consider the following example: mysql&gt; <b class="calibre3">SELECT product_cd, SUM(avail_balance) prod_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE status = 'ACTIVE' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">HAVING SUM(avail_balance) &gt;= 10000; </b></p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">| product_cd | prod_balance |</p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">| CD         |     19500.00 |</p>
<p class="calibre1">| CHK        |     73008.01 |</p>
<p class="calibre1">| MM         |     17045.14 |</p>
<p class="calibre1">| SBL        |     50000.00 |</p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">This query has two filter conditions: one in the where clause, which filters out inactive accounts, and the other in the having clause, which filters out any product whose total available balance is less than $10,000. Thus, one of the filters acts on data  <i class="calibre4">before</i> it is grouped, and the other filter acts on data  <i class="calibre4">after</i> the groups have been created. If you mistakenly put both filters in the where clause, you will see the following error: mysql&gt; <b class="calibre3">SELECT product_cd, SUM(avail_balance) prod_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE status = 'ACTIVE' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND SUM(avail_balance) &gt; 10000</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd; </b></p>
<p class="calibre1">ERROR 1111 (HY000): Invalid use of group function</p>
<p class="calibre1">This query fails because you cannot include an aggregate function in a query’s where clause. This is because the filters in the where clause are evaluated  <i class="calibre4">before</i> the grouping occurs, so the server can’t yet perform any functions on groups. </p>
<p class="calibre1">When adding filters to a query that includes a group by clause, think carefully about whether the filter acts on raw data, in which case it belongs in the where clause, or on grouped data, in which case it belongs in the having clause. </p>
<p class="calibre1">You may, however, include aggregate functions in the having clause, that do  <i class="calibre4">not</i> appear in the select clause, as demonstrated by the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_cd, SUM(avail_balance) prod_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE status = 'ACTIVE' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">HAVING MIN(avail_balance) &gt;= 1000</b></p>
<p class="calibre1"><b class="calibre3">Group Filter Conditions | 155</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-87"></a>    -&gt; <b class="calibre3">AND MAX(avail_balance) &lt;= 10000; </b></p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">| product_cd | prod_balance |</p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">| CD         |     19500.00 |</p>
<p class="calibre1">| MM         |     17045.14 |</p>
<p class="calibre1">+------------+--------------+</p>
<p class="calibre1">2 rows in set (0.00 sec)</p>
<p class="calibre1">This query generates total balances for each active product, but then the filter condition in the having clause excludes all products for which the minimum balance is less than $1,000 or the maximum balance is greater than $10,000. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">Work through the following exercises to test your grasp of SQL’s grouping and aggre-</p>
<p class="calibre1"><a href="#calibre_link-152">gating features. Check your work with the answers in Appendix C. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 8-1</b></p>
<p class="calibre1">Construct a query that counts the number of rows in the account table. </p>
<p class="calibre1"><b class="calibre3">Exercise 8-2</b></p>
<p class="calibre1">Modify your query from Exercise 8-1 to count the number of accounts held by each customer. Show the customer ID and the number of accounts for each customer. </p>
<p class="calibre1"><b class="calibre3">Exercise 8-3</b></p>
<p class="calibre1">Modify your query from Exercise 8-2 to include only those customers having at least two accounts. </p>
<p class="calibre1"><b class="calibre3">Exercise 8-4 (Extra Credit)</b></p>
<p class="calibre1">Find the total available balance by product and branch where there is more than one account per product and branch. Order the results by total balance (highest to lowest). </p>
<p class="calibre1"><b class="calibre3">156 | Chapter 8:</b> <b class="calibre3">Grouping and Aggregates</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-88"></a><b class="calibre3">CHAPTER 9</b></p>
<p class="calibre1"><b class="calibre3">Subqueries</b></p>
<p class="calibre1">Subqueries are a powerful tool that you can use in all four SQL data statements. This chapter explores in great detail the many uses of the subquery. </p>
<p class="calibre1"><b class="calibre3">What Is a Subquery? </b></p>
<p class="calibre1">A  <i class="calibre4">subquery</i> is a query contained within another SQL statement (which I refer to as the <i class="calibre4">containing  statement</i>  for  the  rest  of  this  discussion).  A  subquery  is  always  enclosed within parentheses, and it is usually executed prior to the containing statement. Like any query, a subquery returns a result set that may consist of:</p>
<p class="calibre1">• A single row with a single column</p>
<p class="calibre1">• Multiple rows with a single column</p>
<p class="calibre1">• Multiple rows and columns</p>
<p class="calibre1">The type of result set the subquery returns determines how it may be used and which operators the containing statement may use to interact with the data the subquery returns. When the containing statement has finished executing, the data returned by any subqueries is discarded, making a subquery act like a temporary table with  <i class="calibre4">statement scope</i> (meaning that the server frees up any memory allocated to the subquery results after the SQL statement has finished execution). </p>
<p class="calibre1">You already saw several examples of subqueries in earlier chapters, but here’s a simple example to get started:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE account_id = (SELECT MAX(account_id) FROM account); </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|         29 | SBL        |      13 |      50000.00 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">1 row in set (0.65 sec)</p>
<p class="calibre1"><b class="calibre3">157</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-89"></a>In this example, the subquery returns the maximum value found in the account_id column in the account table, and the containing statement then returns data about that account. If you are ever confused about what a subquery is doing, you can run the subquery by itself (without the parentheses) to see what it returns. Here’s the subquery from the previous example:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT MAX(account_id) FROM account; </b></p>
<p class="calibre1">+-----------------+</p>
<p class="calibre1">| MAX(account_id) |</p>
<p class="calibre1">+-----------------+</p>
<p class="calibre1">|              29 |</p>
<p class="calibre1">+-----------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">So, the subquery returns a single row with a single column, which allows it to be used as one of the expressions in an equality condition (if the subquery returned two or more rows, it could be  <i class="calibre4">compared</i> to something but could not be  <i class="calibre4">equal</i> to anything, but more on this later). In this case, you can take the value the subquery returned and substitute it into the righthand expression of the filter condition in the containing query, as in: mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE account_id = 29; </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|         29 | SBL        |      13 |      50000.00 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">1 row in set (0.02 sec)</p>
<p class="calibre1">The subquery is useful in this case because it allows you to retrieve information about the highest numbered account in a single query, rather than retrieving the maximum account_id using one query and then writing a second query to retrieve the desired data from the account table. As you will see, subqueries are useful in many other situations as well, and may become one of the most powerful tools in your SQL toolkit. </p>
<p class="calibre1"><b class="calibre3">Subquery Types</b></p>
<p class="calibre1">Along with the differences noted previously regarding the type of result set a subquery returns (single row/column, single row/multicolumn, or multiple columns), you can use another factor to differentiate subqueries; some subqueries are completely self-contained (called  <i class="calibre4">noncorrelated subqueries</i>), while others reference columns from the containing statement (called  <i class="calibre4">correlated subqueries</i>). The next several sections explore these two subquery types and show the different operators that you can employ to interact with them. </p>
<p class="calibre1"><b class="calibre3">158 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-90"></a><b class="calibre3">Noncorrelated Subqueries</b></p>
<p class="calibre1">The example from earlier in the chapter is a noncorrelated subquery; it may be executed alone and does not reference anything from the containing statement. Most subqueries that you encounter will be of this type unless you are writing update or delete statements, which frequently make use of correlated subqueries (more on this later). Along with being noncorrelated, the example from earlier in the chapter also returns a table comprising a single row and column. This type of subquery is known as a  <i class="calibre4">scalar subquery</i> and can appear on either side of a condition using the usual operators (=, &lt;&gt;, &lt;, </p>
<p class="calibre1">&gt;, &lt;=, &gt;=). The next example shows how you can use a scalar subquery in an inequality condition:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE open_emp_id &lt;&gt; (SELECT e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.assigned_branch_id = b.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e.title = 'Head Teller' AND b.city = 'Woburn'); </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|          7 | CHK        |       3 |       1057.75 |</p>
<p class="calibre1">|          8 | MM         |       3 |       2212.50 |</p>
<p class="calibre1">|         10 | CHK        |       4 |        534.12 |</p>
<p class="calibre1">|         11 | SAV        |       4 |        767.77 |</p>
<p class="calibre1">|         12 | MM         |       4 |       5487.09 |</p>
<p class="calibre1">|         13 | CHK        |       5 |       2237.97 |</p>
<p class="calibre1">|         14 | CHK        |       6 |        122.37 |</p>
<p class="calibre1">|         15 | CD         |       6 |      10000.00 |</p>
<p class="calibre1">|         18 | CHK        |       8 |       3487.19 |</p>
<p class="calibre1">|         19 | SAV        |       8 |        387.99 |</p>
<p class="calibre1">|         21 | CHK        |       9 |        125.67 |</p>
<p class="calibre1">|         22 | MM         |       9 |       9345.55 |</p>
<p class="calibre1">|         23 | CD         |       9 |       1500.00 |</p>
<p class="calibre1">|         24 | CHK        |      10 |      23575.12 |</p>
<p class="calibre1">|         25 | BUS        |      10 |          0.00 |</p>
<p class="calibre1">|         28 | CHK        |      12 |      38552.05 |</p>
<p class="calibre1">|         29 | SBL        |      13 |      50000.00 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">17 rows in set (0.86 sec)</p>
<p class="calibre1">This query returns data concerning all accounts that were  <i class="calibre4">not</i> opened by the head teller at the Woburn branch (the subquery is written using the assumption that there is only a single head teller at each branch). The subquery in this example is a bit more complex than in the previous example, in that it joins two tables and includes two filter conditions. Subqueries may be as simple or as complex as you need them to be, and they may  utilize  any  and  all  the  available  query  clauses  (select,  from,  where,  group by, having, and order by). </p>
<p class="calibre1">If you use a subquery in an equality condition, but the subquery returns more than one row, you will receive an error. For example, if you modify the previous query such that <b class="calibre3">Noncorrelated Subqueries | 159</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-91"></a>the subquery returns  <i class="calibre4">all</i> tellers at the Woburn branch instead of the single head teller, you will receive the following error:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE open_emp_id &lt;&gt; (SELECT e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.assigned_branch_id = b.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e.title = 'Teller' AND b.city = 'Woburn'); </b></p>
<p class="calibre1">ERROR 1242 (21000): Subquery returns more than 1 row</p>
<p class="calibre1">If you run the subquery by itself, you will see the following results: mysql&gt; <b class="calibre3">SELECT e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.assigned_branch_id = b.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e.title = 'Teller' AND b.city = 'Woburn'; </b></p>
<p class="calibre1">+--------+</p>
<p class="calibre1">| emp_id |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">|     11 |</p>
<p class="calibre1">|     12 |</p>
<p class="calibre1">+--------+</p>
<p class="calibre1">2 rows in set (0.02 sec)</p>
<p class="calibre1">The containing query fails because an expression (open_emp_id) cannot be equated to a set of expressions (emp_ids 11 and 12). In other words, a single thing cannot be equated to a set of things. In the next section, you will see how to fix the problem by using a different operator. </p>
<p class="calibre1"><b class="calibre3">Multiple-Row, Single-Column Subqueries</b></p>
<p class="calibre1">If your subquery returns more than one row, you will not be able to use it on one side of an equality condition, as the previous example demonstrated. However, there are four  additional  operators  that  you  can  use  to  build  conditions  with  these  types  of subqueries. </p>
<p class="calibre1"><b class="calibre3">The in and not in operators</b></p>
<p class="calibre1">While you can’t  <i class="calibre4">equate</i> a single value to a set of values, you can check to see whether a single value can be found  <i class="calibre4">within</i> a set of values. The next example, while it doesn’t use a subquery, demonstrates how to build a condition that uses the in operator to search for a value within a set of values:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT branch_id, name, city</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM branch</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE name IN ('Headquarters', 'Quincy Branch'); </b></p>
<p class="calibre1">+-----------+---------------+---------+</p>
<p class="calibre1">| branch_id | name          | city    |</p>
<p class="calibre1">+-----------+---------------+---------+</p>
<p class="calibre1">|         1 | Headquarters  | Waltham |</p>
<p class="calibre1">|         3 | Quincy Branch | Quincy  |</p>
<p class="calibre1"><b class="calibre3">160 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-209"></a>+-----------+---------------+---------+</p>
<p class="calibre1">2 rows in set (0.03 sec)</p>
<p class="calibre1">The expression on the lefthand side of the condition is the name column, while the righthand side of the condition is a set of strings. The in operator checks to see whether either of the strings can be found in the name column; if so, the condition is met and the row is added to the result set. You could achieve the same results using two equality conditions, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT branch_id, name, city</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM branch</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE name = 'Headquarters' OR name = 'Quincy Branch'; </b></p>
<p class="calibre1">+-----------+---------------+---------+</p>
<p class="calibre1">| branch_id | name          | city    |</p>
<p class="calibre1">+-----------+---------------+---------+</p>
<p class="calibre1">|         1 | Headquarters  | Waltham |</p>
<p class="calibre1">|         3 | Quincy Branch | Quincy  |</p>
<p class="calibre1">+-----------+---------------+---------+</p>
<p class="calibre1">2 rows in set (0.01 sec)</p>
<p class="calibre1">While this approach seems reasonable when the set contains only two expressions, it is easy to see why a single condition using the in operator would be preferable if the set contained dozens (or hundreds, thousands, etc.) of values. </p>
<p class="calibre1">Although you will occasionally create a set of strings, dates, or numbers to use on one side of a condition, you are more likely to generate the set at query execution via a subquery that returns one or more rows. The following query uses the in operator with a subquery on the righthand side of the filter condition to see which employees supervise other employees:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE emp_id IN (SELECT superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee); </b></p>
<p class="calibre1">+--------+---------+-----------+--------------------+</p>
<p class="calibre1">| emp_id | fname   | lname     | title              |</p>
<p class="calibre1">+--------+---------+-----------+--------------------+</p>
<p class="calibre1">|      1 | Michael | Smith     | President          |</p>
<p class="calibre1">|      3 | Robert  | Tyler     | Treasurer          |</p>
<p class="calibre1">|      4 | Susan   | Hawthorne | Operations Manager |</p>
<p class="calibre1">|      6 | Helen   | Fleming   | Head Teller        |</p>
<p class="calibre1">|     10 | Paula   | Roberts   | Head Teller        |</p>
<p class="calibre1">|     13 | John    | Blake     | Head Teller        |</p>
<p class="calibre1">|     16 | Theresa | Markham   | Head Teller        |</p>
<p class="calibre1">+--------+---------+-----------+--------------------+</p>
<p class="calibre1">7 rows in set (0.01 sec)</p>
<p class="calibre1">The subquery returns the IDs of all employees who supervise other employees, and the containing query retrieves four columns from the employee table for these employees. </p>
<p class="calibre1">Here are the results of the subquery:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b></p>
<p class="calibre1">+-----------------+</p>
<p class="calibre1"><b class="calibre3">Noncorrelated Subqueries | 161</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-223"></a>| superior_emp_id |</p>
<p class="calibre1">+-----------------+</p>
<p class="calibre1">|            NULL |</p>
<p class="calibre1">|               1 |</p>
<p class="calibre1">|               1 |</p>
<p class="calibre1">|               3 |</p>
<p class="calibre1">|               4 |</p>
<p class="calibre1">|               4 |</p>
<p class="calibre1">|               4 |</p>
<p class="calibre1">|               4 |</p>
<p class="calibre1">|               4 |</p>
<p class="calibre1">|               6 |</p>
<p class="calibre1">|               6 |</p>
<p class="calibre1">|               6 |</p>
<p class="calibre1">|              10 |</p>
<p class="calibre1">|              10 |</p>
<p class="calibre1">|              13 |</p>
<p class="calibre1">|              13 |</p>
<p class="calibre1">|              16 |</p>
<p class="calibre1">|              16 |</p>
<p class="calibre1">+-----------------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1">As you can see, some employee IDs are listed more than once, since some employees supervise multiple people. This doesn’t adversely affect the results of the containing query, since it doesn’t matter whether an employee ID can be found in the result set of the subquery once or more than once. Of course, you could add the distinct keyword to the subquery’s select clause if it bothers you to have duplicates in the table returned by the subquery, but it won’t change the containing query’s result set. </p>
<p class="calibre1">Along with seeing whether a value exists within a set of values, you can check the converse using the not in operator. Here’s another version of the previous query using not in instead of in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE emp_id NOT IN (SELECT superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE superior_emp_id IS NOT NULL); </b></p>
<p class="calibre1">+--------+----------+----------+----------------+</p>
<p class="calibre1">| emp_id | fname    | lname    | title          |</p>
<p class="calibre1">+--------+----------+----------+----------------+</p>
<p class="calibre1">|      2 | Susan    | Barker   | Vice President |</p>
<p class="calibre1">|      5 | John     | Gooding  | Loan Manager   |</p>
<p class="calibre1">|      7 | Chris    | Tucker   | Teller         |</p>
<p class="calibre1">|      8 | Sarah    | Parker   | Teller         |</p>
<p class="calibre1">|      9 | Jane     | Grossman | Teller         |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler  | Teller         |</p>
<p class="calibre1">|     12 | Samantha | Jameson  | Teller         |</p>
<p class="calibre1">|     14 | Cindy    | Mason    | Teller         |</p>
<p class="calibre1">|     15 | Frank    | Portman  | Teller         |</p>
<p class="calibre1">|     17 | Beth     | Fowler   | Teller         |</p>
<p class="calibre1">|     18 | Rick     | Tulman   | Teller         |</p>
<p class="calibre1"><b class="calibre3">162 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-172"></a>+--------+----------+----------+----------------+</p>
<p class="calibre1">11 rows in set (0.00 sec)</p>
<p class="calibre1">This query finds all employees who do  <i class="calibre4">not</i> supervise other people. For this query, I needed to add a filter condition to the subquery to ensure that null values do not appear in the table returned by the subquery; see the next section for an explanation of why this filter is needed in this case. </p>
<p class="calibre1"><b class="calibre3">The all operator</b></p>
<p class="calibre1">While the in operator is used to see whether an expression can be found within a set of expressions, the all operator allows you to make comparisons between a single value and every value in a set. To build such a condition, you will need to use one of the comparison operators (=, &lt;&gt;, &lt;, &gt;, etc.) in conjunction with the all operator. For example, the next query finds all employees whose employee IDs are not equal to any of the supervisor employee IDs:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE emp_id &lt;&gt; ALL (SELECT superior_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE superior_emp_id IS NOT NULL); </b></p>
<p class="calibre1">+--------+----------+----------+----------------+</p>
<p class="calibre1">| emp_id | fname    | lname    | title          |</p>
<p class="calibre1">+--------+----------+----------+----------------+</p>
<p class="calibre1">|      2 | Susan    | Barker   | Vice President |</p>
<p class="calibre1">|      5 | John     | Gooding  | Loan Manager   |</p>
<p class="calibre1">|      7 | Chris    | Tucker   | Teller         |</p>
<p class="calibre1">|      8 | Sarah    | Parker   | Teller         |</p>
<p class="calibre1">|      9 | Jane     | Grossman | Teller         |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler  | Teller         |</p>
<p class="calibre1">|     12 | Samantha | Jameson  | Teller         |</p>
<p class="calibre1">|     14 | Cindy    | Mason    | Teller         |</p>
<p class="calibre1">|     15 | Frank    | Portman  | Teller         |</p>
<p class="calibre1">|     17 | Beth     | Fowler   | Teller         |</p>
<p class="calibre1">|     18 | Rick     | Tulman   | Teller         |</p>
<p class="calibre1">+--------+----------+----------+----------------+</p>
<p class="calibre1">11 rows in set (0.05 sec)</p>
<p class="calibre1">Once again, the subquery returns the set of IDs for those employees who supervise other people, and the containing query returns data for each employee whose ID is not equal to all of the IDs returned by the subquery. In other words, the query finds all employees who are not supervisors. If this approach seems a bit clumsy to you, you are in good company; most people would prefer to phrase the query differently and avoid using the all operator. For example, this query generates the same results as the last example in the previous section, which used the not in operator. It’s a matter of preference, but I think that most people would find the version that uses not in to be easier to understand. </p>
<p class="calibre1"><b class="calibre3">Noncorrelated Subqueries | 163</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-299"></a><img src="images/000020.png" alt="Image 37" class="calibre2" /></p>
<p class="calibre1">When using not in or &lt;&gt; all to compare a value to a set of values, you must be careful to ensure that the set of values does not contain a null value, because the server equates the value on the lefthand side of the expression to each member of the set, and any attempt to equate a value to null yields unknown. Thus, the following query returns an empty set: mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, title</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE emp_id NOT IN (1, 2, NULL); </b></p>
<p class="calibre1">Empty set (0.00 sec)</p>
<p class="calibre1">In some cases, the all operator is a bit more natural. The next example uses all to find accounts having an available balance smaller than all of Frank Tucker’s accounts: mysql&gt; <b class="calibre3">SELECT account_id, cust_id, product_cd, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE avail_balance &lt; ALL (SELECT a.avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = i.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE i.fname = 'Frank' AND i.lname = 'Tucker'); </b></p>
<p class="calibre1">+------------+---------+------------+---------------+</p>
<p class="calibre1">| account_id | cust_id | product_cd | avail_balance |</p>
<p class="calibre1">+------------+---------+------------+---------------+</p>
<p class="calibre1">|          2 |       1 | SAV        |        500.00 |</p>
<p class="calibre1">|          5 |       2 | SAV        |        200.00 |</p>
<p class="calibre1">|         10 |       4 | CHK        |        534.12 |</p>
<p class="calibre1">|         11 |       4 | SAV        |        767.77 |</p>
<p class="calibre1">|         14 |       6 | CHK        |        122.37 |</p>
<p class="calibre1">|         19 |       8 | SAV        |        387.99 |</p>
<p class="calibre1">|         21 |       9 | CHK        |        125.67 |</p>
<p class="calibre1">|         25 |      10 | BUS        |          0.00 |</p>
<p class="calibre1">+------------+---------+------------+---------------+</p>
<p class="calibre1">8 rows in set (0.17 sec)</p>
<p class="calibre1">Here’s the data returned by the subquery, which consists of the available balance from each of Frank’s accounts:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = i.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE i.fname = 'Frank' AND i.lname = 'Tucker'; </b></p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">| avail_balance |</p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">|       1057.75 |</p>
<p class="calibre1">|       2212.50 |</p>
<p class="calibre1">+---------------+</p>
<p class="calibre1">2 rows in set (0.01 sec)</p>
<p class="calibre1">Frank has two accounts, with the lowest balance being $1,057.75. The containing query finds all accounts having a balance smaller than any of Frank’s accounts, so the result set includes all accounts having a balance less than $1,057.75. </p>
<p class="calibre1"><b class="calibre3">164 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-92"></a><img src="images/000022.png" alt="Image 38" class="calibre2" /></p>
<p class="calibre1"><b class="calibre3">The any operator</b></p>
<p class="calibre1">Like the all operator, the any operator allows a value to be compared to the members of a set of values; unlike all, however, a condition using the any operator evaluates to true as soon as a single comparison is favorable. This is different from the previous example using the all operator, which evaluates to true only if comparisons against <i class="calibre4">all</i> members of the set are favorable. For example, you might want to find all accounts having an available balance greater than  <i class="calibre4">any</i> of Frank Tucker’s accounts: mysql&gt; <b class="calibre3">SELECT account_id, cust_id, product_cd, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE avail_balance &gt; ANY (SELECT a.avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = i.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE i.fname = 'Frank' AND i.lname = 'Tucker'); </b></p>
<p class="calibre1">+------------+---------+------------+---------------+</p>
<p class="calibre1">| account_id | cust_id | product_cd | avail_balance |</p>
<p class="calibre1">+------------+---------+------------+---------------+</p>
<p class="calibre1">|          3 |       1 | CD         |       3000.00 |</p>
<p class="calibre1">|          4 |       2 | CHK        |       2258.02 |</p>
<p class="calibre1">|          8 |       3 | MM         |       2212.50 |</p>
<p class="calibre1">|         12 |       4 | MM         |       5487.09 |</p>
<p class="calibre1">|         13 |       5 | CHK        |       2237.97 |</p>
<p class="calibre1">|         15 |       6 | CD         |      10000.00 |</p>
<p class="calibre1">|         17 |       7 | CD         |       5000.00 |</p>
<p class="calibre1">|         18 |       8 | CHK        |       3487.19 |</p>
<p class="calibre1">|         22 |       9 | MM         |       9345.55 |</p>
<p class="calibre1">|         23 |       9 | CD         |       1500.00 |</p>
<p class="calibre1">|         24 |      10 | CHK        |      23575.12 |</p>
<p class="calibre1">|         27 |      11 | BUS        |       9345.55 |</p>
<p class="calibre1">|         28 |      12 | CHK        |      38552.05 |</p>
<p class="calibre1">|         29 |      13 | SBL        |      50000.00 |</p>
<p class="calibre1">+------------+---------+------------+---------------+</p>
<p class="calibre1">14 rows in set (0.00 sec)</p>
<p class="calibre1">Frank has two accounts with balances of $1,057.75 and $2,212.50; to have a balance greater than  <i class="calibre4">any</i> of these two accounts, an account must have a balance of at least $1,057.75. </p>
<p class="calibre1">Although most people prefer to use in, using = any is equivalent to using the in operator. </p>
<p class="calibre1"><b class="calibre3">Multicolumn Subqueries</b></p>
<p class="calibre1">So far, all of the subquery examples in this chapter have returned a single column and one or more rows. In certain situations, however, you can use subqueries that return two or more columns. To show the utility of multiple-column subqueries, it might help to look first at an example that uses multiple, single-column subqueries: <b class="calibre3">Noncorrelated Subqueries | 165</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-300"></a>mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE open_branch_id = (SELECT branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM branch</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE name = 'Woburn Branch')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND open_emp_id IN (SELECT emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE title = 'Teller' OR title = 'Head Teller'); </b></p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">| account_id | product_cd | cust_id |</p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">|          1 | CHK        |       1 |</p>
<p class="calibre1">|          2 | SAV        |       1 |</p>
<p class="calibre1">|          3 | CD         |       1 |</p>
<p class="calibre1">|          4 | CHK        |       2 |</p>
<p class="calibre1">|          5 | SAV        |       2 |</p>
<p class="calibre1">|         17 | CD         |       7 |</p>
<p class="calibre1">|         27 | BUS        |      11 |</p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">7 rows in set (0.09 sec)</p>
<p class="calibre1">This query uses two subqueries to identify the ID of the Woburn branch and the IDs of all bank tellers, and the containing query then uses this information to retrieve all checking  accounts  opened  by  a  teller  at  the  Woburn  branch.  However,  since  the employee table includes information about which branch each employee is assigned to, you can achieve the same results by comparing both the account.open_branch_id and account.open_emp_id  columns  to  a  single  subquery  against  the  employee  and  branch tables. To do so, your filter condition must name both columns from the account table surrounded by parentheses and in the same order as returned by the subquery, as in: mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE (open_branch_id, open_emp_id) IN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT b.branch_id, e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM branch b INNER JOIN employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON b.branch_id = e.assigned_branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE b.name = 'Woburn Branch' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND (e.title = 'Teller' OR e.title = 'Head Teller')); </b></p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">| account_id | product_cd | cust_id |</p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">|          1 | CHK        |       1 |</p>
<p class="calibre1">|          2 | SAV        |       1 |</p>
<p class="calibre1">|          3 | CD         |       1 |</p>
<p class="calibre1">|          4 | CHK        |       2 |</p>
<p class="calibre1">|          5 | SAV        |       2 |</p>
<p class="calibre1">|         17 | CD         |       7 |</p>
<p class="calibre1">|         27 | BUS        |      11 |</p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">7 rows in set (0.00 sec)</p>
<p class="calibre1">This version of the query performs the same function as the previous example, but with a single subquery that returns two columns instead of two subqueries that each return a single column. </p>
<p class="calibre1"><b class="calibre3">166 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-93"></a>Of course, you could rewrite the previous example simply to join the three tables instead of using a subquery, but it’s helpful when learning SQL to see multiple ways of achieving the same results. Here’s another example, however, that requires a subquery. Let’s say that there have been some customer complaints regarding incorrect values in the available/pending balance columns in the account table. Your job is to find all accounts whose  balances  don’t  match  the  sum  of  the  transaction  amounts  for  that  account. </p>
<p class="calibre1">Here’s a partial solution to the problem:</p>
<p class="calibre1">SELECT 'ALERT! : Account #1 Has Incorrect Balance!' </p>
<p class="calibre1">FROM account</p>
<p class="calibre1">WHERE (avail_balance, pending_balance) &lt;&gt; </p>
<p class="calibre1">(SELECT SUM(&lt;expression to generate available balance&gt;), SUM(&lt;expression to generate pending balance&gt;)</p>
<p class="calibre1">FROM transaction</p>
<p class="calibre1">WHERE account_id = 1)</p>
<p class="calibre1">AND account_id = 1; </p>
<p class="calibre1">As you can see, I have neglected to fill in the expressions used to sum the transaction amounts for the available and pending balance calculations, but I promise to finish the</p>
<p class="calibre1"><a href="#calibre_link-107">job in Chapter 11 after you learn how to build </a>case expressions. Even so, the query is complete  enough  to  see  that  the  subquery  is  generating  two  sums  from  the transaction table that are then compared to the avail_balance and pending_balance columns in the account table. Both the subquery and the containing query include the filter condition account_id = 1, so the query in its present form will check only a single account at a time. In the next section, you will learn how to write a more general form of the query that will check  <i class="calibre4">all</i> accounts with a single execution. </p>
<p class="calibre1"><b class="calibre3">Correlated Subqueries</b></p>
<p class="calibre1">All of the subqueries shown thus far have been independent of their containing statements, meaning that you can execute them by themselves and inspect the results. A <i class="calibre4">correlated subquery</i>, on the other hand, is  <i class="calibre4">dependent</i> on its containing statement from which it references one or more columns. Unlike a noncorrelated subquery, a correlated subquery is not executed once prior to execution of the containing statement; instead, the correlated subquery is executed once for each candidate row (rows that might be included in the final results). For example, the following query uses a correlated subquery to count the number of accounts for each customer, and the containing query then retrieves those customers having exactly two accounts:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT c.cust_id, c.cust_type_cd, c.city</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE 2 = (SELECT COUNT(*)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE a.cust_id = c.cust_id); </b></p>
<p class="calibre1">+---------+--------------+---------+</p>
<p class="calibre1">| cust_id | cust_type_cd | city    |</p>
<p class="calibre1">+---------+--------------+---------+</p>
<p class="calibre1">|       2 | I            | Woburn  |</p>
<p class="calibre1">|       3 | I            | Quincy  |</p>
<p class="calibre1"><b class="calibre3">Correlated Subqueries | 167</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-230"></a><img src="images/000023.png" alt="Image 39" class="calibre2" /></p>
<p class="calibre1">|       6 | I            | Waltham |</p>
<p class="calibre1">|       8 | I            | Salem   |</p>
<p class="calibre1">|      10 | B            | Salem   |</p>
<p class="calibre1">+---------+--------------+---------+</p>
<p class="calibre1">5 rows in set (0.01 sec)</p>
<p class="calibre1">The reference to c.cust_id at the very end of the subquery is what makes the subquery correlated; the containing query must supply values for c.cust_id for the subquery to execute. In this case, the containing query retrieves all 13 rows from the customer table and executes the subquery once for each customer, passing in the appropriate customer ID for each execution. If the subquery returns the value 2, then the filter condition is met and the row is added to the result set. </p>
<p class="calibre1">Along with equality conditions, you can use correlated subqueries in other types of conditions, such as the range condition illustrated here:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT c.cust_id, c.cust_type_cd, c.city</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE (SELECT SUM(a.avail_balance)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE a.cust_id = c.cust_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">BETWEEN 5000 AND 10000; </b></p>
<p class="calibre1">+---------+--------------+------------+</p>
<p class="calibre1">| cust_id | cust_type_cd | city       |</p>
<p class="calibre1">+---------+--------------+------------+</p>
<p class="calibre1">|       4 | I            | Waltham    |</p>
<p class="calibre1">|       7 | I            | Wilmington |</p>
<p class="calibre1">|      11 | B            | Wilmington |</p>
<p class="calibre1">+---------+--------------+------------+</p>
<p class="calibre1">3 rows in set (0.02 sec)</p>
<p class="calibre1">This variation on the previous query finds all customers whose total available balance across all accounts lies between $5,000 and $10,000. Once again, the correlated subquery is executed 13 times (once for each customer row), and each execution of the subquery returns the total account balance for the given customer. </p>
<p class="calibre1">Another subtle difference in the previous query is that the subquery is on the lefthand side of the condition, which may look a bit odd but is perfectly valid. </p>
<p class="calibre1">At the end of the previous section, I demonstrated how to check the available and pending balances of an account against the transactions logged against the account, and I promised to show you how to modify the example to run all accounts in a single execution. Here’s the example again:</p>
<p class="calibre1">SELECT 'ALERT! : Account #1 Has Incorrect Balance!' </p>
<p class="calibre1">FROM account</p>
<p class="calibre1">WHERE (avail_balance, pending_balance) &lt;&gt; </p>
<p class="calibre1">(SELECT SUM(&lt;expression to generate available balance&gt;), SUM(&lt;expression to generate pending balance&gt;)</p>
<p class="calibre1">FROM transaction</p>
<p class="calibre1"><b class="calibre3">168 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-94"></a>  WHERE account_id = 1)</p>
<p class="calibre1">AND account_id = 1; </p>
<p class="calibre1">Using a correlated subquery instead of a noncorrelated subquery, you can execute the containing query once, and the subquery will be run for each account. Here’s the updated version:</p>
<p class="calibre1">SELECT CONCAT('ALERT! : Account #', a.account_id, </p>
<p class="calibre1">' Has Incorrect Balance!')</p>
<p class="calibre1">FROM account a</p>
<p class="calibre1">WHERE (a.avail_balance, a.pending_balance) &lt;&gt; </p>
<p class="calibre1">(SELECT SUM(&lt;expression to generate available balance&gt;), SUM(&lt;expression to generate pending balance&gt;)</p>
<p class="calibre1">FROM transaction t</p>
<p class="calibre1"><b class="calibre3">WHERE t.account_id = a.account_id</b>); </p>
<p class="calibre1">The subquery now includes a filter condition linking the transaction’s account ID to the account ID from the containing query. The select clause has also been modified to concatenate an alert message that includes the account ID rather than the hardcoded value 1. </p>
<p class="calibre1"><b class="calibre3">The exists Operator</b></p>
<p class="calibre1">While you will often see correlated subqueries used in equality and range conditions, the most common operator used to build conditions that utilize correlated subqueries is the exists operator. You use the exists operator when you want to identify that a relationship exists without regard for the quantity; for example, the following query finds all the accounts for which a transaction was posted on a particular day, without regard for how many transactions were posted:</p>
<p class="calibre1">SELECT a.account_id, a.product_cd, a.cust_id, a.avail_balance FROM account a</p>
<p class="calibre1">WHERE <b class="calibre3">EXISTS</b> (SELECT 1</p>
<p class="calibre1">FROM transaction t</p>
<p class="calibre1">WHERE t.account_id = a.account_id</p>
<p class="calibre1">AND t.txn_date = '2008-09-22'); </p>
<p class="calibre1">Using the exists operator, your subquery can return zero, one, or many rows, and the condition simply checks whether the subquery returned any rows. If you look at the select clause of the subquery, you will see that it consists of a single literal (1); since the condition in the containing query only needs to know how many rows have been returned, the actual data the subquery returned is irrelevant. Your subquery can return whatever strikes your fancy, as demonstrated next:</p>
<p class="calibre1">SELECT a.account_id, a.product_cd, a.cust_id, a.avail_balance FROM account a</p>
<p class="calibre1">WHERE EXISTS (<b class="calibre3">SELECT t.txn_id, 'hello', 3.1415927</b></p>
<p class="calibre1">FROM transaction t</p>
<p class="calibre1">WHERE t.account_id = a.account_id</p>
<p class="calibre1">AND t.txn_date = '2008-09-22'); </p>
<p class="calibre1">However, the convention is to specify either select 1 or select * when using exists. </p>
<p class="calibre1"><b class="calibre3">Correlated Subqueries | 169</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-95"></a>You may also use not exists to check for subqueries that return no rows, as demonstrated by the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.product_cd, a.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE NOT EXISTS (SELECT 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE b.cust_id = a.cust_id); </b></p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">| account_id | product_cd | cust_id |</p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">|          1 | CHK        |       1 |</p>
<p class="calibre1">|          2 | SAV        |       1 |</p>
<p class="calibre1">|          3 | CD         |       1 |</p>
<p class="calibre1">|          4 | CHK        |       2 |</p>
<p class="calibre1">|          5 | SAV        |       2 |</p>
<p class="calibre1">|          7 | CHK        |       3 |</p>
<p class="calibre1">|          8 | MM         |       3 |</p>
<p class="calibre1">|         10 | CHK        |       4 |</p>
<p class="calibre1">|         11 | SAV        |       4 |</p>
<p class="calibre1">|         12 | MM         |       4 |</p>
<p class="calibre1">|         13 | CHK        |       5 |</p>
<p class="calibre1">|         14 | CHK        |       6 |</p>
<p class="calibre1">|         15 | CD         |       6 |</p>
<p class="calibre1">|         17 | CD         |       7 |</p>
<p class="calibre1">|         18 | CHK        |       8 |</p>
<p class="calibre1">|         19 | SAV        |       8 |</p>
<p class="calibre1">|         21 | CHK        |       9 |</p>
<p class="calibre1">|         22 | MM         |       9 |</p>
<p class="calibre1">|         23 | CD         |       9 |</p>
<p class="calibre1">+------------+------------+---------+</p>
<p class="calibre1">19 rows in set (0.99 sec)</p>
<p class="calibre1">This query finds all customers whose customer ID does not appear in the business table, which is a roundabout way of finding all nonbusiness customers. </p>
<p class="calibre1"><b class="calibre3">Data Manipulation Using Correlated Subqueries</b></p>
<p class="calibre1">All of the examples thus far in the chapter have been select statements, but don’t think that means that subqueries aren’t useful in other SQL statements. Subqueries are used heavily in update, delete, and insert statements as well, with correlated subqueries appearing frequently in update and delete statements. Here’s an example of a correlated subquery used to modify the last_activity_date column in the account table: UPDATE account a</p>
<p class="calibre1">SET a.last_activity_date =</p>
<p class="calibre1">(SELECT MAX(t.txn_date)</p>
<p class="calibre1">FROM transaction t</p>
<p class="calibre1">WHERE t.account_id = a.account_id); </p>
<p class="calibre1">This statement modifies every row in the account table (since there is no where clause) by finding the latest transaction date for each account. While it seems reasonable to expect that every account will have at least one transaction linked to it, it would be best <b class="calibre3">170 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-96"></a>to check whether an account has any transactions before attempting to update the last_activity_date column; otherwise, the column will be set to null, since the subquery would return no rows. Here’s another version of the update statement, this time employing a where clause with a second correlated subquery:</p>
<p class="calibre1">UPDATE account a</p>
<p class="calibre1">SET a.last_activity_date =</p>
<p class="calibre1">(SELECT MAX(t.txn_date)</p>
<p class="calibre1">FROM transaction t</p>
<p class="calibre1">WHERE t.account_id = a.account_id)</p>
<p class="calibre1">WHERE EXISTS (SELECT 1</p>
<p class="calibre1">FROM transaction t</p>
<p class="calibre1">WHERE t.account_id = a.account_id); </p>
<p class="calibre1">The two correlated subqueries are identical except for the select clauses. The subquery in the set clause, however, executes only if the condition in the update statement’s where clause evaluates to true (meaning that at least one transaction was found for the account), thus protecting the data in the last_activity_date column from being over-written with a null. </p>
<p class="calibre1">Correlated subqueries are also common in delete statements. For example, you may run a data maintenance script at the end of each month that removes unnecessary data. </p>
<p class="calibre1">The  script  might  include  the  following  statement,  which  removes  data  from  the department table that has no child rows in the employee table: DELETE FROM department</p>
<p class="calibre1">WHERE NOT EXISTS (SELECT 1</p>
<p class="calibre1">FROM employee</p>
<p class="calibre1">WHERE employee.dept_id = department.dept_id); </p>
<p class="calibre1">When using correlated subqueries with delete statements in MySQL, keep in mind that, for whatever reason, table aliases are not allowed when using delete, which is why I had to use the entire table name in the subquery. With most other database servers, you could provide aliases for the department and employee tables, such as: DELETE FROM department d</p>
<p class="calibre1">WHERE NOT EXISTS (SELECT 1</p>
<p class="calibre1">FROM employee e</p>
<p class="calibre1">WHERE e.dept_id = d.dept_id); </p>
<p class="calibre1"><b class="calibre3">When to Use Subqueries</b></p>
<p class="calibre1">Now that you have learned about the different types of subqueries and the different operators that you can employ to interact with the data returned by subqueries, it’s time to explore the many ways in which you can use subqueries to build powerful SQL</p>
<p class="calibre1">statements. The next three sections demonstrate how you may use subqueries to construct custom tables, to build conditions, and to generate column values in result sets. </p>
<p class="calibre1"><b class="calibre3">When to Use Subqueries | 171</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-97"></a><b class="calibre3">Subqueries As Data Sources</b></p>
<p class="calibre1">Back in <a href="#calibre_link-25">Chapter 3, </a>I stated that the from clause of a select statement names the  <i class="calibre4">tables</i> to be used by the query. Since a subquery generates a result set containing rows and columns of data, it is perfectly valid to include subqueries in your from clause along with tables. Although it might, at first glance, seem like an interesting feature without much practical merit, using subqueries alongside tables is one of the most powerful tools available when writing queries. Here’s a simple example: mysql&gt; <b class="calibre3">SELECT d.dept_id, d.name, e_cnt.how_many num_employees</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM department d INNER JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT dept_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY dept_id) e_cnt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON d.dept_id = e_cnt.dept_id; </b></p>
<p class="calibre1">+---------+----------------+---------------+</p>
<p class="calibre1">| dept_id | name           | num_employees |</p>
<p class="calibre1">+---------+----------------+---------------+</p>
<p class="calibre1">|       1 | Operations     |            14 |</p>
<p class="calibre1">|       2 | Loans          |             1 |</p>
<p class="calibre1">|       3 | Administration |             3 |</p>
<p class="calibre1">+---------+----------------+---------------+</p>
<p class="calibre1">3 rows in set (0.04 sec)</p>
<p class="calibre1">In this example, a subquery generates a list of department IDs along with the number of  employees  assigned  to  each  department.  Here’s  the  result  set  generated  by  the subquery:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT dept_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY dept_id; </b></p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">| dept_id | how_many |</p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">|       1 |       14 |</p>
<p class="calibre1">|       2 |        1 |</p>
<p class="calibre1">|       3 |        3 |</p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">3 rows in set (0.00 sec)</p>
<p class="calibre1">The subquery is given the name e_cnt and is joined to the department table via the dept_id column. The containing query then retrieves the department ID and name from the department table, along with the employee count from the e_cnt subquery. </p>
<p class="calibre1">Subqueries used in the from clause must be noncorrelated; they are executed first, and the data is held in memory until the containing query finishes execution. Subqueries offer immense flexibility when writing queries, because you can go far beyond the set of available tables to create virtually any view of the data that you desire, and then join the results to other tables or subqueries. If you are writing reports or generating data feeds to external systems, you may be able to do things with a single query that used to demand multiple queries or a procedural language to accomplish. </p>
<p class="calibre1"><b class="calibre3">172 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-163"></a><b class="calibre3">Data fabrication</b></p>
<p class="calibre1">Along with using subqueries to summarize existing data, you can use subqueries to generate data that doesn’t exist in any form within your database. For example, you may wish to group your customers by the amount of money held in deposit accounts, but you want to use group definitions that are not stored in your database. For example, </p>
<p class="calibre1"><a href="#calibre_link-163">let’s say you want to sort your customers into the groups shown in Table 9-1. </a></p>
<p class="calibre1"> <i class="calibre4">Table 9-1. Customer balance groups</i></p>
<p class="calibre1"><b class="calibre3">Group name</b></p>
<p class="calibre1"><b class="calibre3">Lower limit</b></p>
<p class="calibre1"><b class="calibre3">Upper limit</b></p>
<p class="calibre1">Small Fry</p>
<p class="calibre1">0</p>
<p class="calibre1">$4,999.99</p>
<p class="calibre1">Average Joes</p>
<p class="calibre1">$5,000</p>
<p class="calibre1">$9,999.99</p>
<p class="calibre1">Heavy Hitters</p>
<p class="calibre1">$10,000</p>
<p class="calibre1">$9,999,999.99</p>
<p class="calibre1">To generate these groups within a single query, you will need a way to define these three groups. The first step is to define a query that generates the group definitions: mysql&gt; <b class="calibre3">SELECT 'Small Fry' name, 0 low_limit, 4999.99 high_limit</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'Average Joes' name, 5000 low_limit, 9999.99 high_limit</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'Heavy Hitters' name, 10000 low_limit, 9999999.99 high_limit; </b></p>
<p class="calibre1">+---------------+-----------+------------+</p>
<p class="calibre1">| name          | low_limit | high_limit |</p>
<p class="calibre1">+---------------+-----------+------------+</p>
<p class="calibre1">| Small Fry     |         0 |    4999.99 |</p>
<p class="calibre1">| Average Joes  |      5000 |    9999.99 |</p>
<p class="calibre1">| Heavy Hitters |     10000 | 9999999.99 |</p>
<p class="calibre1">+---------------+-----------+------------+</p>
<p class="calibre1">3 rows in set (0.00 sec)</p>
<p class="calibre1">I have used the set operator union all to merge the results from three separate queries into a single result set. Each query retrieves three literals, and the results from the three queries are put together to generate a result set with three rows and three columns. You now have a query to generate the desired groups, and you can place it into the from clause of another query to generate your customer groups:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT groups.name, COUNT(*) num_customers</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT SUM(a.avail_balance) cust_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN product p</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.product_cd = p.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.product_type_cd = 'ACCOUNT' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY a.cust_id) cust_rollup</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 'Small Fry' name, 0 low_limit, 4999.99 high_limit</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'Average Joes' name, 5000 low_limit, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">9999.99 high_limit</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'Heavy Hitters' name, 10000 low_limit, </b></p>
<p class="calibre1"><b class="calibre3">When to Use Subqueries | 173</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-231"></a>    -&gt; <b class="calibre3">9999999.99 high_limit) groups</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON cust_rollup.cust_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">BETWEEN groups.low_limit AND groups.high_limit</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY groups.name; </b></p>
<p class="calibre1">+---------------+---------------+</p>
<p class="calibre1">| name          | num_customers |</p>
<p class="calibre1">+---------------+---------------+</p>
<p class="calibre1">| Average Joes  |             2 |</p>
<p class="calibre1">| Heavy Hitters |             4 |</p>
<p class="calibre1">| Small Fry     |             5 |</p>
<p class="calibre1">+---------------+---------------+</p>
<p class="calibre1">3 rows in set (0.01 sec)</p>
<p class="calibre1">The from clause contains two subqueries; the first subquery, named cust_rollup, returns the total deposit balances for each customer, while the second subquery, named groups,  generates  the  three  customer  groupings.  Here’s  the  data  generated  by cust_rollup:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT SUM(a.avail_balance) cust_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN product p</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.product_cd = p.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.product_type_cd = 'ACCOUNT' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY a.cust_id; </b></p>
<p class="calibre1">+--------------+</p>
<p class="calibre1">| cust_balance |</p>
<p class="calibre1">+--------------+</p>
<p class="calibre1">|      4557.75 |</p>
<p class="calibre1">|      2458.02 |</p>
<p class="calibre1">|      3270.25 |</p>
<p class="calibre1">|      6788.98 |</p>
<p class="calibre1">|      2237.97 |</p>
<p class="calibre1">|     10122.37 |</p>
<p class="calibre1">|      5000.00 |</p>
<p class="calibre1">|      3875.18 |</p>
<p class="calibre1">|     10971.22 |</p>
<p class="calibre1">|     23575.12 |</p>
<p class="calibre1">|     38552.05 |</p>
<p class="calibre1">+--------------+</p>
<p class="calibre1">11 rows in set (0.05 sec)</p>
<p class="calibre1">The data generated by cust_rollup is then joined to the groups table via a range condition (cust_rollup.cust_balance BETWEEN groups.low_limit AND groups.high_limit). </p>
<p class="calibre1">Finally, the joined data is grouped and the number of customers in each group is counted to generate the final result set. </p>
<p class="calibre1">Of course, you could simply decide to build a permanent table to hold the group definitions instead of using a subquery. Using that approach, you would find your database to be littered with small special-purpose tables after awhile, and you wouldn’t remember the reason for which most of them were created. I’ve worked in environments where the database users were allowed to create their own tables for special purposes, and the results were disastrous (tables not included in backups, tables lost during server upgrades, server downtime due to space allocation issues, etc.). Armed with subqueries, <b class="calibre3">174 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-164"></a>however, you will be able to adhere to a policy where tables are added to a database only when there is a clear business need to store new data. </p>
<p class="calibre1"><b class="calibre3">Task-oriented subqueries</b></p>
<p class="calibre1">In systems used for reporting or data-feed generation, you will often come across queries such as the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT p.name product, b.name branch, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONCAT(e.fname, ' ', e.lname) name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(a.avail_balance) tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_emp_id = e.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.open_branch_id = b.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN product p</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.product_cd = p.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.product_type_cd = 'ACCOUNT' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY p.name, b.name, e.fname, e.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1,2; </b></p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">| product                | branch        | name            | tot_deposits |</p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">| certificate of deposit | Headquarters  | Michael Smith   |     11500.00 |</p>
<p class="calibre1">| certificate of deposit | Woburn Branch | Paula Roberts   |      8000.00 |</p>
<p class="calibre1">| checking account       | Headquarters  | Michael Smith   |       782.16 |</p>
<p class="calibre1">| checking account       | Quincy Branch | John Blake      |      1057.75 |</p>
<p class="calibre1">| checking account       | So. NH Branch | Theresa Markham |     67852.33 |</p>
<p class="calibre1">| checking account       | Woburn Branch | Paula Roberts   |      3315.77 |</p>
<p class="calibre1">| money market account   | Headquarters  | Michael Smith   |     14832.64 |</p>
<p class="calibre1">| money market account   | Quincy Branch | John Blake      |      2212.50 |</p>
<p class="calibre1">| savings account        | Headquarters  | Michael Smith   |       767.77 |</p>
<p class="calibre1">| savings account        | So. NH Branch | Theresa Markham |       387.99 |</p>
<p class="calibre1">| savings account        | Woburn Branch | Paula Roberts   |       700.00 |</p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">11 rows in set (0.00 sec)</p>
<p class="calibre1">This  query  sums  all  deposit  account  balances  by  account  type,  the  employee  that opened the accounts, and the branches at which the accounts were opened. If you look at the query closely, you will see that the product, branch, and employee tables are needed only for display purposes, and that the account table has everything needed to generate the groupings (product_cd, open_branch_id, open_emp_id, and avail_balance). Therefore, you could separate out the task of generating the groups into a subquery, and then join the other three tables to the table generated by the subquery to achieve the desired end result. Here’s the grouping subquery:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_cd, open_branch_id branch_id, open_emp_id emp_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(avail_balance) tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd, open_branch_id, open_emp_id; </b></p>
<p class="calibre1">+------------+-----------+--------+--------------+</p>
<p class="calibre1">| product_cd | branch_id | emp_id | tot_deposits |</p>
<p class="calibre1">+------------+-----------+--------+--------------+</p>
<p class="calibre1"><b class="calibre3">When to Use Subqueries | 175</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-301"></a>| BUS        |         2 |     10 |      9345.55 |</p>
<p class="calibre1">| BUS        |         4 |     16 |         0.00 |</p>
<p class="calibre1">| CD         |         1 |      1 |     11500.00 |</p>
<p class="calibre1">| CD         |         2 |     10 |      8000.00 |</p>
<p class="calibre1">| CHK        |         1 |      1 |       782.16 |</p>
<p class="calibre1">| CHK        |         2 |     10 |      3315.77 |</p>
<p class="calibre1">| CHK        |         3 |     13 |      1057.75 |</p>
<p class="calibre1">| CHK        |         4 |     16 |     67852.33 |</p>
<p class="calibre1">| MM         |         1 |      1 |     14832.64 |</p>
<p class="calibre1">| MM         |         3 |     13 |      2212.50 |</p>
<p class="calibre1">| SAV        |         1 |      1 |       767.77 |</p>
<p class="calibre1">| SAV        |         2 |     10 |       700.00 |</p>
<p class="calibre1">| SAV        |         4 |     16 |       387.99 |</p>
<p class="calibre1">| SBL        |         3 |     13 |     50000.00 |</p>
<p class="calibre1">+------------+-----------+--------+--------------+</p>
<p class="calibre1">14 rows in set (0.02 sec)</p>
<p class="calibre1">This is the heart of the query; the other tables are needed only to provide meaningful strings in place of the product_cd, open_branch_id, and open_emp_id foreign key columns. The next query wraps the query against the account table in a subquery and joins the table that results to the other three tables:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT p.name product, b.name branch, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONCAT(e.fname, ' ', e.lname) name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">account_groups.tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT product_cd, open_branch_id branch_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">open_emp_id emp_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(avail_balance) tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd, open_branch_id, open_emp_id) account_groups</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN employee e ON e.emp_id = account_groups.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN branch b ON b.branch_id = account_groups.branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN product p ON p.product_cd = account_groups.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.product_type_cd = 'ACCOUNT'; </b></p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">| product                | branch        | name            | tot_deposits |</p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">| certificate of deposit | Headquarters  | Michael Smith   |     11500.00 |</p>
<p class="calibre1">| certificate of deposit | Woburn Branch | Paula Roberts   |      8000.00 |</p>
<p class="calibre1">| checking account       | Headquarters  | Michael Smith   |       782.16 |</p>
<p class="calibre1">| checking account       | Quincy Branch | John Blake      |      1057.75 |</p>
<p class="calibre1">| checking account       | So. NH Branch | Theresa Markham |     67852.33 |</p>
<p class="calibre1">| checking account       | Woburn Branch | Paula Roberts   |      3315.77 |</p>
<p class="calibre1">| money market account   | Headquarters  | Michael Smith   |     14832.64 |</p>
<p class="calibre1">| money market account   | Quincy Branch | John Blake      |      2212.50 |</p>
<p class="calibre1">| savings account        | Headquarters  | Michael Smith   |       767.77 |</p>
<p class="calibre1">| savings account        | So. NH Branch | Theresa Markham |       387.99 |</p>
<p class="calibre1">| savings account        | Woburn Branch | Paula Roberts   |       700.00 |</p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">11 rows in set (0.01 sec)</p>
<p class="calibre1">I realize that beauty is in the eye of the beholder, but I find this version of the query to be far more satisfying than the big, flat version. This version may execute faster, as well, because the grouping is being done on small, numeric foreign key columns (product_cd, <b class="calibre3">176 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-98"></a>open_branch_id,  open_emp_id)  instead  of  potentially  lengthy  string  columns (branch.name, product.name, employee.fname, employee.lname). </p>
<p class="calibre1"><b class="calibre3">Subqueries in Filter Conditions</b></p>
<p class="calibre1">Many of the examples in this chapter used subqueries as expressions in filter conditions, so it should not surprise you that this is one of the main uses for subqueries. However, filter conditions using subqueries are not found only in the where clause. For example, the next query uses a subquery in the having clause to find the employee responsible for opening the most accounts:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">HAVING COUNT(*) = (SELECT MAX(emp_cnt.how_many)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM (SELECT COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id) emp_cnt); </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|           1 |        8 |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">The subquery in the having clause finds the maximum number of accounts opened by any employee, and the containing query finds the employee that has opened that number of accounts. If multiple employees tie for the highest number of opened accounts, then the query would return multiple rows. </p>
<p class="calibre1"><b class="calibre3">Subqueries As Expression Generators</b></p>
<p class="calibre1">For this last section of the chapter, I finish where I began: with single-column, single-row scalar subqueries. Along with being used in filter conditions, scalar subqueries may be used wherever an expression can appear, including the select and order by clauses of a query and the values clause of an insert statement. </p>
<p class="calibre1">In <a href="#calibre_link-164">“Task-oriented subqueries” on page 175, </a>I showed you how to use a subquery to separate out the grouping mechanism from the rest of the query. Here’s another version of the same query that uses subqueries for the same purpose, but in a different way: mysql&gt; <b class="calibre3">SELECT</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT p.name FROM product p</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.product_cd = a.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND p.product_type_cd = 'ACCOUNT') product, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT b.name FROM branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE b.branch_id = a.open_branch_id) branch, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT CONCAT(e.fname, ' ', e.lname) FROM employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e.emp_id = a.open_emp_id) name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(a.avail_balance) tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a</b></p>
<p class="calibre1"><b class="calibre3">When to Use Subqueries | 177</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-302"></a>    -&gt; <b class="calibre3">GROUP BY a.product_cd, a.open_branch_id, a.open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1,2; </b></p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">| product                | branch        | name            | tot_deposits |</p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">| NULL                   | Quincy Branch | John Blake      |     50000.00 |</p>
<p class="calibre1">| NULL                   | So. NH Branch | Theresa Markham |         0.00 |</p>
<p class="calibre1">| NULL                   | Woburn Branch | Paula Roberts   |      9345.55 |</p>
<p class="calibre1">| certificate of deposit | Headquarters  | Michael Smith   |     11500.00 |</p>
<p class="calibre1">| certificate of deposit | Woburn Branch | Paula Roberts   |      8000.00 |</p>
<p class="calibre1">| checking account       | Headquarters  | Michael Smith   |       782.16 |</p>
<p class="calibre1">| checking account       | Quincy Branch | John Blake      |      1057.75 |</p>
<p class="calibre1">| checking account       | So. NH Branch | Theresa Markham |     67852.33 |</p>
<p class="calibre1">| checking account       | Woburn Branch | Paula Roberts   |      3315.77 |</p>
<p class="calibre1">| money market account   | Headquarters  | Michael Smith   |     14832.64 |</p>
<p class="calibre1">| money market account   | Quincy Branch | John Blake      |      2212.50 |</p>
<p class="calibre1">| savings account        | Headquarters  | Michael Smith   |       767.77 |</p>
<p class="calibre1">| savings account        | So. NH Branch | Theresa Markham |       387.99 |</p>
<p class="calibre1">| savings account        | Woburn Branch | Paula Roberts   |       700.00 |</p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">14 rows in set (0.01 sec)</p>
<p class="calibre1">There are two main differences between this query and the earlier version using a subquery in the from clause:</p>
<p class="calibre1">• Instead of joining the product, branch, and employee tables to the account data, correlated scalar subqueries are used in the select clause to look up the product, branch, and employee names. </p>
<p class="calibre1">• The result set has 14 rows instead of 11 rows, and three of the product names are null. </p>
<p class="calibre1">The reason for the extra three rows in the result set is that the previous version of the query included the filter condition p.product_type_cd = 'ACCOUNT'. That filter eliminated rows with product types of INSURANCE and LOAN, such as small business loans. </p>
<p class="calibre1">Since this version of the query doesn’t include a join to the product table, there is no way to include the filter condition in the main query. The correlated subquery against the product table does include this filter, but the only effect is to leave the product name null. If you want to get rid of the extra three rows, you could join the product table to the account table and include the filter condition, or you could simply do the following: mysql&gt; <b class="calibre3">SELECT all_prods.product, all_prods.branch, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">all_prods.name, all_prods.tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT p.name FROM product p</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.product_cd = a.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND p.product_type_cd = 'ACCOUNT') product, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT b.name FROM branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE b.branch_id = a.open_branch_id) branch, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT CONCAT(e.fname, ' ', e.lname) FROM employee e</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e.emp_id = a.open_emp_id) name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(a.avail_balance) tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a</b></p>
<p class="calibre1"><b class="calibre3">178 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-193"></a>    -&gt; <b class="calibre3">GROUP BY a.product_cd, a.open_branch_id, a.open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">) all_prods</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE all_prods.product IS NOT NULL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1,2; </b></p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">| product                | branch        | name            | tot_deposits |</p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">| certificate of deposit | Headquarters  | Michael Smith   |     11500.00 |</p>
<p class="calibre1">| certificate of deposit | Woburn Branch | Paula Roberts   |      8000.00 |</p>
<p class="calibre1">| checking account       | Headquarters  | Michael Smith   |       782.16 |</p>
<p class="calibre1">| checking account       | Quincy Branch | John Blake      |      1057.75 |</p>
<p class="calibre1">| checking account       | So. NH Branch | Theresa Markham |     67852.33 |</p>
<p class="calibre1">| checking account       | Woburn Branch | Paula Roberts   |      3315.77 |</p>
<p class="calibre1">| money market account   | Headquarters  | Michael Smith   |     14832.64 |</p>
<p class="calibre1">| money market account   | Quincy Branch | John Blake      |      2212.50 |</p>
<p class="calibre1">| savings account        | Headquarters  | Michael Smith   |       767.77 |</p>
<p class="calibre1">| savings account        | So. NH Branch | Theresa Markham |       387.99 |</p>
<p class="calibre1">| savings account        | Woburn Branch | Paula Roberts   |       700.00 |</p>
<p class="calibre1">+------------------------+---------------+-----------------+--------------+</p>
<p class="calibre1">11 rows in set (0.01 sec)</p>
<p class="calibre1">Simply by wrapping the previous query in a subquery (called all_prods) and adding a filter condition to exclude null values of the product column, the query now returns the desired 11 rows. The end result is a query that performs all grouping against raw data in the account table, and then embellishes the output using data in three other tables, and  <i class="calibre4">without doing any joins</i>. </p>
<p class="calibre1">As previously noted, scalar subqueries can also appear in the  order by clause. The following query retrieves employee data sorted by the last name of each employee’s boss, and then by the employee’s last name:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp.emp_id, CONCAT(emp.fname, ' ', emp.lname) emp_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT CONCAT(boss.fname, ' ', boss.lname)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee boss</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE boss.emp_id = emp.superior_emp_id) boss_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee emp</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE emp.superior_emp_id IS NOT NULL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY (SELECT boss.lname FROM employee boss</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE boss.emp_id = emp.superior_emp_id), emp.lname; </b></p>
<p class="calibre1">+--------+------------------+-----------------+</p>
<p class="calibre1">| emp_id | emp_name         | boss_name       |</p>
<p class="calibre1">+--------+------------------+-----------------+</p>
<p class="calibre1">|     14 | Cindy Mason      | John Blake      |</p>
<p class="calibre1">|     15 | Frank Portman    | John Blake      |</p>
<p class="calibre1">|      9 | Jane Grossman    | Helen Fleming   |</p>
<p class="calibre1">|      8 | Sarah Parker     | Helen Fleming   |</p>
<p class="calibre1">|      7 | Chris Tucker     | Helen Fleming   |</p>
<p class="calibre1">|     13 | John Blake       | Susan Hawthorne |</p>
<p class="calibre1">|      6 | Helen Fleming    | Susan Hawthorne |</p>
<p class="calibre1">|      5 | John Gooding     | Susan Hawthorne |</p>
<p class="calibre1">|     16 | Theresa Markham  | Susan Hawthorne |</p>
<p class="calibre1">|     10 | Paula Roberts    | Susan Hawthorne |</p>
<p class="calibre1">|     17 | Beth Fowler      | Theresa Markham |</p>
<p class="calibre1">|     18 | Rick Tulman      | Theresa Markham |</p>
<p class="calibre1"><b class="calibre3">When to Use Subqueries | 179</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-214"></a>|     12 | Samantha Jameson | Paula Roberts   |</p>
<p class="calibre1">|     11 | Thomas Ziegler   | Paula Roberts   |</p>
<p class="calibre1">|      2 | Susan Barker     | Michael Smith   |</p>
<p class="calibre1">|      3 | Robert Tyler     | Michael Smith   |</p>
<p class="calibre1">|      4 | Susan Hawthorne  | Robert Tyler    |</p>
<p class="calibre1">+--------+------------------+-----------------+</p>
<p class="calibre1">17 rows in set (0.01 sec)</p>
<p class="calibre1">The query uses two correlated scalar subqueries: one in the select clause to retrieve the full name of each employee’s boss, and another in the order by clause to return just the last name of each employee’s boss for sorting purposes. </p>
<p class="calibre1">Along with using correlated scalar subqueries in select statements, you can use noncorrelated scalar subqueries to generate values for an insert statement. For example, let’s say you are going to generate a new account row, and you’ve been given the following data:</p>
<p class="calibre1">• The product name (“savings account”)</p>
<p class="calibre1">• The customer’s federal ID (“555-55-5555”)</p>
<p class="calibre1">• The name of the branch where the account was opened (“Quincy Branch”)</p>
<p class="calibre1">• The first and last names of the teller who opened the account (“Frank Portman”) Before you can create a row in the account table, you will need to look up the key values for all of these pieces of data so that you can populate the foreign key columns in the account table. You have two choices for how to go about it: execute four queries to retrieve the primary key values and place those values into an insert statement, or use subqueries to retrieve the four key values from within an insert statement. Here’s an example of the latter approach:</p>
<p class="calibre1">INSERT INTO account</p>
<p class="calibre1">(account_id, product_cd, cust_id, open_date, last_activity_date, status, open_branch_id, open_emp_id, avail_balance, pending_balance) VALUES (NULL, </p>
<p class="calibre1">(SELECT product_cd FROM product WHERE name = 'savings account'), (SELECT cust_id FROM customer WHERE fed_id = '555-55-5555'), </p>
<p class="calibre1">'2008-09-25', '2008-09-25', 'ACTIVE', </p>
<p class="calibre1">(SELECT branch_id FROM branch WHERE name = 'Quincy Branch'), </p>
<p class="calibre1">(SELECT emp_id FROM employee WHERE lname = 'Portman' AND fname = 'Frank'), 0, 0); </p>
<p class="calibre1">Using a single SQL statement, you can create a row in the account table and look up four foreign key column values at the same time. There is one downside to this approach, however. When you use subqueries to generate data for columns that allow null values, your insert statement will succeed even if one of your subqueries fails to return a value. For example, if you mistyped Frank Portman’s name in the fourth subquery, a row will still be created in account, but the open_emp_id would be set to null. </p>
<p class="calibre1"><b class="calibre3">180 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-99"></a><b class="calibre3">Subquery Wrap-up</b></p>
<p class="calibre1">I covered a lot of ground in this chapter, so it might be a good idea to review it. The examples I used in this chapter demonstrated subqueries that:</p>
<p class="calibre1">• Return a single column and row, a single column with multiple rows, and multiple columns and rows</p>
<p class="calibre1">• Are independent of the containing statement (noncorrelated subqueries)</p>
<p class="calibre1">• Reference  one  or  more  columns  from  the  containing  statement  (correlated subqueries)</p>
<p class="calibre1">• Are used in conditions that utilize comparison operators as well as the special-purpose operators in, not in, exists, and not exists</p>
<p class="calibre1">• Can be found in select, update, delete, and insert statements</p>
<p class="calibre1">• Generate result sets that can be joined to other tables (or subqueries) in a query</p>
<p class="calibre1">• Can be used to generate values to populate a table or to populate columns in a query’s result set</p>
<p class="calibre1">• Are used in the select, from, where, having, and order by clauses of queries Obviously, subqueries are a very versatile tool, so don’t feel bad if all these concepts haven’t sunk in after reading this chapter for the first time. Keep experimenting with the various uses for subqueries, and you will soon find yourself thinking about how you might utilize a subquery every time you write a nontrivial SQL statement. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">These exercises are designed to test your understanding of subqueries. Please see <a href="#calibre_link-152">Ap-</a></p>
<p class="calibre1"><a href="#calibre_link-152">pendix C for the solutions. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 9-1</b></p>
<p class="calibre1">Construct a query against the account table that uses a filter condition with a noncorrelated  subquery  against  the  product  table  to  find  all  loan  accounts  (product.prod uct_type_cd = 'LOAN'). Retrieve the account ID, product code, customer ID, and available balance. </p>
<p class="calibre1"><b class="calibre3">Exercise 9-2</b></p>
<p class="calibre1">Rework the query from Exercise 9-1 using a  <i class="calibre4">correlated</i> subquery against the product table to achieve the same results. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 181</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-246"></a><b class="calibre3">Exercise 9-3</b></p>
<p class="calibre1">Join the following query to the employee table to show the experience level of each employee:</p>
<p class="calibre1">SELECT 'trainee' name, '2004-01-01' start_dt, '2005-12-31' end_dt UNION ALL</p>
<p class="calibre1">SELECT 'worker' name, '2002-01-01' start_dt, '2003-12-31' end_dt UNION ALL</p>
<p class="calibre1">SELECT 'mentor' name, '2000-01-01' start_dt, '2001-12-31' end_dt Give the subquery the alias levels, and include the employee ID, first name, last name, and experience level (levels.name). (Hint: build a join condition using an inequality condition to determine into which level the employee.start_date column falls.) <b class="calibre3">Exercise 9-4</b></p>
<p class="calibre1">Construct a query against the employee table that retrieves the employee ID, first name, and last name, along with the names of the department and branch to which the employee is assigned. Do not join any tables. </p>
<p class="calibre1"><b class="calibre3">182 | Chapter 9:</b> <b class="calibre3">Subqueries</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-100"></a><b class="calibre3">CHAPTER 10</b></p>
<p class="calibre1"><b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">By now, you should be comfortable with the concept of the inner join, which I introduced in <a href="#calibre_link-48">Chapter 5</a>. This chapter focuses on other ways in which you can join tables, including the outer join and the cross join. </p>
<p class="calibre1"><b class="calibre3">Outer Joins</b></p>
<p class="calibre1">In all the examples thus far that have included multiple tables, we haven’t been concerned that the join conditions might fail to find matches for all the rows in the tables. </p>
<p class="calibre1">For example, when joining the account table to the customer table, I did not mention the possibility that a value in the cust_id column of the account table might not match a value in the cust_id column of the customer table. If that were the case, then some of the rows in one table or the other would be left out of the result set. </p>
<p class="calibre1">Just to be sure, let’s check the data in the tables. Here are the account_id and cust_id columns from the account table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account_id, cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+------------+---------+</p>
<p class="calibre1">| account_id | cust_id |</p>
<p class="calibre1">+------------+---------+</p>
<p class="calibre1">|          1 |       1 |</p>
<p class="calibre1">|          2 |       1 |</p>
<p class="calibre1">|          3 |       1 |</p>
<p class="calibre1">|          4 |       2 |</p>
<p class="calibre1">|          5 |       2 |</p>
<p class="calibre1">|          7 |       3 |</p>
<p class="calibre1">|          8 |       3 |</p>
<p class="calibre1">|         10 |       4 |</p>
<p class="calibre1">|         11 |       4 |</p>
<p class="calibre1">|         12 |       4 |</p>
<p class="calibre1">|         13 |       5 |</p>
<p class="calibre1">|         14 |       6 |</p>
<p class="calibre1">|         15 |       6 |</p>
<p class="calibre1">|         17 |       7 |</p>
<p class="calibre1">|         18 |       8 |</p>
<p class="calibre1"><b class="calibre3">183</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-303"></a>|         19 |       8 |</p>
<p class="calibre1">|         21 |       9 |</p>
<p class="calibre1">|         22 |       9 |</p>
<p class="calibre1">|         23 |       9 |</p>
<p class="calibre1">|         24 |      10 |</p>
<p class="calibre1">|         25 |      10 |</p>
<p class="calibre1">|         27 |      11 |</p>
<p class="calibre1">|         28 |      12 |</p>
<p class="calibre1">|         29 |      13 |</p>
<p class="calibre1">+------------+---------+</p>
<p class="calibre1">24 rows in set (1.50 sec)</p>
<p class="calibre1">There are 24 accounts spanning 13 different customers, with customer IDs 1 through 13 having at least one account. Here’s the set of customer IDs from the customer table: mysql&gt; <b class="calibre3">SELECT cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer; </b></p>
<p class="calibre1">+---------+</p>
<p class="calibre1">| cust_id |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">|       1 |</p>
<p class="calibre1">|       2 |</p>
<p class="calibre1">|       3 |</p>
<p class="calibre1">|       4 |</p>
<p class="calibre1">|       5 |</p>
<p class="calibre1">|       6 |</p>
<p class="calibre1">|       7 |</p>
<p class="calibre1">|       8 |</p>
<p class="calibre1">|       9 |</p>
<p class="calibre1">|      10 |</p>
<p class="calibre1">|      11 |</p>
<p class="calibre1">|      12 |</p>
<p class="calibre1">|      13 |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">13 rows in set (0.02 sec)</p>
<p class="calibre1">There are 13 rows in the customer table with IDs 1 through 13, so every customer ID</p>
<p class="calibre1">is included at least once in the account table. When the two tables are joined on the cust_id column, therefore, you would expect all 24 rows to be included in the result set (barring any other filter conditions):</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id; </b></p>
<p class="calibre1">+------------+---------+</p>
<p class="calibre1">| account_id | cust_id |</p>
<p class="calibre1">+------------+---------+</p>
<p class="calibre1">|          1 |       1 |</p>
<p class="calibre1">|          2 |       1 |</p>
<p class="calibre1">|          3 |       1 |</p>
<p class="calibre1">|          4 |       2 |</p>
<p class="calibre1">|          5 |       2 |</p>
<p class="calibre1">|          7 |       3 |</p>
<p class="calibre1">|          8 |       3 |</p>
<p class="calibre1"><b class="calibre3">184 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-304"></a>|         10 |       4 |</p>
<p class="calibre1">|         11 |       4 |</p>
<p class="calibre1">|         12 |       4 |</p>
<p class="calibre1">|         13 |       5 |</p>
<p class="calibre1">|         14 |       6 |</p>
<p class="calibre1">|         15 |       6 |</p>
<p class="calibre1">|         17 |       7 |</p>
<p class="calibre1">|         18 |       8 |</p>
<p class="calibre1">|         19 |       8 |</p>
<p class="calibre1">|         21 |       9 |</p>
<p class="calibre1">|         22 |       9 |</p>
<p class="calibre1">|         23 |       9 |</p>
<p class="calibre1">|         24 |      10 |</p>
<p class="calibre1">|         25 |      10 |</p>
<p class="calibre1">|         27 |      11 |</p>
<p class="calibre1">|         28 |      12 |</p>
<p class="calibre1">|         29 |      13 |</p>
<p class="calibre1">+------------+---------+</p>
<p class="calibre1">24 rows in set (0.06 sec)</p>
<p class="calibre1">As expected, all 24 accounts are present in the result set. But what happens if you join the account table to one of the specialized customer tables, such as the business table? </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, b.cust_id, b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = b.cust_id; </b></p>
<p class="calibre1">+------------+---------+------------------------+</p>
<p class="calibre1">| account_id | cust_id | name                   |</p>
<p class="calibre1">+------------+---------+------------------------+</p>
<p class="calibre1">|         24 |      10 | Chilton Engineering    |</p>
<p class="calibre1">|         25 |      10 | Chilton Engineering    |</p>
<p class="calibre1">|         27 |      11 | Northeast Cooling Inc. |</p>
<p class="calibre1">|         28 |      12 | Superior Auto Body     |</p>
<p class="calibre1">|         29 |      13 | AAA Insurance Inc.     |</p>
<p class="calibre1">+------------+---------+------------------------+</p>
<p class="calibre1">5 rows in set (0.10 sec)</p>
<p class="calibre1">Instead of 24 rows in the result set, there are now only five. Let’s look in the business table to see why this is:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM business; </b></p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">| cust_id | name                   |</p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">|      10 | Chilton Engineering    |</p>
<p class="calibre1">|      11 | Northeast Cooling Inc. |</p>
<p class="calibre1">|      12 | Superior Auto Body     |</p>
<p class="calibre1">|      13 | AAA Insurance Inc.     |</p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">4 rows in set (0.01 sec)</p>
<p class="calibre1">Of the 13 rows in the customer table, only four are business customers, and since one of the business customers has two accounts, a total of five rows in the account table are linked to business customers. </p>
<p class="calibre1"><b class="calibre3">Outer Joins | 185</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-305"></a>But what if you want your query to return  <i class="calibre4">all</i> the accounts, but to include the business name only if the account is linked to a business customer? This is an example where you would need an  <i class="calibre4">outer join</i> between the account and business tables, as in: mysql&gt; <b class="calibre3">SELECT a.account_id, a.cust_id, b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a LEFT OUTER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = b.cust_id; </b></p>
<p class="calibre1">+------------+---------+------------------------+</p>
<p class="calibre1">| account_id | cust_id | name                   |</p>
<p class="calibre1">+------------+---------+------------------------+</p>
<p class="calibre1">|          1 |       1 | NULL                   |</p>
<p class="calibre1">|          2 |       1 | NULL                   |</p>
<p class="calibre1">|          3 |       1 | NULL                   |</p>
<p class="calibre1">|          4 |       2 | NULL                   |</p>
<p class="calibre1">|          5 |       2 | NULL                   |</p>
<p class="calibre1">|          7 |       3 | NULL                   |</p>
<p class="calibre1">|          8 |       3 | NULL                   |</p>
<p class="calibre1">|         10 |       4 | NULL                   |</p>
<p class="calibre1">|         11 |       4 | NULL                   |</p>
<p class="calibre1">|         12 |       4 | NULL                   |</p>
<p class="calibre1">|         13 |       5 | NULL                   |</p>
<p class="calibre1">|         14 |       6 | NULL                   |</p>
<p class="calibre1">|         15 |       6 | NULL                   |</p>
<p class="calibre1">|         17 |       7 | NULL                   |</p>
<p class="calibre1">|         18 |       8 | NULL                   |</p>
<p class="calibre1">|         19 |       8 | NULL                   |</p>
<p class="calibre1">|         21 |       9 | NULL                   |</p>
<p class="calibre1">|         22 |       9 | NULL                   |</p>
<p class="calibre1">|         23 |       9 | NULL                   |</p>
<p class="calibre1">|         24 |      10 | Chilton Engineering    |</p>
<p class="calibre1">|         25 |      10 | Chilton Engineering    |</p>
<p class="calibre1">|         27 |      11 | Northeast Cooling Inc. |</p>
<p class="calibre1">|         28 |      12 |  Superior Auto Body     |</p>
<p class="calibre1">|         29 |      13 | AAA Insurance Inc.     |</p>
<p class="calibre1">+------------+---------+------------------------+</p>
<p class="calibre1">24 rows in set (0.04 sec)</p>
<p class="calibre1">An outer join includes all of the rows from one table and includes data from the second table only if matching rows are found. In this case, all rows from the account table are included, since I specified left outer join and the account table is on the left side of the join definition. The name column is null for all rows except for the four business customers (cust_ids 10, 11, 12, and 13). Here’s a similar query with an outer join to the individual table instead of the business table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.cust_id, i.fname, i.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a LEFT OUTER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = i.cust_id; </b></p>
<p class="calibre1">+------------+---------+----------+---------+</p>
<p class="calibre1">| account_id | cust_id | fname    | lname   |</p>
<p class="calibre1">+------------+---------+----------+---------+</p>
<p class="calibre1">|          1 |       1 | James    | Hadley  |</p>
<p class="calibre1">|          2 |       1 | James    | Hadley  |</p>
<p class="calibre1">|          3 |       1 | James    | Hadley  |</p>
<p class="calibre1">|          4 |       2 | Susan    | Tingley |</p>
<p class="calibre1"><b class="calibre3">186 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-101"></a>|          5 |       2 | Susan    | Tingley |</p>
<p class="calibre1">|          7 |       3 | Frank    | Tucker  |</p>
<p class="calibre1">|          8 |       3 | Frank    | Tucker  |</p>
<p class="calibre1">|         10 |       4 | John     | Hayward |</p>
<p class="calibre1">|         11 |       4 | John     | Hayward |</p>
<p class="calibre1">|         12 |       4 | John     | Hayward |</p>
<p class="calibre1">|         13 |       5 | Charles  | Frasier |</p>
<p class="calibre1">|         14 |       6 | John     | Spencer |</p>
<p class="calibre1">|         15 |       6 | John     | Spencer |</p>
<p class="calibre1">|         17 |       7 | Margaret | Young   |</p>
<p class="calibre1">|         18 |       8 | George   | Blake   |</p>
<p class="calibre1">|         19 |       8 | George   | Blake   |</p>
<p class="calibre1">|         21 |       9 | Richard  | Farley  |</p>
<p class="calibre1">|         22 |       9 | Richard  | Farley  |</p>
<p class="calibre1">|         23 |       9 | Richard  | Farley  |</p>
<p class="calibre1">|         24 |      10 | NULL     | NULL    |</p>
<p class="calibre1">|         25 |      10 | NULL     | NULL    |</p>
<p class="calibre1">|         27 |      11 | NULL     | NULL    |</p>
<p class="calibre1">|         28 |      12 | NULL     | NULL    |</p>
<p class="calibre1">|         29 |      13 | NULL     | NULL    |</p>
<p class="calibre1">+------------+---------+----------+---------+</p>
<p class="calibre1">24 rows in set (0.09 sec)</p>
<p class="calibre1">This  query  is  essentially  the  reverse  of  the  previous  query:  first  and  last  names  are supplied for the individual customers, whereas the columns are null for the business customers. </p>
<p class="calibre1"><b class="calibre3">Left Versus Right Outer Joins</b></p>
<p class="calibre1">In  each  of  the  outer  join  examples  in  the  previous  section,  I  specified  left outer join. The keyword left indicates that the table on the left side of the join is responsible for determining the number of rows in the result set, whereas the table on the right side is used to provide column values whenever a match is found. Consider the following query:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT c.cust_id, b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c LEFT OUTER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON c.cust_id = b.cust_id; </b></p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">| cust_id | name                   |</p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">|       1 | NULL                   |</p>
<p class="calibre1">|       2 | NULL                   |</p>
<p class="calibre1">|       3 | NULL                   |</p>
<p class="calibre1">|       4 | NULL                   |</p>
<p class="calibre1">|       5 | NULL                   |</p>
<p class="calibre1">|       6 | NULL                   |</p>
<p class="calibre1">|       7 | NULL                   |</p>
<p class="calibre1">|       8 | NULL                   |</p>
<p class="calibre1">|       9 | NULL                   |</p>
<p class="calibre1">|      10 | Chilton Engineering    |</p>
<p class="calibre1">|      11 | Northeast Cooling Inc. |</p>
<p class="calibre1">|      12 | Superior Auto Body     |</p>
<p class="calibre1"><b class="calibre3">Outer Joins | 187</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-102"></a>|      13 | AAA Insurance Inc.     |</p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">13 rows in set (0.00 sec)</p>
<p class="calibre1">The from clause specifies a left outer join, so all 13 rows from the customer table are included in the result set, with the business table contributing values to the second column in the result set for the four business customers. If you execute the same query, but indicate right outer join, you would see the following results: mysql&gt; <b class="calibre3">SELECT c.cust_id, b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c RIGHT OUTER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON c.cust_id = b.cust_id; </b></p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">| cust_id | name                   |</p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">|      10 | Chilton Engineering    |</p>
<p class="calibre1">|      11 | Northeast Cooling Inc. |</p>
<p class="calibre1">|      12 | Superior Auto Body     |</p>
<p class="calibre1">|      13 | AAA Insurance Inc.     |</p>
<p class="calibre1">+---------+------------------------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">The number of rows in the result set is now determined by the number of rows in the business table, which is why there are only four rows in the result set. </p>
<p class="calibre1">Keep in mind that both queries are performing outer joins; the keywords  left and right are there just to tell the server which table is allowed to have gaps in the data. If you want to outer-join tables A and B and you want all rows from A with additional columns from B whenever there is matching data, you can specify either A left outer join B or B right outer join A. </p>
<p class="calibre1"><b class="calibre3">Three-Way Outer Joins</b></p>
<p class="calibre1">In some cases, you may want to outer-join one table with two other tables. For example, you may want a list of all accounts showing either the customer’s first and last names for individuals or the business name for business customers, as in: mysql&gt; <b class="calibre3">SELECT a.account_id, a.product_cd, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONCAT(i.fname, ' ', i.lname) person_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">b.name business_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a LEFT OUTER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = i.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LEFT OUTER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = b.cust_id; </b></p>
<p class="calibre1">+------------+------------+-----------------+------------------------+</p>
<p class="calibre1">| account_id | product_cd | person_name     | business_name          |</p>
<p class="calibre1">+------------+------------+-----------------+------------------------+</p>
<p class="calibre1">|          1 | CHK        | James Hadley    | NULL                   |</p>
<p class="calibre1">|          2 | SAV        | James Hadley    | NULL                   |</p>
<p class="calibre1">|          3 | CD         | James Hadley    | NULL                   |</p>
<p class="calibre1">|          4 | CHK        | Susan Tingley   | NULL                   |</p>
<p class="calibre1">|          5 | SAV        | Susan Tingley   | NULL                   |</p>
<p class="calibre1">|          7 | CHK        | Frank Tucker    | NULL                   |</p>
<p class="calibre1"><b class="calibre3">188 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-234"></a>|          8 | MM         | Frank Tucker    | NULL                   |</p>
<p class="calibre1">|         10 | CHK        | John Hayward    | NULL                   |</p>
<p class="calibre1">|         11 | SAV        | John Hayward    | NULL                   |</p>
<p class="calibre1">|         12 | MM         | John Hayward    | NULL                   |</p>
<p class="calibre1">|         13 | CHK        | Charles Frasier | NULL                   |</p>
<p class="calibre1">|         14 | CHK        | John Spencer    | NULL                   |</p>
<p class="calibre1">|         15 | CD         | John Spencer    | NULL                   |</p>
<p class="calibre1">|         17 | CD         | Margaret Young  | NULL                   |</p>
<p class="calibre1">|         18 | CHK        | George Blake    | NULL                   |</p>
<p class="calibre1">|         19 | SAV        | George Blake    | NULL                   |</p>
<p class="calibre1">|         21 | CHK        | Richard Farley  | NULL                   |</p>
<p class="calibre1">|         22 | MM         | Richard Farley  | NULL                   |</p>
<p class="calibre1">|         23 | CD         | Richard Farley  | NULL                   |</p>
<p class="calibre1">|         24 | CHK        | NULL            | Chilton Engineering    |</p>
<p class="calibre1">|         25 | BUS        | NULL            | Chilton Engineering    |</p>
<p class="calibre1">|         27 | BUS        | NULL            | Northeast Cooling Inc. |</p>
<p class="calibre1">|         28 | CHK        | NULL            | Superior Auto Body     |</p>
<p class="calibre1">|         29 | SBL        | NULL            | AAA Insurance Inc.     |</p>
<p class="calibre1">+------------+------------+-----------------+------------------------+</p>
<p class="calibre1">24 rows in set (0.08 sec)</p>
<p class="calibre1">The results include all 24 rows from the account table, along with either a person’s name or a business name coming from the two outer-joined tables. </p>
<p class="calibre1">I don’t know of any restrictions with MySQL regarding the number of tables that can be outer-joined to the same table, but you can always use subqueries to limit the number of joins in your query. For instance, you can rewrite the previous example as follows: mysql&gt; <b class="calibre3">SELECT account_ind.account_id, account_ind.product_cd, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">account_ind.person_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">b.name business_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT a.account_id, a.product_cd, a.cust_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONCAT(i.fname, ' ', i.lname) person_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a LEFT OUTER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = i.cust_id) account_ind</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LEFT OUTER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON account_ind.cust_id = b.cust_id; </b></p>
<p class="calibre1">+------------+------------+-----------------+------------------------+</p>
<p class="calibre1">| account_id | product_cd | person_name     | business_name          |</p>
<p class="calibre1">+------------+------------+-----------------+------------------------+</p>
<p class="calibre1">|          1 | CHK        | James Hadley    | NULL                   |</p>
<p class="calibre1">|          2 | SAV        | James Hadley    | NULL                   |</p>
<p class="calibre1">|          3 | CD         | James Hadley    | NULL                   |</p>
<p class="calibre1">|          4 | CHK        | Susan Tingley   | NULL                   |</p>
<p class="calibre1">|          5 | SAV        | Susan Tingley   | NULL                   |</p>
<p class="calibre1">|          7 | CHK        | Frank Tucker    | NULL                   |</p>
<p class="calibre1">|          8 | MM         | Frank Tucker    | NULL                   |</p>
<p class="calibre1">|         10 | CHK        | John Hayward    | NULL                   |</p>
<p class="calibre1">|         11 | SAV        | John Hayward    | NULL                   |</p>
<p class="calibre1">|         12 | MM         | John Hayward    | NULL                   |</p>
<p class="calibre1">|         13 | CHK        | Charles Frasier | NULL                   |</p>
<p class="calibre1">|         14 | CHK        | John Spencer    | NULL                   |</p>
<p class="calibre1">|         15 | CD         | John Spencer    | NULL                   |</p>
<p class="calibre1">|         17 | CD         | Margaret Young  | NULL                   |</p>
<p class="calibre1"><b class="calibre3">Outer Joins | 189</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-103"></a>|         18 | CHK        | George Blake    | NULL                   |</p>
<p class="calibre1">|         19 | SAV        | George Blake    | NULL                   |</p>
<p class="calibre1">|         21 | CHK        | Richard Farley  | NULL                   |</p>
<p class="calibre1">|         22 | MM         | Richard Farley  | NULL                   |</p>
<p class="calibre1">|         23 | CD         | Richard Farley  | NULL                   |</p>
<p class="calibre1">|         24 | CHK        | NULL            | Chilton Engineering    |</p>
<p class="calibre1">|         25 | BUS        | NULL            | Chilton Engineering    |</p>
<p class="calibre1">|         27 | BUS        | NULL            | Northeast Cooling Inc. |</p>
<p class="calibre1">|         28 | CHK        | NULL            | Superior Auto Body     |</p>
<p class="calibre1">|         29 | SBL        | NULL            | AAA Insurance Inc.     |</p>
<p class="calibre1">+------------+------------+-----------------+------------------------+</p>
<p class="calibre1">24 rows in set (0.08 sec)</p>
<p class="calibre1">In this version of the query, the individual table is outer-joined to the account table within a subquery named account_ind, the results of which are then outer-joined to the business table. Thus, each query (the subquery and the containing query) uses only a single outer join. If you are using a database other than MySQL, you may need to utilize this strategy if you want to outer-join more than one table. </p>
<p class="calibre1"><b class="calibre3">Self Outer Joins</b></p>
<p class="calibre1">In <a href="#calibre_link-48">Chapter 5</a>, I introduced you to the concept of the self-join, where a table is joined to itself. Here’s a self-join example from <a href="#calibre_link-48">Chapter 5, </a>which joins the employee table to itself to generate a list of employees and their supervisors: mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">e_mgr.fname mgr_fname, e_mgr.lname mgr_lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN employee e_mgr</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.superior_emp_id = e_mgr.emp_id; </b></p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">| fname    | lname     | mgr_fname | mgr_lname |</p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">| Susan    | Barker    | Michael   | Smith     |</p>
<p class="calibre1">| Robert   | Tyler     | Michael   | Smith     |</p>
<p class="calibre1">| Susan    | Hawthorne | Robert    | Tyler     |</p>
<p class="calibre1">| John     | Gooding   | Susan     | Hawthorne |</p>
<p class="calibre1">| Helen    | Fleming   | Susan     | Hawthorne |</p>
<p class="calibre1">| Chris    | Tucker    | Helen     | Fleming   |</p>
<p class="calibre1">| Sarah    | Parker    | Helen     | Fleming   |</p>
<p class="calibre1">| Jane     | Grossman  | Helen     | Fleming   |</p>
<p class="calibre1">| Paula    | Roberts   | Susan     | Hawthorne |</p>
<p class="calibre1">| Thomas   | Ziegler   | Paula     | Roberts   |</p>
<p class="calibre1">| Samantha | Jameson   | Paula     | Roberts   |</p>
<p class="calibre1">| John     | Blake     | Susan     | Hawthorne |</p>
<p class="calibre1">| Cindy    | Mason     | John      | Blake     |</p>
<p class="calibre1">| Frank    | Portman   | John      | Blake     |</p>
<p class="calibre1">| Theresa  | Markham   | Susan     | Hawthorne |</p>
<p class="calibre1">| Beth     | Fowler    | Theresa   | Markham   |</p>
<p class="calibre1">| Rick     | Tulman    | Theresa   | Markham   |</p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">17 rows in set (0.02 sec)</p>
<p class="calibre1"><b class="calibre3">190 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-306"></a>This query works fine except for one small issue: employees who don’t have a supervisor are left out of the result set. By changing the join from an inner join to an outer join, however, the result set will include all employees, including those without supervisors: mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">e_mgr.fname mgr_fname, e_mgr.lname mgr_lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e LEFT OUTER JOIN employee e_mgr</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.superior_emp_id = e_mgr.emp_id; </b></p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">| fname    | lname     | mgr_fname | mgr_lname |</p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1"><b class="calibre3">| Michael  | Smith     | NULL      | NULL      |</b></p>
<p class="calibre1">| Susan    | Barker    | Michael   | Smith     |</p>
<p class="calibre1">| Robert   | Tyler     | Michael   | Smith     |</p>
<p class="calibre1">| Susan    | Hawthorne | Robert    | Tyler     |</p>
<p class="calibre1">| John     | Gooding   | Susan     | Hawthorne |</p>
<p class="calibre1">| Helen    | Fleming   | Susan     | Hawthorne |</p>
<p class="calibre1">| Chris    | Tucker    | Helen     | Fleming   |</p>
<p class="calibre1">| Sarah    | Parker    | Helen     | Fleming   |</p>
<p class="calibre1">| Jane     | Grossman  | Helen     | Fleming   |</p>
<p class="calibre1">| Paula    | Roberts   | Susan     | Hawthorne |</p>
<p class="calibre1">| Thomas   | Ziegler   | Paula     | Roberts   |</p>
<p class="calibre1">| Samantha | Jameson   | Paula     | Roberts   |</p>
<p class="calibre1">| John     | Blake     | Susan     | Hawthorne |</p>
<p class="calibre1">| Cindy    | Mason     | John      | Blake     |</p>
<p class="calibre1">| Frank    | Portman   | John      | Blake     |</p>
<p class="calibre1">| Theresa  | Markham   | Susan     | Hawthorne |</p>
<p class="calibre1">| Beth     | Fowler    | Theresa   | Markham   |</p>
<p class="calibre1">| Rick     | Tulman    | Theresa   | Markham   |</p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1">The  result  set  now  includes  Michael  Smith,  who  is  the  president  of  the  bank  and, therefore, does not have a supervisor. The query utilizes a left outer join to generate a list of all employees and, if applicable, their supervisor. If you change the join to be a right outer join, you would see the following results:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.fname, e.lname, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">e_mgr.fname mgr_fname, e_mgr.lname mgr_lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e RIGHT OUTER JOIN employee e_mgr</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.superior_emp_id = e_mgr.emp_id; </b></p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">| fname    | lname     | mgr_fname | mgr_lname |</p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">| Susan    | Barker    | Michael   | Smith     |</p>
<p class="calibre1">| Robert   | Tyler     | Michael   | Smith     |</p>
<p class="calibre1">| NULL     | NULL      | Susan     | Barker    |</p>
<p class="calibre1">| Susan    | Hawthorne | Robert    | Tyler     |</p>
<p class="calibre1">| John     | Gooding   | Susan     | Hawthorne |</p>
<p class="calibre1">| Helen    | Fleming   | Susan     | Hawthorne |</p>
<p class="calibre1">| Paula    | Roberts   | Susan     | Hawthorne |</p>
<p class="calibre1">| John     | Blake     | Susan     | Hawthorne |</p>
<p class="calibre1">| Theresa  | Markham   | Susan     | Hawthorne |</p>
<p class="calibre1">| NULL     | NULL      | John      | Gooding   |</p>
<p class="calibre1">| Chris    | Tucker    | Helen     | Fleming   |</p>
<p class="calibre1"><b class="calibre3">Outer Joins | 191</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-104"></a>| Sarah    | Parker    | Helen     | Fleming   |</p>
<p class="calibre1">| Jane     | Grossman  | Helen     | Fleming   |</p>
<p class="calibre1">| NULL     | NULL      | Chris     | Tucker    |</p>
<p class="calibre1">| NULL     | NULL      | Sarah     | Parker    |</p>
<p class="calibre1">| NULL     | NULL      | Jane      | Grossman  |</p>
<p class="calibre1">| Thomas   | Ziegler   | Paula     | Roberts   |</p>
<p class="calibre1">| Samantha | Jameson   | Paula     | Roberts   |</p>
<p class="calibre1">| NULL     | NULL      | Thomas    | Ziegler   |</p>
<p class="calibre1">| NULL     | NULL      | Samantha  | Jameson   |</p>
<p class="calibre1">| Cindy    | Mason     | John      | Blake     |</p>
<p class="calibre1">| Frank    | Portman   | John      | Blake     |</p>
<p class="calibre1">| NULL     | NULL      | Cindy     | Mason     |</p>
<p class="calibre1">| NULL     | NULL      | Frank     | Portman   |</p>
<p class="calibre1">| Beth     | Fowler    | Theresa   | Markham   |</p>
<p class="calibre1">| Rick     | Tulman    | Theresa   | Markham   |</p>
<p class="calibre1">| NULL     | NULL      | Beth      | Fowler    |</p>
<p class="calibre1">| NULL     | NULL      | Rick      | Tulman    |</p>
<p class="calibre1">+----------+-----------+-----------+-----------+</p>
<p class="calibre1">28 rows in set (0.00 sec)</p>
<p class="calibre1">This query shows each supervisor (still the third and fourth columns) along with the set of employees he or she supervises. Therefore, Michael Smith appears twice as supervisor to Susan Barker and Robert Tyler; Susan Barker appears once as a supervisor to nobody (null values in the first and second columns). All 18 employees appear at least once in the third and fourth columns, with some appearing more than once if they supervise more than one employee, making a total of 28 rows in the result set. This is a very different outcome from the previous query, and it was prompted by changing only a single keyword (left to right). Therefore, when using outer joins, make sure you think carefully about whether to specify a left or right outer join. </p>
<p class="calibre1"><b class="calibre3">Cross Joins</b></p>
<p class="calibre1">Back <a href="#calibre_link-48">in Chapter 5, </a>I introduced the concept of a Cartesian product, which is essentially the result of joining multiple tables without specifying any join conditions. Cartesian products are used fairly frequently by accident (e.g., forgetting to add the join condition to the from clause) but are not so common otherwise. If, however, you  <i class="calibre4">do</i> intend to generate the Cartesian product of two tables, you should specify a  <i class="calibre4">cross join</i>, as in: mysql&gt; <b class="calibre3">SELECT pt.name, p.product_cd, p.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product p CROSS JOIN product_type pt; </b></p>
<p class="calibre1">+-------------------------------+------------+-------------------------+</p>
<p class="calibre1">| name                          | product_cd | name                    |</p>
<p class="calibre1">+-------------------------------+------------+-------------------------+</p>
<p class="calibre1">| Customer Accounts             | AUT        | auto loan               |</p>
<p class="calibre1">| Customer Accounts             | BUS        | business line of credit |</p>
<p class="calibre1">| Customer Accounts             | CD         | certificate of deposit  |</p>
<p class="calibre1">| Customer Accounts             | CHK        | checking account        |</p>
<p class="calibre1">| Customer Accounts             | MM         | money market account    |</p>
<p class="calibre1">| Customer Accounts             | MRT        | home mortgage           |</p>
<p class="calibre1">| Customer Accounts             | SAV        | savings account         |</p>
<p class="calibre1">| Customer Accounts             | SBL        | small business loan     |</p>
<p class="calibre1"><b class="calibre3">192 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-236"></a>| Insurance Offerings           | AUT        | auto loan               |</p>
<p class="calibre1">| Insurance Offerings           | BUS        | business line of credit |</p>
<p class="calibre1">| Insurance Offerings           | CD         | certificate of deposit  |</p>
<p class="calibre1">| Insurance Offerings           | CHK        | checking account        |</p>
<p class="calibre1">| Insurance Offerings           | MM         | money market account    |</p>
<p class="calibre1">| Insurance Offerings           | MRT        | home mortgage           |</p>
<p class="calibre1">| Insurance Offerings           | SAV        | savings account         |</p>
<p class="calibre1">| Insurance Offerings           | SBL        | small business loan     |</p>
<p class="calibre1">| Individual and Business Loans | AUT        | auto loan               |</p>
<p class="calibre1">| Individual and Business Loans | BUS        | business line of credit |</p>
<p class="calibre1">| Individual and Business Loans | CD         | certificate of deposit  |</p>
<p class="calibre1">| Individual and Business Loans | CHK        | checking account        |</p>
<p class="calibre1">| Individual and Business Loans | MM         | money market account    |</p>
<p class="calibre1">| Individual and Business Loans | MRT        | home mortgage           |</p>
<p class="calibre1">| Individual and Business Loans | SAV        | savings account         |</p>
<p class="calibre1">| Individual and Business Loans | SBL        | small business loan     |</p>
<p class="calibre1">+-------------------------------+------------+-------------------------+</p>
<p class="calibre1">24 rows in set (0.00 sec)</p>
<p class="calibre1">This query generates the Cartesian product of the product and product_type tables, resulting in 24 rows (8 product rows × 3 product_type rows). But now that you know what a cross join is and how to specify it, what is it used for? Most SQL books will describe what a cross join is and then tell you that it is seldom useful, but I would like to share with you a situation in which I find the cross join to be quite helpful. </p>
<p class="calibre1"><a href="#calibre_link-88">In Chapter 9, </a>I discussed how to use subqueries to fabricate tables. The example I used showed how to build a three-row table that could be joined to other tables. Here’s the fabricated table from the example:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT 'Small Fry' name, 0 low_limit, 4999.99 high_limit</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'Average Joes' name, 5000 low_limit, 9999.99 high_limit</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'Heavy Hitters' name, 10000 low_limit, 9999999.99 high_limit; </b></p>
<p class="calibre1">+---------------+-----------+------------+</p>
<p class="calibre1">| name          | low_limit | high_limit |</p>
<p class="calibre1">+---------------+-----------+------------+</p>
<p class="calibre1">| Small Fry     |         0 |    4999.99 |</p>
<p class="calibre1">| Average Joes  |      5000 |    9999.99 |</p>
<p class="calibre1">| Heavy Hitters |     10000 | 9999999.99 |</p>
<p class="calibre1">+---------------+-----------+------------+</p>
<p class="calibre1">3 rows in set (0.00 sec)</p>
<p class="calibre1">While this table was exactly what was needed for placing customers into three groups based on their aggregate account balance, this strategy of merging single-row tables using the set operator union all doesn’t work very well if you need to fabricate a large table. </p>
<p class="calibre1">Say, for example, that you want to create a query that generates a row for every day in the year 2008, but you don’t have a table in your database that contains a row for every day. Using the strategy from the example in <a href="#calibre_link-88">Chapter 9, </a>you could do something like the following:</p>
<p class="calibre1"><b class="calibre3">Cross Joins | 193</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-307"></a>SELECT '2008-01-01' dt</p>
<p class="calibre1">UNION ALL</p>
<p class="calibre1">SELECT '2008-01-02' dt</p>
<p class="calibre1">UNION ALL</p>
<p class="calibre1">SELECT '2008-01-03' dt</p>
<p class="calibre1">UNION ALL</p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">SELECT '2008-12-29' dt</p>
<p class="calibre1">UNION ALL</p>
<p class="calibre1">SELECT '2008-12-30' dt</p>
<p class="calibre1">UNION ALL</p>
<p class="calibre1">SELECT '2008-12-31' dt</p>
<p class="calibre1">Building a query that merges together the results of 366 queries is a bit tedious, so maybe a different strategy is needed. What if you generate a table with 366 rows (2008</p>
<p class="calibre1">was a leap year) with a single column containing a number between 0 and 366, and then add that number of days to January 1, 2008? Here’s one possible method to generate such a table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT ones.num + tens.num + hundreds.num</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 1 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 2 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 3 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 4 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 5 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 6 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 7 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 8 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 9 num) ones</b></p>
<p class="calibre1">-&gt; <b class="calibre3">CROSS JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 10 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 20 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 30 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 40 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 50 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 60 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 70 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 80 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 90 num) tens</b></p>
<p class="calibre1">-&gt; <b class="calibre3">CROSS JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 100 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 200 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 300 num) hundreds; </b></p>
<p class="calibre1">+------------------------------------+</p>
<p class="calibre1">| ones.num + tens.num + hundreds.num |</p>
<p class="calibre1">+------------------------------------+</p>
<p class="calibre1">|                                  0 |</p>
<p class="calibre1">|                                  1 |</p>
<p class="calibre1">|                                  2 |</p>
<p class="calibre1"><b class="calibre3">194 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-308"></a>|                                  3 |</p>
<p class="calibre1">|                                  4 |</p>
<p class="calibre1">|                                  5 |</p>
<p class="calibre1">|                                  6 |</p>
<p class="calibre1">|                                  7 |</p>
<p class="calibre1">|                                  8 |</p>
<p class="calibre1">|                                  9 |</p>
<p class="calibre1">|                                 10 |</p>
<p class="calibre1">|                                 11 |</p>
<p class="calibre1">|                                 12 |</p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">|                                391 |</p>
<p class="calibre1">|                                392 |</p>
<p class="calibre1">|                                393 |</p>
<p class="calibre1">|                                394 |</p>
<p class="calibre1">|                                395 |</p>
<p class="calibre1">|                                396 |</p>
<p class="calibre1">|                                397 |</p>
<p class="calibre1">|                                398 |</p>
<p class="calibre1">|                                399 |</p>
<p class="calibre1">+------------------------------------+</p>
<p class="calibre1">400 rows in set (0.00 sec)</p>
<p class="calibre1">If you take the Cartesian product of the three sets {0, 1, 2, 3, 4, 5, 6, 7, 8, 9}, {0, 10, 20, 30, 40, 50, 60, 70, 80, 90}, and {0, 100, 200, 300} and add the values in the three columns, you get a 400-row result set containing all numbers between 0 and 399. While this is more than the 366 rows needed to generate the set of days in 2008, it’s easy enough to get rid of the excess rows, and I’ll show you how shortly. </p>
<p class="calibre1">The next step is to convert the set of numbers to a set of dates. To do this, I will use the date_add() function to add each number in the result set to January 1, 2008. Then I’ll add a filter condition to throw away any dates that venture into 2009: mysql&gt; <b class="calibre3">SELECT DATE_ADD('2008-01-01', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTERVAL (ones.num + tens.num + hundreds.num) DAY) dt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 1 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 2 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 3 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 4 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 5 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 6 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 7 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 8 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 9 num) ones</b></p>
<p class="calibre1">-&gt; <b class="calibre3">CROSS JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 10 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 20 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 30 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 40 num UNION ALL</b></p>
<p class="calibre1"><b class="calibre3">Cross Joins | 195</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-309"></a>    -&gt; <b class="calibre3">SELECT 50 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 60 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 70 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 80 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 90 num) tens</b></p>
<p class="calibre1">-&gt; <b class="calibre3">CROSS JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 100 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 200 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 300 num) hundreds</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE DATE_ADD('2008-01-01', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTERVAL (ones.num + tens.num + hundreds.num) DAY) &lt; '2009-01-01' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1; </b></p>
<p class="calibre1">+------------+</p>
<p class="calibre1">| dt         |</p>
<p class="calibre1">+------------+</p>
<p class="calibre1">| 2008-01-01 |</p>
<p class="calibre1">| 2008-01-02 |</p>
<p class="calibre1">| 2008-01-03 |</p>
<p class="calibre1">| 2008-01-04 |</p>
<p class="calibre1">| 2008-01-05 |</p>
<p class="calibre1">| 2008-01-06 |</p>
<p class="calibre1">| 2008-01-07 |</p>
<p class="calibre1">| 2008-01-08 |</p>
<p class="calibre1">| 2008-01-09 |</p>
<p class="calibre1">| 2008-01-10 |</p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">| 2008-02-20 |</p>
<p class="calibre1">| 2008-02-21 |</p>
<p class="calibre1">| 2008-02-22 |</p>
<p class="calibre1">| 2008-02-23 |</p>
<p class="calibre1">| 2008-02-24 |</p>
<p class="calibre1">| 2008-02-25 |</p>
<p class="calibre1">| 2008-02-26 |</p>
<p class="calibre1">| 2008-02-27 |</p>
<p class="calibre1">| 2008-02-28 |</p>
<p class="calibre1"><b class="calibre3">| 2008-02-29 |</b></p>
<p class="calibre1">| 2008-03-01 |</p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">| 2008-12-20 |</p>
<p class="calibre1">| 2008-12-21 |</p>
<p class="calibre1">| 2008-12-22 |</p>
<p class="calibre1">| 2008-12-23 |</p>
<p class="calibre1">| 2008-12-24 |</p>
<p class="calibre1">| 2008-12-25 |</p>
<p class="calibre1">| 2008-12-26 |</p>
<p class="calibre1">| 2008-12-27 |</p>
<p class="calibre1">| 2008-12-28 |</p>
<p class="calibre1">| 2008-12-29 |</p>
<p class="calibre1">| 2008-12-30 |</p>
<p class="calibre1">| 2008-12-31 |</p>
<p class="calibre1"><b class="calibre3">196 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-194"></a>+------------+</p>
<p class="calibre1">366 rows in set (0.01 sec)</p>
<p class="calibre1">The nice thing about this approach is that the result set automatically includes the extra leap day (February 29) without your intervention, since the database server figures it out when it adds 59 days to January 1, 2008. </p>
<p class="calibre1">Now that you have a mechanism for fabricating all the days in 2008, what should you do with it? Well, you might be asked to generate a query that shows every day in 2008</p>
<p class="calibre1">along with the number of banking transactions conducted on that day, the number of accounts opened on that day, and so forth. Here’s an example that answers the first question:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT days.dt, COUNT(t.txn_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM transaction t RIGHT OUTER JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT DATE_ADD('2008-01-01', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTERVAL (ones.num + tens.num + hundreds.num) DAY) dt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 1 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 2 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 3 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 4 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 5 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 6 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 7 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 8 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 9 num) ones</b></p>
<p class="calibre1">-&gt; <b class="calibre3">CROSS JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 10 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 20 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 30 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 40 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 50 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 60 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 70 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 80 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 90 num) tens</b></p>
<p class="calibre1">-&gt; <b class="calibre3">CROSS JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 0 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 100 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 200 num UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 300 num) hundreds</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE DATE_ADD('2008-01-01', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTERVAL (ones.num + tens.num + hundreds.num) DAY) &lt; </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'2009-01-01') days</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON days.dt = t.txn_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY days.dt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1; </b></p>
<p class="calibre1">+------------+-----------------+</p>
<p class="calibre1">| dt         | COUNT(t.txn_id) |</p>
<p class="calibre1">+------------+-----------------+</p>
<p class="calibre1">| 2008-01-01 |               0 |</p>
<p class="calibre1"><b class="calibre3">Cross Joins | 197</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-105"></a>| 2008-01-02 |               0 |</p>
<p class="calibre1">| 2008-01-03 |               0 |</p>
<p class="calibre1">| 2008-01-04 |               0 |</p>
<p class="calibre1">| 2008-01-05 |              21 |</p>
<p class="calibre1">| 2008-01-06 |               0 |</p>
<p class="calibre1">| 2008-01-07 |               0 |</p>
<p class="calibre1">| 2008-01-08 |               0 |</p>
<p class="calibre1">| 2008-01-09 |               0 |</p>
<p class="calibre1">| 2008-01-10 |               0 |</p>
<p class="calibre1">| 2008-01-11 |               0 |</p>
<p class="calibre1">| 2008-01-12 |               0 |</p>
<p class="calibre1">| 2008-01-13 |               0 |</p>
<p class="calibre1">| 2008-01-14 |               0 |</p>
<p class="calibre1">| 2008-01-15 |               0 |</p>
<p class="calibre1">... </p>
<p class="calibre1">| 2008-12-31 |               0 |</p>
<p class="calibre1">+------------+-----------------+</p>
<p class="calibre1">366 rows in set (0.03 sec)</p>
<p class="calibre1">This is one of the more interesting queries thus far in the book, in that it includes cross joins, outer joins, a date function, grouping, set operations (union all), and an aggregate function (count()). It is also not the most elegant solution to the given problem, but it should serve as an example of how, with a little creativity and a firm grasp on the language, you can make even a seldom-used feature like cross joins a potent tool in your SQL toolkit. </p>
<p class="calibre1"><b class="calibre3">Natural Joins</b></p>
<p class="calibre1">If you are lazy (and aren’t we all), you can choose a join type that allows you to name the tables to be joined but lets the database server determine what the join conditions need to be. Known as the  <i class="calibre4">natural join</i>, this join type relies on identical column names across multiple tables to infer the proper join conditions. For example, the account table includes a column named cust_id, which is the foreign key to the customer table, whose primary key is also named cust_id. Thus, you can write a query that uses natural join to join the two tables:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.cust_id, c.cust_type_cd, c.fed_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a NATURAL JOIN customer c; </b></p>
<p class="calibre1">+------------+---------+--------------+-------------+</p>
<p class="calibre1">| account_id | cust_id | cust_type_cd | fed_id      |</p>
<p class="calibre1">+------------+---------+--------------+-------------+</p>
<p class="calibre1">|          1 |       1 | I            | 111-11-1111 |</p>
<p class="calibre1">|          2 |       1 | I            | 111-11-1111 |</p>
<p class="calibre1">|          3 |       1 | I            | 111-11-1111 |</p>
<p class="calibre1">|          4 |       2 | I            | 222-22-2222 |</p>
<p class="calibre1">|          5 |       2 | I            | 222-22-2222 |</p>
<p class="calibre1">|          6 |       3 | I            | 333-33-3333 |</p>
<p class="calibre1">|          7 |       3 | I            | 333-33-3333 |</p>
<p class="calibre1">|          8 |       4 | I            | 444-44-4444 |</p>
<p class="calibre1">|          9 |       4 | I            | 444-44-4444 |</p>
<p class="calibre1">|         10 |       4 | I            | 444-44-4444 |</p>
<p class="calibre1"><b class="calibre3">198 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-310"></a>|         11 |       5 | I            | 555-55-5555 |</p>
<p class="calibre1">|         12 |       6 | I            | 666-66-6666 |</p>
<p class="calibre1">|         13 |       6 | I            | 666-66-6666 |</p>
<p class="calibre1">|         14 |       7 | I            | 777-77-7777 |</p>
<p class="calibre1">|         15 |       8 | I            | 888-88-8888 |</p>
<p class="calibre1">|         16 |       8 | I            | 888-88-8888 |</p>
<p class="calibre1">|         17 |       9 | I            | 999-99-9999 |</p>
<p class="calibre1">|         18 |       9 | I            | 999-99-9999 |</p>
<p class="calibre1">|         19 |       9 | I            | 999-99-9999 |</p>
<p class="calibre1">|         20 |      10 | B            | 04-1111111  |</p>
<p class="calibre1">|         21 |      10 | B            | 04-1111111  |</p>
<p class="calibre1">|         22 |      11 | B            | 04-2222222  |</p>
<p class="calibre1">|         23 |      12 | B            | 04-3333333  |</p>
<p class="calibre1">|         24 |      13 | B            | 04-4444444  |</p>
<p class="calibre1">+------------+---------+--------------+-------------+</p>
<p class="calibre1">24 rows in set (0.02 sec)</p>
<p class="calibre1">Because you specified a natural join, the server inspected the table definitions and added the join condition a.cust_id = c.cust_id to join the two tables. </p>
<p class="calibre1">This is all well and good, but what if the columns don’t have the same name across the tables? For example, the account table also has a foreign key to the branch table, but the column in the account table is named open_branch_id instead of just branch_id. Let’s see what happens if I use natural join between the account and branch tables: mysql&gt; <b class="calibre3">SELECT a.account_id, a.cust_id, a.open_branch_id, b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a NATURAL JOIN branch b; </b></p>
<p class="calibre1">+------------+---------+----------------+---------------+</p>
<p class="calibre1">| account_id | cust_id | open_branch_id | name          |</p>
<p class="calibre1">+------------+---------+----------------+---------------+</p>
<p class="calibre1">|          1 |       1 |              2 | Headquarters  |</p>
<p class="calibre1">|          1 |       1 |              2 | Woburn Branch |</p>
<p class="calibre1">|          1 |       1 |              2 | Quincy Branch |</p>
<p class="calibre1">|          1 |       1 |              2 | So. NH Branch |</p>
<p class="calibre1">|          2 |       1 |              2 | Headquarters  |</p>
<p class="calibre1">|          2 |       1 |              2 | Woburn Branch |</p>
<p class="calibre1">|          2 |       1 |              2 | Quincy Branch |</p>
<p class="calibre1">|          2 |       1 |              2 | So. NH Branch |</p>
<p class="calibre1">|          3 |       1 |              2 | Headquarters  |</p>
<p class="calibre1">|          3 |       1 |              2 | Woburn Branch |</p>
<p class="calibre1">|          3 |       1 |              2 | Quincy Branch |</p>
<p class="calibre1">|          3 |       1 |              2 | So. NH Branch |</p>
<p class="calibre1">|          4 |       2 |              2 | Headquarters  |</p>
<p class="calibre1">|          4 |       2 |              2 | Woburn Branch |</p>
<p class="calibre1">|          4 |       2 |              2 | Quincy Branch |</p>
<p class="calibre1">|          4 |       2 |              2 | So. NH Branch |</p>
<p class="calibre1">|          5 |       2 |              2 | Headquarters  |</p>
<p class="calibre1">|          5 |       2 |              2 | Woburn Branch |</p>
<p class="calibre1">|          5 |       2 |              2 | Quincy Branch |</p>
<p class="calibre1">|          5 |       2 |              2 | So. NH Branch |</p>
<p class="calibre1">|          7 |       3 |              3 | Headquarters  |</p>
<p class="calibre1">|          7 |       3 |              3 | Woburn Branch |</p>
<p class="calibre1">|          7 |       3 |              3 | Quincy Branch |</p>
<p class="calibre1">|          7 |       3 |              3 | So. NH Branch |</p>
<p class="calibre1">|          8 |       3 |              3 | Headquarters  |</p>
<p class="calibre1"><b class="calibre3">Natural Joins | 199</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-106"></a>|          8 |       3 |              3 | Woburn Branch |</p>
<p class="calibre1">|          8 |       3 |              3 | Quincy Branch |</p>
<p class="calibre1">|          8 |       3 |              3 | So. NH Branch |</p>
<p class="calibre1">|         10 |       4 |              1 | Headquarters  |</p>
<p class="calibre1">|         10 |       4 |              1 | Woburn Branch |</p>
<p class="calibre1">|         10 |       4 |              1 | Quincy Branch |</p>
<p class="calibre1">|         10 |       4 |              1 | So. NH Branch |</p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">... </p>
<p class="calibre1">|         24 |      10 |              4 | Headquarters  |</p>
<p class="calibre1">|         24 |      10 |              4 | Woburn Branch |</p>
<p class="calibre1">|         24 |      10 |              4 | Quincy Branch |</p>
<p class="calibre1">|         24 |      10 |              4 | So. NH Branch |</p>
<p class="calibre1">|         25 |      10 |              4 | Headquarters  |</p>
<p class="calibre1">|         25 |      10 |              4 | Woburn Branch |</p>
<p class="calibre1">|         25 |      10 |              4 | Quincy Branch |</p>
<p class="calibre1">|         25 |      10 |              4 | So. NH Branch |</p>
<p class="calibre1">|         27 |      11 |              2 | Headquarters  |</p>
<p class="calibre1">|         27 |      11 |              2 | Woburn Branch |</p>
<p class="calibre1">|         27 |      11 |              2 | Quincy Branch |</p>
<p class="calibre1">|         27 |      11 |              2 | So. NH Branch |</p>
<p class="calibre1">|         28 |      12 |              4 | Headquarters  |</p>
<p class="calibre1">|         28 |      12 |              4 | Woburn Branch |</p>
<p class="calibre1">|         28 |      12 |              4 | Quincy Branch |</p>
<p class="calibre1">|         28 |      12 |              4 | So. NH Branch |</p>
<p class="calibre1">|         29 |      13 |              3 | Headquarters  |</p>
<p class="calibre1">|         29 |      13 |              3 | Woburn Branch |</p>
<p class="calibre1">|         29 |      13 |              3 | Quincy Branch |</p>
<p class="calibre1">|         29 |      13 |              3 | So. NH Branch |</p>
<p class="calibre1">+------------+---------+----------------+---------------+</p>
<p class="calibre1">96 rows in set (0.07 sec)</p>
<p class="calibre1">It looks like something has gone wrong; the query should return no more than 24 rows, since there are 24 rows in the account table. What has happened is that, since the server couldn’t find two identically named columns in the two tables, no join condition was generated and the two tables were cross-joined instead, resulting in 96 rows (24 accounts × 4 branches). </p>
<p class="calibre1">So, is the reduced wear and tear on the old fingers from not having to type the join condition worth the trouble? Absolutely not; you should avoid this join type and use inner joins with explicit join conditions. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">The following exercises test your understanding of outer and cross joins. Please see</p>
<p class="calibre1"><a href="#calibre_link-152">Appendix C for solutions. </a></p>
<p class="calibre1"><b class="calibre3">200 | Chapter 10:</b> <b class="calibre3">Joins Revisited</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-247"></a><b class="calibre3">Exercise 10-1</b></p>
<p class="calibre1">Write a query that returns all product names along with the accounts based on that product (use the product_cd column in the account table to link to the product table). </p>
<p class="calibre1">Include all products, even if no accounts have been opened for that product. </p>
<p class="calibre1"><b class="calibre3">Exercise 10-2</b></p>
<p class="calibre1">Reformulate your query from Exercise 10-1 to use the other outer join type (e.g., if you used a left outer join in Exercise 10-1, use a right outer join this time) such that the results are identical to Exercise 10-1. </p>
<p class="calibre1"><b class="calibre3">Exercise 10-3</b></p>
<p class="calibre1">Outer-join  the  account  table  to  both  the  individual  and  business  tables  (via  the account.cust_id column) such that the result set contains one row per account. Columns  to  include  are  account.account_id,  account.product_cd,  individual.fname, individual.lname, and business.name. </p>
<p class="calibre1"><b class="calibre3">Exercise 10-4 (Extra Credit)</b></p>
<p class="calibre1">Devise a query that will generate the set {1, 2, 3,..., 99, 100}. (Hint: use a cross join with at least two from clause subqueries.)</p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 201</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-311"></a>D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-107"></a><b class="calibre3">CHAPTER 11</b></p>
<p class="calibre1"><b class="calibre3">Conditional Logic</b></p>
<p class="calibre1">In certain situations, you may want your SQL logic to branch in one direction or another depending on the values of certain columns or expressions. This chapter focuses on how to write statements that can behave differently depending on the data encountered during statement execution. </p>
<p class="calibre1"><b class="calibre3">What Is Conditional Logic? </b></p>
<p class="calibre1">Conditional  logic  is  simply  the  ability  to  take  one  of  several  paths  during  program execution. For example, when querying customer information, you might want to retrieve either the fname/lname columns from the individual table or the name column from the business table depending on what type of customer is encountered. Using outer joins, you could return both strings and let the caller figure out which one to use, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT c.cust_id, c.fed_id, c.cust_type_cd, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CONCAT(i.fname, ' ', i.lname) indiv_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">b.name business_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c LEFT OUTER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON c.cust_id = i.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LEFT OUTER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON c.cust_id = b.cust_id; </b></p>
<p class="calibre1">+---------+-------------+--------------+-----------------+------------------------+</p>
<p class="calibre1">| cust_id | fed_id      | cust_type_cd | indiv_name      | business_name          |</p>
<p class="calibre1">+---------+-------------+--------------+-----------------+------------------------+</p>
<p class="calibre1">|       1 | 111-11-1111 | I            | James Hadley    | NULL                   |</p>
<p class="calibre1">|       2 | 222-22-2222 | I            | Susan Tingley   | NULL                   |</p>
<p class="calibre1">|       3 | 333-33-3333 | I            | Frank Tucker    | NULL                   |</p>
<p class="calibre1">|       4 | 444-44-4444 | I            | John Hayward    | NULL                   |</p>
<p class="calibre1">|       5 | 555-55-5555 | I            | Charles Frasier | NULL                   |</p>
<p class="calibre1">|       6 | 666-66-6666 | I            | John Spencer    | NULL                   |</p>
<p class="calibre1">|       7 | 777-77-7777 | I            | Margaret Young  | NULL                   |</p>
<p class="calibre1">|       8 | 888-88-8888 | I            | Louis Blake     | NULL                   |</p>
<p class="calibre1">|       9 | 999-99-9999 | I            | Richard Farley  | NULL                   |</p>
<p class="calibre1">|      10 | 04-1111111  | B            | NULL            | Chilton Engineering    |</p>
<p class="calibre1">|      11 | 04-2222222  | B            | NULL            | Northeast Cooling Inc. |</p>
<p class="calibre1">|      12 | 04-3333333  | B            | NULL            | Superior Auto Body     |</p>
<p class="calibre1"><b class="calibre3">203</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-108"></a>|      13 | 04-4444444  | B            | NULL            | AAA Insurance Inc.     |</p>
<p class="calibre1">+---------+-------------+--------------+-----------------+------------------------+</p>
<p class="calibre1">13 rows in set (0.13 sec)</p>
<p class="calibre1">The caller can look at the value of the cust_type_cd column and decide whether to use the indiv_name or business_name column. Instead, however, you could use conditional logic via a  <i class="calibre4">case expression</i> to determine the type of customer and return the appropriate string, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT c.cust_id, c.fed_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN c.cust_type_cd = 'I' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">THEN CONCAT(i.fname, ' ', i.lname)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN c.cust_type_cd = 'B' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">THEN b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 'Unknown' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c LEFT OUTER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON c.cust_id = i.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LEFT OUTER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON c.cust_id = b.cust_id; </b></p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">| cust_id | fed_id      | name                   |</p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">|       1 | 111-11-1111 | James Hadley           |</p>
<p class="calibre1">|       2 | 222-22-2222 | Susan Tingley          |</p>
<p class="calibre1">|       3 | 333-33-3333 | Frank Tucker           |</p>
<p class="calibre1">|       4 | 444-44-4444 | John Hayward           |</p>
<p class="calibre1">|       5 | 555-55-5555 | Charles Frasier        |</p>
<p class="calibre1">|       6 | 666-66-6666 | John Spencer           |</p>
<p class="calibre1">|       7 | 777-77-7777 | Margaret Young         |</p>
<p class="calibre1">|       8 | 888-88-8888 | Louis Blake            |</p>
<p class="calibre1">|       9 | 999-99-9999 | Richard Farley         |</p>
<p class="calibre1">|      10 | 04-1111111  | Chilton Engineering    |</p>
<p class="calibre1">|      11 | 04-2222222  | Northeast Cooling Inc. |</p>
<p class="calibre1">|      12 | 04-3333333  | Superior Auto Body     |</p>
<p class="calibre1">|      13 | 04-4444444  | AAA Insurance Inc.     |</p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">13 rows in set (0.00 sec)</p>
<p class="calibre1">This version of the query returns a single name column that is generated by the  <i class="calibre4">case</i> <i class="calibre4">expression starting on the second line of the query</i>, which, in this example, checks the value of the cust_type_cd column and returns either the individual’s first/last names <i class="calibre4">or</i> the business name. </p>
<p class="calibre1"><b class="calibre3">The Case Expression</b></p>
<p class="calibre1">All of the major database servers include built-in functions designed to mimic the if-then-else statement found in most programming languages (examples include Oracle’s decode()  function,  MySQL’s  if()  function,  and  SQL  Server’s  coalesce()  function). </p>
<p class="calibre1">Case expressions are also designed to facilitate if-then-else logic but enjoy two advantages over built-in functions:</p>
<p class="calibre1"><b class="calibre3">204 | Chapter 11:</b> <b class="calibre3">Conditional Logic</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-109"></a>• The case expression is part of the SQL standard (SQL92 release) and has been implemented by Oracle Database, SQL Server, MySQL, Sybase, PostgreSQL, IBM</p>
<p class="calibre1">UDB, and others. </p>
<p class="calibre1">• Case expressions are built into the SQL grammar and can be included in select, insert, update, and delete statements. </p>
<p class="calibre1">The next two subsections introduce the two different types of case expressions, and then I show you some examples of case expressions in action. </p>
<p class="calibre1"><b class="calibre3">Searched Case Expressions</b></p>
<p class="calibre1">The case expression demonstrated earlier in the chapter is an example of a  <i class="calibre4">searched</i> <i class="calibre4">case expression</i>, which has the following syntax:</p>
<p class="calibre1">CASE</p>
<p class="calibre1">WHEN C1 THEN E1</p>
<p class="calibre1">WHEN C2 THEN E2</p>
<p class="calibre1">... </p>
<p class="calibre1">WHEN CN THEN EN</p>
<p class="calibre1">[ELSE ED]</p>
<p class="calibre1">END</p>
<p class="calibre1">In the previous definition, the symbols C1, C2,..., CN represent conditions, and the symbols E1, E2,..., EN represent expressions to be returned by the case expression. If the condition in a when clause evaluates to true, then the case expression returns the corresponding expression. Additionally, the ED symbol represents the default expression, which the case expression returns if  <i class="calibre4">none</i> of the conditions C1, C2,..., CN evaluate to true (the else clause is optional, which is why it is enclosed in square brackets). All the expressions returned by the various when clauses must evaluate to the same type (e.g., date, number, varchar). </p>
<p class="calibre1">Here’s an example of a searched case expression:</p>
<p class="calibre1">CASE</p>
<p class="calibre1">WHEN employee.title = 'Head Teller' </p>
<p class="calibre1">THEN 'Head Teller' </p>
<p class="calibre1">WHEN employee.title = 'Teller' </p>
<p class="calibre1">AND YEAR(employee.start_date) &gt; 2007</p>
<p class="calibre1">THEN 'Teller Trainee' </p>
<p class="calibre1">WHEN employee.title = 'Teller' </p>
<p class="calibre1">AND YEAR(employee.start_date) &lt; 2006</p>
<p class="calibre1">THEN 'Experienced Teller' </p>
<p class="calibre1">WHEN employee.title = 'Teller' </p>
<p class="calibre1">THEN 'Teller' </p>
<p class="calibre1">ELSE 'Non-Teller' </p>
<p class="calibre1">END</p>
<p class="calibre1">This case expression returns a string that can be used to determine hourly pay scales, print name badges, and so forth. When the case expression is evaluated, the when clauses are evaluated in order from top to bottom; as soon as one of the conditions in a when clause evaluates to true, the corresponding expression is returned and any remaining <b class="calibre3">The Case Expression | 205</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-110"></a>when clauses are ignored. If none of the when clause conditions evaluate to true, then the expression in the else clause is returned. </p>
<p class="calibre1">Although  the  previous  example  returns  string  expressions,  keep  in  mind  that  case expressions may return any type of expression, including subqueries. Here’s another version of the individual/business name query from earlier in the chapter that uses subqueries instead of outer joins to retrieve data from the individual and business tables:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT c.cust_id, c.fed_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN c.cust_type_cd = 'I' THEN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT CONCAT(i.fname, ' ', i.lname)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE i.cust_id = c.cust_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN c.cust_type_cd = 'B' THEN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE b.cust_id = c.cust_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 'Unknown' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c; </b></p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">| cust_id | fed_id      | name                   |</p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">|       1 | 111-11-1111 | James Hadley           |</p>
<p class="calibre1">|       2 | 222-22-2222 | Susan Tingley          |</p>
<p class="calibre1">|       3 | 333-33-3333 | Frank Tucker           |</p>
<p class="calibre1">|       4 | 444-44-4444 | John Hayward           |</p>
<p class="calibre1">|       5 | 555-55-5555 | Charles Frasier        |</p>
<p class="calibre1">|       6 | 666-66-6666 | John Spencer           |</p>
<p class="calibre1">|       7 | 777-77-7777 | Margaret Young         |</p>
<p class="calibre1">|       8 | 888-88-8888 | Louis Blake            |</p>
<p class="calibre1">|       9 | 999-99-9999 | Richard Farley         |</p>
<p class="calibre1">|      10 | 04-1111111  | Chilton Engineering    |</p>
<p class="calibre1">|      11 | 04-2222222  | Northeast Cooling Inc. |</p>
<p class="calibre1">|      12 | 04-3333333  | Superior Auto Body     |</p>
<p class="calibre1">|      13 | 04-4444444  | AAA Insurance Inc.     |</p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">13 rows in set (0.01 sec)</p>
<p class="calibre1">This version of the query includes only the customer table in the from clause and uses correlated subqueries to retrieve the appropriate name for each customer. I prefer this version over the outer join version from earlier in the chapter, since the server reads from the individual and business tables only as needed instead of always joining all three tables. </p>
<p class="calibre1"><b class="calibre3">Simple Case Expressions</b></p>
<p class="calibre1">The  <i class="calibre4">simple case expression</i> is quite similar to the searched case expression but is a bit less flexible. Here’s the syntax:</p>
<p class="calibre1"><b class="calibre3">206 | Chapter 11:</b> <b class="calibre3">Conditional Logic</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-111"></a>CASE V0</p>
<p class="calibre1">WHEN V1 THEN E1</p>
<p class="calibre1">WHEN V2 THEN E2</p>
<p class="calibre1">... </p>
<p class="calibre1">WHEN VN THEN EN</p>
<p class="calibre1">[ELSE ED]</p>
<p class="calibre1">END</p>
<p class="calibre1">In the preceding definition, V0 represents a value, and the symbols V1, V2,..., VN represent values that are to be compared to V0. The symbols E1, E2,..., EN represent expressions to be returned by the case expression, and ED represents the expression to be returned if none of the values in the set V1, V2,..., VN match the V0 value. </p>
<p class="calibre1">Here’s an example of a simple case expression:</p>
<p class="calibre1">CASE customer.cust_type_cd</p>
<p class="calibre1">WHEN 'I' THEN</p>
<p class="calibre1">(SELECT CONCAT(i.fname, ' ', i.lname)</p>
<p class="calibre1">FROM individual I</p>
<p class="calibre1">WHERE i.cust_id = customer.cust_id)</p>
<p class="calibre1">WHEN 'B' THEN</p>
<p class="calibre1">(SELECT b.name</p>
<p class="calibre1">FROM business b</p>
<p class="calibre1">WHERE b.cust_id = customer.cust_id)</p>
<p class="calibre1">ELSE 'Unknown Customer Type' </p>
<p class="calibre1">END</p>
<p class="calibre1">Simple case expressions are less powerful than searched case expressions because you can’t specify your own conditions; instead, equality conditions are built for you. To show you what I mean, here’s a searched case expression having the same logic as the previous simple case expression:</p>
<p class="calibre1">CASE</p>
<p class="calibre1">WHEN customer.cust_type_cd = 'I' THEN</p>
<p class="calibre1">(SELECT CONCAT(i.fname, ' ', i.lname)</p>
<p class="calibre1">FROM individual I</p>
<p class="calibre1">WHERE i.cust_id = customer.cust_id)</p>
<p class="calibre1">WHEN customer.cust_type_cd = 'B' THEN</p>
<p class="calibre1">(SELECT b.name</p>
<p class="calibre1">FROM business b</p>
<p class="calibre1">WHERE b.cust_id = customer.cust_id)</p>
<p class="calibre1">ELSE 'Unknown Customer Type' </p>
<p class="calibre1">END</p>
<p class="calibre1">With searched case expressions, you can build range conditions, inequality conditions, and multipart conditions using and/or/not, so I would recommend using searched case expressions for all but the simplest logic. </p>
<p class="calibre1"><b class="calibre3">Case Expression Examples</b></p>
<p class="calibre1">The following sections present a variety of examples illustrating the utility of conditional logic in SQL statements. </p>
<p class="calibre1"><b class="calibre3">Case Expression Examples | 207</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-112"></a><b class="calibre3">Result Set Transformations</b></p>
<p class="calibre1">You may have run into a situation where you are performing aggregations over a finite set of values, such as days of the week, but you want the result set to contain a single row with one column per value instead of one row per value. As an example, let’s say you have been asked to write a query that shows the number of accounts opened in the years 2000 through 2005:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT YEAR(open_date) year, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE open_date &gt; '1999-12-31' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND open_date &lt; '2006-01-01' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY YEAR(open_date); </b></p>
<p class="calibre1">+------+----------+</p>
<p class="calibre1">| year | how_many |</p>
<p class="calibre1">+------+----------+</p>
<p class="calibre1">| 2000 |        3 |</p>
<p class="calibre1">| 2001 |        4 |</p>
<p class="calibre1">| 2002 |        5 |</p>
<p class="calibre1">| 2003 |        3 |</p>
<p class="calibre1">| 2004 |        9 |</p>
<p class="calibre1">+------+----------+</p>
<p class="calibre1">5 rows in set (0.00 sec)</p>
<p class="calibre1">However, you have also been instructed to return a single row of data with six columns (one for each year in the data range). To transform this result set into a single row, you will need to create six columns and, within each column, sum  <i class="calibre4">only</i> those rows pertaining to the year in question:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN EXTRACT(YEAR FROM open_date) = 2000 THEN 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 0</b></p>
<p class="calibre1">-&gt; <b class="calibre3">END) year_2000, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN EXTRACT(YEAR FROM open_date) = 2001 THEN 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 0</b></p>
<p class="calibre1">-&gt; <b class="calibre3">END) year_2001, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN EXTRACT(YEAR FROM open_date) = 2002 THEN 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 0</b></p>
<p class="calibre1">-&gt; <b class="calibre3">END) year_2002, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN EXTRACT(YEAR FROM open_date) = 2003 THEN 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 0</b></p>
<p class="calibre1">-&gt; <b class="calibre3">END) year_2003, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN EXTRACT(YEAR FROM open_date) = 2004 THEN 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 0</b></p>
<p class="calibre1">-&gt; <b class="calibre3">END) year_2004, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN EXTRACT(YEAR FROM open_date) = 2005 THEN 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 0</b></p>
<p class="calibre1">-&gt; <b class="calibre3">END) year_2005</b></p>
<p class="calibre1"><b class="calibre3">208 | Chapter 11:</b> <b class="calibre3">Conditional Logic</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-113"></a><img src="images/000027.png" alt="Image 40" class="calibre2" /></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE open_date &gt; '1999-12-31' AND open_date &lt; '2006-01-01'; </b></p>
<p class="calibre1">+-----------+-----------+-----------+-----------+-----------+-----------+</p>
<p class="calibre1">| year_2000 | year_2001 | year_2002 | year_2003 | year_2004 | year_2005 |</p>
<p class="calibre1">+-----------+-----------+-----------+-----------+-----------+-----------+</p>
<p class="calibre1">|         3 |         4 |         5 |         3 |         9 |         0 |</p>
<p class="calibre1">+-----------+-----------+-----------+-----------+-----------+-----------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">Each of the six columns in the previous query are identical, except for the year value. </p>
<p class="calibre1">When the extract() function returns the desired year for that column, the case expression returns the value 1; otherwise, it returns a 0. When summed over all accounts opened since 2000, each column returns the number of accounts opened for that year. </p>
<p class="calibre1">Obviously, such transformations are practical for only a small number of values; generating one column for each year since 1905 would quickly become tedious. </p>
<p class="calibre1">Although it is a bit advanced for this book, it is worth pointing out that both SQL Server and Oracle Database 11 <i class="calibre4">g</i> include PIVOT clauses specifically for these types of queries. </p>
<p class="calibre1"><b class="calibre3">Selective Aggregation</b></p>
<p class="calibre1">Back in <a href="#calibre_link-88">Chapter 9, </a>I showed a partial solution for an example that demonstrated how to  find  accounts  whose  account  balances  don’t  agree  with  the  raw  data  in  the transaction table. The reason for the partial solution was that a full solution requires the use of conditional logic, so all the pieces are now in place to finish the job. Here’s</p>
<p class="calibre1"><a href="#calibre_link-88">where I left off in Chapter 9:</a></p>
<p class="calibre1">SELECT CONCAT('ALERT! : Account #', a.account_id, </p>
<p class="calibre1">' Has Incorrect Balance!')</p>
<p class="calibre1">FROM account a</p>
<p class="calibre1">WHERE (a.avail_balance, a.pending_balance) &lt;&gt; </p>
<p class="calibre1">(SELECT SUM(&lt;expression to generate available balance&gt;), SUM(&lt;expression to generate pending balance&gt;)</p>
<p class="calibre1">FROM transaction t</p>
<p class="calibre1">WHERE t.account_id = a.account_id); </p>
<p class="calibre1">The query uses a correlated subquery on the transaction table to sum together the individual transactions for a given account. When summing transactions, you need to consider the following two issues:</p>
<p class="calibre1">• Transaction amounts are always positive, so you need to look at the transaction type to see whether the transaction is a debit or a credit and flip the sign (multiply by −1) for debit transactions. </p>
<p class="calibre1">• If the date in the funds_avail_date column is greater than the current day, the transaction should be added to the pending balance total but not to the available balance total. </p>
<p class="calibre1"><b class="calibre3">Case Expression Examples | 209</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-312"></a>While some transactions need to be excluded from the available balance, all transactions are included in the pending balance, making it the simpler of the two calculations. </p>
<p class="calibre1">Here’s the case expression used to calculate the pending balance: CASE</p>
<p class="calibre1">WHEN transaction.txn_type_cd = 'DBT' </p>
<p class="calibre1">THEN transaction.amount * −1</p>
<p class="calibre1">ELSE transaction.amount</p>
<p class="calibre1">END</p>
<p class="calibre1">Thus, all transaction amounts are multiplied by −1 for debit transactions and are left as is for credit transactions. This same logic applies to the available balance calculation as well, but only transactions that have become available should be included. Therefore, the case expression used to calculate available balance includes one additional when clause:</p>
<p class="calibre1">CASE</p>
<p class="calibre1">WHEN transaction.funds_avail_date &gt; CURRENT_TIMESTAMP()</p>
<p class="calibre1">THEN 0</p>
<p class="calibre1">WHEN transaction.txn_type_cd = 'DBT' </p>
<p class="calibre1">THEN transaction.amount * −1</p>
<p class="calibre1">ELSE transaction.amount</p>
<p class="calibre1">END</p>
<p class="calibre1">With the first when clause in place, unavailable funds, such as checks that have not cleared, will contribute $0 to the sum. Here’s the final query with the two case expressions in place:</p>
<p class="calibre1">SELECT CONCAT('ALERT! : Account #', a.account_id, </p>
<p class="calibre1">' Has Incorrect Balance!')</p>
<p class="calibre1">FROM account a</p>
<p class="calibre1">WHERE (a.avail_balance, a.pending_balance) &lt;&gt; </p>
<p class="calibre1">(SELECT</p>
<p class="calibre1">SUM(CASE</p>
<p class="calibre1">WHEN t.funds_avail_date &gt; CURRENT_TIMESTAMP()</p>
<p class="calibre1">THEN 0</p>
<p class="calibre1">WHEN t.txn_type_cd = 'DBT' </p>
<p class="calibre1">THEN t.amount * −1</p>
<p class="calibre1">ELSE t.amount</p>
<p class="calibre1">END), </p>
<p class="calibre1">SUM(CASE</p>
<p class="calibre1">WHEN t.txn_type_cd = 'DBT' </p>
<p class="calibre1">THEN t.amount * −1</p>
<p class="calibre1">ELSE t.amount</p>
<p class="calibre1">END)</p>
<p class="calibre1">FROM transaction t</p>
<p class="calibre1">WHERE t.account_id = a.account_id); </p>
<p class="calibre1">By using conditional logic, the sum() aggregate functions are being fed manipulated data by the two case expressions, allowing the appropriate amounts to be summed. </p>
<p class="calibre1"><b class="calibre3">210 | Chapter 11:</b> <b class="calibre3">Conditional Logic</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-114"></a><b class="calibre3">Checking for Existence</b></p>
<p class="calibre1">Sometimes you will want to determine whether a relationship exists between two entities without regard for the quantity. For example, you might want to know whether a customer has any checking or savings accounts, but you don’t care whether a customer has more than one of each type of account. Here’s a query that uses multiple case expressions to generate two output columns, one to show whether the customer has any checking accounts and the other to show whether the customer has any savings accounts:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT c.cust_id, c.fed_id, c.cust_type_cd, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN EXISTS (SELECT 1 FROM account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND a.product_cd = 'CHK') THEN 'Y' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 'N' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END has_checking, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN EXISTS (SELECT 1 FROM account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND a.product_cd = 'SAV') THEN 'Y' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE 'N' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END has_savings</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c; </b></p>
<p class="calibre1">+---------+-------------+--------------+--------------+-------------+</p>
<p class="calibre1">| cust_id | fed_id      | cust_type_cd | has_checking | has_savings |</p>
<p class="calibre1">+---------+-------------+--------------+--------------+-------------+</p>
<p class="calibre1">|       1 | 111-11-1111 | I            | Y            | Y           |</p>
<p class="calibre1">|       2 | 222-22-2222 | I            | Y            | Y           |</p>
<p class="calibre1">|       3 | 333-33-3333 | I            | Y            | N           |</p>
<p class="calibre1">|       4 | 444-44-4444 | I            | Y            | Y           |</p>
<p class="calibre1">|       5 | 555-55-5555 | I            | Y            | N           |</p>
<p class="calibre1">|       6 | 666-66-6666 | I            | Y            | N           |</p>
<p class="calibre1">|       7 | 777-77-7777 | I            | N            | N           |</p>
<p class="calibre1">|       8 | 888-88-8888 | I            | Y            | Y           |</p>
<p class="calibre1">|       9 | 999-99-9999 | I            | Y            | N           |</p>
<p class="calibre1">|      10 | 04-1111111  | B            | Y            | N           |</p>
<p class="calibre1">|      11 | 04-2222222  | B            | N            | N           |</p>
<p class="calibre1">|      12 | 04-3333333  | B            | Y            | N           |</p>
<p class="calibre1">|      13 | 04-4444444  | B            | N            | N           |</p>
<p class="calibre1">+---------+-------------+--------------+--------------+-------------+</p>
<p class="calibre1">13 rows in set (0.00 sec)</p>
<p class="calibre1">Each case expression includes a correlated subquery against the account table; one looks for checking accounts, the other for savings accounts. Since each when clause uses the exists operator, the conditions evaluate to true as long as the customer has at least one of the desired accounts. </p>
<p class="calibre1">In other cases, you may care how many rows are encountered, but only up to a point. </p>
<p class="calibre1">For example, the next query uses a simple case expression to count the number of accounts for each customer, and then returns either 'None', '1', '2', or '3+': <b class="calibre3">Case Expression Examples | 211</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-115"></a>mysql&gt; <b class="calibre3">SELECT c.cust_id, c.fed_id, c.cust_type_cd, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE (SELECT COUNT(*) FROM account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE a.cust_id = c.cust_id)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN 0 THEN 'None' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN 1 THEN '1' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN 2 THEN '2' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE '3+' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END num_accounts</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c; </b></p>
<p class="calibre1">+---------+-------------+--------------+--------------+</p>
<p class="calibre1">| cust_id | fed_id      | cust_type_cd | num_accounts |</p>
<p class="calibre1">+---------+-------------+--------------+--------------+</p>
<p class="calibre1">|       1 | 111-11-1111 | I            | 3+           |</p>
<p class="calibre1">|       2 | 222-22-2222 | I            | 2            |</p>
<p class="calibre1">|       3 | 333-33-3333 | I            | 2            |</p>
<p class="calibre1">|       4 | 444-44-4444 | I            | 3+           |</p>
<p class="calibre1">|       5 | 555-55-5555 | I            | 1            |</p>
<p class="calibre1">|       6 | 666-66-6666 | I            | 2            |</p>
<p class="calibre1">|       7 | 777-77-7777 | I            | 1            |</p>
<p class="calibre1">|       8 | 888-88-8888 | I            | 2            |</p>
<p class="calibre1">|       9 | 999-99-9999 | I            | 3+           |</p>
<p class="calibre1">|      10 | 04-1111111  | B            | 2            |</p>
<p class="calibre1">|      11 | 04-2222222  | B            | 1            |</p>
<p class="calibre1">|      12 | 04-3333333  | B            | 1            |</p>
<p class="calibre1">|      13 | 04-4444444  | B            | 1            |</p>
<p class="calibre1">+---------+-------------+--------------+--------------+</p>
<p class="calibre1">13 rows in set (0.01 sec)</p>
<p class="calibre1">For this query, I didn’t want to differentiate between customers having more than two accounts, so the case expression simply creates a '3+' category. Such a query might be useful if you were looking for customers to contact regarding opening a new account with the bank. </p>
<p class="calibre1"><b class="calibre3">Division-by-Zero Errors</b></p>
<p class="calibre1">When performing calculations that include division, you should always take care to ensure that the denominators are never equal to zero. Whereas some database servers, such as Oracle Database, will throw an error when a zero denominator is encountered, MySQL  simply  sets  the  result  of  the  calculation  to  null,  as  demonstrated  by  the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT 100 / 0; </b></p>
<p class="calibre1">+---------+</p>
<p class="calibre1">| 100 / 0 |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">|    NULL |</p>
<p class="calibre1">+---------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">To safeguard your calculations from encountering errors or, even worse, from being mysteriously set to null, you should wrap all denominators in conditional logic, as demonstrated by the following:</p>
<p class="calibre1"><b class="calibre3">212 | Chapter 11:</b> <b class="calibre3">Conditional Logic</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-116"></a>mysql&gt; <b class="calibre3">SELECT a.cust_id, a.product_cd, a.avail_balance /</b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN prod_tots.tot_balance = 0 THEN 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE prod_tots.tot_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">END percent_of_total</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT a.product_cd, SUM(a.avail_balance) tot_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY a.product_cd) prod_tots</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.product_cd = prod_tots.product_cd; </b></p>
<p class="calibre1">+---------+------------+------------------+</p>
<p class="calibre1">| cust_id | product_cd | percent_of_total |</p>
<p class="calibre1">+---------+------------+------------------+</p>
<p class="calibre1">|      10 | BUS        |         0.000000 |</p>
<p class="calibre1">|      11 | BUS        |         1.000000 |</p>
<p class="calibre1">|       1 | CD         |         0.153846 |</p>
<p class="calibre1">|       6 | CD         |         0.512821 |</p>
<p class="calibre1">|       7 | CD         |         0.256410 |</p>
<p class="calibre1">|       9 | CD         |         0.076923 |</p>
<p class="calibre1">|       1 | CHK        |         0.014488 |</p>
<p class="calibre1">|       2 | CHK        |         0.030928 |</p>
<p class="calibre1">|       3 | CHK        |         0.014488 |</p>
<p class="calibre1">|       4 | CHK        |         0.007316 |</p>
<p class="calibre1">|       5 | CHK        |         0.030654 |</p>
<p class="calibre1">|       6 | CHK        |         0.001676 |</p>
<p class="calibre1">|       8 | CHK        |         0.047764 |</p>
<p class="calibre1">|       9 | CHK        |         0.001721 |</p>
<p class="calibre1">|      10 | CHK        |         0.322911 |</p>
<p class="calibre1">|      12 | CHK        |         0.528052 |</p>
<p class="calibre1">|       3 | MM         |         0.129802 |</p>
<p class="calibre1">|       4 | MM         |         0.321915 |</p>
<p class="calibre1">|       9 | MM         |         0.548282 |</p>
<p class="calibre1">|       1 | SAV        |         0.269431 |</p>
<p class="calibre1">|       2 | SAV        |         0.107773 |</p>
<p class="calibre1">|       4 | SAV        |         0.413723 |</p>
<p class="calibre1">|       8 | SAV        |         0.209073 |</p>
<p class="calibre1">|      13 | SBL        |         1.000000 |</p>
<p class="calibre1">+---------+------------+------------------+</p>
<p class="calibre1">24 rows in set (0.13 sec)</p>
<p class="calibre1">This query computes the ratio of each account balance to the total balance for all accounts of the same product type. Since some product types, such as business loans, could have a total balance of zero if all loans were currently paid in full, it is best to include the case expression to ensure that the denominator is never zero. </p>
<p class="calibre1"><b class="calibre3">Conditional Updates</b></p>
<p class="calibre1">When updating rows in a table, you sometimes need to decide what values to set certain columns to. For example, after inserting a new transaction, you need to modify the avail_balance, pending_balance, and last_activity_date columns in the account table. </p>
<p class="calibre1">Although  the  last  two  columns  are  easily  updated,  to  correctly  modify  the avail_balance column you need to know whether the funds from the transaction are <b class="calibre3">Case Expression Examples | 213</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-117"></a>immediately available by checking the funds_avail_date column in the transaction table. Given that transaction ID 999 has just been inserted, you can use the following update statement to modify the three columns in the account table: 1   UPDATE account</p>
<p class="calibre1">2     SET last_activity_date = CURRENT_TIMESTAMP(), </p>
<p class="calibre1">3     pending_balance = pending_balance +</p>
<p class="calibre1">4      (SELECT t.amount *</p>
<p class="calibre1">5         CASE t.txn_type_cd WHEN 'DBT' THEN −1 ELSE 1 END</p>
<p class="calibre1">6       FROM transaction t</p>
<p class="calibre1">7       WHERE t.txn_id = 999), </p>
<p class="calibre1">8     avail_balance = avail_balance +</p>
<p class="calibre1">9      (SELECT</p>
<p class="calibre1">10         CASE</p>
<p class="calibre1">11           WHEN t.funds_avail_date &gt; CURRENT_TIMESTAMP() THEN 0</p>
<p class="calibre1">12           ELSE t.amount *</p>
<p class="calibre1">13             CASE t.txn_type_cd WHEN 'DBT' THEN −1 ELSE 1 END</p>
<p class="calibre1">14         END</p>
<p class="calibre1">15       FROM transaction t</p>
<p class="calibre1">16       WHERE t.txn_id = 999)</p>
<p class="calibre1">17   WHERE account.account_id =</p>
<p class="calibre1">18    (SELECT t.account_id</p>
<p class="calibre1">19     FROM transaction t</p>
<p class="calibre1">20     WHERE t.txn_id = 999); </p>
<p class="calibre1">This statement contains a total of three case expressions : two of them (lines 5 and 13) are used to flip the sign on the transaction amount for debit transactions, and the third case expression (line 10) is used to check the funds availability date. If the date is in the future, then zero is added to the available balance; otherwise, the transaction amount is added. </p>
<p class="calibre1"><b class="calibre3">Handling Null Values</b></p>
<p class="calibre1">While null values are the appropriate thing to store in a table if the value for a column is unknown, it is not always appropriate to retrieve null values for display or to take part in expressions. For example, you might want to display the word  <i class="calibre4">unknown</i> on a data entry screen rather than leaving a field blank. When retrieving the data, you can use a case expression to substitute the string if the value is null, as in: SELECT emp_id, fname, lname, </p>
<p class="calibre1">CASE</p>
<p class="calibre1">WHEN title IS NULL THEN 'Unknown' </p>
<p class="calibre1">ELSE title</p>
<p class="calibre1">END</p>
<p class="calibre1">FROM employee; </p>
<p class="calibre1">For calculations, null values often cause a null result, as demonstrated by the following: mysql&gt; <b class="calibre3">SELECT (7 * 5) / ((3 + 14) * null); </b></p>
<p class="calibre1">+-----------------------------+</p>
<p class="calibre1">| (7 * 5) / ((3 + 14) * null) |</p>
<p class="calibre1">+-----------------------------+</p>
<p class="calibre1">|                        NULL |</p>
<p class="calibre1"><b class="calibre3">214 | Chapter 11:</b> <b class="calibre3">Conditional Logic</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-118"></a>+-----------------------------+</p>
<p class="calibre1">1 row in set (0.08 sec)</p>
<p class="calibre1">When performing calculations, case expressions are useful for translating a null value into a number (usually 0 or 1) that will allow the calculation to yield a non-null value. </p>
<p class="calibre1">If you are performing a calculation that includes the account.avail_balance column, for example, you could substitute a 0 (if doing addition or subtraction) or a 1 (if doing multiplication or division) for those accounts that have been established but haven’t yet been funded:</p>
<p class="calibre1">SELECT &lt;some calculation&gt; +</p>
<p class="calibre1">CASE</p>
<p class="calibre1">WHEN avail_balance IS NULL THEN 0</p>
<p class="calibre1">ELSE avail_balance</p>
<p class="calibre1">END</p>
<p class="calibre1">+ &lt;rest of calculation&gt; </p>
<p class="calibre1">... </p>
<p class="calibre1">If a numeric column is allowed to contain null values, it is generally a good idea to use conditional logic in any calculations that include the column so that the results are usable. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">Challenge your ability to work through conditional logic problems with the examples</p>
<p class="calibre1"><a href="#calibre_link-152">that follow. When you’re done, compare your solutions with those in Appendix C. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 11-1</b></p>
<p class="calibre1">Rewrite the following query, which uses a simple case expression, so that the same results are achieved using a searched case expression. Try to use as few when clauses as possible. </p>
<p class="calibre1">SELECT emp_id, </p>
<p class="calibre1">CASE title</p>
<p class="calibre1">WHEN 'President' THEN 'Management' </p>
<p class="calibre1">WHEN 'Vice President' THEN 'Management' </p>
<p class="calibre1">WHEN 'Treasurer' THEN 'Management' </p>
<p class="calibre1">WHEN 'Loan Manager' THEN 'Management' </p>
<p class="calibre1">WHEN 'Operations Manager' THEN 'Operations' </p>
<p class="calibre1">WHEN 'Head Teller' THEN 'Operations' </p>
<p class="calibre1">WHEN 'Teller' THEN 'Operations' </p>
<p class="calibre1">ELSE 'Unknown' </p>
<p class="calibre1">END</p>
<p class="calibre1">FROM employee; </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 215</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-248"></a><b class="calibre3">Exercise 11-2</b></p>
<p class="calibre1">Rewrite the following query so that the result set contains a single row with four columns (one for each branch). Name the four columns branch_1 through branch_4. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_branch_id, COUNT(*)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_branch_id; </b></p>
<p class="calibre1">+----------------+----------+</p>
<p class="calibre1">| open_branch_id | COUNT(*) |</p>
<p class="calibre1">+----------------+----------+</p>
<p class="calibre1">|              1 |        8 |</p>
<p class="calibre1">|              2 |        7 |</p>
<p class="calibre1">|              3 |        3 |</p>
<p class="calibre1">|              4 |        6 |</p>
<p class="calibre1">+----------------+----------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">216 | Chapter 11:</b> <b class="calibre3">Conditional Logic</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-119"></a><b class="calibre3">CHAPTER 12</b></p>
<p class="calibre1"><b class="calibre3">Transactions</b></p>
<p class="calibre1">All of the examples thus far in this book have been individual, independent SQL statements. While this may be the norm for ad hoc reporting or data maintenance scripts, application logic will frequently include multiple SQL statements that need to execute together as a logical unit of work. This chapter explores the need and the infrastructure necessary to execute multiple SQL statements concurrently. </p>
<p class="calibre1"><b class="calibre3">Multiuser Databases</b></p>
<p class="calibre1">Database management systems allow not only a single user to query and modify data, but multiple people to do so simultaneously. If every user is only executing queries, such as might be the case with a data warehouse during normal business hours, then there are very few issues for the database server to deal with. If some of the users are adding  and/or  modifying  data,  however,  the  server  must  handle  quite  a  bit  more bookkeeping. </p>
<p class="calibre1">Let’s say, for example, that you are running a report that shows the available balance for all the checking accounts opened at your branch. At the same time you are running the report, however, the following activities are occurring:</p>
<p class="calibre1">• A teller at your branch is handling a deposit for one of your customers. </p>
<p class="calibre1">• A customer is finishing a withdrawal at the ATM in the front lobby. </p>
<p class="calibre1">• The bank’s month-end application is applying interest to the accounts. </p>
<p class="calibre1">While your report is running, therefore, multiple users are modifying the underlying data, so what numbers should appear on the report? The answer depends somewhat on how your server handles  <i class="calibre4">locking</i>, which is described in the next section. </p>
<p class="calibre1"><b class="calibre3">Locking</b></p>
<p class="calibre1">Locks are the mechanism the database server uses to control simultaneous use of data resources. When some portion of the database is locked, any other users wishing to <b class="calibre3">217</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-120"></a>modify (or possibly read) that data must wait until the lock has been released. Most database servers use one of two locking strategies:</p>
<p class="calibre1">• Database writers must request and receive from the server a  <i class="calibre4">write lock</i> to modify data, and database readers must request and receive from the server a  <i class="calibre4">read lock</i> to query data. While multiple users can read data simultaneously, only one write lock is given out at a time for each table (or portion thereof), and read requests are blocked until the write lock is released. </p>
<p class="calibre1">• Database writers must request and receive from the server a write lock to modify data, but readers do not need any type of lock to query data. Instead, the server ensures that a reader sees a consistent view of the data (the data seems the same even though other users may be making modifications) from the time her query begins until her query has finished. This approach is known as  <i class="calibre4">versioning</i>. </p>
<p class="calibre1">There are pros and cons to both approaches. The first approach can lead to long wait times if there are many concurrent read and write requests, and the second approach can be problematic if there are long-running queries while data is being modified. Of the three servers discussed in this book, Microsoft SQL Server uses the first approach, Oracle Database uses the second approach, and MySQL uses both approaches (depending on your choice of  <i class="calibre4">storage engine</i>, which we’ll discuss a bit later in the chapter). </p>
<p class="calibre1"><b class="calibre3">Lock Granularities</b></p>
<p class="calibre1">There are also a number of different strategies that you may employ when deciding <i class="calibre4">how</i> to lock a resource. The server may apply a lock at one of three different levels, or <i class="calibre4">granularities</i>:</p>
<p class="calibre1"> <i class="calibre4">Table locks</i></p>
<p class="calibre1">Keep multiple users from modifying data in the same table simultaneously <i class="calibre4">Page locks</i></p>
<p class="calibre1">Keep multiple users from modifying data on the same page (a page is a segment of memory generally in the range of 2 KB to 16 KB) of a table simultaneously <i class="calibre4">Row locks</i></p>
<p class="calibre1">Keep multiple users from modifying the same row in a table simultaneously Again, there are pros and cons to these approaches. It takes very little bookkeeping to lock  entire  tables,  but  this  approach  quickly  yields  unacceptable  wait  times  as  the number  of  users  increases.  On  the  other  hand,  row  locking  takes  quite  a  bit  more bookkeeping, but it allows many users to modify the same table as long as they are interested in different rows. Of the three servers discussed in this book, Microsoft SQL</p>
<p class="calibre1">Server uses page, row, and table locking, Oracle Database uses only row locking, and MySQL uses table, page, or row locking (depending, again, on your choice of storage engine). SQL Server will, under certain circumstances,  <i class="calibre4">escalate</i> locks from row to page, and from page to table, whereas Oracle Database will never escalate locks. </p>
<p class="calibre1"><b class="calibre3">218 | Chapter 12:</b> <b class="calibre3">Transactions</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-121"></a>To get back to your report, the data that appears on the pages of the report will mirror either the state of the database when your report started (if your server uses a versioning approach) or the state of the database when the server issues the reporting application a read lock (if your server uses both read and write locks). </p>
<p class="calibre1"><b class="calibre3">What Is a Transaction? </b></p>
<p class="calibre1">If database servers enjoyed 100% uptime, if users always allowed programs to finish executing, and if applications always completed without encountering fatal errors that halt execution, then there would be nothing left to discuss regarding concurrent database access. However, we can rely on none of these things, so one more element is necessary to allow multiple users to access the same data. </p>
<p class="calibre1">This  extra  piece  of  the  concurrency  puzzle  is  the   <i class="calibre4">transaction</i>,  which  is  a  device  for grouping together multiple SQL statements such that either  <i class="calibre4">all</i> or  <i class="calibre4">none</i> of the statements succeed (a property known as  <i class="calibre4">atomicity</i>). If you attempt to transfer $500 from your savings account to your checking account, you would be a bit upset if the money were successfully withdrawn from your savings account but never made it to your checking account. Whatever the reason for the failure (the server was shut down for maintenance, the request for a page lock on the account table timed out, etc.), you want your $500</p>
<p class="calibre1">back. </p>
<p class="calibre1">To protect against this kind of error, the program that handles your transfer request would first begin a transaction, then issue the SQL statements needed to move the money from your savings to your checking account, and, if everything succeeds, end the transaction by issuing the commit command. If something unexpected happens, however, the program would issue a rollback command, which instructs the server to undo  all  changes  made  since  the  transaction  began.  The  entire  process  might  look something like the following:</p>
<p class="calibre1">START TRANSACTION; </p>
<p class="calibre1">/* withdraw money from first account, making sure balance is sufficient */</p>
<p class="calibre1">UPDATE account SET avail_balance = avail_balance - 500</p>
<p class="calibre1">WHERE account_id = 9988</p>
<p class="calibre1">AND avail_balance &gt; 500; </p>
<p class="calibre1">IF &lt;exactly one row was updated by the previous statement&gt; THEN</p>
<p class="calibre1">/* deposit money into second account */</p>
<p class="calibre1">UPDATE account SET avail_balance = avail_balance + 500</p>
<p class="calibre1">WHERE account_id = 9989; </p>
<p class="calibre1">IF &lt;exactly one row was updated by the previous statement&gt; THEN</p>
<p class="calibre1">/* everything worked, make the changes permanent */</p>
<p class="calibre1">COMMIT; </p>
<p class="calibre1">ELSE</p>
<p class="calibre1">/* something went wrong, undo all changes in this transaction */</p>
<p class="calibre1">ROLLBACK; </p>
<p class="calibre1">END IF; </p>
<p class="calibre1"><b class="calibre3">What Is a Transaction? | 219</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-122"></a><img src="images/000028.png" alt="Image 41" class="calibre2" /></p>
<p class="calibre1">ELSE</p>
<p class="calibre1">/* insufficient funds, or error encountered during update */</p>
<p class="calibre1">ROLLBACK; </p>
<p class="calibre1">END IF; </p>
<p class="calibre1">While the previous code block may look similar to one of the procedural languages provided by the major database companies, such as Oracle’s PL/SQL or Microsoft’s Transact-SQL, it is written in pseudocode and does not attempt to mimic any particular language. </p>
<p class="calibre1">The previous code block begins by starting a transaction and then attempts to remove $500 from the checking account and add it to the savings account. If all goes well, the transaction is committed; if anything goes awry, however, the transaction is rolled back, meaning that all data changes since the beginning of the transaction are undone. </p>
<p class="calibre1">By using a transaction, the program ensures that your $500 either stays in your savings account or moves to your checking account, without the possibility of it falling into a crack. Regardless of whether the transaction was committed or was rolled back, all resources acquired (e.g., write locks) during the execution of the transaction are released when the transaction completes. </p>
<p class="calibre1">Of course, if the program manages to complete both update statements but the server shuts down before a commit or rollback can be executed, then the transaction will be rolled back when the server comes back online. (One of the tasks that a database server must complete before coming online is to find any incomplete transactions that were underway when the server shut down and to roll them back.) Additionally, if your program finishes a transaction and issues a commit, but the server shuts down before the changes have been applied to permanent storage (i.e., the modified data is sitting in memory but has not been flushed to disk), then the database server must reapply the changes  from  your  transaction  when  the  server  is  restarted  (a  property  known  as <i class="calibre4">durability</i>). </p>
<p class="calibre1"><b class="calibre3">Starting a Transaction</b></p>
<p class="calibre1">Database servers handle transaction creation in one of two ways:</p>
<p class="calibre1">• An active transaction is always associated with a database session, so there is no need or method to explicitly begin a transaction. When the current transaction ends, the server automatically begins a new transaction for your session. </p>
<p class="calibre1">• Unless you explicitly begin a transaction, individual SQL statements are automatically committed independently of one another. To begin a transaction, you must first issue a command. </p>
<p class="calibre1">Of the three servers, Oracle Database takes the first approach, while Microsoft SQL</p>
<p class="calibre1">Server and MySQL take the second approach. One of the advantages of Oracle’s approach to transactions is that, even if you are issuing only a single SQL command, you <b class="calibre3">220 | Chapter 12:</b> <b class="calibre3">Transactions</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-123"></a><img src="images/000029.png" alt="Image 42" class="calibre2" /></p>
<p class="calibre1">have the ability to roll back the changes if you don’t like the outcome or if you change your mind. Thus, if you forget to add a where clause to your delete statement, you will have the opportunity to undo the damage (assuming you’ve had your morning coffee and realize that you didn’t mean to delete all 125,000 rows in your table). With MySQL</p>
<p class="calibre1">and SQL Server, however, once you press the Enter key, the changes brought about by your SQL statement will be permanent (unless your DBA can retrieve the original data from a backup or from some other means). </p>
<p class="calibre1">The SQL:2003 standard includes a start transaction command to be used when you want to explicitly begin a transaction. While MySQL conforms to the standard, SQL</p>
<p class="calibre1">Server users must instead issue the command begin transaction. With both servers, until  you  explicitly  begin  a  transaction,  you  are  in  what  is  known  as   <i class="calibre4">auto-commit</i> <i class="calibre4">mode</i>,  which  means  that  individual  statements  are  automatically  committed  by  the server. You can, therefore, decide that you want to be in a transaction and issue a start/</p>
<p class="calibre1">begin  transaction  command,  or  you  can  simply  let  the  server  commit  individual statements. </p>
<p class="calibre1">Both MySQL and SQL Server allow you to turn off auto-commit mode for individual sessions, in which case, the servers will act just like Oracle Database regarding transactions. With SQL Server, you issue the following command to disable auto-commit mode:</p>
<p class="calibre1">SET IMPLICIT_TRANSACTIONS ON</p>
<p class="calibre1">MySQL allows you to disable auto-commit mode via the following: SET AUTOCOMMIT=0</p>
<p class="calibre1">Once you have left auto-commit mode, all SQL commands take place within the scope of a transaction and must be explicitly committed or rolled back. </p>
<p class="calibre1">A word of advice: shut off auto-commit mode each time you log in, and get in the habit of running all of your SQL statements within a transaction. If nothing else, it may save you the embarrassment of having to ask your DBA to reconstruct data that you have inadvertently deleted. </p>
<p class="calibre1"><b class="calibre3">Ending a Transaction</b></p>
<p class="calibre1">Once a transaction has begun, whether explicitly via the start transaction command or implicitly by the database server, you must explicitly end your transaction for your changes to become permanent. You do this by way of the commit command, which instructs the server to mark the changes as permanent and release any resources (i.e., page or row locks) used during the transaction. </p>
<p class="calibre1">If you decide that you want to undo all the changes made since starting the transaction, you must issue the rollback command, which instructs the server to return the data to its pretransaction state. After the rollback has been completed, any resources used by your session are released. </p>
<p class="calibre1"><b class="calibre3">What Is a Transaction? | 221</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-185"></a>Along  with  issuing  either  the  commit  or  rollback  command,  there  are  several  other scenarios by which your transaction can end, either as an indirect result of your actions or as a result of something outside your control:</p>
<p class="calibre1">• The server shuts down, in which case, your transaction will be rolled back automatically when the server is restarted. </p>
<p class="calibre1">• You issue an SQL schema statement, such as alter table, which will cause the current transaction to be committed and a new transaction to be started. </p>
<p class="calibre1">• You issue another start transaction command, which will cause the previous transaction to be committed. </p>
<p class="calibre1">• The server prematurely ends your transaction because the server detects a  <i class="calibre4">deadlock</i> and decides that your transaction is the culprit. In this case, the transaction will be rolled back and you will receive an error message. </p>
<p class="calibre1">Of these four scenarios, the first and third are fairly straightforward, but the other two merit  some  discussion.  As  far  as  the  second  scenario  is  concerned,  alterations  to  a database, whether it be the addition of a new table or index or the removal of a column from a table, cannot be rolled back, so commands that alter your schema must take place outside a transaction. If a transaction is currently underway, therefore, the server will commit your current transaction, execute the SQL schema statement command(s), and then automatically start a new transaction for your session. The server will not inform you of what has happened, so you should be careful that the statements that comprise a unit of work are not inadvertently broken up into multiple transactions by the server. </p>
<p class="calibre1">The fourth scenario deals with deadlock detection. A deadlock occurs when two different transactions are waiting for resources that the other transaction currently holds. </p>
<p class="calibre1">For example, transaction A might have just updated the account table and is waiting for a write lock on the transaction table, while transaction B has inserted a row into the transaction table and is waiting for a write lock on the account table. If both transactions happen to be modifying the same page or row (depending on the lock granularity  in  use  by  the  database  server),  then  they  will  each  wait  forever  for  the  other transaction to finish and free up the needed resource. Database servers must always be on the lookout for these situations so that throughput doesn’t grind to a halt; when a deadlock is detected, one of the transactions is chosen (either arbitrarily or by some criteria) to be rolled back so that the other transaction may proceed. Most of the time, the  terminated  transaction  can  be  restarted  and  will  succeed  without  encountering another deadlock situation. </p>
<p class="calibre1">Unlike the second scenario discussed earlier, the database server will raise an error to inform you that your transaction has been rolled back due to deadlock detection. With MySQL,  for  example,  you  will  receive  error  #1213,  which  carries  the  following message:</p>
<p class="calibre1">Message: Deadlock found when trying to get lock; try restarting transaction <b class="calibre3">222 | Chapter 12:</b> <b class="calibre3">Transactions</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-124"></a>As the error message suggests, it is a reasonable practice to retry a transaction that has been rolled back due to deadlock detection. However, if deadlocks become fairly common, then you may need to modify the applications that access the database to decrease the probability of deadlocks (one common strategy is to ensure that data resources are always accessed in the same order, such as always modifying account data before inserting transaction data). </p>
<p class="calibre1"><b class="calibre3">Transaction Savepoints</b></p>
<p class="calibre1">In some cases, you may encounter an issue within a transaction that requires a rollback, but you may not want to undo  <i class="calibre4">all</i> of the work that has transpired. For these situations, you can establish one or more  <i class="calibre4">savepoints</i> within a transaction and use them to roll back to a particular location within your transaction rather than rolling all the way back to the start of the transaction. </p>
<p class="calibre1"><b class="calibre3">Choosing a Storage Engine</b></p>
<p class="calibre1">When using Oracle Database or Microsoft SQL Server, a single set of code is responsible for low-level database operations, such as retrieving a particular row from a table based on primary key value. The MySQL server, however, has been designed so that multiple storage engines may be utilized to provide low-level database functionality, including resource locking and transaction management. As of version 6.0, MySQL includes the following storage engines:</p>
<p class="calibre1"> <i class="calibre4">MyISAM</i></p>
<p class="calibre1">A nontransactional engine employing table locking</p>
<p class="calibre1"> <i class="calibre4">MEMORY</i></p>
<p class="calibre1">A nontransactional engine used for in-memory tables</p>
<p class="calibre1"> <i class="calibre4">BDB</i></p>
<p class="calibre1">A transactional engine employing page-level locking</p>
<p class="calibre1"> <i class="calibre4">InnoDB</i></p>
<p class="calibre1">A transactional engine employing row-level locking</p>
<p class="calibre1"> <i class="calibre4">Merge</i></p>
<p class="calibre1">A specialty engine used to make multiple identical MyISAM tables appear as a single table (a.k.a. table partitioning)</p>
<p class="calibre1"> <i class="calibre4">Maria</i></p>
<p class="calibre1">A  MyISAM  replacement  included  in  version  6.0.6  that  adds  full  recovery capabilities</p>
<p class="calibre1"> <i class="calibre4">Falcon</i></p>
<p class="calibre1">A new (as of 6.0.4) high-performance transactional engine employing row-level locking</p>
<p class="calibre1"> <i class="calibre4">Archive</i></p>
<p class="calibre1">A specialty engine used to store large amounts of unindexed data, mainly for ar-chival purposes</p>
<p class="calibre1"><b class="calibre3">What Is a Transaction? | 223</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-175"></a>Although you might think that you would be forced to choose a single storage engine for your database, MySQL is flexible enough to allow you to choose a storage engine on a table-by-table basis. For any tables that might take part in transactions, however, you should choose the InnoDB or Falcon storage engine, which uses row-level locking and versioning to provide the highest level of concurrency across the different storage engines. </p>
<p class="calibre1">You may explicitly specify a storage engine when creating a table, or you can change an existing table to use a different engine. If you do not know what engine is assigned to a table, you can use the show table command, as demonstrated by the following: mysql&gt; SHOW TABLE STATUS LIKE 'transaction' \G</p>
<p class="calibre1">*************************** 1. row ***************************</p>
<p class="calibre1">Name: transaction</p>
<p class="calibre1">Engine: InnoDB</p>
<p class="calibre1">Version: 10</p>
<p class="calibre1">Row_format: Compact</p>
<p class="calibre1">Rows: 21</p>
<p class="calibre1">Avg_row_length: 780</p>
<p class="calibre1">Data_length: 16384</p>
<p class="calibre1">Max_data_length: 0</p>
<p class="calibre1">Index_length: 49152</p>
<p class="calibre1">Data_free: 0</p>
<p class="calibre1">Auto_increment: 22</p>
<p class="calibre1">Create_time: 2008-02-19 23:24:36</p>
<p class="calibre1">Update_time: NULL</p>
<p class="calibre1">Check_time: NULL</p>
<p class="calibre1">Collation: latin1_swedish_ci</p>
<p class="calibre1">Checksum: NULL</p>
<p class="calibre1">Create_options:</p>
<p class="calibre1">Comment:</p>
<p class="calibre1">1 row in set (1.46 sec)</p>
<p class="calibre1">Looking at the second item, you can see that the transaction table is already using the InnoDB engine. If it were not, you could assign the InnoDB engine to the transaction table via the following command:</p>
<p class="calibre1">ALTER TABLE transaction ENGINE = INNODB; </p>
<p class="calibre1">All savepoints must be given a name, which allows you to have multiple savepoints within a single transaction. To create a savepoint named my_savepoint, you can do the following:</p>
<p class="calibre1">SAVEPOINT my_savepoint; </p>
<p class="calibre1">To roll back to a particular savepoint, you simply issue the rollback command followed by the keywords to savepoint and the name of the savepoint, as in: ROLLBACK TO SAVEPOINT my_savepoint; </p>
<p class="calibre1">Here’s an example of how savepoints may be used:</p>
<p class="calibre1">START TRANSACTION; </p>
<p class="calibre1">UPDATE product</p>
<p class="calibre1">SET date_retired = CURRENT_TIMESTAMP()</p>
<p class="calibre1"><b class="calibre3">224 | Chapter 12:</b> <b class="calibre3">Transactions</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-125"></a>WHERE product_cd = 'XYZ'; </p>
<p class="calibre1">SAVEPOINT before_close_accounts; </p>
<p class="calibre1">UPDATE account</p>
<p class="calibre1">SET status = 'CLOSED', close_date = CURRENT_TIMESTAMP(), </p>
<p class="calibre1">last_activity_date = CURRENT_TIMESTAMP()</p>
<p class="calibre1">WHERE product_cd = 'XYZ'; </p>
<p class="calibre1">ROLLBACK TO SAVEPOINT before_close_accounts; </p>
<p class="calibre1">COMMIT; </p>
<p class="calibre1">The net effect of this transaction is that the mythical XYZ product is retired but none of the accounts are closed. </p>
<p class="calibre1">When using savepoints, remember the following:</p>
<p class="calibre1">• Despite the name, nothing is saved when you create a savepoint. You must even-tually issue a commit if you want your transaction to be made permanent. </p>
<p class="calibre1">• If you issue a rollback without naming a savepoint, all savepoints within the transaction will be ignored and the entire transaction will be undone. </p>
<p class="calibre1">If  you  are  using  SQL  Server,  you  will  need  to  use  the  proprietary  command  save transaction to create a savepoint and rollback transaction to roll back to a savepoint, with each command being followed by the savepoint name. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">Test your understanding of transactions by working through the following exercise. </p>
<p class="calibre1"><a href="#calibre_link-152">When you’re done, compare your solution with that in Appendix C. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 12-1</b></p>
<p class="calibre1">Generate a transaction to transfer $50 from Frank Tucker’s money market account to his checking account. You will need to insert two rows into the transaction table and update two rows in the account table. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 225</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-313"></a>D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-126"></a><b class="calibre3">CHAPTER 13</b></p>
<p class="calibre1"><b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">Because the focus of this book is on programming techniques, the first 12 chapters concentrated  on  elements  of  the  SQL  language  that  you  can  use  to  craft  powerful select, insert, update, and delete statements. However, other database features  <i class="calibre4">indirectly</i> affect the code you write. This chapter focuses on two of those features: indexes and constraints. </p>
<p class="calibre1"><b class="calibre3">Indexes</b></p>
<p class="calibre1">When you insert a row into a table, the database server does not attempt to put the data in any particular location within the table. For example, if you add a row to the department table, the server doesn’t place the row in numeric order via the dept_id column or in alphabetical order via the name column. Instead, the server simply places the data in the next available location within the file (the server maintains a list of free space for each table). When you query the department table, therefore, the server will need to inspect every row of the table to answer the query. For example, let’s say that you issue the following query:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT dept_id, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM department</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE name LIKE 'A%'; </b></p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">| dept_id | name           |</p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">|       3 | Administration |</p>
<p class="calibre1">+---------+----------------+</p>
<p class="calibre1">1 row in set (0.03 sec)</p>
<p class="calibre1">To find all departments whose name begins with  <i class="calibre4">A</i>, the server must visit each row in the department table and inspect the contents of the name column; if the department name begins with  <i class="calibre4">A</i>, then the row is added to the result set. This type of access is known as a  <i class="calibre4">table scan</i>. </p>
<p class="calibre1"><b class="calibre3">227</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-127"></a>While this method works fine for a table with only three rows, imagine how long it might take to answer the query if the table contains 3 million rows. At some number of rows larger than three and smaller than 3 million, a line is crossed where the server cannot answer the query within a reasonable amount of time without additional help. </p>
<p class="calibre1">This help comes in the form of one or more  <i class="calibre4">indexes</i> on the department table. </p>
<p class="calibre1">Even if you have never heard of a database index, you are certainly aware of what an index is (e.g., this book has one). An index is simply a mechanism for finding a specific item within a resource. Each technical publication, for example, includes an index at the end that allows you to locate a specific word or phrase within the publication. The index lists these words and phrases in alphabetical order, allowing the reader to move quickly to a particular letter within the index, find the desired entry, and then find the page or pages on which the word or phrase may be found. </p>
<p class="calibre1">In the same way that a person uses an index to find words within a publication, a database server uses indexes to locate rows in a table. Indexes are special tables that, unlike normal data tables,  <i class="calibre4">are</i> kept in a specific order. Instead of containing  <i class="calibre4">all</i> of the data about an entity, however, an index contains only the column (or columns) used to locate rows in the data table, along with information describing where the rows are physically located. Therefore, the role of indexes is to facilitate the retrieval of a subset of a table’s rows and columns  <i class="calibre4">without</i> the need to inspect every row in the table. </p>
<p class="calibre1"><b class="calibre3">Index Creation</b></p>
<p class="calibre1">Returning to the department table, you might decide to add an index on the name column to speed up any queries that specify a full or partial department name, as well as any update or delete operations that specify a department name. Here’s how you can add such an index to a MySQL database:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">ALTER TABLE department</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ADD INDEX dept_name_idx (name); </b></p>
<p class="calibre1">Query OK, 3 rows affected (0.08 sec)</p>
<p class="calibre1">Records: 3  Duplicates: 0  Warnings: 0</p>
<p class="calibre1">This statement creates an index (a B-tree index to be precise, but more on this shortly) on  the  department.name  column;  furthermore,  the  index  is  given  the  name dept_name_idx. With the index in place, the query optimizer (which we discussed in</p>
<p class="calibre1"><a href="#calibre_link-25">Chapter 3) </a>can choose to use the index if it is deemed beneficial to do so (with only three rows in the department table, for example, the optimizer might very well choose to ignore the index and read the entire table). If there is more than one index on a table, the optimizer must decide which index will be the most beneficial for a particular SQL</p>
<p class="calibre1">statement. </p>
<p class="calibre1"><b class="calibre3">228 | Chapter 13:</b> <b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-174"></a><img src="images/000030.png" alt="Image 43" class="calibre2" /></p>
<p class="calibre1">MySQL treats indexes as optional components of a table, which is why you must use the alter table command to add or remove an index. </p>
<p class="calibre1">Other  database  servers,  including  SQL  Server  and  Oracle  Database, treat indexes as independent schema objects. For both SQL Server and Oracle,  therefore,  you  would  generate  an  index  using  the  create index command, as in:</p>
<p class="calibre1">CREATE INDEX dept_name_idx</p>
<p class="calibre1">ON department (name); </p>
<p class="calibre1">As  of  MySQL  version  5.0,  a  create index  command  is  available,  although it is mapped to the alter table command. </p>
<p class="calibre1">All database servers allow you to look at the available indexes. MySQL users can use the show command to see all of the indexes on a specific table, as in: mysql&gt; <b class="calibre3">SHOW INDEX FROM department \G</b> *************************** 1. row </p>
<p class="calibre1">*************************** 1. row ***************************</p>
<p class="calibre1">Table: department</p>
<p class="calibre1">Non_unique: 0</p>
<p class="calibre1">Key_name: PRIMARY</p>
<p class="calibre1">Seq_in_index: 1</p>
<p class="calibre1">Column_name: dept_id</p>
<p class="calibre1">Collation: A</p>
<p class="calibre1">Cardinality: 3</p>
<p class="calibre1">Sub_part: NULL</p>
<p class="calibre1">Packed: NULL</p>
<p class="calibre1">Null:</p>
<p class="calibre1">Index_type: BTREE</p>
<p class="calibre1">Comment:</p>
<p class="calibre1">Index_Comment:</p>
<p class="calibre1">*************************** 2. row ***************************</p>
<p class="calibre1">Table: department</p>
<p class="calibre1">Non_unique: 1</p>
<p class="calibre1">Key_name: dept_name_idx</p>
<p class="calibre1">Seq_in_index: 1</p>
<p class="calibre1">Column_name: name</p>
<p class="calibre1">Collation: A</p>
<p class="calibre1">Cardinality: 3</p>
<p class="calibre1">Sub_part: NULL</p>
<p class="calibre1">Packed: NULL</p>
<p class="calibre1">Null:</p>
<p class="calibre1">Index_type: BTREE</p>
<p class="calibre1">Comment:</p>
<p class="calibre1">Index_Comment:</p>
<p class="calibre1">2 rows in set (0.01 sec)</p>
<p class="calibre1">The  output  shows  that  there  are  two  indexes  on  the  department  table:  one  on  the dept_id  column  called  PRIMARY,  and  the  other  on  the  name  column  called dept_name_idx. Since I have created only one index so far (dept_name_idx), you might be wondering where the other came from; when the department table was created, the <b class="calibre3">Indexes | 229</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-196"></a><img src="images/000031.png" alt="Image 44" class="calibre2" /></p>
<p class="calibre1">create table statement included a constraint naming the dept_id column as the primary key for the table. Here’s the statement used to create the table: CREATE TABLE department</p>
<p class="calibre1">(dept_id SMALLINT UNSIGNED NOT NULL AUTO_INCREMENT, </p>
<p class="calibre1">name VARCHAR(20) NOT NULL, </p>
<p class="calibre1"><b class="calibre3">CONSTRAINT pk_department PRIMARY KEY (dept_id)</b>  ); </p>
<p class="calibre1">When the table was created, the MySQL server automatically generated an index on the primary key column, which, in this case, is dept_id, and gave the index the name PRIMARY. I cover constraints later in this chapter. </p>
<p class="calibre1">If, after creating an index, you decide that the index is not proving useful, you can remove it via the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">ALTER TABLE department</b></p>
<p class="calibre1">-&gt; <b class="calibre3">DROP INDEX dept_name_idx; </b></p>
<p class="calibre1">Query OK, 3 rows affected (0.02 sec)</p>
<p class="calibre1">Records: 3  Duplicates: 0  Warnings: 0</p>
<p class="calibre1">SQL Server and Oracle Database users must use the drop index command to remove an index, as in:</p>
<p class="calibre1">DROP INDEX dept_name_idx; (Oracle)</p>
<p class="calibre1">DROP INDEX dept_name_idx ON department (SQL Server)</p>
<p class="calibre1">MySQL now also supports a drop index command. </p>
<p class="calibre1"><b class="calibre3">Unique indexes</b></p>
<p class="calibre1">When designing a database, it is important to consider which columns are allowed to contain duplicate data and which are not. For example, it is allowable to have two customers named John Smith in the individual table since each row will have a different identifier (cust_id), birth date, and tax number (customer.fed_id) to help tell them apart. You would not, however, want to allow two departments with the same name in the department table. You can enforce a rule against duplicate department names by creating a  <i class="calibre4">unique index</i> on the department.name column. </p>
<p class="calibre1">A unique index plays multiple roles in that, along with providing all the benefits of a regular index, it also serves as a mechanism for disallowing duplicate values in the indexed column. Whenever a row is inserted or when the indexed column is modified, the database server checks the unique index to see whether the value already exists in another  row  in  the  table.  Here’s  how  you  would  create  a  unique  index  on  the department.name column:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">ALTER TABLE department</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ADD UNIQUE dept_name_idx (name); </b></p>
<p class="calibre1">Query OK, 3 rows affected (0.04 sec)</p>
<p class="calibre1">Records: 3  Duplicates: 0  Warnings: 0</p>
<p class="calibre1"><b class="calibre3">230 | Chapter 13:</b> <b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-128"></a><img src="images/000032.png" alt="Image 45" class="calibre2" /></p>
<p class="calibre1">SQL Server and Oracle Database users need only add the unique keyword when creating an index, as in:</p>
<p class="calibre1">CREATE UNIQUE INDEX dept_name_idx</p>
<p class="calibre1">ON department (name); </p>
<p class="calibre1">With the index in place, you will receive an error if you try to add another department with the name 'Operations':</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO department (dept_id, name)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (999, 'Operations'); </b></p>
<p class="calibre1">ERROR 1062 (23000): Duplicate entry 'Operations' for key 'dept_name_idx' </p>
<p class="calibre1">You should not build unique indexes on your primary key column(s), since the server already checks uniqueness for primary key values. You may, however, create more than one unique index on the same table if you feel that it is warranted. </p>
<p class="calibre1"><b class="calibre3">Multicolumn indexes</b></p>
<p class="calibre1">Along with the single-column indexes demonstrated thus far, you may build indexes that span multiple columns. If, for example, you find yourself searching for employees by first  <i class="calibre4">and</i> last names, you can build an index on  <i class="calibre4">both</i> columns together, as in: mysql&gt; <b class="calibre3">ALTER TABLE employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ADD INDEX emp_names_idx (lname, fname); </b></p>
<p class="calibre1">Query OK, 18 rows affected (0.10 sec)</p>
<p class="calibre1">Records: 18  Duplicates: 0  Warnings: 0</p>
<p class="calibre1">This index will be useful for queries that specify the first and last names or just the last name, but you cannot use it for queries that specify only the employee’s first name. To understand why, consider how you would find a person’s phone number; if you know the person’s first and last names, you can use a phone book to find the number quickly, since a phone book is organized by last name and then by first name. If you know only the person’s first name, you would need to scan every entry in the phone book to find all the entries with the specified first name. </p>
<p class="calibre1">When building multiple-column indexes, therefore, you should think carefully about which column to list first, which column to list second, and so on so that the index is as useful as possible. Keep in mind, however, that there is nothing stopping you from building multiple indexes using the same set of columns but in a different order if you feel that it is needed to ensure adequate response time. </p>
<p class="calibre1"><b class="calibre3">Types of Indexes</b></p>
<p class="calibre1">Indexing is a powerful tool, but since there are many different types of data, a single indexing strategy doesn’t always do the job. The following sections illustrate the different types of indexing available from various servers. </p>
<p class="calibre1"><b class="calibre3">Indexes | 231</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-165"></a><b class="calibre3">B-tree indexes</b></p>
<p class="calibre1">All the indexes shown thus far are  <i class="calibre4">balanced-tree indexes</i>, which are more commonly known as  <i class="calibre4">B-tree indexes</i>. MySQL, Oracle Database, and SQL Server all default to B-tree indexing, so you will get a B-tree index unless you explicitly ask for another type. </p>
<p class="calibre1">As you might expect, B-tree indexes are organized as trees, with one or more levels of <i class="calibre4">branch nodes</i> leading to a single level of  <i class="calibre4">leaf nodes</i>. Branch nodes are used for navigating the tree, while leaf nodes hold the actual values and location information. For example, a  B-tree  index  built  on  the  employee.lname  column  might  look  something  like  <a href="#calibre_link-165">Fig-</a></p>
<p class="calibre1"><a href="#calibre_link-165">ure 13-1. </a></p>
<p class="calibre1">A - M</p>
<p class="calibre1">N - Z</p>
<p class="calibre1">A - C</p>
<p class="calibre1">N - P</p>
<p class="calibre1">D - F</p>
<p class="calibre1">Q - S</p>
<p class="calibre1">G - I</p>
<p class="calibre1">T - V</p>
<p class="calibre1">J - M</p>
<p class="calibre1">W - Z</p>
<p class="calibre1">Gooding</p>
<p class="calibre1">Jameson</p>
<p class="calibre1">Tucker</p>
<p class="calibre1">Barker</p>
<p class="calibre1">Fleming</p>
<p class="calibre1">Parker</p>
<p class="calibre1">Roberts</p>
<p class="calibre1">Grossman</p>
<p class="calibre1">Markham</p>
<p class="calibre1">Tulman</p>
<p class="calibre1">Ziegler</p>
<p class="calibre1">Blake</p>
<p class="calibre1">Fowler</p>
<p class="calibre1">Portman</p>
<p class="calibre1">Smith</p>
<p class="calibre1">Hawthorne</p>
<p class="calibre1">Mason</p>
<p class="calibre1">Tyler</p>
<p class="calibre1"> <i class="calibre4">Figure 13-1. B-tree example</i></p>
<p class="calibre1">If you were to issue a query to retrieve all employees whose last name starts with  <i class="calibre4">G</i>, the server would look at the top branch node (called the  <i class="calibre4">root node</i>) and follow the link to the branch node that handles last names beginning with  <i class="calibre4">A</i> through  <i class="calibre4">M</i>. This branch node would, in turn, direct the server to a leaf node containing last names beginning with  <i class="calibre4">G</i> through  <i class="calibre4">I</i>. The server then starts reading the values in the leaf node until it encounters a value that doesn’t begin with  <i class="calibre4">G</i> (which, in this case, is 'Hawthorne'). </p>
<p class="calibre1">As rows are inserted, updated, and deleted from the  employee table, the server will attempt to keep the tree balanced so that there aren’t far more branch/leaf nodes on one side of the root node than the other. The server can add or remove branch nodes to redistribute the values more evenly and can even add or remove an entire level of branch nodes. By keeping the tree balanced, the server is able to traverse quickly to the leaf nodes to find the desired values without having to navigate through many levels of branch nodes. </p>
<p class="calibre1"><b class="calibre3">232 | Chapter 13:</b> <b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-166"></a><b class="calibre3">Bitmap indexes</b></p>
<p class="calibre1">Although B-tree indexes are great at handling columns that contain many different values, such as a customer’s first/last names, they can become unwieldy when built on a column that allows only a small number of values. For example, you may decide to generate an index on the account.product_cd column so that you can quickly retrieve all accounts of a specific type (e.g., checking, savings). Because there are only eight different products, however, and because some products are far more popular than others, it can be difficult to maintain a balanced B-tree index as the number of accounts grows. </p>
<p class="calibre1">For columns that contain only a small number of values across a large number of rows (known as  <i class="calibre4">low-cardinality</i> data), a different indexing strategy is needed. To handle this situation more efficiently, Oracle Database includes  <i class="calibre4">bitmap indexes</i>, which generate a bitmap for each value stored in the column. <a href="#calibre_link-166">Figure 13-2 </a>shows what a bitmap index might look like for data in the account.product_cd column. </p>
<p class="calibre1">Value/row</p>
<p class="calibre1">1</p>
<p class="calibre1">2</p>
<p class="calibre1">3</p>
<p class="calibre1">4</p>
<p class="calibre1">5</p>
<p class="calibre1">6</p>
<p class="calibre1">7</p>
<p class="calibre1">8</p>
<p class="calibre1">9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24</p>
<p class="calibre1">BUS</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">CD</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">CHK</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">MM</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">SAV</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">SBL</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">0</p>
<p class="calibre1">1</p>
<p class="calibre1"> <i class="calibre4">Figure 13-2. Bitmap example</i></p>
<p class="calibre1">The index contains six bitmaps, one for each value in the product_cd column (two of the eight available products are not being used), and each bitmap includes a 0/1 value for each of the 24 rows in the account table. Thus, if you ask the server to retrieve all money market accounts (product_cd = 'MM'), the server simply finds all the 1 values in the MM bitmap and returns rows 7, 10, and 18. The server can also combine bitmaps if you are looking for multiple values; for example, if you want to retrieve all money market  <i class="calibre4">and</i> savings accounts (product_cd = 'MM' or product_cd = 'SAV'), the server can perform an OR operation on the MM and SAV bitmaps and return rows 2, 5, 7, 9, 10, 16, and 18. </p>
<p class="calibre1">Bitmap indexes are a nice, compact indexing solution for low-cardinality data, but this indexing strategy breaks down if the number of values stored in the column climbs too high in relation to the number of rows (known as  <i class="calibre4">high-cardinality</i> data), since the server would need to maintain too many bitmaps. For example, you would never build a <b class="calibre3">Indexes | 233</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-129"></a>bitmap index on your primary key column, since this represents the highest possible cardinality (a different value for every row). </p>
<p class="calibre1">Oracle users can generate bitmap indexes by simply adding the bitmap keyword to the create index statement, as in:</p>
<p class="calibre1">CREATE BITMAP INDEX acc_prod_idx ON account (product_cd); </p>
<p class="calibre1">Bitmap indexes are commonly used in data warehousing environments, where large amounts of data are generally indexed on columns containing relatively few values (e.g., sales quarters, geographic regions, products, salespeople). </p>
<p class="calibre1"><b class="calibre3">Text indexes</b></p>
<p class="calibre1">If your database stores documents, you may need to allow users to search for words or phrases in the documents. You certainly don’t want the server to open each document and scan for the desired text each time a search is requested, but traditional indexing strategies don’t work for this situation. To handle this situation, MySQL, SQL Server, and Oracle Database include specialized indexing and search mechanisms for documents;  both  SQL  Server  and  MySQL  include  what  they  call   <i class="calibre4">full-text</i>  indexes  (for MySQL,  full-text  indexes  are  available  only  with  its  MyISAM  storage  engine),  and Oracle Database includes a powerful set of tools known as  <i class="calibre4">Oracle Text</i>. Document searches are specialized enough that I refrain from showing an example, but I wanted you to at least know what is available. </p>
<p class="calibre1"><b class="calibre3">How Indexes Are Used</b></p>
<p class="calibre1">Indexes are generally used by the server to quickly locate rows in a particular table, after which the server visits the associated table to extract the additional information requested by the user. Consider the following query:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE emp_id IN (1, 3, 9, 15); </b></p>
<p class="calibre1">+--------+---------+----------+</p>
<p class="calibre1">| emp_id | fname   | lname    |</p>
<p class="calibre1">+--------+---------+----------+</p>
<p class="calibre1">|      1 | Michael | Smith    |</p>
<p class="calibre1">|      3 | Robert  | Tyler    |</p>
<p class="calibre1">|      9 | Jane    | Grossman |</p>
<p class="calibre1">|     15 | Frank   | Portman  |</p>
<p class="calibre1">+--------+---------+----------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">For this query, the server can use the primary key index on the emp_id column to locate employee IDs 1, 3, 9, and 15 in the employee table, and then visit each of the four rows to retrieve the first and last name columns. </p>
<p class="calibre1"><b class="calibre3">234 | Chapter 13:</b> <b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-314"></a><img src="images/000034.png" alt="Image 46" class="calibre2" /></p>
<p class="calibre1">If the index contains everything needed to satisfy the query, however, the server doesn’t need to visit the associated table. To illustrate, let’s look at how the query optimizer approaches the same query with different indexes in place. </p>
<p class="calibre1">The query, which aggregates account balances for specific customers, looks as follows: mysql&gt; <b class="calibre3">SELECT cust_id, SUM(avail_balance) tot_bal</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE cust_id IN (1, 5, 9, 11)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY cust_id; </b></p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">| cust_id | tot_bal  |</p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">|       1 |  4557.75 |</p>
<p class="calibre1">|       5 |  2237.97 |</p>
<p class="calibre1">|       9 | 10971.22 |</p>
<p class="calibre1">|      11 |  9345.55 |</p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">To see how MySQL’s query optimizer decides to execute the query, I use the explain statement to ask the server to show the execution plan for the query rather than executing the query:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">EXPLAIN SELECT cust_id, SUM(avail_balance) tot_bal</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE cust_id IN (1, 5, 9, 11)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY cust_id \G</b></p>
<p class="calibre1">*************************** 1. row ***************************</p>
<p class="calibre1">id: 1</p>
<p class="calibre1">select_type: SIMPLE</p>
<p class="calibre1">table: account</p>
<p class="calibre1">type: index</p>
<p class="calibre1">possible_keys: fk_a_cust_id</p>
<p class="calibre1">key: fk_a_cust_id</p>
<p class="calibre1">key_len: 4</p>
<p class="calibre1">ref: NULL</p>
<p class="calibre1">rows: 24</p>
<p class="calibre1">Extra: Using where</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Each database server includes tools to allow you to see how the query optimizer handles your SQL statement. SQL Server allows you to see an execution plan by issuing the statement set showplan_text on before running  your  SQL  statement.  Oracle  Database  includes  the  explain plan statement, which writes the execution plan to a special table called plan_table. </p>
<p class="calibre1">Without going into too much detail, here’s what the execution plan tells you: <b class="calibre3">Indexes | 235</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-229"></a>• The fk_a_cust_id index is used to find the rows in the account table that satisfy the where clause. </p>
<p class="calibre1">• After reading the index, the server expects to read all 24 rows of the account table to gather the available balance data, since it doesn’t know that there might be other customers besides IDs 1, 5, 9, and 11. </p>
<p class="calibre1">The fk_a_cust_id index is another index generated automatically by the server, but this time it is because of a foreign key constraint rather than a primary key constraint (more on this later in the chapter). The fk_a_cust_id index is built on the account.cust_id column, so the server is using the index to locate customer IDs 1, 5, 9, and 11 in the account table and is then visiting those rows to retrieve and aggregate the available balance data. </p>
<p class="calibre1">Next,  I  will  add  a  new  index  called  acc_bal_idx  on  both  the  cust_id  and avail_balance columns:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">ALTER TABLE account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ADD INDEX acc_bal_idx (cust_id, avail_balance); </b></p>
<p class="calibre1">Query OK, 24 rows affected (0.03 sec)</p>
<p class="calibre1">Records: 24  Duplicates: 0  Warnings: 0</p>
<p class="calibre1">With this index in place, let’s see how the query optimizer approaches the same query: mysql&gt; <b class="calibre3">EXPLAIN SELECT cust_id, SUM(avail_balance) tot_bal</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE cust_id IN (1, 5, 9, 11)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY cust_id \G</b></p>
<p class="calibre1">*************************** 1. row ***************************</p>
<p class="calibre1">id: 1</p>
<p class="calibre1">select_type: SIMPLE</p>
<p class="calibre1">table: account</p>
<p class="calibre1">type: range</p>
<p class="calibre1">possible_keys: acc_bal_idx</p>
<p class="calibre1">key: acc_bal_idx</p>
<p class="calibre1">key_len: 4</p>
<p class="calibre1">ref: NULL</p>
<p class="calibre1">rows: 8</p>
<p class="calibre1">Extra: Using where; Using index</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">Comparing the two execution plans yields the following differences:</p>
<p class="calibre1">• The  optimizer  is  using  the  new  acc_bal_idx  index  instead  of  the  fk_a_cust_id index. </p>
<p class="calibre1">• The optimizer anticipates needing only eight rows instead of 24. </p>
<p class="calibre1">• The account table is not needed (designated by Using index in the Extra column) to satisfy the query results. </p>
<p class="calibre1">Therefore, the server can use indexes to help locate rows in the associated table, or the server can use an index as though it were a table as long as the index contains all the columns needed by the query. </p>
<p class="calibre1"><b class="calibre3">236 | Chapter 13:</b> <b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-130"></a><img src="images/000035.png" alt="Image 47" class="calibre2" /></p>
<p class="calibre1">The process that I just led you through is an example of query tuning. </p>
<p class="calibre1">Tuning involves looking at an SQL statement and determining the resources available to the server to execute the statement. You can decide to modify the SQL statement, to adjust the database resources, or to do both  in  order  to  make  a  statement  run  more  efficiently.  Tuning  is  a detailed topic, and I strongly urge you to either read your server’s tuning guide or pick up a good tuning book so that you can see all the different approaches available for your server. </p>
<p class="calibre1"><b class="calibre3">The Downside of Indexes</b></p>
<p class="calibre1">If indexes are so great, why not index everything? Well, the key to understanding why more indexes are not necessarily a good thing is to keep in mind that every index is a table (a special type of table, but still a table). Therefore, every time a row is added to or removed from a table, all indexes on that table must be modified. When a row is updated, any indexes on the column or columns that were affected need to be modified as well. Therefore, the more indexes you have, the more work the server needs to do to keep all schema objects up-to-date, which tends to slow things down. </p>
<p class="calibre1">Indexes also require disk space as well as some amount of care from your administrators, so the best strategy is to add an index when a clear need arises. If you need an index for only special purposes, such as a monthly maintenance routine, you can always add the index, run the routine, and then drop the index until you need it again. In the case of data warehouses, where indexes are crucial during business hours as users run reports and ad hoc queries but are problematic when data is being loaded into the warehouse overnight, it is a common practice to drop the indexes before data is loaded and then re-create them before the warehouse opens for business. </p>
<p class="calibre1">In general, you should strive to have neither too many indexes nor too few. If you aren’t sure how many indexes you should have, you can use this strategy as a default:</p>
<p class="calibre1">• Make sure all primary key columns are indexed (most servers automatically create unique indexes when you create primary key constraints). For multicolumn primary keys, consider building additional indexes on a subset of the primary key columns, or on all the primary key columns but in a different order than the primary key constraint definition. </p>
<p class="calibre1">• Build indexes on all columns that are referenced in foreign key constraints. Keep in mind that the server checks to make sure there are no child rows when a parent is deleted, so it must issue a query to search for a particular value in the column. </p>
<p class="calibre1">If there’s no index on the column, the entire table must be scanned. </p>
<p class="calibre1">• Index any columns that will frequently be used to retrieve data. Most date columns are good candidates, along with short (3- to 50-character) string columns. </p>
<p class="calibre1">After you have built your initial set of indexes, try to capture actual queries against your tables, and modify your indexing strategy to fit the most-common access paths. </p>
<p class="calibre1"><b class="calibre3">Indexes | 237</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-131"></a><img src="images/000036.png" alt="Image 48" class="calibre2" /></p>
<p class="calibre1"><b class="calibre3">Constraints</b></p>
<p class="calibre1">A constraint is simply a restriction placed on one or more columns of a table. There are several different types of constraints, including:</p>
<p class="calibre1"> <i class="calibre4">Primary key constraints</i></p>
<p class="calibre1">Identify the column or columns that guarantee uniqueness within a table <i class="calibre4">Foreign key constraints</i></p>
<p class="calibre1">Restrict one or more columns to contain only values found in another table’s primary key columns, and may also restrict the allowable values in other tables if update cascade or delete cascade rules are established</p>
<p class="calibre1"> <i class="calibre4">Unique constraints</i></p>
<p class="calibre1">Restrict one or more columns to contain unique values within a table (primary key constraints are a special type of unique constraint)</p>
<p class="calibre1"> <i class="calibre4">Check constraints</i></p>
<p class="calibre1">Restrict the allowable values for a column</p>
<p class="calibre1">Without constraints, a database’s consistency is suspect. For example, if the server allows you to change a customer’s ID in the customer table without changing the same customer ID in the account table, then you will end up with accounts that no longer point to valid customer records (known as  <i class="calibre4">orphaned rows</i>). With primary and foreign key constraints in place, however, the server will either raise an error if an attempt is made  to  modify  or  delete  data  that  is  referenced  by  other  tables,  or  propagate  the changes to other tables for you (more on this shortly). </p>
<p class="calibre1">If you want to use foreign key constraints with the MySQL server, you must use the InnoDB storage engine for your tables. Foreign key constraints are not supported in the Falcon engine as of version 6.0.4, but they will be supported in later versions. </p>
<p class="calibre1"><b class="calibre3">Constraint Creation</b></p>
<p class="calibre1">Constraints are generally created at the same time as the associated table via the create table statement. To illustrate, here’s an example from the schema generation script for this book’s example database:</p>
<p class="calibre1">CREATE TABLE product</p>
<p class="calibre1">(product_cd VARCHAR(10) NOT NULL, </p>
<p class="calibre1">name VARCHAR(50) NOT NULL, </p>
<p class="calibre1">product_type_cd VARCHAR (10) NOT NULL, </p>
<p class="calibre1">date_offered DATE, </p>
<p class="calibre1">date_retired DATE, </p>
<p class="calibre1"><b class="calibre3">CONSTRAINT fk_product_type_cd FOREIGN KEY (product_type_cd)</b> <b class="calibre3">REFERENCES product_type (product_type_cd), </b></p>
<p class="calibre1"><b class="calibre3">CONSTRAINT pk_product PRIMARY KEY (product_cd)</b></p>
<p class="calibre1">); </p>
<p class="calibre1"><b class="calibre3">238 | Chapter 13:</b> <b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-132"></a>The product table includes two constraints: one to specify that the product_cd column serves  as  the  primary  key  for  the  table,  and  another  to  specify  that  the product_type_cd column serves as a foreign key to the product_type table. Alternatively, you can create the product table without constraints, and add the primary and foreign key constraints later via alter table statements:</p>
<p class="calibre1">ALTER TABLE product</p>
<p class="calibre1">ADD CONSTRAINT pk_product PRIMARY KEY (product_cd); </p>
<p class="calibre1">ALTER TABLE product</p>
<p class="calibre1">ADD CONSTRAINT fk_product_type_cd FOREIGN KEY (product_type_cd) REFERENCES product_type (product_type_cd); </p>
<p class="calibre1">If  you  want  to  remove  a  primary  or  foreign  key  constraint,  you  can  use  the  alter table statement again, except that you specify drop instead of add, as in: ALTER TABLE product</p>
<p class="calibre1">DROP PRIMARY KEY; </p>
<p class="calibre1">ALTER TABLE product</p>
<p class="calibre1">DROP FOREIGN KEY fk_product_type_cd; </p>
<p class="calibre1">While it is unusual to drop a primary key constraint, foreign key constraints are sometimes dropped during certain maintenance operations and then reestablished. </p>
<p class="calibre1"><b class="calibre3">Constraints and Indexes</b></p>
<p class="calibre1">As you saw earlier in the chapter, constraint creation sometimes involves the automatic generation of an index. However, database servers behave differently regarding the relationship between constraints and indexes. <a href="#calibre_link-132">Table 13-1 </a>shows how MySQL, SQL</p>
<p class="calibre1">Server, and Oracle Database handle the relationship between constraints and indexes. </p>
<p class="calibre1"> <i class="calibre4">Table 13-1. Constraint generation</i></p>
<p class="calibre1"><b class="calibre3">Constraint type</b></p>
<p class="calibre1"><b class="calibre3">MySQL</b></p>
<p class="calibre1"><b class="calibre3">SQL Server</b></p>
<p class="calibre1"><b class="calibre3">Oracle Database</b></p>
<p class="calibre1">Primary key constraints</p>
<p class="calibre1">Generates unique index</p>
<p class="calibre1">Generates unique index</p>
<p class="calibre1">Uses existing index or creates new index</p>
<p class="calibre1">Foreign key constraints</p>
<p class="calibre1">Generates index</p>
<p class="calibre1">Does not generate index</p>
<p class="calibre1">Does not generate index</p>
<p class="calibre1">Unique constraints</p>
<p class="calibre1">Generates unique index</p>
<p class="calibre1">Generates unique index</p>
<p class="calibre1">Uses existing index or creates new index</p>
<p class="calibre1">MySQL, therefore, generates a new index to enforce primary key, foreign key, and unique  constraints,  SQL  Server  generates  a  new  index  for  primary  key  and  unique constraints but  <i class="calibre4">not</i> for foreign key constraints, and Oracle Database takes the same approach as SQL Server except that Oracle will use an existing index (if an appropriate one exists) to enforce primary key and unique constraints. Although neither SQL Server nor Oracle Database generates an index for a foreign key constraint, both servers’ documentation advises that indexes be created for every foreign key. </p>
<p class="calibre1"><b class="calibre3">Constraints | 239</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-133"></a><b class="calibre3">Cascading Constraints</b></p>
<p class="calibre1">With foreign key constraints in place, if a user attempts to insert a new row or change an existing row such that a foreign key column doesn’t have a matching value in the parent table, the server raises an error. To illustrate, here’s a look at the data in the product and product_type tables:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_type_cd, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product_type; </b></p>
<p class="calibre1">+-----------------+-------------------------------+</p>
<p class="calibre1">| product_type_cd | name                          |</p>
<p class="calibre1">+-----------------+-------------------------------+</p>
<p class="calibre1">| ACCOUNT         | Customer Accounts             |</p>
<p class="calibre1">| INSURANCE       | Insurance Offerings           |</p>
<p class="calibre1">| LOAN            | Individual and Business Loans |</p>
<p class="calibre1">+-----------------+-------------------------------+</p>
<p class="calibre1">3 rows in set (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_type_cd, product_cd, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY product_type_cd; </b></p>
<p class="calibre1">+-----------------+------------+-------------------------+</p>
<p class="calibre1">| product_type_cd | product_cd | name                    |</p>
<p class="calibre1">+-----------------+------------+-------------------------+</p>
<p class="calibre1">| ACCOUNT         | CD         | certificate of deposit  |</p>
<p class="calibre1">| ACCOUNT         | CHK        | checking account        |</p>
<p class="calibre1">| ACCOUNT         | MM         | money market account    |</p>
<p class="calibre1">| ACCOUNT         | SAV        | savings account         |</p>
<p class="calibre1">| LOAN            | AUT        | auto loan               |</p>
<p class="calibre1">| LOAN            | BUS        | business line of credit |</p>
<p class="calibre1">| LOAN            | MRT        | home mortgage           |</p>
<p class="calibre1">| LOAN            | SBL        | small business loan     |</p>
<p class="calibre1">+-----------------+------------+-------------------------+</p>
<p class="calibre1">8 rows in set (0.01 sec)</p>
<p class="calibre1">There are three different values for the product_type_cd column in the product_type table (ACCOUNT, INSURANCE, and LOAN). Of the three values, two of them (ACCOUNT and LOAN) are referenced in the product table’s product_type_cd column. </p>
<p class="calibre1">The  following  statement  attempts  to  change  the  product_type_cd  column  in  the product table to a value that doesn’t exist in the product_type table: mysql&gt; <b class="calibre3">UPDATE product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET product_type_cd = 'XYZ' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_type_cd = 'LOAN'; </b></p>
<p class="calibre1">ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails ('bank'.'product', CONSTRAINT 'fk_product_type_cd' FOREIGN KEY</p>
<p class="calibre1">('product_type_cd') REFERENCES 'product_type' ('product_type_cd')) Because  of  the  foreign  key  constraint  on  the  product.product_type_cd  column,  the server  does  not  allow  the  update  to  succeed,  since  there  is  no  row  in  the product_type table with a value of XYZ in the product_type_cd column. Thus, the foreign <b class="calibre3">240 | Chapter 13:</b> <b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-186"></a>key constraint doesn’t let you change a child row if there is no corresponding value in the parent. </p>
<p class="calibre1">What  would  happen,  however,  if  you  tried  to  change  the   <i class="calibre4">parent</i>  row  in  the product_type  table  to  XYZ?  Here’s  an  update  statement  that  attempts  to  change  the LOAN product type to XYZ:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE product_type</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET product_type_cd = 'XYZ' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_type_cd = 'LOAN'; </b></p>
<p class="calibre1">ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails ('bank'.'product', CONSTRAINT 'fk_product_type_cd' FOREIGN KEY</p>
<p class="calibre1">('product_type_cd') REFERENCES 'product_type' ('product_type_cd')) Once again, an error is raised; this time because there are child rows in the product table whose product_type_cd column contains the value LOAN. This is the default behavior for foreign key constraints, but it is not the only possible behavior; instead, you can instruct the server to propagate the change to all child rows for you, thus preserving the integrity of the data. Known as a  <i class="calibre4">cascading update</i>, this variation of the foreign key constraint can be installed by removing the existing foreign key and adding a new one that includes the on update cascade clause:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">ALTER TABLE product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">DROP FOREIGN KEY fk_product_type_cd; </b></p>
<p class="calibre1">Query OK, 8 rows affected (0.02 sec)</p>
<p class="calibre1">Records: 8  Duplicates: 0  Warnings: 0</p>
<p class="calibre1">mysql&gt; <b class="calibre3">ALTER TABLE product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ADD CONSTRAINT fk_product_type_cd FOREIGN KEY (product_type_cd)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">REFERENCES product_type (product_type_cd)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON UPDATE CASCADE; </b></p>
<p class="calibre1">Query OK, 8 rows affected (0.03 sec)</p>
<p class="calibre1">Records: 8  Duplicates: 0  Warnings: 0</p>
<p class="calibre1">With  this  modified  constraint  in  place,  let’s  see  what  happens  when  the  previous update statement is attempted again:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE product_type</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET product_type_cd = 'XYZ' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_type_cd = 'LOAN'; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.01 sec)</p>
<p class="calibre1">Rows matched: 1  Changed: 1  Warnings: 0</p>
<p class="calibre1">This time, the statement succeeds. To verify that the change was propagated to the product table, here’s another look at the data in both tables: mysql&gt; <b class="calibre3">SELECT product_type_cd, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product_type; </b></p>
<p class="calibre1">+-----------------+-------------------------------+</p>
<p class="calibre1">| product_type_cd | name                          |</p>
<p class="calibre1">+-----------------+-------------------------------+</p>
<p class="calibre1">| ACCOUNT         | Customer Accounts             |</p>
<p class="calibre1">| INSURANCE       | Insurance Offerings           |</p>
<p class="calibre1">| XYZ             | Individual and Business Loans |</p>
<p class="calibre1"><b class="calibre3">Constraints | 241</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-134"></a>+-----------------+-------------------------------+</p>
<p class="calibre1">3 rows in set (0.02 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_type_cd, product_cd, name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY product_type_cd; </b></p>
<p class="calibre1">+-----------------+------------+-------------------------+</p>
<p class="calibre1">| product_type_cd | product_cd | name                    |</p>
<p class="calibre1">+-----------------+------------+-------------------------+</p>
<p class="calibre1">| ACCOUNT         | CD         | certificate of deposit  |</p>
<p class="calibre1">| ACCOUNT         | CHK        | checking account        |</p>
<p class="calibre1">| ACCOUNT         | MM         | money market account    |</p>
<p class="calibre1">| ACCOUNT         | SAV        | savings account         |</p>
<p class="calibre1">| XYZ             | AUT        | auto loan               |</p>
<p class="calibre1">| XYZ             | BUS        | business line of credit |</p>
<p class="calibre1">| XYZ             | MRT        | home mortgage           |</p>
<p class="calibre1">| XYZ             | SBL        | small business loan     |</p>
<p class="calibre1">+-----------------+------------+-------------------------+</p>
<p class="calibre1">8 rows in set (0.01 sec)</p>
<p class="calibre1">As  you  can  see,  the  change  to  the  product_type  table  has  been  propagated  to  the product table as well. Along with cascading updates, you can specify  <i class="calibre4">cascading deletes</i> as well. A cascading delete  <i class="calibre4">removes</i> rows from the child table when a row is deleted from the parent table. To specify cascading deletes, use the on delete cascade clause, as in:</p>
<p class="calibre1">ALTER TABLE product</p>
<p class="calibre1">ADD CONSTRAINT fk_product_type_cd FOREIGN KEY (product_type_cd) REFERENCES product_type (product_type_cd)</p>
<p class="calibre1">ON UPDATE CASCADE</p>
<p class="calibre1">ON DELETE CASCADE; </p>
<p class="calibre1">With this version of the constraint in place, the server will now update child rows in the product table when a row in the product_type table is updated, as well as delete child rows in the product table when a row in the product_type table is deleted. </p>
<p class="calibre1">Cascading constraints are one case in which constraints  <i class="calibre4">do</i> directly affect the code that you write. You need to know which constraints in your database specify cascading updates  and/or  deletes  so  that  you  know  the  full  effect  of  your  update  and  delete statements. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">Work  through  the  following  exercises  to  test  your  knowledge  of  indexes  and  con-</p>
<p class="calibre1"><a href="#calibre_link-152">straints. When you’re done, compare your solutions with those in Appendix C. </a></p>
<p class="calibre1"><b class="calibre3">242 | Chapter 13:</b> <b class="calibre3">Indexes and Constraints</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-249"></a><b class="calibre3">Exercise 13-1</b></p>
<p class="calibre1">Modify the account table so that customers may not have more than one account for each product. </p>
<p class="calibre1"><b class="calibre3">Exercise 13-2</b></p>
<p class="calibre1">Generate a multicolumn index on the transaction table that could be used by both of the following queries:</p>
<p class="calibre1">SELECT txn_date, account_id, txn_type_cd, amount</p>
<p class="calibre1">FROM transaction</p>
<p class="calibre1">WHERE txn_date &gt; cast('2008-12-31 23:59:59' as datetime); </p>
<p class="calibre1">SELECT txn_date, account_id, txn_type_cd, amount</p>
<p class="calibre1">FROM transaction</p>
<p class="calibre1">WHERE txn_date &gt; cast('2008-12-31 23:59:59' as datetime)</p>
<p class="calibre1">AND amount &lt; 1000; </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 243</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-315"></a>D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-135"></a><b class="calibre3">CHAPTER 14</b></p>
<p class="calibre1"><b class="calibre3">Views</b></p>
<p class="calibre1">Well-designed applications generally expose a public interface while keeping implementation details private, thereby enabling future design changes without impacting end users. When designing your database, you can achieve a similar result by keeping your tables private and allowing your users to access data only through a set of  <i class="calibre4">views</i>. </p>
<p class="calibre1">This chapter strives to define what views are, how they are created, and when and how you might want to use them. </p>
<p class="calibre1"><b class="calibre3">What Are Views? </b></p>
<p class="calibre1">A view is simply a mechanism for querying data. Unlike tables, views do not involve data storage; you won’t need to worry about views filling up your disk space. You create a view by assigning a name to a select statement, and then storing the query for others to use. Other users can then use your view to access data just as though they were querying tables directly (in fact, they may not even know they are using a view). </p>
<p class="calibre1">As a simple example, let’s say that you want to partially obscure the federal IDs (Social Security numbers and corporate identifiers) in the customer table. The customer service department, for example, may need access to just the last portion of the federal ID in order to verify the identity of a caller, but exposing the entire number would violate the  company’s  privacy  policy.  Therefore,  instead  of  allowing  direct  access  to  the customer table, you define a view called customer_vw and mandate that all bank per-sonnel use it to access customer data. Here’s the view definition: CREATE VIEW customer_vw</p>
<p class="calibre1">(cust_id, </p>
<p class="calibre1">fed_id, </p>
<p class="calibre1">cust_type_cd, </p>
<p class="calibre1">address, </p>
<p class="calibre1">city, </p>
<p class="calibre1">state, </p>
<p class="calibre1">zipcode</p>
<p class="calibre1">)</p>
<p class="calibre1">AS</p>
<p class="calibre1">SELECT cust_id, </p>
<p class="calibre1"><b class="calibre3">245</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-239"></a>  concat('ends in ', substr(fed_id, 8, 4)) fed_id, cust_type_cd, </p>
<p class="calibre1">address, </p>
<p class="calibre1">city, </p>
<p class="calibre1">state, </p>
<p class="calibre1">postal_code</p>
<p class="calibre1">FROM customer; </p>
<p class="calibre1">The first part of the statement lists the view’s column names, which may be different from those of the underlying table (e.g., the customer_vw view has a column named zipcode  which  maps  to  the  customer.postal_code  column).  The  second  part  of  the statement is a select statement, which must contain one expression for each column in the view. </p>
<p class="calibre1">When the create view statement is executed, the database server simply stores the view definition for future use; the query is not executed, and no data is retrieved or stored. </p>
<p class="calibre1">Once the view has been created, users can query it just like they would a table, as in: mysql&gt; <b class="calibre3">SELECT cust_id, fed_id, cust_type_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer_vw; </b></p>
<p class="calibre1">+---------+--------------+--------------+</p>
<p class="calibre1">| cust_id | fed_id       | cust_type_cd |</p>
<p class="calibre1">+---------+--------------+--------------+</p>
<p class="calibre1">|       1 | ends in 1111 | I            |</p>
<p class="calibre1">|       2 | ends in 2222 | I            |</p>
<p class="calibre1">|       3 | ends in 3333 | I            |</p>
<p class="calibre1">|       4 | ends in 4444 | I            |</p>
<p class="calibre1">|       5 | ends in 5555 | I            |</p>
<p class="calibre1">|       6 | ends in 6666 | I            |</p>
<p class="calibre1">|       7 | ends in 7777 | I            |</p>
<p class="calibre1">|       8 | ends in 8888 | I            |</p>
<p class="calibre1">|       9 | ends in 9999 | I            |</p>
<p class="calibre1">|      10 | ends in 111  | B            |</p>
<p class="calibre1">|      11 | ends in 222  | B            |</p>
<p class="calibre1">|      12 | ends in 333  | B            |</p>
<p class="calibre1">|      13 | ends in 444  | B            |</p>
<p class="calibre1">+---------+--------------+--------------+</p>
<p class="calibre1">13 rows in set (0.02 sec)</p>
<p class="calibre1">The actual query that the server executes is neither the one submitted by the user nor the query attached to the view definition. Instead, the server merges the two together to create another statement, which in this case looks as follows: SELECT cust_id, </p>
<p class="calibre1">concat('ends in ', substr(fed_id, 8, 4)) fed_id, </p>
<p class="calibre1">cust_type_cd</p>
<p class="calibre1">FROM customer; </p>
<p class="calibre1">Even though the customer_vw view definition includes seven columns of the customer table, the query executed by the server retrieves only three of the seven. As you’ll see later in the chapter, this is an important distinction if some of the columns in your view are attached to functions or subqueries. </p>
<p class="calibre1"><b class="calibre3">246 | Chapter 14:</b> <b class="calibre3">Views</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-201"></a>From the user’s standpoint, a view looks exactly like a table. If you want to know what columns are available in a view, you can use MySQL’s (or Oracle’s) describe command to examine it:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">describe customer_vw; </b></p>
<p class="calibre1">+--------------+------------------+------+-----+---------+-------+</p>
<p class="calibre1">| Field        | Type             | Null | Key | Default | Extra |</p>
<p class="calibre1">+--------------+------------------+------+-----+---------+-------+</p>
<p class="calibre1">| cust_id      | int(10) unsigned | NO   |     | 0       |       |</p>
<p class="calibre1">| fed_id       | varchar(12)      | YES  |     | NULL    |       |</p>
<p class="calibre1">| cust_type_cd | enum('I','B')    | NO   |     | NULL    |       |</p>
<p class="calibre1">| address      | varchar(30)      | YES  |     | NULL    |       |</p>
<p class="calibre1">| city         | varchar(20)      | YES  |     | NULL    |       |</p>
<p class="calibre1">| state        | varchar(20)      | YES  |     | NULL    |       |</p>
<p class="calibre1">| postal_code  | varchar(10)      | YES  |     | NULL    |       |</p>
<p class="calibre1">+--------------+------------------+------+-----+---------+-------+</p>
<p class="calibre1">7 rows in set (1.40 sec)</p>
<p class="calibre1">You are free to use any clauses of the select statement when querying through a view, including group by, having, and order by. Here’s an example:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_type_cd, count(*)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE state = 'MA' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY cust_type_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1; </b></p>
<p class="calibre1">+--------------+----------+</p>
<p class="calibre1">| cust_type_cd | count(*) |</p>
<p class="calibre1">+--------------+----------+</p>
<p class="calibre1">| I            |        7 |</p>
<p class="calibre1">| B            |        2 |</p>
<p class="calibre1">+--------------+----------+</p>
<p class="calibre1">2 rows in set (0.22 sec)</p>
<p class="calibre1">In addition, you can join views to other tables (or even to other views) within a query, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cst.cust_id, cst.fed_id, bus.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer_vw cst INNER JOIN business bus</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON cst.cust_id = bus.cust_id; </b></p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">| cust_id | fed_id      | name                   |</p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">|      10 | ends in 111 | Chilton Engineering    |</p>
<p class="calibre1">|      11 | ends in 222 | Northeast Cooling Inc. |</p>
<p class="calibre1">|      12 | ends in 333 | Superior Auto Body     |</p>
<p class="calibre1">|      13 | ends in 444 | AAA Insurance Inc.     |</p>
<p class="calibre1">+---------+-------------+------------------------+</p>
<p class="calibre1">4 rows in set (0.24 sec)</p>
<p class="calibre1">This query joins the customer_vw view to the business table in order to retrieve only business customers. </p>
<p class="calibre1"><b class="calibre3">What Are Views? | 247</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-136"></a><b class="calibre3">Why Use Views? </b></p>
<p class="calibre1">In the previous section, I demonstrated a simple view whose sole purpose was to mask the contents of the customer.fed_id column. While views are often employed for this purpose, there are many reasons for using views, as I demonstrate in the following subsections. </p>
<p class="calibre1"><b class="calibre3">Data Security</b></p>
<p class="calibre1">If you create a table and allow users to query it, they will be able to access every column and every row in the table. As I pointed out earlier, however, your table may include some columns that contain sensitive data, such as identification numbers or credit card numbers; not only is it a bad idea to expose such data to all users, but also it might violate your company’s privacy policies, or even state or federal laws, to do so. </p>
<p class="calibre1">The best approach for these situations is to keep the table private (i.e., don’t grant select permission to any users) and then to create one or more views that either omit or obscure (such as the 'ends in ####' approach taken with the customer_vw.fed_id column) the sensitive columns. You may also constrain which  <i class="calibre4">rows</i> a set of users may access by adding a where clause to your view definition. For example, the next view definition allows only business customers to be queried:</p>
<p class="calibre1">CREATE VIEW business_customer_vw</p>
<p class="calibre1">(cust_id, </p>
<p class="calibre1">fed_id, </p>
<p class="calibre1">cust_type_cd, </p>
<p class="calibre1">address, </p>
<p class="calibre1">city, </p>
<p class="calibre1">state, </p>
<p class="calibre1">zipcode</p>
<p class="calibre1">)</p>
<p class="calibre1">AS</p>
<p class="calibre1">SELECT cust_id, </p>
<p class="calibre1">concat('ends in ', substr(fed_id, 8, 4)) fed_id, </p>
<p class="calibre1">cust_type_cd, </p>
<p class="calibre1">address, </p>
<p class="calibre1">city, </p>
<p class="calibre1">state, </p>
<p class="calibre1">postal_code</p>
<p class="calibre1">FROM customer</p>
<p class="calibre1"><b class="calibre3">WHERE cust_type_cd = 'B' </b></p>
<p class="calibre1">If you provide this view to your corporate banking department, they will be able to access only business accounts because the condition in the view’s where clause will always be included in their queries. </p>
<p class="calibre1"><b class="calibre3">248 | Chapter 14:</b> <b class="calibre3">Views</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-137"></a><img src="images/000037.png" alt="Image 49" class="calibre2" /></p>
<p class="calibre1">Oracle Database users have another option for securing both rows and columns of a table: Virtual Private Database (VPD). VPD allows you to attach policies to your tables, after which the server will modify a user’s query as necessary to enforce the policies. For example, if you enact a policy that members of the corporate banking department can see only business accounts, then the condition cust_type_cd = 'B' will be added to all of their queries against the customer table. </p>
<p class="calibre1"><b class="calibre3">Data Aggregation</b></p>
<p class="calibre1">Reporting applications generally require aggregated data, and views are a great way to make it appear as though data is being pre-aggregated and stored in the database. As an example, let’s say that an application generates a report each month showing the number of accounts and total deposits for every customer. Rather than allowing the application developers to write queries against the base tables, you could provide them with the following view:</p>
<p class="calibre1">CREATE VIEW customer_totals_vw</p>
<p class="calibre1">(cust_id, </p>
<p class="calibre1">cust_type_cd, </p>
<p class="calibre1">cust_name, </p>
<p class="calibre1">num_accounts, </p>
<p class="calibre1">tot_deposits</p>
<p class="calibre1">)</p>
<p class="calibre1">AS</p>
<p class="calibre1">SELECT cst.cust_id, cst.cust_type_cd, </p>
<p class="calibre1">CASE</p>
<p class="calibre1">WHEN cst.cust_type_cd = 'B' THEN</p>
<p class="calibre1">(SELECT bus.name FROM business bus WHERE bus.cust_id = cst.cust_id) ELSE</p>
<p class="calibre1">(SELECT concat(ind.fname, ' ', ind.lname)</p>
<p class="calibre1">FROM individual ind</p>
<p class="calibre1">WHERE ind.cust_id = cst.cust_id)</p>
<p class="calibre1">END cust_name, </p>
<p class="calibre1">sum(CASE WHEN act.status = 'ACTIVE' THEN 1 ELSE 0 END) tot_active_accounts, sum(CASE WHEN act.status = 'ACTIVE' THEN act.avail_balance ELSE 0 END) tot_balance FROM customer cst INNER JOIN account act</p>
<p class="calibre1">ON act.cust_id = cst.cust_id</p>
<p class="calibre1">GROUP BY cst.cust_id, cst.cust_type_cd; </p>
<p class="calibre1">Using this approach gives you a great deal of flexibility as a database designer. If you decide at some point in the future that query performance would improve dramatically if the data were preaggregated in a table rather than summed using a view, you can create a customer_totals table and modify the customer_totals_vw view definition to retrieve data from this table. Before modifying the view definition, you can use it to populate the new table. Here are the necessary SQL statements for this scenario: mysql&gt; <b class="calibre3">CREATE TABLE customer_totals</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AS</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT * FROM customer_totals_vw; </b></p>
<p class="calibre1">Query OK, 13 rows affected (3.33 sec)</p>
<p class="calibre1"><b class="calibre3">Why Use Views? | 249</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-138"></a>Records: 13  Duplicates: 0  Warnings: 0</p>
<p class="calibre1">mysql&gt; <b class="calibre3">CREATE OR REPLACE VIEW customer_totals_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(cust_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">cust_type_cd, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">cust_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">num_accounts, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AS</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT cust_id,  cust_type_cd,  cust_name,  num_accounts,  tot_deposits</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer_totals; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.02 sec)</p>
<p class="calibre1">From now on, all queries that use the customer_totals_vw view will pull data from the new customer_totals table, meaning that users will see a performance improvement without needing to modify their queries. </p>
<p class="calibre1"><b class="calibre3">Hiding Complexity</b></p>
<p class="calibre1">One of the most common reasons for deploying views is to shield end users from complexity. For example, let’s say that a report is created each month showing the number of employees, the total number of active accounts, and the total number of transactions for each branch. Rather than expecting the report designer to navigate four different tables to gather the necessary data, you could provide a view that looks as follows: CREATE VIEW branch_activity_vw</p>
<p class="calibre1">(branch_name, </p>
<p class="calibre1">city, </p>
<p class="calibre1">state, </p>
<p class="calibre1">num_employees, </p>
<p class="calibre1">num_active_accounts, </p>
<p class="calibre1">tot_transactions</p>
<p class="calibre1">)</p>
<p class="calibre1">AS</p>
<p class="calibre1">SELECT br.name, br.city, br.state, </p>
<p class="calibre1">(SELECT count(*)</p>
<p class="calibre1">FROM employee emp</p>
<p class="calibre1">WHERE emp.assigned_branch_id = br.branch_id) num_emps, </p>
<p class="calibre1">(SELECT count(*)</p>
<p class="calibre1">FROM account acnt</p>
<p class="calibre1">WHERE acnt.status = 'ACTIVE' AND acnt.open_branch_id = br.branch_id) num_accounts, (SELECT count(*)</p>
<p class="calibre1">FROM transaction txn</p>
<p class="calibre1">WHERE txn.execution_branch_id = br.branch_id) num_txns</p>
<p class="calibre1">FROM branch br; </p>
<p class="calibre1">This view definition is interesting because three of the six column values are generated using  scalar  subqueries.  If  someone  uses  this  view  but  does   <i class="calibre4">not</i>  reference  the num_employees, num_active_accounts, or tot_transactions column, then none of the subqueries will be executed. </p>
<p class="calibre1"><b class="calibre3">250 | Chapter 14:</b> <b class="calibre3">Views</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-139"></a><b class="calibre3">Joining Partitioned Data</b></p>
<p class="calibre1">Some database designs break large tables into multiple pieces in order to improve performance. For example, if the transaction table became large, the designers may decide to break it into two tables: transaction_current, which holds the latest six months’ of data, and transaction_historic, which holds all data up to six months ago. If a customer wants to see all the transactions for a particular account, you would need to query both tables. By creating a view that queries both tables and combines the results together, however, you can make it look like all transaction data is stored in a single table. Here’s the view definition:</p>
<p class="calibre1">CREATE VIEW transaction_vw</p>
<p class="calibre1">(txn_date, </p>
<p class="calibre1">account_id, </p>
<p class="calibre1">txn_type_cd, </p>
<p class="calibre1">amount, </p>
<p class="calibre1">teller_emp_id, </p>
<p class="calibre1">execution_branch_id, </p>
<p class="calibre1">funds_avail_date</p>
<p class="calibre1">)</p>
<p class="calibre1">AS</p>
<p class="calibre1">SELECT txn_date,  account_id,  txn_type_cd,  amount,  teller_emp_id, execution_branch_id,  funds_avail_date</p>
<p class="calibre1">FROM transaction_historic</p>
<p class="calibre1">UNION ALL</p>
<p class="calibre1">SELECT txn_date,  account_id,  txn_type_cd,  amount,  teller_emp_id, execution_branch_id,  funds_avail_date</p>
<p class="calibre1">FROM transaction_current; </p>
<p class="calibre1">Using a view in this case is a good idea because it allows the designers to change the structure of the underlying data without the need to force all database users to modify their queries. </p>
<p class="calibre1"><b class="calibre3">Updatable Views</b></p>
<p class="calibre1">If you provide users with a set of views to use for data retrieval, what should you do if the users also need to modify the same data? It might seem a bit strange, for example, to force the users to retrieve data using a view, but then allow them to directly modify the  underlying  table  using  update  or  insert  statements.  For  this  purpose,  MySQL, Oracle Database, and SQL Server all allow you to modify data through a view, as long as you abide by certain restrictions. In the case of MySQL, a view is updatable if the following conditions are met:</p>
<p class="calibre1">• No aggregate functions are used (max(), min(), avg(), etc.). </p>
<p class="calibre1">• The view does not employ group by or having clauses. </p>
<p class="calibre1">• No subqueries exist in the select or from clause, and any subqueries in the where clause do not refer to tables in the from clause. </p>
<p class="calibre1">• The view does not utilize union, union all, or distinct. </p>
<p class="calibre1"><b class="calibre3">Updatable Views | 251</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-140"></a>• The from clause includes at least one table or updatable view. </p>
<p class="calibre1">• The from clause uses only inner joins if there is more than one table or view. </p>
<p class="calibre1">To demonstrate the utility of updatable views, it might be best to start with a simple view definition and then to move to a more complex view. </p>
<p class="calibre1"><b class="calibre3">Updating Simple Views</b></p>
<p class="calibre1">The view at the beginning of the chapter is about as simple as it gets, so let’s start there: CREATE VIEW customer_vw</p>
<p class="calibre1">(cust_id, </p>
<p class="calibre1">fed_id, </p>
<p class="calibre1">cust_type_cd, </p>
<p class="calibre1">address, </p>
<p class="calibre1">city, </p>
<p class="calibre1">state, </p>
<p class="calibre1">zipcode</p>
<p class="calibre1">)</p>
<p class="calibre1">AS</p>
<p class="calibre1">SELECT cust_id, </p>
<p class="calibre1">concat('ends in ', substr(fed_id, 8, 4)) fed_id, </p>
<p class="calibre1">cust_type_cd, </p>
<p class="calibre1">address, </p>
<p class="calibre1">city, </p>
<p class="calibre1">state, </p>
<p class="calibre1">postal_code</p>
<p class="calibre1">FROM customer; </p>
<p class="calibre1">The  customer_vw  view  queries  a  single  table,  and  only  one  of  the  seven  columns  is derived via an expression. This view definition doesn’t violate any of the restrictions listed earlier, so you can use it to modify data in the customer table, as in: mysql&gt; <b class="calibre3">UPDATE customer_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET city = 'Woooburn' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE city = 'Woburn'; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.34 sec)</p>
<p class="calibre1">Rows matched: 1  Changed: 1  Warnings: 0</p>
<p class="calibre1">As you can see, the statement claims to have modified one row, but let’s check the underlying customer table just to be sure:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT DISTINCT city FROM customer; </b></p>
<p class="calibre1">+------------+</p>
<p class="calibre1">| city       |</p>
<p class="calibre1">+------------+</p>
<p class="calibre1">| Lynnfield  |</p>
<p class="calibre1">| <b class="calibre3">Woooburn</b>   |</p>
<p class="calibre1">| Quincy     |</p>
<p class="calibre1">| Waltham    |</p>
<p class="calibre1">| Salem      |</p>
<p class="calibre1">| Wilmington |</p>
<p class="calibre1">| Newton     |</p>
<p class="calibre1"><b class="calibre3">252 | Chapter 14:</b> <b class="calibre3">Views</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-141"></a>+------------+</p>
<p class="calibre1">7 rows in set (0.12 sec)</p>
<p class="calibre1">While you can modify most of the columns in the view in this fashion, you will not be able to modify the fed_id column, since it is derived from an expression: mysql&gt; <b class="calibre3">UPDATE customer_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET city = 'Woburn', fed_id = '999999999' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE city = 'Woooburn'; </b></p>
<p class="calibre1">ERROR 1348 (HY000): Column 'fed_id' is not updatable</p>
<p class="calibre1">In this case, it may not be a bad thing, since the whole point of the view is to obscure the federal identifiers. </p>
<p class="calibre1">If you want to insert data using the customer_vw view, you are out of luck; views that contain derived columns cannot be used for inserting data, even if the derived columns are not included in the statement. For example, the next statement attempts to populate only the cust_id, cust_type_cd, and city columns using the customer_vw view: mysql&gt; <b class="calibre3">INSERT INTO customer_vw(cust_id, cust_type_cd, city)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (9999, 'I', 'Worcester'); </b></p>
<p class="calibre1">ERROR 1471 (HY000): The target table customer_vw of the INSERT is not insertable</p>
<p class="calibre1">-into</p>
<p class="calibre1">Now that you have seen the limitations of simple views, the next section will demonstrate the use of a view that joins multiple tables. </p>
<p class="calibre1"><b class="calibre3">Updating Complex Views</b></p>
<p class="calibre1">While single-table views are certainly common, many of the views that you come across will include multiple tables in the from clause of the underlying query. The next view, for example, joins the business and customer tables so that all the data for business customers can be easily queried:</p>
<p class="calibre1">CREATE VIEW business_customer_vw</p>
<p class="calibre1">(cust_id, </p>
<p class="calibre1">fed_id, </p>
<p class="calibre1">address, </p>
<p class="calibre1">city, </p>
<p class="calibre1">state, </p>
<p class="calibre1">postal_code, </p>
<p class="calibre1">business_name, </p>
<p class="calibre1">state_id, </p>
<p class="calibre1">incorp_date</p>
<p class="calibre1">)</p>
<p class="calibre1">AS</p>
<p class="calibre1">SELECT cst.cust_id, </p>
<p class="calibre1">cst.fed_id, </p>
<p class="calibre1">cst.address, </p>
<p class="calibre1">cst.city, </p>
<p class="calibre1">cst.state, </p>
<p class="calibre1">cst.postal_code, </p>
<p class="calibre1">bsn.name, </p>
<p class="calibre1">bsn.state_id, </p>
<p class="calibre1"><b class="calibre3">Updatable Views | 253</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-213"></a>  bsn.incorp_date</p>
<p class="calibre1">FROM customer cst INNER JOIN business bsn</p>
<p class="calibre1">ON cst.cust_id = bsn.cust_id</p>
<p class="calibre1">WHERE cust_type_cd = 'B'; </p>
<p class="calibre1">You may use this view to update data in either the customer or the business table, as the following statements demonstrate:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE business_customer_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET postal_code = '99999' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE cust_id = 10; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.09 sec)</p>
<p class="calibre1">Rows matched: 1  Changed: 1  Warnings: 0</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE business_customer_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET incorp_date = '2008-11-17' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE cust_id = 10; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.11 sec)</p>
<p class="calibre1">Rows matched: 1  Changed: 1  Warnings: 0</p>
<p class="calibre1">The first statement modifies the customer.postal_code column, whereas the second statement modifies the business.incorp_date column. You might be wondering what happens if you try to update columns from  <i class="calibre4">both</i> tables in a single statement, so let’s find out:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">UPDATE business_customer_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET postal_code = '88888', incorp_date = '2008-10-31' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE cust_id = 10; </b></p>
<p class="calibre1">ERROR 1393 (HY000): Can not modify more than one base table through a join view</p>
<p class="calibre1">'bank.business_customer_vw' </p>
<p class="calibre1">As you can see, you are allowed to modify both of the underlying tables, as long as you don’t try to do it with a single statement. Now let’s try to  <i class="calibre4">insert</i> data into both tables for a new customer (cust_id = 99):</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO business_customer_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(cust_id, fed_id, address, city, state, postal_code)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (99, '04-9999999', '99 Main St.', 'Peabody', 'MA', '01975');</b> Query OK, 1 row affected (0.07 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO business_customer_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(cust_id, business_name, state_id, incorp_date)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (99, 'Ninety-Nine Restaurant', '99-999-999', '1999-01-01');</b> ERROR 1393 (HY000): Can not modify more than one base table through a join view</p>
<p class="calibre1">'bank.business_customer_vw' </p>
<p class="calibre1">The first statement, which attempts to insert data into the customer table, works fine, but the second statement, which attempts to insert a row into the business table, raises an exception. The second statement fails because both tables include a cust_id column, but the cust_id column in the view definition is mapped to the customer.cust_id column. Therefore, it is not possible to insert data into the business table using the preceding view definition. </p>
<p class="calibre1"><b class="calibre3">254 | Chapter 14:</b> <b class="calibre3">Views</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-142"></a><img src="images/000039.png" alt="Image 50" class="calibre2" /></p>
<p class="calibre1">Oracle Database and SQL Server also allow data to be inserted and updated through views, but, like MySQL, there are many restrictions. If you are willing to write some PL/SQL or Transact-SQL, however, you can use a feature called  <i class="calibre4">instead-of triggers</i>, which allows you to essentially intercept insert, update, and delete statements against a view, and write custom code to incorporate the changes. Without this type of feature, there are simply too many restrictions to make updating through views a feasible strategy for nontrivial applications. </p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">Test your understanding of views by working through the following exercises. When</p>
<p class="calibre1"><a href="#calibre_link-152">you’re done, compare your solutions with those in Appendix C. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 14-1</b></p>
<p class="calibre1">Create a view that queries the employee table and generates the following output when queried with no where clause:</p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">| supervisor_name | employee_name    |</p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">| NULL            | Michael Smith    |</p>
<p class="calibre1">| Michael Smith   | Susan Barker     |</p>
<p class="calibre1">| Michael Smith   | Robert Tyler     |</p>
<p class="calibre1">| Robert Tyler    | Susan Hawthorne  |</p>
<p class="calibre1">| Susan Hawthorne | John Gooding     |</p>
<p class="calibre1">| Susan Hawthorne | Helen Fleming    |</p>
<p class="calibre1">| Helen Fleming   | Chris Tucker     |</p>
<p class="calibre1">| Helen Fleming   | Sarah Parker     |</p>
<p class="calibre1">| Helen Fleming   | Jane Grossman    |</p>
<p class="calibre1">| Susan Hawthorne | Paula Roberts    |</p>
<p class="calibre1">| Paula Roberts   | Thomas Ziegler   |</p>
<p class="calibre1">| Paula Roberts   | Samantha Jameson |</p>
<p class="calibre1">| Susan Hawthorne | John Blake       |</p>
<p class="calibre1">| John Blake      | Cindy Mason      |</p>
<p class="calibre1">| John Blake      | Frank Portman    |</p>
<p class="calibre1">| Susan Hawthorne | Theresa Markham  |</p>
<p class="calibre1">| Theresa Markham | Beth Fowler      |</p>
<p class="calibre1">| Theresa Markham | Rick Tulman      |</p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">18 rows in set (1.47 sec)</p>
<p class="calibre1"><b class="calibre3">Test Your Knowledge | 255</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-250"></a><b class="calibre3">Exercise 14-2</b></p>
<p class="calibre1">The bank president would like to have a report showing the name and city of each branch, along with the total balances of all accounts opened at the branch. Create a view to generate the data. </p>
<p class="calibre1"><b class="calibre3">256 | Chapter 14:</b> <b class="calibre3">Views</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-143"></a><b class="calibre3">CHAPTER 15</b></p>
<p class="calibre1"><b class="calibre3">Metadata</b></p>
<p class="calibre1">Along with storing all of the data that various users insert into a database, a database server also needs to store information about all of the database objects (tables, views, indexes, etc.) that were created to store this data. The database server stores this information, not surprisingly, in a database. This chapter discusses how and where this information, known as  <i class="calibre4">metadata</i>, is stored, how you can access it, and how you can use it to build flexible systems. </p>
<p class="calibre1"><b class="calibre3">Data About Data</b></p>
<p class="calibre1">Metadata is essentially data about data. Every time you create a database object, the database server needs to record various pieces of information. For example, if you were to create a table with multiple columns, a primary key constraint, three indexes, and a foreign  key  constraint,  the  database  server  would  need  to  store  all  the  following information:</p>
<p class="calibre1">• Table name</p>
<p class="calibre1">• Table storage information (tablespace, initial size, etc.)</p>
<p class="calibre1">• Storage engine</p>
<p class="calibre1">• Column names</p>
<p class="calibre1">• Column data types</p>
<p class="calibre1">• Default column values</p>
<p class="calibre1">• NOT NULL column constraints</p>
<p class="calibre1">• Primary key columns</p>
<p class="calibre1">• Primary key name</p>
<p class="calibre1">• Name of primary key index</p>
<p class="calibre1">• Index names</p>
<p class="calibre1">• Index types (B-tree, bitmap)</p>
<p class="calibre1">• Indexed columns</p>
<p class="calibre1"><b class="calibre3">257</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-144"></a>• Index column sort order (ascending or descending)</p>
<p class="calibre1">• Index storage information</p>
<p class="calibre1">• Foreign key name</p>
<p class="calibre1">• Foreign key columns</p>
<p class="calibre1">• Associated table/columns for foreign keys</p>
<p class="calibre1">This data is collectively known as the  <i class="calibre4">data dictionary</i> or  <i class="calibre4">system catalog</i>. The database server needs to store this data persistently, and it needs to be able to quickly retrieve this data in order to verify and execute SQL statements. Additionally, the database server  must  safeguard  this  data  so  that  it  can  be  modified  only  via  an  appropriate mechanism, such as the alter table statement. </p>
<p class="calibre1">While standards exist for the exchange of metadata between different servers, every database server uses a different mechanism to publish metadata, such as:</p>
<p class="calibre1">• A set of views, such as Oracle Database’s user_tables and all_constraints views</p>
<p class="calibre1">• A set of system-stored procedures, such as SQL Server’s sp_tables procedure or Oracle Database’s dbms_metadata package</p>
<p class="calibre1">• A special database, such as MySQL’s information_schema database Along with SQL Server’s system-stored procedures, which are a vestige of its Sybase lineage, SQL Server also includes a special schema called information_schema that is provided automatically within each database. Both MySQL and SQL Server provide this interface to conform with the ANSI SQL:2003 standard. The remainder of this chapter discusses the information_schema objects that are available in MySQL and SQL</p>
<p class="calibre1">Server. </p>
<p class="calibre1"><b class="calibre3">Information_Schema</b></p>
<p class="calibre1">All of the objects available within the information_schema database (or schema, in the case of SQL Server) are views. Unlike the describe utility, which I used in several chapters of this book as a way to show the structure of various tables and views, the views within information_schema can be queried, and, thus, used programmatically (more on this later in the chapter). Here’s an example that demonstrates how to retrieve the names of all of the tables in the bank database:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT table_name, table_type</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.tables</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1; </b></p>
<p class="calibre1">+----------------------+------------+</p>
<p class="calibre1">| table_name           | table_type |</p>
<p class="calibre1">+----------------------+------------+</p>
<p class="calibre1">| account              | BASE TABLE |</p>
<p class="calibre1">| branch               | BASE TABLE |</p>
<p class="calibre1">| branch_activity_vw   | VIEW       |</p>
<p class="calibre1">| business             | BASE TABLE |</p>
<p class="calibre1"><b class="calibre3">258 | Chapter 15:</b> <b class="calibre3">Metadata</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-211"></a>| business_customer_vw | VIEW       |</p>
<p class="calibre1">| customer             | BASE TABLE |</p>
<p class="calibre1">| customer_vw          | VIEW       |</p>
<p class="calibre1">| department           | BASE TABLE |</p>
<p class="calibre1">| employee             | BASE TABLE |</p>
<p class="calibre1">| employee_vw          | VIEW       |</p>
<p class="calibre1">| individual           | BASE TABLE |</p>
<p class="calibre1">| nh_customer_vw       | VIEW       |</p>
<p class="calibre1">| officer              | BASE TABLE |</p>
<p class="calibre1">| product              | BASE TABLE |</p>
<p class="calibre1">| product_type         | BASE TABLE |</p>
<p class="calibre1">| transaction          | BASE TABLE |</p>
<p class="calibre1">+----------------------+------------+</p>
<p class="calibre1">16 rows in set (0.02 sec)</p>
<p class="calibre1">Along with the various tables we created back <a href="#calibre_link-11">in Chapter 2, </a>the results show several of the views that I demonstrated <a href="#calibre_link-135">in Chapter 14</a>. If you want to exclude the views, simply add another condition to the where clause:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT table_name, table_type</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.tables</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' AND table_type = 'BASE TABLE' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1; </b></p>
<p class="calibre1">+--------------+------------+</p>
<p class="calibre1">| table_name   | table_type |</p>
<p class="calibre1">+--------------+------------+</p>
<p class="calibre1">| account      | BASE TABLE |</p>
<p class="calibre1">| branch       | BASE TABLE |</p>
<p class="calibre1">| business     | BASE TABLE |</p>
<p class="calibre1">| customer     | BASE TABLE |</p>
<p class="calibre1">| department   | BASE TABLE |</p>
<p class="calibre1">| employee     | BASE TABLE |</p>
<p class="calibre1">| individual   | BASE TABLE |</p>
<p class="calibre1">| officer      | BASE TABLE |</p>
<p class="calibre1">| product      | BASE TABLE |</p>
<p class="calibre1">| product_type | BASE TABLE |</p>
<p class="calibre1">| transaction  | BASE TABLE |</p>
<p class="calibre1">+--------------+------------+</p>
<p class="calibre1">11 rows in set (0.01 sec)</p>
<p class="calibre1">If  you  are  only  interested  in  information  about  views,  you  can  query information_schema.views. Along with the view names, you can retrieve additional information, such as a flag that shows whether a view is updatable: mysql&gt; <b class="calibre3">SELECT table_name, is_updatable</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.views</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1; </b></p>
<p class="calibre1">+----------------------+--------------+</p>
<p class="calibre1">| table_name           | is_updatable |</p>
<p class="calibre1">+----------------------+--------------+</p>
<p class="calibre1">| branch_activity_vw   | NO           |</p>
<p class="calibre1">| business_customer_vw | YES          |</p>
<p class="calibre1">| customer_vw          | YES          |</p>
<p class="calibre1">| employee_vw          | YES          |</p>
<p class="calibre1"><b class="calibre3">Information_Schema | 259</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-184"></a>| nh_customer_vw       | YES          |</p>
<p class="calibre1">+----------------------+--------------+</p>
<p class="calibre1">5 rows in set (1.83 sec)</p>
<p class="calibre1">Additionally, you can retrieve the view’s underlying query using the view_definition column, as long as the query is small enough (4,000 characters or fewer for MySQL). </p>
<p class="calibre1">Column information for both tables and views is available via the columns view. The following query shows column information for the account table: mysql&gt; <b class="calibre3">SELECT column_name, data_type, character_maximum_length char_max_len, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">numeric_precision num_prcsn, numeric_scale num_scale</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.columns</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' AND table_name = 'account' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY ordinal_position; </b></p>
<p class="calibre1">+--------------------+-----------+--------------+-----------+-----------+</p>
<p class="calibre1">| column_name        | data_type | char_max_len | num_prcsn | num_scale |</p>
<p class="calibre1">+--------------------+-----------+--------------+-----------+-----------+</p>
<p class="calibre1">| account_id         | int       |         NULL |        10 |         0 |</p>
<p class="calibre1">| product_cd         | varchar   |           10 |      NULL |      NULL |</p>
<p class="calibre1">| cust_id            | int       |         NULL |        10 |         0 |</p>
<p class="calibre1">| open_date          | date      |         NULL |      NULL |      NULL |</p>
<p class="calibre1">| close_date         | date      |         NULL |      NULL |      NULL |</p>
<p class="calibre1">| last_activity_date | date      |         NULL |      NULL |      NULL |</p>
<p class="calibre1">| status             | enum      |            6 |      NULL |      NULL |</p>
<p class="calibre1">| open_branch_id     | smallint  |         NULL |         5 |         0 |</p>
<p class="calibre1">| open_emp_id        | smallint  |         NULL |         5 |         0 |</p>
<p class="calibre1">| avail_balance      | float     |         NULL |        10 |         2 |</p>
<p class="calibre1">| pending_balance    | float     |         NULL |        10 |         2 |</p>
<p class="calibre1">+--------------------+-----------+--------------+-----------+-----------+</p>
<p class="calibre1">11 rows in set (0.02 sec)</p>
<p class="calibre1">The ordinal_position column is included merely as a means to retrieve the columns in the order in which they were added to the table. </p>
<p class="calibre1">You can retrieve information about a table’s indexes via the information_schema.sta tistics view as demonstrated by the following query, which retrieves information for the indexes built on the account table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT index_name, non_unique, seq_in_index, column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.statistics</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' AND table_name = 'account' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1, 3; </b></p>
<p class="calibre1">+----------------+------------+--------------+----------------+</p>
<p class="calibre1">| index_name     | non_unique | seq_in_index | column_name    |</p>
<p class="calibre1">+----------------+------------+--------------+----------------+</p>
<p class="calibre1">| acc_bal_idx    |          1 |            1 | cust_id        |</p>
<p class="calibre1">| acc_bal_idx    |          1 |            2 | avail_balance  |</p>
<p class="calibre1">| fk_a_branch_id |          1 |            1 | open_branch_id |</p>
<p class="calibre1">| fk_a_emp_id    |          1 |            1 | open_emp_id    |</p>
<p class="calibre1">| fk_product_cd  |          1 |            1 | product_cd     |</p>
<p class="calibre1">| PRIMARY        |          0 |            1 | account_id     |</p>
<p class="calibre1">+----------------+------------+--------------+----------------+</p>
<p class="calibre1">6 rows in set (0.09 sec)</p>
<p class="calibre1"><b class="calibre3">260 | Chapter 15:</b> <b class="calibre3">Metadata</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-167"></a>The  account  table  has  a  total  of  five  indexes,  one  of  which  has  two  columns (acc_bal_idx) and one of which is a unique index (PRIMARY). </p>
<p class="calibre1">You can retrieve the different types of constraints (foreign key, primary key, unique) that have been created via the information_schema.table_constraints view. Here’s a query that retrieves all of the constraints in the bank schema: mysql&gt; <b class="calibre3">SELECT constraint_name, table_name, constraint_type</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.table_constraints</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 3,1; </b></p>
<p class="calibre1">+--------------------+--------------+-----------------+</p>
<p class="calibre1">| constraint_name    | table_name   | constraint_type |</p>
<p class="calibre1">+--------------------+--------------+-----------------+</p>
<p class="calibre1">| fk_a_branch_id     | account      | FOREIGN KEY     |</p>
<p class="calibre1">| fk_a_cust_id       | account      | FOREIGN KEY     |</p>
<p class="calibre1">| fk_a_emp_id        | account      | FOREIGN KEY     |</p>
<p class="calibre1">| fk_b_cust_id       | business     | FOREIGN KEY     |</p>
<p class="calibre1">| fk_dept_id         | employee     | FOREIGN KEY     |</p>
<p class="calibre1">| fk_exec_branch_id  | transaction  | FOREIGN KEY     |</p>
<p class="calibre1">| fk_e_branch_id     | employee     | FOREIGN KEY     |</p>
<p class="calibre1">| fk_e_emp_id        | employee     | FOREIGN KEY     |</p>
<p class="calibre1">| fk_i_cust_id       | individual   | FOREIGN KEY     |</p>
<p class="calibre1">| fk_o_cust_id       | officer      | FOREIGN KEY     |</p>
<p class="calibre1">| fk_product_cd      | account      | FOREIGN KEY     |</p>
<p class="calibre1">| fk_product_type_cd | product      | FOREIGN KEY     |</p>
<p class="calibre1">| fk_teller_emp_id   | transaction  | FOREIGN KEY     |</p>
<p class="calibre1">| fk_t_account_id    | transaction  | FOREIGN KEY     |</p>
<p class="calibre1">| PRIMARY            | branch       | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | account      | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | product      | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | department   | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | customer     | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | transaction  | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | officer      | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | product_type | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | employee     | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | business     | PRIMARY KEY     |</p>
<p class="calibre1">| PRIMARY            | individual   | PRIMARY KEY     |</p>
<p class="calibre1">| dept_name_idx      | department   | UNIQUE          |</p>
<p class="calibre1">+--------------------+--------------+-----------------+</p>
<p class="calibre1">26 rows in set (2.28 sec)</p>
<p class="calibre1"><a href="#calibre_link-167">Table  15-1  </a>shows  the  entire  set  of  information_schema  views  that  are  available  in MySQL version 6.0. </p>
<p class="calibre1"> <i class="calibre4">Table 15-1. Information_schema views</i></p>
<p class="calibre1"><b class="calibre3">View name</b></p>
<p class="calibre1"><b class="calibre3">Provides information about…</b></p>
<p class="calibre1">Schemata</p>
<p class="calibre1">Databases</p>
<p class="calibre1">Tables</p>
<p class="calibre1">Tables and views</p>
<p class="calibre1">Columns</p>
<p class="calibre1">Columns of tables and views</p>
<p class="calibre1">Statistics</p>
<p class="calibre1">Indexes</p>
<p class="calibre1"><b class="calibre3">Information_Schema | 261</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-145"></a><b class="calibre3">View name</b></p>
<p class="calibre1"><b class="calibre3">Provides information about…</b></p>
<p class="calibre1">User_Privileges</p>
<p class="calibre1">Who has privileges on which schema objects</p>
<p class="calibre1">Schema_Privileges</p>
<p class="calibre1">Who has privileges on which databases</p>
<p class="calibre1">Table_Privileges</p>
<p class="calibre1">Who has privileges on which tables</p>
<p class="calibre1">Column_Privileges</p>
<p class="calibre1">Who has privileges on which columns of which tables</p>
<p class="calibre1">Character_Sets</p>
<p class="calibre1">What character sets are available</p>
<p class="calibre1">Collations</p>
<p class="calibre1">What collations are available for which character sets</p>
<p class="calibre1">Collation_Character_Set_Applicability</p>
<p class="calibre1">Which character sets are available for which collation</p>
<p class="calibre1">Table_Constraints</p>
<p class="calibre1">The unique, foreign key, and primary key constraints</p>
<p class="calibre1">Key_Column_Usage</p>
<p class="calibre1">The constraints associated with each key column</p>
<p class="calibre1">Routines</p>
<p class="calibre1">Stored routines (procedures and functions)</p>
<p class="calibre1">Views</p>
<p class="calibre1">Views</p>
<p class="calibre1">Triggers</p>
<p class="calibre1">Table triggers</p>
<p class="calibre1">Plugins</p>
<p class="calibre1">Server plug-ins</p>
<p class="calibre1">Engines</p>
<p class="calibre1">Available storage engines</p>
<p class="calibre1">Partitions</p>
<p class="calibre1">Table partitions</p>
<p class="calibre1">Events</p>
<p class="calibre1">Scheduled events</p>
<p class="calibre1">Process_List</p>
<p class="calibre1">Running processes</p>
<p class="calibre1">Referential_Constraints</p>
<p class="calibre1">Foreign keys</p>
<p class="calibre1">Global_Status</p>
<p class="calibre1">Server status information</p>
<p class="calibre1">Session_Status</p>
<p class="calibre1">Session status information</p>
<p class="calibre1">Global_Variables</p>
<p class="calibre1">Server status variables</p>
<p class="calibre1">Session_Variables</p>
<p class="calibre1">Session status variables</p>
<p class="calibre1">Parameters</p>
<p class="calibre1">Stored procedure and function parameters</p>
<p class="calibre1">Profiling</p>
<p class="calibre1">User profiling information</p>
<p class="calibre1">While some of these views, such as engines, events, and plugins, are specific to MySQL, many of these views are available in SQL Server as well. If you are using Oracle Database, please consult the online <a href="http://www.oracle.com/pls/db111/portal.all_books">Oracle Database Reference Guide ( <i class="calibre4">http://www.oracle</i></a></p>
<p class="calibre1"><a href="http://www.oracle.com/pls/db111/portal.all_books"> <i class="calibre4">.com/pls/db111/portal.all_books</i></a>) for information about the user_, all_, and dba_ views. </p>
<p class="calibre1"><b class="calibre3">Working with Metadata</b></p>
<p class="calibre1">As I mentioned earlier, having the ability to retrieve information about your schema objects via SQL queries opens up some interesting possibilities. This section shows several ways in which you can make use of metadata in your applications. </p>
<p class="calibre1"><b class="calibre3">262 | Chapter 15:</b> <b class="calibre3">Metadata</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-146"></a><b class="calibre3">Schema Generation Scripts</b></p>
<p class="calibre1">While some project teams include a full-time database designer who oversees the design and implementation of the database, many projects take the “design-by-committee” </p>
<p class="calibre1">approach, allowing multiple people to create database objects. After several weeks or months of development, you may need to generate a script that will create the various tables, indexes, views, and so on that the team has deployed. Although a variety of tools and  utilities  will  generate  these  types  of  scripts  for  you,  you  can  also  query  the information_schema views and generate the script yourself. </p>
<p class="calibre1">As an example, let’s build a script that will create the bank.customer table. Here’s the command used to build the table, which I extracted from the script used to build the example database:</p>
<p class="calibre1">create table customer</p>
<p class="calibre1">(cust_id integer unsigned not null auto_increment, </p>
<p class="calibre1">fed_id varchar(12) not null, </p>
<p class="calibre1">cust_type_cd enum('I','B') not null, </p>
<p class="calibre1">address varchar(30), </p>
<p class="calibre1">city varchar(20), </p>
<p class="calibre1">state varchar(20), </p>
<p class="calibre1">postal_code varchar(10), </p>
<p class="calibre1">constraint pk_customer primary key (cust_id)</p>
<p class="calibre1">); </p>
<p class="calibre1">Although it would certainly be easier to generate the script with the use of a procedural language (e.g., Transact-SQL or Java), since this is a book about SQL I’m going to write a single query that will generate the create table statement. The first step is to query the information_schema.columns table to retrieve information about the columns in the table:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT 'CREATE TABLE customer (' create_table_statement</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT cols.txt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT concat('  ',column_name, ' ', column_type, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN is_nullable = 'NO' THEN ' not null' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE '' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN extra IS NOT NULL THEN concat(' ', extra)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE '' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">',') txt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.columns</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' AND table_name = 'customer' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY ordinal_position</b></p>
<p class="calibre1">-&gt; <b class="calibre3">) cols</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT ')'; </b></p>
<p class="calibre1">+-----------------------------------------------------+</p>
<p class="calibre1">| create_table_statement                              |</p>
<p class="calibre1"><b class="calibre3">Working with Metadata | 263</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-190"></a>+-----------------------------------------------------+</p>
<p class="calibre1">| CREATE TABLE customer (                             |</p>
<p class="calibre1">|   cust_id int(10) unsigned not null auto_increment, |</p>
<p class="calibre1">|   fed_id varchar(12) not null ,                     |</p>
<p class="calibre1">|   cust_type_cd enum('I','B') not null ,             |</p>
<p class="calibre1">|   address varchar(30) ,                             |</p>
<p class="calibre1">|   city varchar(20) ,                                |</p>
<p class="calibre1">|   state varchar(20) ,                               |</p>
<p class="calibre1">|   postal_code varchar(10) ,                         |</p>
<p class="calibre1">| )                                                   |</p>
<p class="calibre1">+-----------------------------------------------------+</p>
<p class="calibre1">9 rows in set (0.04 sec)</p>
<p class="calibre1">Well,  that  got  us  pretty  close;  we  just  need  to  add  queries  against  the table_constraints and key_column_usage views to retrieve information about the primary key constraint:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT 'CREATE TABLE customer (' create_table_statement</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT cols.txt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT concat('  ',column_name, ' ', column_type, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN is_nullable = 'NO' THEN ' not null' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE '' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN extra IS NOT NULL THEN concat(' ', extra)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE '' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">',') txt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.columns</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' AND table_name = 'customer' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY ordinal_position</b></p>
<p class="calibre1">-&gt; <b class="calibre3">) cols</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT concat('  constraint primary key (')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.table_constraints</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' AND table_name = 'customer' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND constraint_type = 'PRIMARY KEY' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT cols.txt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT concat(CASE WHEN ordinal_position &gt; 1 THEN '   ,' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE '    ' END, column_name) txt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.key_column_usage</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' AND table_name = 'customer' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND constraint_name = 'PRIMARY' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY ordinal_position</b></p>
<p class="calibre1">-&gt; <b class="calibre3">) cols</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT '  )' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT ')'; </b></p>
<p class="calibre1">+-----------------------------------------------------+</p>
<p class="calibre1"><b class="calibre3">264 | Chapter 15:</b> <b class="calibre3">Metadata</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-147"></a>| create_table_statement                              |</p>
<p class="calibre1">+-----------------------------------------------------+</p>
<p class="calibre1">| CREATE TABLE customer (                             |</p>
<p class="calibre1">|   cust_id int(10) unsigned not null auto_increment, |</p>
<p class="calibre1">|   fed_id varchar(12) not null ,                     |</p>
<p class="calibre1">|   cust_type_cd enum('I','B') not null ,             |</p>
<p class="calibre1">|   address varchar(30) ,                             |</p>
<p class="calibre1">|   city varchar(20) ,                                |</p>
<p class="calibre1">|   state varchar(20) ,                               |</p>
<p class="calibre1">|   postal_code varchar(10) ,                         |</p>
<p class="calibre1">|   constraint primary key (                          |</p>
<p class="calibre1">|     cust_id                                         |</p>
<p class="calibre1">|   )                                                 |</p>
<p class="calibre1">| )                                                   |</p>
<p class="calibre1">+-----------------------------------------------------+</p>
<p class="calibre1">12 rows in set (0.02 sec)</p>
<p class="calibre1">To see whether the statement is properly formed, I’ll paste the query output into the mysql tool (I’ve changed the table name to customer2 so that it won’t step on our other table):</p>
<p class="calibre1">mysql&gt; <b class="calibre3">CREATE TABLE customer2 (</b></p>
<p class="calibre1">-&gt; <b class="calibre3">cust_id int(10) unsigned not null auto_increment, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">fed_id varchar(12) not null , </b></p>
<p class="calibre1">-&gt; <b class="calibre3">cust_type_cd enum('I','B') not null , </b></p>
<p class="calibre1">-&gt; <b class="calibre3">address varchar(30) , </b></p>
<p class="calibre1">-&gt; <b class="calibre3">city varchar(20) , </b></p>
<p class="calibre1">-&gt; <b class="calibre3">state varchar(20) , </b></p>
<p class="calibre1">-&gt; <b class="calibre3">postal_code varchar(10) , </b></p>
<p class="calibre1">-&gt; <b class="calibre3">constraint primary key (</b></p>
<p class="calibre1">-&gt; <b class="calibre3">cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">); </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.14 sec)</p>
<p class="calibre1">The  statement  executed  without  errors,  and  there  is  now  a  customer2  table  in  the bank database. In order for the query to generate a well-formed create table statement for  <i class="calibre4">any</i> table, more work is required (such as handling indexes and foreign key constraints), but I’ll leave that as an exercise. </p>
<p class="calibre1"><b class="calibre3">Deployment Verification</b></p>
<p class="calibre1">Many organizations allow for database maintenance windows, wherein existing database  objects  may  be  administered  (such  as  adding/dropping  partitions)  and  new schema objects and code can be deployed. After the deployment scripts have been run, it’s a good idea to run a verification script to ensure that the new schema objects are in place with the appropriate columns, indexes, primary keys, and so forth. Here’s a query that returns the number of columns, number of indexes, and number of primary key constraints (0 or 1) for each table in the bank schema:</p>
<p class="calibre1"><b class="calibre3">Working with Metadata | 265</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-148"></a>mysql&gt; <b class="calibre3">SELECT tbl.table_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT count(*) FROM information_schema.columns clm</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE clm.table_schema = tbl.table_schema</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND clm.table_name = tbl.table_name) num_columns, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT count(*) FROM information_schema.statistics sta</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE sta.table_schema = tbl.table_schema</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND sta.table_name = tbl.table_name) num_indexes, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT count(*) FROM information_schema.table_constraints tc</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE tc.table_schema = tbl.table_schema</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND tc.table_name = tbl.table_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND tc.constraint_type = 'PRIMARY KEY') num_primary_keys</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.tables tbl</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE tbl.table_schema = 'bank' AND tbl.table_type = 'BASE TABLE' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 1; </b></p>
<p class="calibre1">+--------------+-------------+-------------+------------------+</p>
<p class="calibre1">| table_name   | num_columns | num_indexes | num_primary_keys |</p>
<p class="calibre1">+--------------+-------------+-------------+------------------+</p>
<p class="calibre1">| account      |          11 |           6 |                1 |</p>
<p class="calibre1">| branch       |           6 |           1 |                1 |</p>
<p class="calibre1">| business     |           4 |           1 |                1 |</p>
<p class="calibre1">| customer     |           7 |           1 |                1 |</p>
<p class="calibre1">| department   |           2 |           2 |                1 |</p>
<p class="calibre1">| employee     |           9 |           4 |                1 |</p>
<p class="calibre1">| individual   |           4 |           1 |                1 |</p>
<p class="calibre1">| officer      |           7 |           2 |                1 |</p>
<p class="calibre1">| product      |           5 |           2 |                1 |</p>
<p class="calibre1">| product_type |           2 |           1 |                1 |</p>
<p class="calibre1">| transaction  |           8 |           4 |                1 |</p>
<p class="calibre1">+--------------+-------------+-------------+------------------+</p>
<p class="calibre1">11 rows in set (13.83 sec)</p>
<p class="calibre1">You could execute this statement before and after the deployment and then verify any differences between the two sets of results before declaring the deployment a success. </p>
<p class="calibre1"><b class="calibre3">Dynamic SQL Generation</b></p>
<p class="calibre1">Some languages, such as Oracle’s PL/SQL and Microsoft’s Transact-SQL, are supersets of the SQL language, meaning that they include SQL statements in their grammar along with the usual procedural constructs, such as “if-then-else” and “while.” Other languages, such as Java, include the ability to interface with a relational database, but do not include SQL statements in the grammar, meaning that all SQL statements must be contained within strings. </p>
<p class="calibre1">Therefore, most relational database servers, including SQL Server, Oracle Database, and MySQL, allow SQL statements to be submitted to the server as strings. Submitting strings to a database engine rather than utilizing its SQL interface is generally known as  <i class="calibre4">dynamic SQL execution</i>. Oracle’s PL/SQL language, for example, includes an execute immediate command, which you can use to submit a string for execution, while SQL</p>
<p class="calibre1">Server  includes  a  system  stored  procedure  called  sp_executesql  for  executing  SQL</p>
<p class="calibre1">statements dynamically. </p>
<p class="calibre1"><b class="calibre3">266 | Chapter 15:</b> <b class="calibre3">Metadata</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-198"></a>MySQL provides the statements prepare, execute, and deallocate to allow for dynamic SQL execution. Here’s a simple example:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SET @qry = 'SELECT cust_id, cust_type_cd, fed_id FROM customer';</b> Query OK, 0 rows affected (0.07 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">PREPARE dynsql1 FROM @qry; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.04 sec)</p>
<p class="calibre1">Statement prepared</p>
<p class="calibre1">mysql&gt; <b class="calibre3">EXECUTE dynsql1; </b></p>
<p class="calibre1">+---------+--------------+-------------+</p>
<p class="calibre1">| cust_id | cust_type_cd | fed_id      |</p>
<p class="calibre1">+---------+--------------+-------------+</p>
<p class="calibre1">|       1 | I            | 111-11-1111 |</p>
<p class="calibre1">|       2 | I            | 222-22-2222 |</p>
<p class="calibre1">|       3 | I            | 333-33-3333 |</p>
<p class="calibre1">|       4 | I            | 444-44-4444 |</p>
<p class="calibre1">|       5 | I            | 555-55-5555 |</p>
<p class="calibre1">|       6 | I            | 666-66-6666 |</p>
<p class="calibre1">|       7 | I            | 777-77-7777 |</p>
<p class="calibre1">|       8 | I            | 888-88-8888 |</p>
<p class="calibre1">|       9 | I            | 999-99-9999 |</p>
<p class="calibre1">|      10 | B            | 04-1111111  |</p>
<p class="calibre1">|      11 | B            | 04-2222222  |</p>
<p class="calibre1">|      12 | B            | 04-3333333  |</p>
<p class="calibre1">|      13 | B            | 04-4444444  |</p>
<p class="calibre1">|      99 | I            | 04-9999999  |</p>
<p class="calibre1">+---------+--------------+-------------+</p>
<p class="calibre1">14 rows in set (0.27 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DEALLOCATE PREPARE dynsql1; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">The set statement simply assigns a string to the qry variable, which is then submitted to  the  database  engine  (for  parsing,  security  checking,  and  optimization)  using  the prepare statement. After executing the statement by calling execute, the statement must be closed using deallocate prepare, which frees any database resources (e.g., cursors) that have been utilized during execution. </p>
<p class="calibre1">The next example shows how you could execute a query that includes placeholders so that conditions can be specified at runtime:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SET @qry = 'SELECT product_cd, name, product_type_cd, date_offered, date_</b></p>
<p class="calibre1"><b class="calibre3">retired FROM product WHERE product_cd = ?'; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">PREPARE dynsql2 FROM @qry; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">Statement prepared</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SET @prodcd = 'CHK'; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">EXECUTE dynsql2 USING @prodcd; </b></p>
<p class="calibre1"><b class="calibre3">Working with Metadata | 267</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-210"></a>+------------+------------------+-----------------+--------------+-------------+</p>
<p class="calibre1">| product_cd | name             | product_type_cd | date_offered | date_retired|</p>
<p class="calibre1">+------------+------------------+-----------------+--------------+-------------+</p>
<p class="calibre1">| CHK        | checking account | ACCOUNT         | 2004-01-01   | NULL        |</p>
<p class="calibre1">+------------+------------------+-----------------+--------------+-------------+</p>
<p class="calibre1">1 row in set (0.01 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SET @prodcd = 'SAV'; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">EXECUTE dynsql2 USING @prodcd; </b></p>
<p class="calibre1">+------------+-----------------+-----------------+--------------+--------------+</p>
<p class="calibre1">| product_cd | name            | product_type_cd | date_offered | date_retired |</p>
<p class="calibre1">+------------+-----------------+-----------------+--------------+--------------+</p>
<p class="calibre1">| SAV        | savings account | ACCOUNT         | 2004-01-01   | NULL         |</p>
<p class="calibre1">+------------+-----------------+-----------------+--------------+--------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DEALLOCATE PREPARE dynsql2; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">In this sequence, the query contains a placeholder (the ? at the end of the statement) so that the product code can be submitted at runtime. The statement is prepared once and  then  executed  twice,  once  for  product  code  'CHK'  and  again  for  product  code</p>
<p class="calibre1">'SAV', after which the statement is closed. </p>
<p class="calibre1">What, you may wonder, does this have to do with metadata? Well, if you are going to use dynamic SQL to query a table, why not build the query string using metadata rather than hardcoding the table definition? The following example generates the same dynamic SQL string as the previous example, but it retrieves the column names from the information_schema.columns view:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT concat('SELECT ', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">concat_ws(',', cols.col1, cols.col2, cols.col3, cols.col4, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">cols.col5, cols.col6, cols.col7, cols.col8, cols.col9), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">' FROM product WHERE product_cd = ?')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTO @qry</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT</b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 1 THEN column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col1, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 2 THEN column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col2, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 3 THEN column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col3, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 4 THEN column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col4, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 5 THEN column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col5, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 6 THEN column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col6, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 7 THEN column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col7, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 8 THEN column_name</b></p>
<p class="calibre1"><b class="calibre3">268 | Chapter 15:</b> <b class="calibre3">Metadata</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-316"></a><img src="images/000040.png" alt="Image 51" class="calibre2" /></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col8, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">max(CASE WHEN ordinal_position = 9 THEN column_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE NULL END) col9</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.columns</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank' AND table_name = 'product' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY table_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">) cols; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.02 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT @qry; </b></p>
<p class="calibre1">+-------------------------------------------------------------------------------</p>
<p class="calibre1">---------------------+</p>
<p class="calibre1">| @qry</p>
<p class="calibre1">|</p>
<p class="calibre1">+-------------------------------------------------------------------------------</p>
<p class="calibre1">---------------------+</p>
<p class="calibre1">| SELECT product_cd,name,product_type_cd,date_offered,date_retired FROM product WHERE product_cd = ? |</p>
<p class="calibre1">+-------------------------------------------------------------------------------</p>
<p class="calibre1">---------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">PREPARE dynsql3 FROM @qry; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.01 sec)</p>
<p class="calibre1">Statement prepared</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SET @prodcd = 'MM'; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">EXECUTE dynsql3 USING @prodcd; </b></p>
<p class="calibre1">+------------+----------------------+-----------------+--------------+--------------+</p>
<p class="calibre1">| product_cd | name                 | product_type_cd | date_offered | date_retired |</p>
<p class="calibre1">+------------+----------------------+-----------------+--------------+--------------+</p>
<p class="calibre1">| MM         | money market account | ACCOUNT         | 2004-01-01   | NULL         |</p>
<p class="calibre1">+------------+----------------------+-----------------+--------------+--------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DEALLOCATE PREPARE dynsql3; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">The query pivots the first nine columns in the product table, builds a query string using the concat and concat_ws functions, and assigns the string to the qry variable. The query string is then executed as before. </p>
<p class="calibre1">Generally, it would be better to generate the query using a procedural language that includes looping constructs, such as Java, PL/SQL, Transact-SQL, or MySQL’s Stored Procedure Language. However, I wanted to demonstrate a pure SQL example, so I had to limit the number of columns retrieved to some reasonable number, which in this example is nine. </p>
<p class="calibre1"><b class="calibre3">Working with Metadata | 269</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-149"></a><b class="calibre3">Test Your Knowledge</b></p>
<p class="calibre1">The following exercises are designed to test your understanding of metadata. When</p>
<p class="calibre1"><a href="#calibre_link-152">you’re finished, please see Appendix C for the solutions. </a></p>
<p class="calibre1"><b class="calibre3">Exercise 15-1</b></p>
<p class="calibre1">Write a query that lists all of the indexes in the bank schema. Include the table names. </p>
<p class="calibre1"><b class="calibre3">Exercise 15-2</b></p>
<p class="calibre1">Write a query that generates output that can be used to create all of the indexes on the bank.employee table. Output should be of the form:</p>
<p class="calibre1">"ALTER TABLE &lt;table_name&gt; ADD INDEX &lt;index_name&gt; (&lt;column_list&gt;)" </p>
<p class="calibre1"><b class="calibre3">270 | Chapter 15:</b> <b class="calibre3">Metadata</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-150"></a><b class="calibre3">APPENDIX A</b></p>
<p class="calibre1"><b class="calibre3">ER Diagram for Example Database</b></p>
<p class="calibre1"><a href="#calibre_link-168">Figure A-1 </a>is an entity-relationship (ER) diagram for the example database used in this book. As the name suggests, the diagram depicts the entities, or tables, in the database along with the foreign-key relationships between the tables. Here are a few tips to help you understand the notation:</p>
<p class="calibre1">• Each rectangle represents a table, with the table name above the upper-left corner of the rectangle. The primary-key column(s) are listed first and are separated from nonkey columns by a line. Nonkey columns are listed below the line, and foreign key columns are marked with “(FK).” </p>
<p class="calibre1">• Lines between tables represent foreign key relationships. The markings at either end of the lines represents the allowable quantity, which can be zero (0), one (1), or many ( ). For example, if you look at the relationship between the account and product tables, you would say that an account must belong to exactly one product, but a product may have zero, one, or many accounts. </p>
<p class="calibre1">For more information on entity-relationship modeling, please see <a href="http://en.wikipedia.org/wiki/Entity-relationship_model"> <i class="calibre4">http://en.wikipedia</i></a></p>
<p class="calibre1"><a href="http://en.wikipedia.org/wiki/Entity-relationship_model"> <i class="calibre4">.org/wiki/Entity-relationship_model</i>. </a></p>
<p class="calibre1"><b class="calibre3">271</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-168"></a>branch</p>
<p class="calibre1">branch_id: smallint unsigned</p>
<p class="calibre1">name: varchar(20)</p>
<p class="calibre1">department</p>
<p class="calibre1">address: varchar(30)</p>
<p class="calibre1">city: varchar(20)</p>
<p class="calibre1">dept_id: smallint unsigned</p>
<p class="calibre1">state: varchar(2)</p>
<p class="calibre1">zip: varchar(12)</p>
<p class="calibre1">name: varchar(20)</p>
<p class="calibre1">product_type</p>
<p class="calibre1">employee</p>
<p class="calibre1">product_type_cd: varchar(10)</p>
<p class="calibre1">emp_id: smallint unsigned</p>
<p class="calibre1">name: varchar(50)</p>
<p class="calibre1">fname: varchar(20)</p>
<p class="calibre1">lname: varchar(20)</p>
<p class="calibre1">start_date: date</p>
<p class="calibre1">end_date: date</p>
<p class="calibre1">product</p>
<p class="calibre1">superior_emp_id: smallint unsigned (FK)</p>
<p class="calibre1">dept_id: smallint unsigned (FK)</p>
<p class="calibre1">product_cd: varchar(10)</p>
<p class="calibre1">title: varchar(20)</p>
<p class="calibre1">assigned_branch_id: smallint unsigned (FK)</p>
<p class="calibre1">name: varchar(50)</p>
<p class="calibre1">product_type_cd: varchar(10) (FK)</p>
<p class="calibre1">date_offered: date</p>
<p class="calibre1">date_retired: date</p>
<p class="calibre1">account</p>
<p class="calibre1">account_id: integer unsigned</p>
<p class="calibre1">transaction</p>
<p class="calibre1">txn_id: integer unsigned</p>
<p class="calibre1">product_cd: varchar(10) (FK)</p>
<p class="calibre1">cust_id: integer unsigned (FK)</p>
<p class="calibre1">txn_date: datetime</p>
<p class="calibre1">open_date: date</p>
<p class="calibre1">account_id: integer unsigned (FK)</p>
<p class="calibre1">close_date: date</p>
<p class="calibre1">txn_type_cd: varchar(10)</p>
<p class="calibre1">last_activity_date: date</p>
<p class="calibre1">amount: double(10,2)</p>
<p class="calibre1">status: varchar(10)</p>
<p class="calibre1">teller_emp_id: smallint unsigned (FK)</p>
<p class="calibre1">open_branch_id: smallint unsigned (FK)</p>
<p class="calibre1">execution_branch_id: smallint unsigned (FK)</p>
<p class="calibre1">open_emp_id: smallint unsigned (FK)</p>
<p class="calibre1">funds_avail_date: datetime</p>
<p class="calibre1">avail_balance: float(10,2)</p>
<p class="calibre1">pending_balance: float(10,2)</p>
<p class="calibre1">customer</p>
<p class="calibre1">cust_id: integer unsigned</p>
<p class="calibre1">fed_id: varchar(12)</p>
<p class="calibre1">cust_type_cd: char(2)</p>
<p class="calibre1">address: varchar(30)</p>
<p class="calibre1">city: varchar(20)</p>
<p class="calibre1">state: varchar(20)</p>
<p class="calibre1">postal_code: varchar(10)</p>
<p class="calibre1">officer</p>
<p class="calibre1">business</p>
<p class="calibre1">individual</p>
<p class="calibre1">officer_id: smallint unsigned</p>
<p class="calibre1">cust_id: integer unsigned (FK)</p>
<p class="calibre1">cust_id: integer unsigned (FK)</p>
<p class="calibre1">cust_id: integer unsigned (FK)</p>
<p class="calibre1">name: varchar(40)</p>
<p class="calibre1">fname: varchar(30)</p>
<p class="calibre1">fname: varchar(30)</p>
<p class="calibre1">state_id: varchar(10)</p>
<p class="calibre1">lname: varchar(30)</p>
<p class="calibre1">lname: varchar(30)</p>
<p class="calibre1">incorp_date: date</p>
<p class="calibre1">birth_date: date</p>
<p class="calibre1">title: varchar(20)</p>
<p class="calibre1">start_date: date</p>
<p class="calibre1">end_date: date</p>
<p class="calibre1"> <i class="calibre4">Figure A-1. ER diagram</i></p>
<p class="calibre1"><b class="calibre3">272 | Appendix A:</b> <b class="calibre3">ER Diagram for Example Database</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-151"></a><b class="calibre3">APPENDIX B</b></p>
<p class="calibre1"><b class="calibre3">MySQL Extensions to the SQL Language</b></p>
<p class="calibre1">Since this book uses the MySQL server for all the examples, I thought it would be useful for readers who are planning to continue using MySQL to include an appendix on MySQL’s extensions to the SQL language. This appendix explores some of MySQL’s extensions to the select, insert, update, and delete statements that can be very useful in certain situations. </p>
<p class="calibre1"><b class="calibre3">Extensions to the select Statement</b></p>
<p class="calibre1">MySQL’s  implementation  of  the  select  statement  includes  two  additional  clauses, which are discussed in the following subsections. </p>
<p class="calibre1"><b class="calibre3">The limit Clause</b></p>
<p class="calibre1">In some situations, you may not be interested in  <i class="calibre4">all</i> of the rows returned by a query. </p>
<p class="calibre1">For example, you might construct a query that returns all of the bank tellers along with the number of accounts opened by each teller. If your reason for executing the query is to determine the top three tellers so that they can receive an award from the bank, then you don’t necessarily need to know who came in fourth, fifth, and so on. To help with these types of situations, MySQL’s select statement includes the limit clause, which allows you to restrict the number of rows returned by a query. </p>
<p class="calibre1">To demonstrate the utility of the limit clause, I will begin by constructing a query to show the number of accounts opened by each bank teller:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id; </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|           1 |        8 |</p>
<p class="calibre1">|          10 |        7 |</p>
<p class="calibre1">|          13 |        3 |</p>
<p class="calibre1">|          16 |        6 |</p>
<p class="calibre1"><b class="calibre3">273</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-251"></a>+-------------+----------+</p>
<p class="calibre1">4 rows in set (0.31 sec)</p>
<p class="calibre1">The results show that four different tellers opened accounts; if you want to limit the result set to only three records, you can add a limit clause specifying that only three records be returned:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LIMIT 3; </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|           1 |        8 |</p>
<p class="calibre1">|          10 |        7 |</p>
<p class="calibre1">|          13 |        3 |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">3 rows in set (0.06 sec)</p>
<p class="calibre1">Thanks to the limit clause (the fourth line of the query), the result set now includes exactly three records, and the fourth teller (employee ID 16) has been discarded from the result set. </p>
<p class="calibre1"><b class="calibre3">Combining the limit clause with the order by clause</b></p>
<p class="calibre1">While the previous query returns three records, there’s one small problem; you haven’t described  <i class="calibre4">which</i> three of the four records you are interested in. If you are looking for three  <i class="calibre4">specific</i> records, such as the three tellers who opened the most accounts, you will need to use the limit clause in concert with an order by clause, as in: mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY how_many DESC</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LIMIT 3; </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|           1 |        8 |</p>
<p class="calibre1">|          10 |        7 |</p>
<p class="calibre1">|          16 |        6 |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">3 rows in set (0.03 sec)</p>
<p class="calibre1">The difference between this query and the previous query is that the limit clause is now being applied to an ordered set, resulting in the three tellers with the most opened accounts being included in the final result set. Unless you are interested in seeing only an arbitrary sample of records, you will generally want to use an order by clause along with a limit clause. </p>
<p class="calibre1"><b class="calibre3">274 | Appendix B:</b> <b class="calibre3">MySQL Extensions to the SQL Language</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-252"></a><img src="images/000041.png" alt="Image 52" class="calibre2" /></p>
<p class="calibre1">The limit clause is applied after all filtering, grouping, and ordering have occurred, so it will never change the outcome of your select statement  other  than  restricting  the  number  of  records  returned  by  the statement. </p>
<p class="calibre1"><b class="calibre3">The limit clause’s optional second parameter</b></p>
<p class="calibre1">Instead of finding the top three tellers, let’s say your goal is to identify all but the top two tellers (instead of giving awards to top performers, the bank will be sending some of the less-productive tellers to assertiveness training). For these types of situations, the limit clause allows for an optional second parameter; when two parameters are used, the first designates at which record to begin adding records to the final result set, and the  second  designates  how  many  records  to  include.  When  specifying  a  record  by number, remember that MySQL designates the first record as record 0. Therefore, if your goal is to find the third-best performer, you can do the following: mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY how_many DESC</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LIMIT 2, 1; </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|          16 |        6 |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">In this example, the zeroth and first records are discarded, and records are included starting at the second record. Since the second parameter in the limit clause is 1, only a single record is included. </p>
<p class="calibre1">If you want to start at the second position and include  <i class="calibre4">all</i> the remaining records, you can make the second argument to the limit clause large enough to guarantee that all remaining records are included. If you do not know how many tellers opened new accounts, therefore, you might do something like the following to find all but the top two performers:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY how_many DESC</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LIMIT 2, 999999999; </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|          16 |        6 |</p>
<p class="calibre1">|          13 |        3 |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">2 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">Extensions to the select Statement | 275</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-253"></a>In  this  version  of  the  query,  the  zeroth  and  first  records  are  discarded,  and  up  to 999,999,999 records are included starting at the second record (in this case, there are only two more, but it’s better to go a bit overboard rather than taking a chance on excluding valid records from your final result set because you underestimated). </p>
<p class="calibre1"><b class="calibre3">Ranking queries</b></p>
<p class="calibre1">When used in conjunction with an order by clause, queries that include a limit clause can be called  <i class="calibre4">ranking queries</i> because they allow you to rank your data. While I have demonstrated how to rank bank tellers by the number of opened accounts, ranking queries are used to answer many different types of business questions, such as:</p>
<p class="calibre1">• Who are our top five salespeople for 2005? </p>
<p class="calibre1">• Who has the third-most home runs in the history of baseball? </p>
<p class="calibre1">• Other than  <i class="calibre4">The Holy Bible</i> and  <i class="calibre4">Quotations from Chairman Mao</i>, what are the next 98 best-selling books of all time? </p>
<p class="calibre1">• What are our two worst-selling flavors of ice cream? </p>
<p class="calibre1">So far, I have shown how to find the top three tellers, the third-best teller, and all but the top two tellers. If I want to do something analogous to the fourth example (i.e., find the  <i class="calibre4">worst</i> performers), I need only reverse the sort order so that the results proceed from lowest number of accounts opened to highest number of accounts opened, as in: mysql&gt; <b class="calibre3">SELECT open_emp_id, COUNT(*) how_many</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY how_many ASC</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LIMIT 2; </b></p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">| open_emp_id | how_many |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">|          13 |        3 |</p>
<p class="calibre1">|          16 |        6 |</p>
<p class="calibre1">+-------------+----------+</p>
<p class="calibre1">2 rows in set (0.24 sec)</p>
<p class="calibre1">By simply changing the sort order (from ORDER BY how_many DESC to ORDER BY how_many ASC), the query now returns the two worst-performing tellers. Therefore, by using a limit clause with either an ascending or descending sort order, you can produce ranking queries to answer most types of business questions. </p>
<p class="calibre1"><b class="calibre3">The into outfile Clause</b></p>
<p class="calibre1">If you want the output from your query to be written to a file, you could highlight the query results, copy them to the buffer, and paste them into your favorite editor. However, if the query’s result set is sufficiently large, or if the query is being executed from within a script, you will need a way to write the results to a file without your intervention. To aid in such situations, MySQL includes the into outfile clause to allow you <b class="calibre3">276 | Appendix B:</b> <b class="calibre3">MySQL Extensions to the SQL Language</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-317"></a><img src="images/000042.png" alt="Image 53" class="calibre2" /></p>
<p class="calibre1"><img src="images/000043.png" alt="Image 54" class="calibre2" /></p>
<p class="calibre1">to provide the name of a file into which the results will be written. Here’s an example that writes the query results to a file in my  <i class="calibre4">c:\temp</i> directory: mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTO OUTFILE 'C:\\TEMP\\emp_list.txt' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b> Query OK, 18 rows affected (0.20 sec) If you remember <a href="#calibre_link-67">from Chapter 7, </a>the backslash is used to escape another character within a string. If you’re a Windows user, therefore, you will need to enter two backslashes in a row when building pathnames. </p>
<p class="calibre1">Rather than showing the query results on the screen, the result set has been written to the  <i class="calibre4">emp_list.txt</i> file, which looks as follows:</p>
<p class="calibre1">1    Michael    Smith    2001-06-22</p>
<p class="calibre1">2    Susan    Barker    2002-09-12</p>
<p class="calibre1">3    Robert    Tyler    2000-02-09</p>
<p class="calibre1">4    Susan    Hawthorne    2002-04-24</p>
<p class="calibre1">... </p>
<p class="calibre1">16    Theresa    Markham    2001-03-15</p>
<p class="calibre1">17    Beth    Fowler    2002-06-29</p>
<p class="calibre1">18    Rick    Tulman    2002-12-12</p>
<p class="calibre1">The default format uses tabs ('\t') between columns and newlines ('\n') after each record. If you want more control over the format of the data, several additional subclauses are available with the into outfile clause. For example, if you want the data to be in what is referred to as  <i class="calibre4">pipe-delimited format</i>, you can use the fields subclause to ask that the '|' character be placed between each column, as in: mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTO OUTFILE 'C:\\TEMP\\emp_list_delim.txt' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">FIELDS TERMINATED BY '|' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b> Query OK, 18 rows affected (0.02 sec) MySQL does not allow you to overwrite an existing file when using into outfile, so you will need to remove an existing file first if you run the same query more than once. </p>
<p class="calibre1">The contents of the  <i class="calibre4">emp_list_delim.txt</i> file look as follows: 1|Michael|Smith|2001-06-22</p>
<p class="calibre1">2|Susan|Barker|2002-09-12</p>
<p class="calibre1">3|Robert|Tyler|2000-02-09</p>
<p class="calibre1">4|Susan|Hawthorne|2002-04-24</p>
<p class="calibre1">... </p>
<p class="calibre1">16|Theresa|Markham|2001-03-15</p>
<p class="calibre1">17|Beth|Fowler|2002-06-29</p>
<p class="calibre1">18|Rick|Tulman|2002-12-12</p>
<p class="calibre1"><b class="calibre3">Extensions to the select Statement | 277</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-318"></a>Along with pipe-delimited format, you may need your data in  <i class="calibre4">comma-delimited format</i>, in which case you would use fields terminated by ','. If the data being written to a file includes strings, however, using commas as field separators can prove problematic, as commas are much more likely to appear within strings than the pipe character. Consider the following query, which writes a number and two strings delimited by commas to the  <i class="calibre4">comma1.txt</i> file:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT data.num, data.str1, data.str2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTO OUTFILE 'C:\\TEMP\\comma1.txt' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">FIELDS TERMINATED BY ',' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 1 num, 'This string has no commas' str1, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'This string, however, has two commas' str2) data; </b></p>
<p class="calibre1">Query OK, 1 row affected (0.04 sec)</p>
<p class="calibre1">Since the third column in the output file (str2) is a string containing commas, you might think that an application attempting to read the  <i class="calibre4">comma1.txt</i> file will encounter problems when parsing each line into columns, but the MySQL server has made provisions for such situations. Here are the contents of  <i class="calibre4">comma1.txt</i>: 1,This string has no commas,This string\, however\, has two commas As you can see, the commas within the third column have been escaped by putting a backslash before the two commas embedded in the str2 column. If you run the same query but use pipe-delimited format, the commas will  <i class="calibre4">not</i> be escaped, since they don’t need to be. If you want to use a different escape character, such as using another comma, you can use the fields escaped by subclause to specify the escape character to use for your output file. </p>
<p class="calibre1">Along with specifying column separators, you can also specify the character used to separate the different records in your datafile. If you would like each record in the output file to be separated by something other than the newline character, you can use the lines subclause, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname, start_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INTO OUTFILE 'C:\\TEMP\\emp_list_atsign.txt' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">FIELDS TERMINATED BY '|' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">LINES TERMINATED BY '@' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b></p>
<p class="calibre1">Query OK, 18 rows affected (0.03 sec)</p>
<p class="calibre1">Because I am not using a newline character between records, the  <i class="calibre4">emp_list_atsign.txt</i> file looks like a single long line of text when viewed, with each record separated by the</p>
<p class="calibre1">'@' character:</p>
<p class="calibre1">1|Michael|Smith|2001-06-22@2|Susan|Barker|2002-09-12@3|Robert|Tyler|2000-02-09@4|Susan|Hawthorne|2002-04-24@5|John|Gooding|2003-11-14@6|Helen|Fleming|2004-03-17@7|Chris|Tucker|2004-09-15@8|Sarah|Parker|2002-12-02@9|Jane|Grossman|2002-05-03@10|Paula|Roberts|2002-07-27@11|Thomas|Ziegler|2000-10-23@12|Samantha|Jameson|2003-01-08@13|John|Blake|2000-05-11@14|Cindy|Mason|2002-08-09@15|Frank|Portman|2003-04-01@16|Theresa|Markham|2001-03-15@17|Beth|Fowler|2002-06-29@18|Rick|Tulman|2002-12-12@</p>
<p class="calibre1"><b class="calibre3">278 | Appendix B:</b> <b class="calibre3">MySQL Extensions to the SQL Language</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-254"></a>If you need to generate a datafile to be loaded into a spreadsheet application or sent within or outside your organization, the into outfile clause should provide enough flexibility for whatever file format you need. </p>
<p class="calibre1"><b class="calibre3">Combination Insert/Update Statements</b></p>
<p class="calibre1">Let’s say that you have been asked to create a table to capture information about which of the bank’s branches are visited by which customers. The table needs to contain the customer’s ID, the branch’s ID, and a datetime column indicating the last time the customer visited the branch. Rows are added to the table whenever a customer visits a certain branch, but if the customer has already visited the branch, then the existing row should simply have its datetime column updated. Here’s the table definition: CREATE TABLE branch_usage</p>
<p class="calibre1">(branch_id SMALLINT UNSIGNED NOT NULL, </p>
<p class="calibre1">cust_id INTEGER UNSIGNED NOT NULL, </p>
<p class="calibre1">last_visited_on DATETIME, </p>
<p class="calibre1">CONSTRAINT pk_branch_usage PRIMARY KEY (branch_id, cust_id)</p>
<p class="calibre1">); </p>
<p class="calibre1">Along with the three column definitions, the branch_usage table defines a primary key constraint on the branch_id and cust_id columns. Therefore, the server will reject any row added to the table whose branch/customer pair already exists in the table. </p>
<p class="calibre1">Let’s say that, after the table is in place, customer ID 5 visits the main branch (branch ID 1) three times in the first week. After the first visit, you can insert a record into the branch_usage table, since no record exists yet for customer ID 5 and branch ID 1: mysql&gt; <b class="calibre3">INSERT INTO branch_usage (branch_id, cust_id, last_visited_on)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (1, 5, CURRENT_TIMESTAMP()); </b></p>
<p class="calibre1">Query OK, 1 row affected (0.02 sec)</p>
<p class="calibre1">The next time the customer visits the same branch, however, you will need to  <i class="calibre4">update</i> the existing record rather than inserting a new record; otherwise, you will receive the following error:</p>
<p class="calibre1">ERROR 1062 (23000): Duplicate entry '1-5' for key 1</p>
<p class="calibre1">To  avoid  this  error,  you  can  query  the  branch_usage  table  to  see  whether  a  given customer/branch pair exists and then either insert a record if no record is found or update  the  existing  row  if  it  already  exists.  To  save  you  the  trouble,  however,  the MySQL designers have extended the insert statement to allow you to specify that one or more columns be modified if an insert statement fails due to a duplicate key. The following statement instructs the server to modify the last_visited_on column if the given customer and branch already exist in the branch_usage table: mysql&gt; <b class="calibre3">INSERT INTO branch_usage (branch_id, cust_id, last_visited_on)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">VALUES (1, 5, CURRENT_TIMESTAMP())</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON DUPLICATE KEY UPDATE last_visited_on = CURRENT_TIMESTAMP();</b> Query OK, 2 rows affected (0.02 sec)</p>
<p class="calibre1"><b class="calibre3">Combination Insert/Update Statements | 279</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-255"></a>The on duplicate key clause allows this same statement to be executed every time customer ID 5 conducts business in branch ID 1. If run 100 times, the first execution results in a single row being added to the table, and the next 99 executions result in the last_visited_on column being changed to the current time. This type of operation is often referred to as an  <i class="calibre4">upsert</i>, since it is a combination of an update and an insert statement. </p>
<p class="calibre1"><b class="calibre3">Replacing the replace Command</b></p>
<p class="calibre1">Prior to version 4.1 of the MySQL server, upsert operations were performed using the replace command, which is a proprietary statement that first deletes an existing row if the primary key value already exists in the table before inserting a row. If you are using version 4.1 or later, you can choose between the replace command and the insert...on duplicate key command when performing upsert operations. </p>
<p class="calibre1">However, the replace command performs a delete operation when duplicate key values are encountered, which can cause a ripple effect if you are using the InnoDB storage engine and have foreign key constraints enabled. If the constraints have been created with the on delete cascade option, then rows in other tables may also be automatically deleted when the replace command deletes a row in the target table. For this reason, it is generally regarded as safer to use the on duplicate key clause of the insert statement rather than the older replace command. </p>
<p class="calibre1"><b class="calibre3">Ordered Updates and Deletes</b></p>
<p class="calibre1">Earlier in the appendix, I showed you how to write queries using the limit clause in conjunction with an order by clause to generate rankings, such as the top three tellers in terms of accounts opened. MySQL also allows the limit and order by clauses to be used in both update and delete statements, thereby allowing you to modify or remove specific rows in a table based on a ranking. For example, imagine that you are asked to  remove  records  from  a  table  used  to  track  customer  logins  to  the  bank’s  online banking system. The table, which tracks the customer ID and date/time of login, looks as follows:</p>
<p class="calibre1">CREATE TABLE login_history</p>
<p class="calibre1">(cust_id INTEGER UNSIGNED NOT NULL, </p>
<p class="calibre1">login_date DATETIME, </p>
<p class="calibre1">CONSTRAINT pk_login_history PRIMARY KEY (cust_id, login_date)</p>
<p class="calibre1">); </p>
<p class="calibre1">The following statement populates the login_history table with some data by generating a cross join between the account and customer tables and using the account’s open_date column as a basis for generating login dates:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">INSERT INTO login_history (cust_id, login_date)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT c.cust_id, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ADDDATE(a.open_date, INTERVAL a.account_id * c.cust_id HOUR)</b> <b class="calibre3">280 | Appendix B:</b> <b class="calibre3">MySQL Extensions to the SQL Language</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-319"></a><img src="images/000044.png" alt="Image 55" class="calibre2" /></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM customer c CROSS JOIN account a; </b></p>
<p class="calibre1">Query OK, 312 rows affected (0.03 sec)</p>
<p class="calibre1">Records: 312  Duplicates: 0  Warnings: 0</p>
<p class="calibre1">The table is now populated with 312 rows of relatively random data. Your task is to look at the data in the login_history table once a month, generate a report for your manager showing who is using the online banking system, and then delete all but the 50 most-recent records from the table. One approach would be to write a query using order by and limit to find the 50th most recent login, such as: mysql&gt; <b class="calibre3">SELECT login_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM login_history</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY login_date DESC</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LIMIT 49,1; </b></p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">| login_date          |</p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">| 2004-07-02 09:00:00 |</p>
<p class="calibre1">+---------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1">Armed with this information, you can then construct a delete statement that removes all rows whose login_date column is less than the date returned by the query: mysql&gt; <b class="calibre3">DELETE FROM login_history</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE login_date &lt; '2004-07-02 09:00:00'; </b></p>
<p class="calibre1">Query OK, 262 rows affected (0.02 sec)</p>
<p class="calibre1">The table now contains the 50 most-recent logins. Using MySQL’s extensions, however, you can achieve the same result with a single delete statement using limit and order by clauses. After returning the original 312 rows to the login_history table, you can run the following:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DELETE FROM login_history</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY login_date ASC</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LIMIT 262; </b></p>
<p class="calibre1">Query OK, 262 rows affected (0.05 sec)</p>
<p class="calibre1">With this statement, the rows are sorted by login_date in ascending order, and then the first 262 rows are deleted, leaving the 50 most recent rows. </p>
<p class="calibre1">In this example, I had to know the number of rows in the table to construct the limit clause (312 original rows − 50 remaining rows = 262</p>
<p class="calibre1">deletions). It would be better if you could sort the rows in descending order and tell the server to skip the first 50 rows and then delete the remaining rows, as in:</p>
<p class="calibre1">DELETE FROM login_history</p>
<p class="calibre1">ORDER BY login_date DESC</p>
<p class="calibre1">LIMIT 49, 9999999; </p>
<p class="calibre1">However, MySQL does not allow the optional second parameter when using the limit clause in delete or update statements. </p>
<p class="calibre1"><b class="calibre3">Ordered Updates and Deletes | 281</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-256"></a><img src="images/000045.png" alt="Image 56" class="calibre2" /></p>
<p class="calibre1">Along with deleting data, you can use the limit and order by clauses when modifying data as well. For example, if the bank decides to add $100 to each of the 10 oldest accounts to help retain loyal customers, you can do the following: mysql&gt; <b class="calibre3">UPDATE account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET avail_balance = avail_balance + 100</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd IN ('CHK', 'SAV', 'MM')</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY open_date ASC</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LIMIT 10; </b></p>
<p class="calibre1">Query OK, 10 rows affected (0.06 sec)</p>
<p class="calibre1">Rows matched: 10  Changed: 10  Warnings: 0</p>
<p class="calibre1">This statement sorts accounts by the open date in ascending order and then modifies the first 10 records, which, in this case, are the 10 oldest accounts. </p>
<p class="calibre1"><b class="calibre3">Multitable Updates and Deletes</b></p>
<p class="calibre1">In certain situations, you might need to modify or delete data from several different tables  to  perform  a  given  task.  If  you  discover  that  the  bank’s  database  contains  a dummy customer left over from system testing, for example, you might need to remove data from the account, customer, and individual tables. </p>
<p class="calibre1">For this section, I will create a set of clones for the account, customer, and individual tables, called account2, customer2, and individual2. I am doing so both to protect the sample data from being altered and to avoid  any  problems  with  foreign  key  constraints  between  the  tables (more on this later in the section). Here are the create table statements used to generate the three clone tables:</p>
<p class="calibre1">CREATE TABLE individual2 AS</p>
<p class="calibre1">SELECT * FROM individual; </p>
<p class="calibre1">CREATE TABLE customer2 AS</p>
<p class="calibre1">SELECT * FROM customer; </p>
<p class="calibre1">CREATE TABLE account2 AS</p>
<p class="calibre1">SELECT * FROM account; </p>
<p class="calibre1">If the customer ID of the dummy customer is 1, you could generate three individual delete statements against each of the three tables, as in:</p>
<p class="calibre1">DELETE FROM account2</p>
<p class="calibre1">WHERE cust_id = 1; </p>
<p class="calibre1">DELETE FROM customer2</p>
<p class="calibre1">WHERE cust_id = 1; </p>
<p class="calibre1">DELETE FROM individual2</p>
<p class="calibre1">WHERE cust_id = 1; </p>
<p class="calibre1">Instead of writing individual delete statements, however, MySQL allows you to write a single  <i class="calibre4">multitable</i> delete statement, which, in this case, looks as follows: <b class="calibre3">282 | Appendix B:</b> <b class="calibre3">MySQL Extensions to the SQL Language</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-320"></a>mysql&gt; <b class="calibre3">DELETE account2, customer2, individual2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account2 INNER JOIN customer2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON account2.cust_id = customer2.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN individual2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON customer2.cust_id = individual2.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE individual2.cust_id = 1; </b></p>
<p class="calibre1">Query OK, 5 rows affected (0.02 sec)</p>
<p class="calibre1">This statement removes a total of five rows, one from each of the individual2 and customer2 tables, and three from the account2 table (customer ID 1 has three accounts). </p>
<p class="calibre1">The statement comprises three separate clauses:</p>
<p class="calibre1">delete</p>
<p class="calibre1">Specifies the tables targeted for deletion. </p>
<p class="calibre1">from</p>
<p class="calibre1">Specifies the tables used to identify the rows to be deleted. This clause is identical in form and function to the from clause in a select statement, and not all tables named herein need to be included in the delete clause. </p>
<p class="calibre1">where</p>
<p class="calibre1">Contains filter conditions used to identify the rows to be deleted. </p>
<p class="calibre1">The  multitable  delete  statement  looks  a  lot  like  a  select  statement,  except  that  a delete clause is used instead of a select clause. If you are deleting rows from a single table using a multitable delete format, the difference becomes even less noticeable. For example, here’s a select statement that finds the account IDs of all accounts owned by John Hayward:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account2.account_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account2 INNER JOIN customer2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON account2.cust_id = customer2.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN individual2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON individual2.cust_id = customer2.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE individual2.fname = 'John' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND individual2.lname = 'Hayward'; </b></p>
<p class="calibre1">+------------+</p>
<p class="calibre1">| account_id |</p>
<p class="calibre1">+------------+</p>
<p class="calibre1">|          8 |</p>
<p class="calibre1">|          9 |</p>
<p class="calibre1">|         10 |</p>
<p class="calibre1">+------------+</p>
<p class="calibre1">3 rows in set (0.01 sec)</p>
<p class="calibre1">If, after viewing the results, you decide to delete all three of John’s accounts from the account2 table, you need only replace the select clause in the previous query with a delete clause naming the account2 table, as in:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">DELETE account2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account2 INNER JOIN customer2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON account2.cust_id = customer2.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN individual2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON customer2.cust_id = individual2.cust_id</b></p>
<p class="calibre1"><b class="calibre3">Multitable Updates and Deletes | 283</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-321"></a>    -&gt; <b class="calibre3">WHERE individual2.fname = 'John' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND individual2.lname = 'Hayward'; </b></p>
<p class="calibre1">Query OK, 3 rows affected (0.01 sec)</p>
<p class="calibre1">Hopefully, this gives you a better idea of what the delete and from clauses are used for in a multitable delete statement. This statement is functionally identical to the following single-table delete statement, which uses a subquery to identify the customer ID</p>
<p class="calibre1">of John Hayward:</p>
<p class="calibre1">DELETE FROM account2</p>
<p class="calibre1">WHERE cust_id =</p>
<p class="calibre1">(SELECT cust_id</p>
<p class="calibre1">FROM individual2</p>
<p class="calibre1">WHERE fname = 'John' AND lname = 'Hayward'; </p>
<p class="calibre1">When using a multitable delete statement to delete rows from a single table, you are simply choosing to use a querylike format involving table joins rather than a traditional delete statement using subqueries. The real power of multitable delete statements lies in the ability to delete from multiple tables in a single statement, as I demonstrated in the first statement in this section. </p>
<p class="calibre1">Along with the ability to delete rows from multiple tables, MySQL also gives you the ability to  <i class="calibre4">modify</i> rows in multiple tables using a  <i class="calibre4">multitable update</i>. Let’s say that your bank is merging with another bank, and the databases from both banks have overlapping customer IDs. Your management decides to fix the problem by incrementing each customer ID in your database by 10,000 so that the second bank’s data can be safely imported. The following statement shows how to modify the ID of customer ID 3 across the individual2, customer2, and account2 tables using a single statement: mysql&gt; <b class="calibre3">UPDATE individual2 INNER JOIN customer2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON individual2.cust_id = customer2.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN account2</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON customer2.cust_id = account2.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SET individual2.cust_id = individual2.cust_id + 10000, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">customer2.cust_id = customer2.cust_id + 10000, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">account2.cust_id = account2.cust_id + 10000</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE individual2.cust_id = 3; </b></p>
<p class="calibre1">Query OK, 4 rows affected (0.01 sec)</p>
<p class="calibre1">Rows matched: 5  Changed: 4  Warnings: 0</p>
<p class="calibre1">This statement modifies four rows: one in each of the individual2 and customer2 tables, and two in the account2 table. The multitable update syntax is very similar to that of the single-table update, except that the update clause contains multiple tables and their corresponding join conditions rather than just naming a single table. Just like the single-table update, the multitable version includes a set clause, the difference being that any tables referenced in the update clause may be modified via the set clause. </p>
<p class="calibre1"><b class="calibre3">284 | Appendix B:</b> <b class="calibre3">MySQL Extensions to the SQL Language</b> D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-322"></a><img src="images/000046.png" alt="Image 57" class="calibre2" /></p>
<p class="calibre1">If you are using the InnoDB storage engine, you will most likely not be able to use multitable delete and update statements if the tables involved have foreign key constraints. This is because the engine does not guarantee that the changes will be applied in an order that won’t violate the constraints. Instead, you should use multiple single-table statements in the proper order so that foreign key constraints are not violated. </p>
<p class="calibre1"><b class="calibre3">Multitable Updates and Deletes | 285</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-323"></a>D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-152"></a><b class="calibre3">APPENDIX C</b></p>
<p class="calibre1"><b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1"><a href="#calibre_link-25"><b class="calibre3">Chapter 3</b></a></p>
<p class="calibre1"><b class="calibre3">3-1</b></p>
<p class="calibre1">Retrieve the employee ID, first name, and last name for all bank employees. Sort by last name and then by first name. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT emp_id, fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY lname, fname; </b></p>
<p class="calibre1">+--------+----------+-----------+</p>
<p class="calibre1">| emp_id | fname    | lname     |</p>
<p class="calibre1">+--------+----------+-----------+</p>
<p class="calibre1">|      2 | Susan    | Barker    |</p>
<p class="calibre1">|     13 | John     | Blake     |</p>
<p class="calibre1">|      6 | Helen    | Fleming   |</p>
<p class="calibre1">|     17 | Beth     | Fowler    |</p>
<p class="calibre1">|      5 | John     | Gooding   |</p>
<p class="calibre1">|      9 | Jane     | Grossman  |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne |</p>
<p class="calibre1">|     12 | Samantha | Jameson   |</p>
<p class="calibre1">|     16 | Theresa  | Markham   |</p>
<p class="calibre1">|     14 | Cindy    | Mason     |</p>
<p class="calibre1">|      8 | Sarah    | Parker    |</p>
<p class="calibre1">|     15 | Frank    | Portman   |</p>
<p class="calibre1">|     10 | Paula    | Roberts   |</p>
<p class="calibre1">|      1 | Michael  | Smith     |</p>
<p class="calibre1">|      7 | Chris    | Tucker    |</p>
<p class="calibre1">|     18 | Rick     | Tulman    |</p>
<p class="calibre1">|      3 | Robert   | Tyler     |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   |</p>
<p class="calibre1">+--------+----------+-----------+</p>
<p class="calibre1">18 rows in set (0.01 sec)</p>
<p class="calibre1"><b class="calibre3">287</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-257"></a><b class="calibre3">3-2</b></p>
<p class="calibre1">Retrieve the account ID, customer ID, and available balance for all accounts whose status equals 'ACTIVE' and whose available balance is greater than $2,500. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account_id, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE status = 'ACTIVE' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND avail_balance &gt; 2500; </b></p>
<p class="calibre1">+------------+---------+---------------+</p>
<p class="calibre1">| account_id | cust_id | avail_balance |</p>
<p class="calibre1">+------------+---------+---------------+</p>
<p class="calibre1">|          3 |       1 |       3000.00 |</p>
<p class="calibre1">|         10 |       4 |       5487.09 |</p>
<p class="calibre1">|         13 |       6 |      10000.00 |</p>
<p class="calibre1">|         14 |       7 |       5000.00 |</p>
<p class="calibre1">|         15 |       8 |       3487.19 |</p>
<p class="calibre1">|         18 |       9 |       9345.55 |</p>
<p class="calibre1">|         20 |      10 |      23575.12 |</p>
<p class="calibre1">|         22 |      11 |       9345.55 |</p>
<p class="calibre1">|         23 |      12 |      38552.05 |</p>
<p class="calibre1">|         24 |      13 |      50000.00 |</p>
<p class="calibre1">+------------+---------+---------------+</p>
<p class="calibre1">10 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">3-3</b></p>
<p class="calibre1">Write a query against the account table that returns the IDs of the employees who opened the accounts (use the account.open_emp_id column). Include a single row for each distinct employee. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT DISTINCT open_emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">| open_emp_id |</p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">|           1 |</p>
<p class="calibre1">|          10 |</p>
<p class="calibre1">|          13 |</p>
<p class="calibre1">|          16 |</p>
<p class="calibre1">+-------------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">3-4</b></p>
<p class="calibre1">Fill in the blanks (denoted by &lt;  <i class="calibre4">#</i>&gt;) for this multi-data-set query to achieve the results shown here:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT p.product_cd, a.cust_id, a.avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product p INNER JOIN account &lt;1&gt; </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON p.product_cd = &lt;2&gt; </b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.&lt;3&gt; = 'ACCOUNT'; </b></p>
<p class="calibre1"></p>
<p class="calibre1"><b class="calibre3">288 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-258"></a>+------------+---------+---------------+</p>
<p class="calibre1">| product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+---------+---------------+</p>
<p class="calibre1">| CD         |       1 |       3000.00 |</p>
<p class="calibre1">| CD         |       6 |      10000.00 |</p>
<p class="calibre1">| CD         |       7 |       5000.00 |</p>
<p class="calibre1">| CD         |       9 |       1500.00 |</p>
<p class="calibre1">| CHK        |       1 |       1057.75 |</p>
<p class="calibre1">| CHK        |       2 |       2258.02 |</p>
<p class="calibre1">| CHK        |       3 |       1057.75 |</p>
<p class="calibre1">| CHK        |       4 |        534.12 |</p>
<p class="calibre1">| CHK        |       5 |       2237.97 |</p>
<p class="calibre1">| CHK        |       6 |        122.37 |</p>
<p class="calibre1">| CHK        |       8 |       3487.19 |</p>
<p class="calibre1">| CHK        |       9 |        125.67 |</p>
<p class="calibre1">| CHK        |      10 |      23575.12 |</p>
<p class="calibre1">| CHK        |      12 |      38552.05 |</p>
<p class="calibre1">| MM         |       3 |       2212.50 |</p>
<p class="calibre1">| MM         |       4 |       5487.09 |</p>
<p class="calibre1">| MM         |       9 |       9345.55 |</p>
<p class="calibre1">| SAV        |       1 |        500.00 |</p>
<p class="calibre1">| SAV        |       2 |        200.00 |</p>
<p class="calibre1">| SAV        |       4 |        767.77 |</p>
<p class="calibre1">| SAV        |       8 |        387.99 |</p>
<p class="calibre1">+------------+---------+---------------+</p>
<p class="calibre1">21 rows in set (0.02 sec)</p>
<p class="calibre1">The correct values for &lt;1&gt;, &lt;2&gt;, and &lt;3&gt; are: 1. a</p>
<p class="calibre1">2. a.product_cd</p>
<p class="calibre1">3. product_type_cd</p>
<p class="calibre1"><a href="#calibre_link-39"><b class="calibre3">Chapter 4</b></a></p>
<p class="calibre1"><b class="calibre3">4-1</b></p>
<p class="calibre1">Which of the transaction IDs would be returned by the following filter conditions? </p>
<p class="calibre1">txn_date &lt; '2005-02-26' AND (txn_type_cd = 'DBT' OR amount &gt; 100) Transaction IDs 1, 2, 3, 5, 6, and 7. </p>
<p class="calibre1"><b class="calibre3">4-2</b></p>
<p class="calibre1">Which of the transaction IDs would be returned by the following filter conditions? </p>
<p class="calibre1">account_id IN (101,103) AND NOT (txn_type_cd = 'DBT' OR amount &gt; 100) Transaction IDs 4 and 9. </p>
<p class="calibre1"><b class="calibre3">Chapter 4 | 289</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-259"></a><b class="calibre3">4-3</b></p>
<p class="calibre1">Construct a query that retrieves all accounts opened in 2002. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account_id, open_date</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE open_date BETWEEN '2002-01-01' AND '2002-12-31'; </b></p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">| account_id | open_date  |</p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">|          6 | 2002-11-23 |</p>
<p class="calibre1">|          7 | 2002-12-15 |</p>
<p class="calibre1">|         12 | 2002-08-24 |</p>
<p class="calibre1">|         20 | 2002-09-30 |</p>
<p class="calibre1">|         21 | 2002-10-01 |</p>
<p class="calibre1">+------------+------------+</p>
<p class="calibre1">5 rows in set (0.01 sec)</p>
<p class="calibre1"><b class="calibre3">4-4</b></p>
<p class="calibre1">Construct a query that finds all nonbusiness customers whose last name contains an <i class="calibre4">a</i> in the second position and an  <i class="calibre4">e</i> anywhere after the  <i class="calibre4">a</i>. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id, lname, fname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM individual</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE lname LIKE '_a%e%'; </b></p>
<p class="calibre1">+---------+--------+---------+</p>
<p class="calibre1">| cust_id | lname  | fname   |</p>
<p class="calibre1">+---------+--------+---------+</p>
<p class="calibre1">|       1 | Hadley | James   |</p>
<p class="calibre1">|       9 | Farley | Richard |</p>
<p class="calibre1">+---------+--------+---------+</p>
<p class="calibre1">2 rows in set (0.02 sec)</p>
<p class="calibre1"><a href="#calibre_link-48"><b class="calibre3">Chapter 5</b></a></p>
<p class="calibre1"><b class="calibre3">5-1</b></p>
<p class="calibre1">Fill in the blanks (denoted by &lt;  <i class="calibre4">#</i>&gt;) for the following query to obtain the results that follow:</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.emp_id, e.fname, e.lname, b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN &lt;1&gt; b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.assigned_branch_id = b.&lt;2&gt;; </b></p>
<p class="calibre1">+--------+----------+-----------+---------------+</p>
<p class="calibre1">| emp_id | fname    | lname     | name          |</p>
<p class="calibre1">+--------+----------+-----------+---------------+</p>
<p class="calibre1">|      1 | Michael  | Smith     | Headquarters  |</p>
<p class="calibre1">|      2 | Susan    | Barker    | Headquarters  |</p>
<p class="calibre1">|      3 | Robert   | Tyler     | Headquarters  |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne | Headquarters  |</p>
<p class="calibre1">|      5 | John     | Gooding   | Headquarters  |</p>
<p class="calibre1"><b class="calibre3">290 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-260"></a>|      6 | Helen    | Fleming   | Headquarters  |</p>
<p class="calibre1">|      7 | Chris    | Tucker    | Headquarters  |</p>
<p class="calibre1">|      8 | Sarah    | Parker    | Headquarters  |</p>
<p class="calibre1">|      9 | Jane     | Grossman  | Headquarters  |</p>
<p class="calibre1">|     10 | Paula    | Roberts   | Woburn Branch |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   | Woburn Branch |</p>
<p class="calibre1">|     12 | Samantha | Jameson   | Woburn Branch |</p>
<p class="calibre1">|     13 | John     | Blake     | Quincy Branch |</p>
<p class="calibre1">|     14 | Cindy    | Mason     | Quincy Branch |</p>
<p class="calibre1">|     15 | Frank    | Portman   | Quincy Branch |</p>
<p class="calibre1">|     16 | Theresa  | Markham   | So. NH Branch |</p>
<p class="calibre1">|     17 | Beth     | Fowler    | So. NH Branch |</p>
<p class="calibre1">|     18 | Rick     | Tulman    | So. NH Branch |</p>
<p class="calibre1">+--------+----------+-----------+---------------+</p>
<p class="calibre1">18 rows in set (0.03 sec)</p>
<p class="calibre1">The correct values for &lt;1&gt; and &lt;2&gt; are:</p>
<p class="calibre1">1. branch</p>
<p class="calibre1">2. branch_id</p>
<p class="calibre1"><b class="calibre3">5-2</b></p>
<p class="calibre1">Write  a  query  that  returns  the  account  ID  for  each  nonbusiness  customer (customer.cust_type_cd = 'I')  along  with  the  customer’s  federal  ID  (cus tomer.fed_id)  and  the  name  of  the  product  on  which  the  account  is  based  (prod uct.name). </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, c.fed_id, p.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a INNER JOIN customer c</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = c.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">INNER JOIN product p</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.product_cd = p.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE c.cust_type_cd = 'I'; </b></p>
<p class="calibre1">+------------+-------------+------------------------+</p>
<p class="calibre1">| account_id | fed_id      | name                   |</p>
<p class="calibre1">+------------+-------------+------------------------+</p>
<p class="calibre1">|          1 | 111-11-1111 | checking account       |</p>
<p class="calibre1">|          2 | 111-11-1111 | savings account        |</p>
<p class="calibre1">|          3 | 111-11-1111 | certificate of deposit |</p>
<p class="calibre1">|          4 | 222-22-2222 | checking account       |</p>
<p class="calibre1">|          5 | 222-22-2222 | savings account        |</p>
<p class="calibre1">|          6 | 333-33-3333 | checking account       |</p>
<p class="calibre1">|          7 | 333-33-3333 | money market account   |</p>
<p class="calibre1">|          8 | 444-44-4444 | checking account       |</p>
<p class="calibre1">|          9 | 444-44-4444 | savings account        |</p>
<p class="calibre1">|         10 | 444-44-4444 | money market account   |</p>
<p class="calibre1">|         11 | 555-55-5555 | checking account       |</p>
<p class="calibre1">|         12 | 666-66-6666 | checking account       |</p>
<p class="calibre1">|         13 | 666-66-6666 | certificate of deposit |</p>
<p class="calibre1">|         14 | 777-77-7777 | certificate of deposit |</p>
<p class="calibre1">|         15 | 888-88-8888 | checking account       |</p>
<p class="calibre1">|         16 | 888-88-8888 | savings account        |</p>
<p class="calibre1">|         17 | 999-99-9999 | checking account       |</p>
<p class="calibre1"><b class="calibre3">Chapter 5 | 291</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-261"></a>|         18 | 999-99-9999 | money market account   |</p>
<p class="calibre1">|         19 | 999-99-9999 | certificate of deposit |</p>
<p class="calibre1">+------------+-------------+------------------------+</p>
<p class="calibre1">19 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">5-3</b></p>
<p class="calibre1">Construct a query that finds all employees whose supervisor is assigned to a different department. Retrieve the employees’ ID, first name, and last name. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.emp_id, e.fname, e.lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN employee mgr</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.superior_emp_id = mgr.emp_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE e.dept_id != mgr.dept_id; </b></p>
<p class="calibre1">+--------+-------+-----------+</p>
<p class="calibre1">| emp_id | fname | lname     |</p>
<p class="calibre1">+--------+-------+-----------+</p>
<p class="calibre1">|      4 | Susan | Hawthorne |</p>
<p class="calibre1">|      5 | John  | Gooding   |</p>
<p class="calibre1">+--------+-------+-----------+</p>
<p class="calibre1">2 rows in set (0.00 sec)</p>
<p class="calibre1"><a href="#calibre_link-59"><b class="calibre3">Chapter 6</b></a></p>
<p class="calibre1"><b class="calibre3">6-1</b></p>
<p class="calibre1">If set A = {L M N O P} and set B = {P Q R S T}, what sets are generated by the following operations? </p>
<p class="calibre1">• A union B</p>
<p class="calibre1">• A union all B</p>
<p class="calibre1">• A intersect B</p>
<p class="calibre1">• A except B</p>
<p class="calibre1">1. A union B = {L M N O P Q R S T}</p>
<p class="calibre1">2. A union all B = {L M N O P P Q R S T}</p>
<p class="calibre1">3. A intersect B = {P}</p>
<p class="calibre1">4. A except B = {L M N O}</p>
<p class="calibre1"><b class="calibre3">6-2</b></p>
<p class="calibre1">Write a compound query that finds the first and last names of all individual customers along with the first and last names of all employees. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM individual</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION</b></p>
<p class="calibre1"><b class="calibre3">292 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-262"></a>    -&gt; <b class="calibre3">SELECT fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee; </b></p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">| fname    | lname     |</p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">| James    | Hadley    |</p>
<p class="calibre1">| Susan    | Tingley   |</p>
<p class="calibre1">| Frank    | Tucker    |</p>
<p class="calibre1">| John     | Hayward   |</p>
<p class="calibre1">| Charles  | Frasier   |</p>
<p class="calibre1">| John     | Spencer   |</p>
<p class="calibre1">| Margaret | Young     |</p>
<p class="calibre1">| Louis    | Blake     |</p>
<p class="calibre1">| Richard  | Farley    |</p>
<p class="calibre1">| Michael  | Smith     |</p>
<p class="calibre1">| Susan    | Barker    |</p>
<p class="calibre1">| Robert   | Tyler     |</p>
<p class="calibre1">| Susan    | Hawthorne |</p>
<p class="calibre1">| John     | Gooding   |</p>
<p class="calibre1">| Helen    | Fleming   |</p>
<p class="calibre1">| Chris    | Tucker    |</p>
<p class="calibre1">| Sarah    | Parker    |</p>
<p class="calibre1">| Jane     | Grossman  |</p>
<p class="calibre1">| Paula    | Roberts   |</p>
<p class="calibre1">| Thomas   | Ziegler   |</p>
<p class="calibre1">| Samantha | Jameson   |</p>
<p class="calibre1">| John     | Blake     |</p>
<p class="calibre1">| Cindy    | Mason     |</p>
<p class="calibre1">| Frank    | Portman   |</p>
<p class="calibre1">| Theresa  | Markham   |</p>
<p class="calibre1">| Beth     | Fowler    |</p>
<p class="calibre1">| Rick     | Tulman    |</p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">27 rows in set (0.01 sec)</p>
<p class="calibre1"><b class="calibre3">6-3</b></p>
<p class="calibre1">Sort the results from Exercise 6-2 by the lname column. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM individual</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT fname, lname</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY lname; </b></p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">| fname    | lname     |</p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">| Susan    | Barker    |</p>
<p class="calibre1">| Louis    | Blake     |</p>
<p class="calibre1">| John     | Blake     |</p>
<p class="calibre1">| Richard  | Farley    |</p>
<p class="calibre1">| Helen    | Fleming   |</p>
<p class="calibre1">| Beth     | Fowler    |</p>
<p class="calibre1">| Charles  | Frasier   |</p>
<p class="calibre1"><b class="calibre3">Chapter 6 | 293</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-263"></a>| John     | Gooding   |</p>
<p class="calibre1">| Jane     | Grossman  |</p>
<p class="calibre1">| James    | Hadley    |</p>
<p class="calibre1">| Susan    | Hawthorne |</p>
<p class="calibre1">| John     | Hayward   |</p>
<p class="calibre1">| Samantha | Jameson   |</p>
<p class="calibre1">| Theresa  | Markham   |</p>
<p class="calibre1">| Cindy    | Mason     |</p>
<p class="calibre1">| Sarah    | Parker    |</p>
<p class="calibre1">| Frank    | Portman   |</p>
<p class="calibre1">| Paula    | Roberts   |</p>
<p class="calibre1">| Michael  | Smith     |</p>
<p class="calibre1">| John     | Spencer   |</p>
<p class="calibre1">| Susan    | Tingley   |</p>
<p class="calibre1">| Chris    | Tucker    |</p>
<p class="calibre1">| Frank    | Tucker    |</p>
<p class="calibre1">| Rick     | Tulman    |</p>
<p class="calibre1">| Robert   | Tyler     |</p>
<p class="calibre1">| Margaret | Young     |</p>
<p class="calibre1">| Thomas   | Ziegler   |</p>
<p class="calibre1">+----------+-----------+</p>
<p class="calibre1">27 rows in set (0.01 sec)</p>
<p class="calibre1"><a href="#calibre_link-67"><b class="calibre3">Chapter 7</b></a></p>
<p class="calibre1"><b class="calibre3">7-1</b></p>
<p class="calibre1">Write a query that returns the 17th through 25th characters of the string 'Please find the substring in this string'. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT SUBSTRING('Please find the substring in this string',17,9); </b></p>
<p class="calibre1">+------------------------------------------------------------+</p>
<p class="calibre1">| SUBSTRING('Please find the substring in this string',17,9) |</p>
<p class="calibre1">+------------------------------------------------------------+</p>
<p class="calibre1">| substring                                                  |</p>
<p class="calibre1">+------------------------------------------------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">7-2</b></p>
<p class="calibre1">Write a query that returns the absolute value and sign (−1, 0, or 1) of the number −25. </p>
<p class="calibre1">76823. Also return the number rounded to the nearest hundredth. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT ABS(-25.76823), SIGN(-25.76823), ROUND(-25.76823, 2); </b></p>
<p class="calibre1">+----------------+-----------------+---------------------+</p>
<p class="calibre1">| ABS(-25.76823) | SIGN(-25.76823) | ROUND(-25.76823, 2) |</p>
<p class="calibre1">+----------------+-----------------+---------------------+</p>
<p class="calibre1">|       25.76823 |              −1 |              −25.77 |</p>
<p class="calibre1">+----------------+-----------------+---------------------+</p>
<p class="calibre1">1 row in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">294 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-264"></a><b class="calibre3">7-3</b></p>
<p class="calibre1">Write a query to return just the month portion of the current date. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT EXTRACT(MONTH FROM CURRENT_DATE()); </b></p>
<p class="calibre1">+----------------------------------+</p>
<p class="calibre1">| EXTRACT(MONTH FROM CURRENT_DATE) |</p>
<p class="calibre1">+----------------------------------+</p>
<p class="calibre1">|                                5 |</p>
<p class="calibre1">+----------------------------------+</p>
<p class="calibre1">1 row in set (0.02 sec)</p>
<p class="calibre1">(Your result will most likely be different, unless it happens to be May when you try this exercise.)</p>
<p class="calibre1"><a href="#calibre_link-78"><b class="calibre3">Chapter 8</b></a></p>
<p class="calibre1"><b class="calibre3">8-1</b></p>
<p class="calibre1">Construct a query that counts the number of rows in the account table. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT COUNT(*)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+----------+</p>
<p class="calibre1">| count(*) |</p>
<p class="calibre1">+----------+</p>
<p class="calibre1">|       24 |</p>
<p class="calibre1">+----------+</p>
<p class="calibre1">1 row in set (0.32 sec)</p>
<p class="calibre1"><b class="calibre3">8-2</b></p>
<p class="calibre1">Modify your query from Exercise 8-1 to count the number of accounts held by each customer. Show the customer ID and the number of accounts for each customer. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id, COUNT(*)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY cust_id; </b></p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">| cust_id | count(*) |</p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">|       1 |        3 |</p>
<p class="calibre1">|       2 |        2 |</p>
<p class="calibre1">|       3 |        2 |</p>
<p class="calibre1">|       4 |        3 |</p>
<p class="calibre1">|       5 |        1 |</p>
<p class="calibre1">|       6 |        2 |</p>
<p class="calibre1">|       7 |        1 |</p>
<p class="calibre1">|       8 |        2 |</p>
<p class="calibre1">|       9 |        3 |</p>
<p class="calibre1">|      10 |        2 |</p>
<p class="calibre1">|      11 |        1 |</p>
<p class="calibre1"><b class="calibre3">Chapter 8 | 295</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-265"></a>|      12 |        1 |</p>
<p class="calibre1">|      13 |        1 |</p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">13 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">8-3</b></p>
<p class="calibre1">Modify your query from Exercise 8-2 to include only those customers having at least two accounts. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT cust_id, COUNT(*)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">HAVING COUNT(*) &gt;= 2; </b></p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">| cust_id | COUNT(*) |</p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">|       1 |        3 |</p>
<p class="calibre1">|       2 |        2 |</p>
<p class="calibre1">|       3 |        2 |</p>
<p class="calibre1">|       4 |        3 |</p>
<p class="calibre1">|       6 |        2 |</p>
<p class="calibre1">|       8 |        2 |</p>
<p class="calibre1">|       9 |        3 |</p>
<p class="calibre1">|      10 |        2 |</p>
<p class="calibre1">+---------+----------+</p>
<p class="calibre1">8 rows in set (0.04 sec)</p>
<p class="calibre1"><b class="calibre3">8-4 (Extra Credit)</b></p>
<p class="calibre1">Find the total available balance by product and branch where there is more than one account per product and branch. Order the results by total balance (highest to lowest). </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT product_cd, open_branch_id, SUM(avail_balance)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY product_cd, open_branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">HAVING COUNT(*) &gt; 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY 3 DESC; </b></p>
<p class="calibre1">+------------+----------------+--------------------+</p>
<p class="calibre1">| product_cd | open_branch_id | SUM(avail_balance) |</p>
<p class="calibre1">+------------+----------------+--------------------+</p>
<p class="calibre1">| CHK        |              4 |           67852.33 |</p>
<p class="calibre1">| MM         |              1 |           14832.64 |</p>
<p class="calibre1">| CD         |              1 |           11500.00 |</p>
<p class="calibre1">| CD         |              2 |            8000.00 |</p>
<p class="calibre1">| CHK        |              2 |            3315.77 |</p>
<p class="calibre1">| CHK        |              1 |             782.16 |</p>
<p class="calibre1">| SAV        |              2 |             700.00 |</p>
<p class="calibre1">+------------+----------------+--------------------+</p>
<p class="calibre1">7 rows in set (0.01 sec)</p>
<p class="calibre1">Note  that  MySQL  would  not  accept  ORDER BY SUM(avail_balance) DESC,,  so  I  was forced to indicate the sort column by position. </p>
<p class="calibre1"><b class="calibre3">296 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-266"></a><a href="#calibre_link-88"><b class="calibre3">Chapter 9</b></a></p>
<p class="calibre1"><b class="calibre3">9-1</b></p>
<p class="calibre1">Construct a query against the account table that uses a filter condition with a noncorrelated  subquery  against  the  product  table  to  find  all  loan  accounts (product.product_type_cd = 'LOAN'). Retrieve the account ID, product code, customer ID, and available balance. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT account_id, product_cd, cust_id, avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_cd IN (SELECT product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE product_type_cd = 'LOAN'); </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|         21 | BUS        |      10 |          0.00 |</p>
<p class="calibre1">|         22 | BUS        |      11 |       9345.55 |</p>
<p class="calibre1">|         24 | SBL        |      13 |      50000.00 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">3 rows in set (0.07 sec)</p>
<p class="calibre1"><b class="calibre3">9-2</b></p>
<p class="calibre1">Rework the query from Exercise 9-1 using a  <i class="calibre4">correlated</i> subquery against the product table to achieve the same results. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.product_cd, a.cust_id, a.avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE EXISTS (SELECT 1</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product p</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE p.product_cd = a.product_cd</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND p.product_type_cd = 'LOAN'); </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| account_id | product_cd | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">|         21 | BUS        |      10 |          0.00 |</p>
<p class="calibre1">|         22 | BUS        |      11 |       9345.55 |</p>
<p class="calibre1">|         24 | SBL        |      13 |      50000.00 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">3 rows in set (0.01 sec)</p>
<p class="calibre1"><b class="calibre3">9-3</b></p>
<p class="calibre1">Join the following query to the employee table to show the experience level of each employee:</p>
<p class="calibre1">SELECT 'trainee' name, '2004-01-01' start_dt, '2005-12-31' end_dt UNION ALL</p>
<p class="calibre1">SELECT 'worker' name, '2002-01-01' start_dt, '2003-12-31' end_dt <b class="calibre3">Chapter 9 | 297</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-267"></a>UNION ALL</p>
<p class="calibre1">SELECT 'mentor' name, '2000-01-01' start_dt, '2001-12-31' end_dt Give the subquery the alias levels, and include the employee’s ID, first name, last name, and experience level (levels.name). (Hint: build a join condition using an inequality condition to determine into which level the employee.start_date column falls.) mysql&gt; <b class="calibre3">SELECT e.emp_id, e.fname, e.lname, levels.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e INNER JOIN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT 'trainee' name, '2004-01-01' start_dt, '2005-12-31' end_dt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'worker' name, '2002-01-01' start_dt, '2003-12-31' end_dt</b></p>
<p class="calibre1">-&gt; <b class="calibre3">UNION ALL</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT 'mentor' name, '2000-01-01' start_dt, '2001-12-31' end_dt) levels</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON e.start_date BETWEEN levels.start_dt AND levels.end_dt; </b></p>
<p class="calibre1"></p>
<p class="calibre1">+--------+----------+-----------+---------+</p>
<p class="calibre1">| emp_id | fname    | lname     | name    |</p>
<p class="calibre1">+--------+----------+-----------+---------+</p>
<p class="calibre1">|      6 | Helen    | Fleming   | trainee |</p>
<p class="calibre1">|      7 | Chris    | Tucker    | trainee |</p>
<p class="calibre1">|      2 | Susan    | Barker    | worker  |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne | worker  |</p>
<p class="calibre1">|      5 | John     | Gooding   | worker  |</p>
<p class="calibre1">|      8 | Sarah    | Parker    | worker  |</p>
<p class="calibre1">|      9 | Jane     | Grossman  | worker  |</p>
<p class="calibre1">|     10 | Paula    | Roberts   | worker  |</p>
<p class="calibre1">|     12 | Samantha | Jameson   | worker  |</p>
<p class="calibre1">|     14 | Cindy    | Mason     | worker  |</p>
<p class="calibre1">|     15 | Frank    | Portman   | worker  |</p>
<p class="calibre1">|     17 | Beth     | Fowler    | worker  |</p>
<p class="calibre1">|     18 | Rick     | Tulman    | worker  |</p>
<p class="calibre1">|      1 | Michael  | Smith     | mentor  |</p>
<p class="calibre1">|      3 | Robert   | Tyler     | mentor  |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   | mentor  |</p>
<p class="calibre1">|     13 | John     | Blake     | mentor  |</p>
<p class="calibre1">|     16 | Theresa  | Markham   | mentor  |</p>
<p class="calibre1">+--------+----------+-----------+---------+</p>
<p class="calibre1">18 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">9-4</b></p>
<p class="calibre1">Construct a query against the employee table that retrieves the employee ID, first name, and last name, along with the names of the department and branch to which the employee is assigned. Do not join any tables. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT e.emp_id, e.fname, e.lname, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT d.name FROM department d</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE d.dept_id = e.dept_id) dept_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT b.name FROM branch b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE b.branch_id = e.assigned_branch_id) branch_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee e; </b></p>
<p class="calibre1">+--------+----------+-----------+----------------+---------------+</p>
<p class="calibre1"><b class="calibre3">298 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-268"></a>| emp_id | fname    | lname     | dept_name      | branch_name   |</p>
<p class="calibre1">+--------+----------+-----------+----------------+---------------+</p>
<p class="calibre1">|      1 | Michael  | Smith     | Administration | Headquarters  |</p>
<p class="calibre1">|      2 | Susan    | Barker    | Administration | Headquarters  |</p>
<p class="calibre1">|      3 | Robert   | Tyler     | Administration | Headquarters  |</p>
<p class="calibre1">|      4 | Susan    | Hawthorne | Operations     | Headquarters  |</p>
<p class="calibre1">|      5 | John     | Gooding   | Loans          | Headquarters  |</p>
<p class="calibre1">|      6 | Helen    | Fleming   | Operations     | Headquarters  |</p>
<p class="calibre1">|      7 | Chris    | Tucker    | Operations     | Headquarters  |</p>
<p class="calibre1">|      8 | Sarah    | Parker    | Operations     | Headquarters  |</p>
<p class="calibre1">|      9 | Jane     | Grossman  | Operations     | Headquarters  |</p>
<p class="calibre1">|     10 | Paula    | Roberts   | Operations     | Woburn Branch |</p>
<p class="calibre1">|     11 | Thomas   | Ziegler   | Operations     | Woburn Branch |</p>
<p class="calibre1">|     12 | Samantha | Jameson   | Operations     | Woburn Branch |</p>
<p class="calibre1">|     13 | John     | Blake     | Operations     | Quincy Branch |</p>
<p class="calibre1">|     14 | Cindy    | Mason     | Operations     | Quincy Branch |</p>
<p class="calibre1">|     15 | Frank    | Portman   | Operations     | Quincy Branch |</p>
<p class="calibre1">|     16 | Theresa  | Markham   | Operations     | So. NH Branch |</p>
<p class="calibre1">|     17 | Beth     | Fowler    | Operations     | So. NH Branch |</p>
<p class="calibre1">|     18 | Rick     | Tulman    | Operations     | So. NH Branch |</p>
<p class="calibre1">+--------+----------+-----------+----------------+---------------+</p>
<p class="calibre1">18 rows in set (0.12 sec)</p>
<p class="calibre1"><a href="#calibre_link-100"><b class="calibre3">Chapter 10</b></a></p>
<p class="calibre1"><b class="calibre3">10-1</b></p>
<p class="calibre1">Write a query that returns all product names along with the accounts based on that product (use the product_cd column in the account table to link to the product table). </p>
<p class="calibre1">Include all products, even if no accounts have been opened for that product. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT p.product_cd, a.account_id, a.cust_id, a.avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM product p LEFT OUTER JOIN account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON p.product_cd = a.product_cd; </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| product_cd | account_id | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| AUT        |       NULL |    NULL |          NULL |</p>
<p class="calibre1">| BUS        |         21 |      10 |          0.00 |</p>
<p class="calibre1">| BUS        |         22 |      11 |       9345.55 |</p>
<p class="calibre1">| CD         |          3 |       1 |       3000.00 |</p>
<p class="calibre1">| CD         |         13 |       6 |      10000.00 |</p>
<p class="calibre1">| CD         |         14 |       7 |       5000.00 |</p>
<p class="calibre1">| CD         |         19 |       9 |       1500.00 |</p>
<p class="calibre1">| CHK        |          1 |       1 |       1057.75 |</p>
<p class="calibre1">| CHK        |          4 |       2 |       2258.02 |</p>
<p class="calibre1">| CHK        |          6 |       3 |       1057.75 |</p>
<p class="calibre1">| CHK        |          8 |       4 |        534.12 |</p>
<p class="calibre1">| CHK        |         11 |       5 |       2237.97 |</p>
<p class="calibre1">| CHK        |         12 |       6 |        122.37 |</p>
<p class="calibre1">| CHK        |         15 |       8 |       3487.19 |</p>
<p class="calibre1">| CHK        |         17 |       9 |        125.67 |</p>
<p class="calibre1">| CHK        |         20 |      10 |      23575.12 |</p>
<p class="calibre1"><b class="calibre3">Chapter 10 | 299</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-269"></a>| CHK        |         23 |      12 |      38552.05 |</p>
<p class="calibre1">| MM         |          7 |       3 |       2212.50 |</p>
<p class="calibre1">| MM         |         10 |       4 |       5487.09 |</p>
<p class="calibre1">| MM         |         18 |       9 |       9345.55 |</p>
<p class="calibre1">| MRT        |       NULL |    NULL |          NULL |</p>
<p class="calibre1">| SAV        |          2 |       1 |        500.00 |</p>
<p class="calibre1">| SAV        |          5 |       2 |        200.00 |</p>
<p class="calibre1">| SAV        |          9 |       4 |        767.77 |</p>
<p class="calibre1">| SAV        |         16 |       8 |        387.99 |</p>
<p class="calibre1">| SBL        |         24 |      13 |      50000.00 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">26 rows in set (0.01 sec)</p>
<p class="calibre1"><b class="calibre3">10-2</b></p>
<p class="calibre1">Reformulate your query from Exercise 10-1 to use the other outer join type (e.g., if you used a left outer join in Exercise 10-1, use a right outer join this time) such that the results are identical to Exercise 10-1. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT p.product_cd, a.account_id, a.cust_id, a.avail_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a RIGHT OUTER JOIN product p</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON p.product_cd = a.product_cd; </b></p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| product_cd | account_id | cust_id | avail_balance |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">| AUT        |       NULL |    NULL |          NULL |</p>
<p class="calibre1">| BUS        |         21 |      10 |          0.00 |</p>
<p class="calibre1">| BUS        |         22 |      11 |       9345.55 |</p>
<p class="calibre1">| CD         |          3 |       1 |       3000.00 |</p>
<p class="calibre1">| CD         |         13 |       6 |      10000.00 |</p>
<p class="calibre1">| CD         |         14 |       7 |       5000.00 |</p>
<p class="calibre1">| CD         |         19 |       9 |       1500.00 |</p>
<p class="calibre1">| CHK        |          1 |       1 |       1057.75 |</p>
<p class="calibre1">| CHK        |          4 |       2 |       2258.02 |</p>
<p class="calibre1">| CHK        |          6 |       3 |       1057.75 |</p>
<p class="calibre1">| CHK        |          8 |       4 |        534.12 |</p>
<p class="calibre1">| CHK        |         11 |       5 |       2237.97 |</p>
<p class="calibre1">| CHK        |         12 |       6 |        122.37 |</p>
<p class="calibre1">| CHK        |         15 |       8 |       3487.19 |</p>
<p class="calibre1">| CHK        |         17 |       9 |        125.67 |</p>
<p class="calibre1">| CHK        |         20 |      10 |      23575.12 |</p>
<p class="calibre1">| CHK        |         23 |      12 |      38552.05 |</p>
<p class="calibre1">| MM         |          7 |       3 |       2212.50 |</p>
<p class="calibre1">| MM         |         10 |       4 |       5487.09 |</p>
<p class="calibre1">| MM         |         18 |       9 |       9345.55 |</p>
<p class="calibre1">| MRT        |       NULL |    NULL |          NULL |</p>
<p class="calibre1">| SAV        |          2 |       1 |        500.00 |</p>
<p class="calibre1">| SAV        |          5 |       2 |        200.00 |</p>
<p class="calibre1">| SAV        |          9 |       4 |        767.77 |</p>
<p class="calibre1">| SAV        |         16 |       8 |        387.99 |</p>
<p class="calibre1">| SBL        |         24 |      13 |      50000.00 |</p>
<p class="calibre1">+------------+------------+---------+---------------+</p>
<p class="calibre1">26 rows in set (0.02 sec)</p>
<p class="calibre1"><b class="calibre3">300 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-270"></a><b class="calibre3">10-3</b></p>
<p class="calibre1">Outer-join  the  account  table  to  both  the  individual  and  business  tables  (via  the account.cust_id column) such that the result set contains one row per account. Columns  to  include  are  account.account_id,  account.product_cd,  individual.fname, individual.lname, and business.name. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT a.account_id, a.product_cd, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">i.fname, i.lname, b.name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account a LEFT OUTER JOIN business b</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = b.cust_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">LEFT OUTER JOIN individual i</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON a.cust_id = i.cust_id; </b></p>
<p class="calibre1">+------------+------------+----------+---------+------------------------+</p>
<p class="calibre1">| account_id | product_cd | fname    | lname   | name                   |</p>
<p class="calibre1">+------------+------------+----------+---------+------------------------+</p>
<p class="calibre1">|          1 | CHK        | James    | Hadley  | NULL                   |</p>
<p class="calibre1">|          2 | SAV        | James    | Hadley  | NULL                   |</p>
<p class="calibre1">|          3 | CD         | James    | Hadley  | NULL                   |</p>
<p class="calibre1">|          4 | CHK        | Susan    | Tingley | NULL                   |</p>
<p class="calibre1">|          5 | SAV        | Susan    | Tingley | NULL                   |</p>
<p class="calibre1">|          6 | CHK        | Frank    | Tucker  | NULL                   |</p>
<p class="calibre1">|          7 | MM         | Frank    | Tucker  | NULL                   |</p>
<p class="calibre1">|          8 | CHK        | John     | Hayward | NULL                   |</p>
<p class="calibre1">|          9 | SAV        | John     | Hayward | NULL                   |</p>
<p class="calibre1">|         10 | MM         | John     | Hayward | NULL                   |</p>
<p class="calibre1">|         11 | CHK        | Charles  | Frasier | NULL                   |</p>
<p class="calibre1">|         12 | CHK        | John     | Spencer | NULL                   |</p>
<p class="calibre1">|         13 | CD         | John     | Spencer | NULL                   |</p>
<p class="calibre1">|         14 | CD         | Margaret | Young   | NULL                   |</p>
<p class="calibre1">|         15 | CHK        | Louis    | Blake   | NULL                   |</p>
<p class="calibre1">|         16 | SAV        | Louis    | Blake   | NULL                   |</p>
<p class="calibre1">|         17 | CHK        | Richard  | Farley  | NULL                   |</p>
<p class="calibre1">|         18 | MM         | Richard  | Farley  | NULL                   |</p>
<p class="calibre1">|         19 | CD         | Richard  | Farley  | NULL                   |</p>
<p class="calibre1">|         20 | CHK        | NULL     | NULL    | Chilton Engineering    |</p>
<p class="calibre1">|         21 | BUS        | NULL     | NULL    | Chilton Engineering    |</p>
<p class="calibre1">|         22 | BUS        | NULL     | NULL    | Northeast Cooling Inc. |</p>
<p class="calibre1">|         23 | CHK        | NULL     | NULL    | Superior Auto Body     |</p>
<p class="calibre1">|         24 | SBL        | NULL     | NULL    | AAA Insurance Inc.     |</p>
<p class="calibre1">+------------+------------+----------+---------+------------------------+</p>
<p class="calibre1">24 rows in set (0.05 sec)</p>
<p class="calibre1"><b class="calibre3">10-4 (Extra Credit)</b></p>
<p class="calibre1">Devise a query that will generate the set {1, 2, 3,..., 99, 100}. (Hint: use a cross join with at least two from clause subqueries.)</p>
<p class="calibre1">SELECT ones.x + tens.x + 1</p>
<p class="calibre1">FROM</p>
<p class="calibre1">(SELECT 0 x UNION ALL</p>
<p class="calibre1">SELECT 1 x UNION ALL</p>
<p class="calibre1">SELECT 2 x UNION ALL</p>
<p class="calibre1">SELECT 3 x UNION ALL</p>
<p class="calibre1"><b class="calibre3">Chapter 10 | 301</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-271"></a>  SELECT 4 x UNION ALL</p>
<p class="calibre1">SELECT 5 x UNION ALL</p>
<p class="calibre1">SELECT 6 x UNION ALL</p>
<p class="calibre1">SELECT 7 x UNION ALL</p>
<p class="calibre1">SELECT 8 x UNION ALL</p>
<p class="calibre1">SELECT 9 x) ones</p>
<p class="calibre1">CROSS JOIN</p>
<p class="calibre1">(SELECT 0 x UNION ALL</p>
<p class="calibre1">SELECT 10 x UNION ALL</p>
<p class="calibre1">SELECT 20 x UNION ALL</p>
<p class="calibre1">SELECT 30 x UNION ALL</p>
<p class="calibre1">SELECT 40 x UNION ALL</p>
<p class="calibre1">SELECT 50 x UNION ALL</p>
<p class="calibre1">SELECT 60 x UNION ALL</p>
<p class="calibre1">SELECT 70 x UNION ALL</p>
<p class="calibre1">SELECT 80 x UNION ALL</p>
<p class="calibre1">SELECT 90 x) tens; </p>
<p class="calibre1"><a href="#calibre_link-107"><b class="calibre3">Chapter 11</b></a></p>
<p class="calibre1"><b class="calibre3">11-1</b></p>
<p class="calibre1">Rewrite the following query, which uses a simple case expression, so that the same results are achieved using a searched case expression. Try to use as few when clauses as possible. </p>
<p class="calibre1">SELECT emp_id, </p>
<p class="calibre1">CASE title</p>
<p class="calibre1">WHEN 'President' THEN 'Management' </p>
<p class="calibre1">WHEN 'Vice President' THEN 'Management' </p>
<p class="calibre1">WHEN 'Treasurer' THEN 'Management' </p>
<p class="calibre1">WHEN 'Loan Manager' THEN 'Management' </p>
<p class="calibre1">WHEN 'Operations Manager' THEN 'Operations' </p>
<p class="calibre1">WHEN 'Head Teller' THEN 'Operations' </p>
<p class="calibre1">WHEN 'Teller' THEN 'Operations' </p>
<p class="calibre1">ELSE 'Unknown' </p>
<p class="calibre1">END</p>
<p class="calibre1">FROM employee; </p>
<p class="calibre1">SELECT emp_id, </p>
<p class="calibre1">CASE</p>
<p class="calibre1">WHEN title LIKE '%President' OR title = 'Loan Manager' </p>
<p class="calibre1">OR title = 'Treasurer' </p>
<p class="calibre1">THEN 'Management' </p>
<p class="calibre1">WHEN title LIKE '%Teller' OR title = 'Operations Manager' </p>
<p class="calibre1">THEN 'Operations' </p>
<p class="calibre1">ELSE 'Unknown' </p>
<p class="calibre1">END</p>
<p class="calibre1">FROM employee; </p>
<p class="calibre1"><b class="calibre3">302 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-272"></a><b class="calibre3">11-2</b></p>
<p class="calibre1">Rewrite the following query so that the result set contains a single row with four columns (one for each branch). Name the four columns branch_1 through branch_4. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT open_branch_id, COUNT(*)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY open_branch_id; </b></p>
<p class="calibre1">+----------------+----------+</p>
<p class="calibre1">| open_branch_id | COUNT(*) |</p>
<p class="calibre1">+----------------+----------+</p>
<p class="calibre1">|              1 |        8 |</p>
<p class="calibre1">|              2 |        7 |</p>
<p class="calibre1">|              3 |        3 |</p>
<p class="calibre1">|              4 |        6 |</p>
<p class="calibre1">+----------------+----------+</p>
<p class="calibre1">4 rows in set (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE WHEN open_branch_id = 1 THEN 1 ELSE 0 END) branch_1, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE WHEN open_branch_id = 2 THEN 1 ELSE 0 END) branch_2, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE WHEN open_branch_id = 3 THEN 1 ELSE 0 END) branch_3, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">SUM(CASE WHEN open_branch_id = 4 THEN 1 ELSE 0 END) branch_4</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM account; </b></p>
<p class="calibre1">+----------+----------+----------+----------+</p>
<p class="calibre1">| branch_1 | branch_2 | branch_3 | branch_4 |</p>
<p class="calibre1">+----------+----------+----------+----------+</p>
<p class="calibre1">|        8 |        7 |        3 |        6 |</p>
<p class="calibre1">+----------+----------+----------+----------+</p>
<p class="calibre1">1 row in set (0.02 sec)</p>
<p class="calibre1"><a href="#calibre_link-119"><b class="calibre3">Chapter 12</b></a></p>
<p class="calibre1"><b class="calibre3">12-1</b></p>
<p class="calibre1">Generate a transaction to transfer $50 from Frank Tucker’s money market account to his checking account. You will need to insert two rows into the transaction table and update two rows in the account table. </p>
<p class="calibre1">START TRANSACTION; </p>
<p class="calibre1">SELECT i.cust_id, </p>
<p class="calibre1">(SELECT a.account_id FROM account a</p>
<p class="calibre1">WHERE a.cust_id = i.cust_id</p>
<p class="calibre1">AND a.product_cd = 'MM') mm_id, </p>
<p class="calibre1">(SELECT a.account_id FROM account a</p>
<p class="calibre1">WHERE a.cust_id = i.cust_id</p>
<p class="calibre1">AND a.product_cd = 'chk') chk_id</p>
<p class="calibre1">INTO @cst_id, @mm_id, @chk_id</p>
<p class="calibre1">FROM individual i</p>
<p class="calibre1">WHERE i.fname = 'Frank' AND i.lname = 'Tucker'; </p>
<p class="calibre1"><b class="calibre3">Chapter 12 | 303</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-273"></a>INSERT INTO transaction (txn_id, txn_date, account_id, txn_type_cd, amount)</p>
<p class="calibre1">VALUES (NULL, now(), @mm_id, 'CDT', 50); </p>
<p class="calibre1">INSERT INTO transaction (txn_id, txn_date, account_id, </p>
<p class="calibre1">txn_type_cd, amount)</p>
<p class="calibre1">VALUES (NULL, now(), @chk_id, 'DBT', 50); </p>
<p class="calibre1">UPDATE account</p>
<p class="calibre1">SET last_activity_date = now(), </p>
<p class="calibre1">avail_balance = avail_balance - 50</p>
<p class="calibre1">WHERE account_id = @mm_id; </p>
<p class="calibre1">UPDATE account</p>
<p class="calibre1">SET last_activity_date = now(), </p>
<p class="calibre1">avail_balance = avail_balance + 50</p>
<p class="calibre1">WHERE account_id = @chk_id; </p>
<p class="calibre1">COMMIT; </p>
<p class="calibre1"><a href="#calibre_link-126"><b class="calibre3">Chapter 13</b></a></p>
<p class="calibre1"><b class="calibre3">13-1</b></p>
<p class="calibre1">Modify the account table so that customers may not have more than one account for each product. </p>
<p class="calibre1">ALTER TABLE account</p>
<p class="calibre1">ADD CONSTRAINT account_unq1 UNIQUE (cust_id, product_cd); </p>
<p class="calibre1"><b class="calibre3">13-2</b></p>
<p class="calibre1">Generate a multicolumn index on the transaction table that could be used by both of the following queries:</p>
<p class="calibre1">SELECT txn_date, account_id, txn_type_cd, amount</p>
<p class="calibre1">FROM transaction</p>
<p class="calibre1">WHERE txn_date &gt; cast('2008-12-31 23:59:59' as datetime); </p>
<p class="calibre1">SELECT txn_date, account_id, txn_type_cd, amount</p>
<p class="calibre1">FROM transaction</p>
<p class="calibre1">WHERE txn_date &gt; cast('2008-12-31 23:59:59' as datetime)</p>
<p class="calibre1">AND amount &lt; 1000; </p>
<p class="calibre1">CREATE INDEX txn_idx01</p>
<p class="calibre1">ON transaction (txn_date, amount); </p>
<p class="calibre1"><b class="calibre3">304 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-274"></a><a href="#calibre_link-135"><b class="calibre3">Chapter 14</b></a></p>
<p class="calibre1"><b class="calibre3">14-1</b></p>
<p class="calibre1">Create a view that queries the employee table and generates the following output when queried with no where clause:</p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">| supervisor_name | employee_name    |</p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">| NULL            | Michael Smith    |</p>
<p class="calibre1">| Michael Smith   | Susan Barker     |</p>
<p class="calibre1">| Michael Smith   | Robert Tyler     |</p>
<p class="calibre1">| Robert Tyler    | Susan Hawthorne  |</p>
<p class="calibre1">| Susan Hawthorne | John Gooding     |</p>
<p class="calibre1">| Susan Hawthorne | Helen Fleming    |</p>
<p class="calibre1">| Helen Fleming   | Chris Tucker     |</p>
<p class="calibre1">| Helen Fleming   | Sarah Parker     |</p>
<p class="calibre1">| Helen Fleming   | Jane Grossman    |</p>
<p class="calibre1">| Susan Hawthorne | Paula Roberts    |</p>
<p class="calibre1">| Paula Roberts   | Thomas Ziegler   |</p>
<p class="calibre1">| Paula Roberts   | Samantha Jameson |</p>
<p class="calibre1">| Susan Hawthorne | John Blake       |</p>
<p class="calibre1">| John Blake      | Cindy Mason      |</p>
<p class="calibre1">| John Blake      | Frank Portman    |</p>
<p class="calibre1">| Susan Hawthorne | Theresa Markham  |</p>
<p class="calibre1">| Theresa Markham | Beth Fowler      |</p>
<p class="calibre1">| Theresa Markham | Rick Tulman      |</p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">18 rows in set (1.47 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">CREATE VIEW supervisor_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(supervisor_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">employee_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AS</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT concat(spr.fname, ' ', spr.lname), </b></p>
<p class="calibre1">-&gt; <b class="calibre3">concat(emp.fname, ' ', emp.lname)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM employee emp LEFT OUTER JOIN employee spr</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON emp.superior_emp_id = spr.emp_id; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.12 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT * FROM supervisor_vw; </b></p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">| supervisor_name | employee_name    |</p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">| NULL            | Michael Smith    |</p>
<p class="calibre1">| Michael Smith   | Susan Barker     |</p>
<p class="calibre1">| Michael Smith   | Robert Tyler     |</p>
<p class="calibre1">| Robert Tyler    | Susan Hawthorne  |</p>
<p class="calibre1">| Susan Hawthorne | John Gooding     |</p>
<p class="calibre1">| Susan Hawthorne | Helen Fleming    |</p>
<p class="calibre1">| Helen Fleming   | Chris Tucker     |</p>
<p class="calibre1"><b class="calibre3">Chapter 14 | 305</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-275"></a>| Helen Fleming   | Sarah Parker     |</p>
<p class="calibre1">| Helen Fleming   | Jane Grossman    |</p>
<p class="calibre1">| Susan Hawthorne | Paula Roberts    |</p>
<p class="calibre1">| Paula Roberts   | Thomas Ziegler   |</p>
<p class="calibre1">| Paula Roberts   | Samantha Jameson |</p>
<p class="calibre1">| Susan Hawthorne | John Blake       |</p>
<p class="calibre1">| John Blake      | Cindy Mason      |</p>
<p class="calibre1">| John Blake      | Frank Portman    |</p>
<p class="calibre1">| Susan Hawthorne | Theresa Markham  |</p>
<p class="calibre1">| Theresa Markham | Beth Fowler      |</p>
<p class="calibre1">| Theresa Markham | Rick Tulman      |</p>
<p class="calibre1">+-----------------+------------------+</p>
<p class="calibre1">18 rows in set (0.17 sec)</p>
<p class="calibre1"><b class="calibre3">14-2</b></p>
<p class="calibre1">The bank president would like to have a report showing the name and city of each branch, along with the total balances of all accounts opened at the branch. Create a view to generate the data. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">CREATE VIEW branch_summary_vw</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(branch_name, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">branch_city, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">total_balance</b></p>
<p class="calibre1">-&gt; <b class="calibre3">)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AS</b></p>
<p class="calibre1">-&gt; <b class="calibre3">SELECT b.name, b.city, sum(a.avail_balance)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM branch b INNER JOIN account a</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ON b.branch_id = a.open_branch_id</b></p>
<p class="calibre1">-&gt; <b class="calibre3">GROUP BY b.name, b.city; </b></p>
<p class="calibre1">Query OK, 0 rows affected (0.00 sec)</p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT * FROM branch_summary_vw; </b></p>
<p class="calibre1">+---------------+-------------+---------------+</p>
<p class="calibre1">| branch_name   | branch_city | total_balance |</p>
<p class="calibre1">+---------------+-------------+---------------+</p>
<p class="calibre1">| Headquarters  | Waltham     |      27882.57 |</p>
<p class="calibre1">| Quincy Branch | Quincy      |      53270.25 |</p>
<p class="calibre1">| So. NH Branch | Salem       |      68240.32 |</p>
<p class="calibre1">| Woburn Branch | Woburn      |      21361.32 |</p>
<p class="calibre1">+---------------+-------------+---------------+</p>
<p class="calibre1">4 rows in set (0.01 sec)</p>
<p class="calibre1"><a href="#calibre_link-143"><b class="calibre3">Chapter 15</b></a></p>
<p class="calibre1"><b class="calibre3">15-1</b></p>
<p class="calibre1">Write a query that lists all the indexes in the bank schema. Include the table names. </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT DISTINCT table_name, index_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.statistics</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE table_schema = 'bank'; </b></p>
<p class="calibre1"><b class="calibre3">306 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-276"></a>+--------------+--------------------+</p>
<p class="calibre1">| table_name   | index_name         |</p>
<p class="calibre1">+--------------+--------------------+</p>
<p class="calibre1">| account      | PRIMARY            |</p>
<p class="calibre1">| account      | account_unq1       |</p>
<p class="calibre1">| account      | fk_product_cd      |</p>
<p class="calibre1">| account      | fk_a_branch_id     |</p>
<p class="calibre1">| account      | fk_a_emp_id        |</p>
<p class="calibre1">| account      | acc_bal_idx        |</p>
<p class="calibre1">| branch       | PRIMARY            |</p>
<p class="calibre1">| business     | PRIMARY            |</p>
<p class="calibre1">| customer     | PRIMARY            |</p>
<p class="calibre1">| department   | PRIMARY            |</p>
<p class="calibre1">| department   | dept_name_idx      |</p>
<p class="calibre1">| employee     | PRIMARY            |</p>
<p class="calibre1">| employee     | fk_dept_id         |</p>
<p class="calibre1">| employee     | fk_e_branch_id     |</p>
<p class="calibre1">| employee     | fk_e_emp_id        |</p>
<p class="calibre1">| individual   | PRIMARY            |</p>
<p class="calibre1">| officer      | PRIMARY            |</p>
<p class="calibre1">| officer      | fk_o_cust_id       |</p>
<p class="calibre1">| product      | PRIMARY            |</p>
<p class="calibre1">| product      | fk_product_type_cd |</p>
<p class="calibre1">| product_type | PRIMARY            |</p>
<p class="calibre1">| transaction  | PRIMARY            |</p>
<p class="calibre1">| transaction  | fk_t_account_id    |</p>
<p class="calibre1">| transaction  | fk_teller_emp_id   |</p>
<p class="calibre1">| transaction  | fk_exec_branch_id  |</p>
<p class="calibre1">| transaction  | txn_idx01          |</p>
<p class="calibre1">+--------------+--------------------+</p>
<p class="calibre1">26 rows in set (0.00 sec)</p>
<p class="calibre1"><b class="calibre3">15-2</b></p>
<p class="calibre1">Write a query that generates output that can be used to create all of the indexes on the bank.employee table. Output should be of the form:</p>
<p class="calibre1">"ALTER TABLE &lt;table_name&gt; ADD INDEX &lt;index_name&gt; (&lt;column_list&gt;)" </p>
<p class="calibre1">mysql&gt; <b class="calibre3">SELECT concat(</b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN st.seq_in_index = 1 THEN</b></p>
<p class="calibre1">-&gt; <b class="calibre3">concat('ALTER TABLE ', st.table_name, ' ADD', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN st.non_unique = 0 THEN ' UNIQUE ' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE ' ' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">'INDEX ', </b></p>
<p class="calibre1">-&gt; <b class="calibre3">st.index_name, ' (', st.column_name)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE concat('  ', st.column_name)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">END, </b></p>
<p class="calibre1">-&gt; <b class="calibre3">CASE</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHEN st.seq_in_index =</b></p>
<p class="calibre1">-&gt; <b class="calibre3">(SELECT max(st2.seq_in_index)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.statistics st2</b></p>
<p class="calibre1"><b class="calibre3">Chapter 15 | 307</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-324"></a>    -&gt; <b class="calibre3">WHERE st2.table_schema = st.table_schema</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND st2.table_name = st.table_name</b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND st2.index_name = st.index_name)</b></p>
<p class="calibre1">-&gt; <b class="calibre3">THEN ');' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ELSE '' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">END</b></p>
<p class="calibre1">-&gt; <b class="calibre3">) index_creation_statement</b></p>
<p class="calibre1">-&gt; <b class="calibre3">FROM information_schema.statistics st</b></p>
<p class="calibre1">-&gt; <b class="calibre3">WHERE st.table_schema = 'bank' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">AND st.table_name = 'employee' </b></p>
<p class="calibre1">-&gt; <b class="calibre3">ORDER BY st.index_name, st.seq_in_index; </b></p>
<p class="calibre1">+---------------------------------------------------------------------+</p>
<p class="calibre1">| index_creation_statement                                            |</p>
<p class="calibre1">+---------------------------------------------------------------------+</p>
<p class="calibre1">| ALTER TABLE employee ADD INDEX fk_dept_id (dept_id);                |</p>
<p class="calibre1">| ALTER TABLE employee ADD INDEX fk_e_branch_id (assigned_branch_id); |</p>
<p class="calibre1">| ALTER TABLE employee ADD INDEX fk_e_emp_id (superior_emp_id);       |</p>
<p class="calibre1">| ALTER TABLE employee ADD UNIQUE INDEX PRIMARY (emp_id);             |</p>
<p class="calibre1">+---------------------------------------------------------------------+</p>
<p class="calibre1">4 rows in set (0.20 sec)</p>
<p class="calibre1"><b class="calibre3">308 | Appendix C:</b> <b class="calibre3">Solutions to Exercises</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-153"></a><b class="calibre3">Index</b></p>
<p class="calibre1"><b class="calibre3">Symbols</b></p>
<p class="calibre1">\ (backslash), escaping special characters in</p>
<p class="calibre1"><a href="#calibre_link-169">strings, 116</a></p>
<p class="calibre1">! (exclamation mark), != (not equal to)</p>
<p class="calibre1">_ (underscore), wildcard character in partial</p>
<p class="calibre1"><a href="#calibre_link-170">operator, 67</a></p>
<p class="calibre1"><a href="#calibre_link-159">string matches, 74</a></p>
<p class="calibre1">% (percent sign), wildcard character in partial</p>
<p class="calibre1"><a href="#calibre_link-159">string matches, 74</a></p>
<p class="calibre1">' ' (quotes, single)</p>
<p class="calibre1"><b class="calibre3">A</b></p>
<p class="calibre1"><a href="#calibre_link-169">in strings, 116</a></p>
<p class="calibre1"><a href="#calibre_link-72">abs( ) function, 130</a></p>
<p class="calibre1"><a href="#calibre_link-68">surrounding strings, 114</a></p>
<p class="calibre1"><a href="#calibre_link-171">aggregate functions, 144, 145&ndash;150</a></p>
<p class="calibre1"><a href="#calibre_link-169">' (apostrophe) in strings, 116</a></p>
<p class="calibre1"><a href="#calibre_link-81">count( ) function, 147</a></p>
<p class="calibre1">( ) (parentheses)</p>
<p class="calibre1"><a href="#calibre_link-87">exercises with, 156</a></p>
<p class="calibre1"><a href="#calibre_link-88">enclosing subqueries, 157</a></p>
<p class="calibre1"><a href="#calibre_link-82">handling null values, 149</a></p>
<p class="calibre1">ordering query combinations in compound</p>
<p class="calibre1"><a href="#calibre_link-86">in having clause, 155</a></p>
<p class="calibre1"><a href="#calibre_link-66">queries, 111</a></p>
<p class="calibre1"><a href="#calibre_link-80">implicit versus explicit groups, 146</a></p>
<p class="calibre1"><a href="#calibre_link-40">using with filter conditions, 64</a></p>
<p class="calibre1"><a href="#calibre_link-79">listing of common functions, 145</a></p>
<p class="calibre1">&lt; (less than) operator</p>
<p class="calibre1"><a href="#calibre_link-82">using expressions as arguments, 149</a></p>
<p class="calibre1"><a href="#calibre_link-90">scalar subqueries and, 159</a></p>
<p class="calibre1"><a href="#calibre_link-86">where clause and, 155</a></p>
<p class="calibre1"><a href="#calibre_link-172">using with all operator, 163</a></p>
<p class="calibre1">aggregation</p>
<p class="calibre1"><a href="#calibre_link-90">&lt;= (less than or equal to) operator, 159</a></p>
<p class="calibre1">selective aggregation using case expressions, </p>
<p class="calibre1">&lt;&gt; (not equal to) operator</p>
<p class="calibre1"><a href="#calibre_link-113">209</a></p>
<p class="calibre1"><a href="#calibre_link-170">in inequality conditions, 67</a></p>
<p class="calibre1"><a href="#calibre_link-137">using views for data aggregation, 249</a></p>
<p class="calibre1"><a href="#calibre_link-90">scalar subqueries and, 159</a></p>
<p class="calibre1"><a href="#calibre_link-172">all operator, 163</a></p>
<p class="calibre1"><a href="#calibre_link-172">using with all operator, 163</a></p>
<p class="calibre1"><a href="#calibre_link-172">&lt;&gt; all comparisons, null values and, 163</a></p>
<p class="calibre1">= (equals sign)</p>
<p class="calibre1">alter table statements</p>
<p class="calibre1"><a href="#calibre_link-173">= null, filtering for null values, 77</a></p>
<p class="calibre1"><a href="#calibre_link-132">adding or removing constraints, 239</a></p>
<p class="calibre1">equal to operator</p>
<p class="calibre1"><a href="#calibre_link-174">adding or removing indexes, 229</a></p>
<p class="calibre1"><a href="#calibre_link-90">scalar subqueries and, 159</a></p>
<p class="calibre1"><a href="#calibre_link-175">changing storage engine, 224</a></p>
<p class="calibre1"><a href="#calibre_link-172">using with all operator, 163</a></p>
<p class="calibre1"><a href="#calibre_link-20">modifying definition of existing table, 31</a></p>
<p class="calibre1"><a href="#calibre_link-92">using with any operator, 165</a></p>
<p class="calibre1">and operator</p>
<p class="calibre1"><a href="#calibre_link-170">in equality conditions, 67</a></p>
<p class="calibre1"><a href="#calibre_link-39">condition evaluation with, 63</a></p>
<p class="calibre1">&gt; (greater than) operator</p>
<p class="calibre1">three-condition evaluation using and, or, </p>
<p class="calibre1"><a href="#calibre_link-90">scalar subqueries and, 159</a></p>
<p class="calibre1"><a href="#calibre_link-40">64</a></p>
<p class="calibre1"><a href="#calibre_link-172">using with all operator, 163</a></p>
<p class="calibre1">three-condition evaluation using and, or, </p>
<p class="calibre1"><a href="#calibre_link-90">&gt;= (greater than or equal to) operator, 159</a></p>
<p class="calibre1"><a href="#calibre_link-41">and not, 65</a></p>
<p class="calibre1"><a href="#calibre_link-33">using in select statement where clause, 54</a></p>
<p class="calibre1"><a href="#calibre_link-176">ANSI mode, 115</a></p>
<p class="calibre1">We’d like to hear your suggestions for improving our indexes. Send email to  <i class="calibre4">index@oreilly.com</i>. </p>
<p class="calibre1"><b class="calibre3">309</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-325"></a><a href="#calibre_link-51">ANSI SQL standard, join syntax, 86</a></p>
<p class="calibre1">character sets</p>
<p class="calibre1"><a href="#calibre_link-92">any operator, 165</a></p>
<p class="calibre1"><a href="#calibre_link-177">ASCII, 117</a></p>
<p class="calibre1"><a href="#calibre_link-70">arithmetic functions, 126</a></p>
<p class="calibre1"><a href="#calibre_link-178">latin1, 118</a></p>
<p class="calibre1"><a href="#calibre_link-42">arithmetic operators in filter conditions, 66</a></p>
<p class="calibre1"><a href="#calibre_link-44">sorting order or collation, 71</a></p>
<p class="calibre1">as keyword</p>
<p class="calibre1"><a href="#calibre_link-131">check constraints, 238</a></p>
<p class="calibre1"><a href="#calibre_link-28">using with column aliases, 47</a></p>
<p class="calibre1">clauses</p>
<p class="calibre1"><a href="#calibre_link-32">using with table aliases, 52</a></p>
<p class="calibre1">referencing multiple tables joined in a query, </p>
<p class="calibre1"><a href="#calibre_link-35">asc and desc keywords, 57</a></p>
<p class="calibre1"><a href="#calibre_link-32">52</a></p>
<p class="calibre1"><a href="#calibre_link-177">ASCII character set, 117</a></p>
<p class="calibre1"><a href="#calibre_link-26">select statement, 43</a></p>
<p class="calibre1"><a href="#calibre_link-178">ascii( ) function, 118</a></p>
<p class="calibre1"><a href="#calibre_link-26">select clause, 43</a></p>
<p class="calibre1"><a href="#calibre_link-121">atomicity, 219</a></p>
<p class="calibre1"><a href="#calibre_link-179">select, from, and where, 11</a></p>
<p class="calibre1"><a href="#calibre_link-123">auto-commit mode, 221</a></p>
<p class="calibre1"><a href="#calibre_link-90">subqueries in, 159</a></p>
<p class="calibre1"><a href="#calibre_link-20">auto-increment feature in MySQL, 31</a></p>
<p class="calibre1"><a href="#calibre_link-68">CLOB (Character Large Object) type, 114</a></p>
<p class="calibre1"><a href="#calibre_link-79">avg( ) function, 145</a></p>
<p class="calibre1"><a href="#calibre_link-180">code examples from this book, xii</a></p>
<p class="calibre1"><a href="#calibre_link-44">collation, 71</a></p>
<p class="calibre1"><b class="calibre3">B</b></p>
<p class="calibre1"><a href="#calibre_link-27">column aliases, 46</a></p>
<p class="calibre1"><a href="#calibre_link-181">columns, 5</a></p>
<p class="calibre1"><a href="#calibre_link-165">B-tree (balanced-tree) indexes, 232</a></p>
<p class="calibre1"><a href="#calibre_link-5">defined, 6</a></p>
<p class="calibre1"><a href="#calibre_link-123">begin transaction command, 221</a></p>
<p class="calibre1"><a href="#calibre_link-23">incorrect values for, 37</a></p>
<p class="calibre1"><a href="#calibre_link-182">between operator, 69</a></p>
<p class="calibre1"><a href="#calibre_link-84">multicolumn grouping, 151</a></p>
<p class="calibre1"><a href="#calibre_link-166">bitmap indexes, 233</a></p>
<p class="calibre1"><a href="#calibre_link-147">query returning number of, 265</a></p>
<p class="calibre1"><a href="#calibre_link-165">branch nodes (B-tree indexes), 232</a></p>
<p class="calibre1"><a href="#calibre_link-84">single-column grouping, 151</a></p>
<p class="calibre1"><b class="calibre3">C</b></p>
<p class="calibre1">viewing for a table with describe command, </p>
<p class="calibre1"><a href="#calibre_link-183">39</a></p>
<p class="calibre1"><a href="#calibre_link-8">C language, SQL integration toolkits, 10</a></p>
<p class="calibre1"><a href="#calibre_link-184">columns view, 260</a></p>
<p class="calibre1"><a href="#calibre_link-8">C#, SQL integration toolkit, 10</a></p>
<p class="calibre1"><a href="#calibre_link-179">comments, 11</a></p>
<p class="calibre1"><a href="#calibre_link-8">C++, SQL integration toolkits, 10</a></p>
<p class="calibre1"><a href="#calibre_link-121">commit command, 219</a></p>
<p class="calibre1"><a href="#calibre_link-50">Cartesian products, 83, 192&ndash;198</a></p>
<p class="calibre1"><a href="#calibre_link-185">ending transactions, 222</a></p>
<p class="calibre1"><a href="#calibre_link-134">cascading deletes, 242</a></p>
<p class="calibre1"><a href="#calibre_link-125">issuing for savepoints, 225</a></p>
<p class="calibre1"><a href="#calibre_link-186">cascading updates, 241</a></p>
<p class="calibre1"><a href="#calibre_link-123">commits, auto-commit mode, 221</a></p>
<p class="calibre1"><a href="#calibre_link-108">case expressions, 204</a></p>
<p class="calibre1">comparison operators</p>
<p class="calibre1"><a href="#calibre_link-111">examples, 207&ndash;215</a></p>
<p class="calibre1"><a href="#calibre_link-42">in filter conditions, 66</a></p>
<p class="calibre1"><a href="#calibre_link-114">checking for existence, 211</a></p>
<p class="calibre1"><a href="#calibre_link-90">using scalar subqueries with, 159</a></p>
<p class="calibre1"><a href="#calibre_link-117">conditional updates, 214</a></p>
<p class="calibre1"><a href="#calibre_link-172">using with all operator, 163</a></p>
<p class="calibre1"><a href="#calibre_link-115">division-by-zero errors, 212</a></p>
<p class="calibre1"><a href="#calibre_link-92">using with any operator, 165</a></p>
<p class="calibre1"><a href="#calibre_link-117">handling null values, 214</a></p>
<p class="calibre1"><a href="#calibre_link-138">complexity, hiding with use of views, 250</a></p>
<p class="calibre1"><a href="#calibre_link-112">result set transformations, 208</a></p>
<p class="calibre1"><a href="#calibre_link-181">compound key, 5</a></p>
<p class="calibre1"><a href="#calibre_link-113">selective aggregation, 209</a></p>
<p class="calibre1"><a href="#calibre_link-61">compound queries, 103</a></p>
<p class="calibre1"><a href="#calibre_link-109">searched, 205</a></p>
<p class="calibre1"><a href="#calibre_link-178">concat( ) function, 118</a></p>
<p class="calibre1"><a href="#calibre_link-110">simple, 206</a></p>
<p class="calibre1"><a href="#calibre_link-187">appending characters to strings, 123</a></p>
<p class="calibre1"><a href="#calibre_link-76">cast( ) function, 141</a></p>
<p class="calibre1">building strings from individual pieces of</p>
<p class="calibre1">converting strings to temporal data types, </p>
<p class="calibre1"><a href="#calibre_link-187">data, 123</a></p>
<p class="calibre1"><a href="#calibre_link-188">135</a></p>
<p class="calibre1"><a href="#calibre_link-107">conditional logic, 203&ndash;216</a></p>
<p class="calibre1"><a href="#calibre_link-71">ceil( ) function, 128</a></p>
<p class="calibre1"><a href="#calibre_link-108">case expressions, 204</a></p>
<p class="calibre1"><a href="#calibre_link-189">char type, 19, 113</a></p>
<p class="calibre1"><a href="#calibre_link-111">examples, 207&ndash;215</a></p>
<p class="calibre1"><a href="#calibre_link-177">char( ) function, 117</a></p>
<p class="calibre1"><a href="#calibre_link-109">searched, 205</a></p>
<p class="calibre1"><a href="#calibre_link-178">generating strings, 118</a></p>
<p class="calibre1"><a href="#calibre_link-110">simple, 206</a></p>
<p class="calibre1"><a href="#calibre_link-67">character data types, 113</a></p>
<p class="calibre1"><a href="#calibre_link-107">defined, 203</a></p>
<p class="calibre1"><a href="#calibre_link-13">character data, MySQL database, 18</a></p>
<p class="calibre1"><a href="#calibre_link-118">exercises in, 215</a></p>
<p class="calibre1"><b class="calibre3">310 | Index</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-326"></a>conditions, filter (see filter conditions; filtering) errors in table data insertion and</p>
<p class="calibre1"><a href="#calibre_link-131">constraints, 238&ndash;243</a></p>
<p class="calibre1"><a href="#calibre_link-22">modification, 36</a></p>
<p class="calibre1"><a href="#calibre_link-133">cascading, 240&ndash;242</a></p>
<p class="calibre1"><a href="#calibre_link-67">data types, character, 113</a></p>
<p class="calibre1"><a href="#calibre_link-131">creating, 238</a></p>
<p class="calibre1"><a href="#calibre_link-13">data types, MySQL, 18</a></p>
<p class="calibre1"><a href="#calibre_link-134">exercises, 242</a></p>
<p class="calibre1"><a href="#calibre_link-13">character data, 18</a></p>
<p class="calibre1">getting information about primary key</p>
<p class="calibre1"><a href="#calibre_link-189">character sets, 19</a></p>
<p class="calibre1"><a href="#calibre_link-190">constraints, 264</a></p>
<p class="calibre1"><a href="#calibre_link-191">text types, 20</a></p>
<p class="calibre1">getting information about using</p>
<p class="calibre1"><a href="#calibre_link-14">numeric data, 21</a></p>
<p class="calibre1"><a href="#calibre_link-167">information_schema, 261</a></p>
<p class="calibre1"><a href="#calibre_link-156">floating-point types, 22</a></p>
<p class="calibre1"><a href="#calibre_link-132">indexes and, 239</a></p>
<p class="calibre1"><a href="#calibre_link-156">integer types, 22</a></p>
<p class="calibre1">query returning number of primary key</p>
<p class="calibre1"><a href="#calibre_link-15">temporal types, 23</a></p>
<p class="calibre1"><a href="#calibre_link-147">constraints, 265</a></p>
<p class="calibre1"><a href="#calibre_link-25">database connections, 41</a></p>
<p class="calibre1"><a href="#calibre_link-88">containing statement, 157</a></p>
<p class="calibre1"><a href="#calibre_link-2">database systems, 1</a></p>
<p class="calibre1">conversions</p>
<p class="calibre1"><a href="#calibre_link-2">databases, 1&ndash;7</a></p>
<p class="calibre1"><a href="#calibre_link-76">functions for, 141</a></p>
<p class="calibre1"><a href="#calibre_link-131">constraints, 238&ndash;243</a></p>
<p class="calibre1">invalid date conversions causing statement</p>
<p class="calibre1"><a href="#calibre_link-11">creating MySQL database, 15</a></p>
<p class="calibre1"><a href="#calibre_link-23">errors, 37</a></p>
<p class="calibre1"><a href="#calibre_link-2">defined, 1</a></p>
<p class="calibre1"><a href="#calibre_link-188">string-to-date, 135</a></p>
<p class="calibre1"><a href="#calibre_link-126">indexes, 227&ndash;237</a></p>
<p class="calibre1"><a href="#calibre_link-192">convert_tz( ) function, 139</a></p>
<p class="calibre1"><a href="#calibre_link-119">multiuser, 217</a></p>
<p class="calibre1"><a href="#calibre_link-73">Coordinated Universal Time (UTC), 131</a></p>
<p class="calibre1"><a href="#calibre_link-120">locking, 218</a></p>
<p class="calibre1"><a href="#calibre_link-89">correlated subqueries, 158, 167</a></p>
<p class="calibre1"><a href="#calibre_link-3">nonrelational, 2</a></p>
<p class="calibre1"><a href="#calibre_link-114">in case expressions checking existence, 211</a></p>
<p class="calibre1"><a href="#calibre_link-7">optimizer, 9</a></p>
<p class="calibre1"><a href="#calibre_link-193">scalar subqueries example, 179</a></p>
<p class="calibre1"><a href="#calibre_link-4">relational model, 4</a></p>
<p class="calibre1"><a href="#calibre_link-113">summing transactions for an account, 209</a></p>
<p class="calibre1"><a href="#calibre_link-12">specifying database for mysql tool, 17</a></p>
<p class="calibre1"><a href="#calibre_link-94">using exists operator, 169</a></p>
<p class="calibre1"><a href="#calibre_link-51">SQL92 join syntax, 86</a></p>
<p class="calibre1"><a href="#calibre_link-95">using for data manipulation, 170</a></p>
<p class="calibre1"><a href="#calibre_link-5">terms and definitions, 6</a></p>
<p class="calibre1"><a href="#calibre_link-95">using with not exists operator, 170</a></p>
<p class="calibre1"><a href="#calibre_link-73">time zones and, 131</a></p>
<p class="calibre1"><a href="#calibre_link-79">count( ) function, 145, 146</a></p>
<p class="calibre1"><a href="#calibre_link-8">tools for SQL commands, 10</a></p>
<p class="calibre1">counting banking transactions for a day</p>
<p class="calibre1"><a href="#calibre_link-15">date type, 23</a></p>
<p class="calibre1"><a href="#calibre_link-194">(example), 197</a></p>
<p class="calibre1"><a href="#calibre_link-195">datediff( ) function, 140</a></p>
<p class="calibre1"><a href="#calibre_link-81">counting distinct values, 147</a></p>
<p class="calibre1">dates and times</p>
<p class="calibre1"><a href="#calibre_link-174">create index command, 229</a></p>
<p class="calibre1">date format components, MySQL temporal</p>
<p class="calibre1">create table statements</p>
<p class="calibre1"><a href="#calibre_link-157">types, 24</a></p>
<p class="calibre1"><a href="#calibre_link-18">building for MySQL table creation, 27</a></p>
<p class="calibre1">functions generating dates from strings, </p>
<p class="calibre1"><a href="#calibre_link-147">checking for well-formed, 265</a></p>
<p class="calibre1"><a href="#calibre_link-188">135</a></p>
<p class="calibre1"><a href="#calibre_link-131">creating constraints, 238</a></p>
<p class="calibre1"><a href="#calibre_link-23">invalid date conversions, 37</a></p>
<p class="calibre1"><a href="#calibre_link-196">index generated by, 230</a></p>
<p class="calibre1"><a href="#calibre_link-15">MySQL temporal types, 23</a></p>
<p class="calibre1">query generating, using</p>
<p class="calibre1"><a href="#calibre_link-188">string-to-date conversions, 135</a></p>
<p class="calibre1"><a href="#calibre_link-146">information_schema, 263</a></p>
<p class="calibre1"><a href="#calibre_link-75">temporal functions returning dates, 137</a></p>
<p class="calibre1"><a href="#calibre_link-135">create view statements, 245</a></p>
<p class="calibre1"><a href="#calibre_link-73">time zones, 131</a></p>
<p class="calibre1"><a href="#calibre_link-50">cross joins, 83, 192&ndash;198</a></p>
<p class="calibre1"><a href="#calibre_link-15">datetime type, 23, 24</a></p>
<p class="calibre1"><a href="#calibre_link-197">cube operations in grouping, 154</a></p>
<p class="calibre1"><a href="#calibre_link-161">strings representing datetime values, 134</a></p>
<p class="calibre1">current date or time, generating from strings, </p>
<p class="calibre1"><a href="#calibre_link-75">date_add( ) function, 137, 195</a></p>
<p class="calibre1"><a href="#calibre_link-162">136</a></p>
<p class="calibre1"><a href="#calibre_link-192">dayname( ) function, 139</a></p>
<p class="calibre1"><a href="#calibre_link-9">DB2 Universal Database, 12</a></p>
<p class="calibre1"><b class="calibre3">D</b></p>
<p class="calibre1"><a href="#calibre_link-185">deadlocks, 222</a></p>
<p class="calibre1"><a href="#calibre_link-198">deallocate statements, 267</a></p>
<p class="calibre1"><a href="#calibre_link-199">data dictionary, 8, 258</a></p>
<p class="calibre1">delete statements</p>
<p class="calibre1"><a href="#calibre_link-200">data statements, x, 7</a></p>
<p class="calibre1"><a href="#calibre_link-21">deleting data from MySQL table, 35</a></p>
<p class="calibre1"><b class="calibre3">Index | 311</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-327"></a><a href="#calibre_link-96">using correlated subqueries, 171</a></p>
<p class="calibre1">sorting data in select statement order by</p>
<p class="calibre1"><a href="#calibre_link-134">deletes, cascading, 242</a></p>
<p class="calibre1"><a href="#calibre_link-36">clause, 58</a></p>
<p class="calibre1">deployment verification for schema objects, </p>
<p class="calibre1">using as arguments for aggregate functions, </p>
<p class="calibre1"><a href="#calibre_link-147">265</a></p>
<p class="calibre1"><a href="#calibre_link-82">149</a></p>
<p class="calibre1"><a href="#calibre_link-35">desc and asc keywords, 57</a></p>
<p class="calibre1"><a href="#calibre_link-192">extract( ) function, 139</a></p>
<p class="calibre1"><a href="#calibre_link-158">describe (desc) command, 29</a></p>
<p class="calibre1"><a href="#calibre_link-85">returning only year portion of a date, 152</a></p>
<p class="calibre1"><a href="#calibre_link-183">columns in table, describing, 39</a></p>
<p class="calibre1"><a href="#calibre_link-201">examining views, 247</a></p>
<p class="calibre1"><b class="calibre3">F</b></p>
<p class="calibre1"><a href="#calibre_link-29">distinct keyword, 48, 162</a></p>
<p class="calibre1"><a href="#calibre_link-115">division-by-zero errors, 212</a></p>
<p class="calibre1"><a href="#calibre_link-175">Falcon storage engine, 224</a></p>
<p class="calibre1"><a href="#calibre_link-53">driving table, 90</a></p>
<p class="calibre1">filter conditions</p>
<p class="calibre1">duplicates</p>
<p class="calibre1"><a href="#calibre_link-51">ANSI join syntax and, 86</a></p>
<p class="calibre1"><a href="#calibre_link-202">excluding using union operator, 105</a></p>
<p class="calibre1"><a href="#calibre_link-79">group, 145, 155</a></p>
<p class="calibre1">removal by except and except all operators, </p>
<p class="calibre1"><a href="#calibre_link-57">join conditions versus, 96</a></p>
<p class="calibre1"><a href="#calibre_link-64">108</a></p>
<p class="calibre1"><a href="#calibre_link-32">in select statement where clause, 52</a></p>
<p class="calibre1"><a href="#calibre_link-62">removal by intersect operator, 106</a></p>
<p class="calibre1"><a href="#calibre_link-98">subqueries in, 177</a></p>
<p class="calibre1"><a href="#calibre_link-28">removing from query returns, 47</a></p>
<p class="calibre1"><a href="#calibre_link-39">in where clauses, 63</a></p>
<p class="calibre1"><a href="#calibre_link-203">union all operator and, 104</a></p>
<p class="calibre1"><a href="#calibre_link-39">filtering, 63&ndash;79</a></p>
<p class="calibre1"><a href="#calibre_link-122">durability, 220</a></p>
<p class="calibre1"><a href="#calibre_link-42">building conditions, 66</a></p>
<p class="calibre1"><a href="#calibre_link-148">dynamic SQL execution, 266</a></p>
<p class="calibre1"><a href="#calibre_link-42">condition types, 66</a></p>
<p class="calibre1"><a href="#calibre_link-42">equality conditions, 66</a></p>
<p class="calibre1"><b class="calibre3">E</b></p>
<p class="calibre1"><a href="#calibre_link-170">inequality conditions, 67</a></p>
<p class="calibre1"><a href="#calibre_link-45">matching conditions, 73</a></p>
<p class="calibre1"><a href="#calibre_link-73">Eastern Standard Time, 131</a></p>
<p class="calibre1"><a href="#calibre_link-44">membership conditions, 71</a></p>
<p class="calibre1"><a href="#calibre_link-181">entities, 5</a></p>
<p class="calibre1">modifying data with equality conditions, </p>
<p class="calibre1"><a href="#calibre_link-5">defined, 6</a></p>
<p class="calibre1"><a href="#calibre_link-170">67</a></p>
<p class="calibre1"><a href="#calibre_link-204">enum data type, MySQL, 28</a></p>
<p class="calibre1"><a href="#calibre_link-43">range conditions, 68</a></p>
<p class="calibre1"><a href="#calibre_link-42">equality conditions, 66</a></p>
<p class="calibre1"><a href="#calibre_link-39">evaluation of conditions, 63</a></p>
<p class="calibre1"><a href="#calibre_link-111">case expressions and, 207</a></p>
<p class="calibre1"><a href="#calibre_link-41">using not operator, 65</a></p>
<p class="calibre1"><a href="#calibre_link-93">correlated subqueries in, 167</a></p>
<p class="calibre1"><a href="#calibre_link-40">using parentheses, 64</a></p>
<p class="calibre1"><a href="#calibre_link-170">data modification using, 67</a></p>
<p class="calibre1"><a href="#calibre_link-47">exercises, 79</a></p>
<p class="calibre1">error from subquery returning more than</p>
<p class="calibre1"><a href="#calibre_link-46">null values, 76</a></p>
<p class="calibre1"><a href="#calibre_link-91">one row, 160</a></p>
<p class="calibre1">floating-point numbers, controlling precision</p>
<p class="calibre1"><a href="#calibre_link-89">subquery in, 158</a></p>
<p class="calibre1"><a href="#calibre_link-71">of, 128</a></p>
<p class="calibre1"><a href="#calibre_link-56">equi-joins, 94</a></p>
<p class="calibre1"><a href="#calibre_link-156">floating-point types, MySQL, 22</a></p>
<p class="calibre1"><a href="#calibre_link-169">escaping single quotes in strings, 116</a></p>
<p class="calibre1"><a href="#calibre_link-71">floor( ) function, 128</a></p>
<p class="calibre1"><a href="#calibre_link-63">except all operator, 107</a></p>
<p class="calibre1"><a href="#calibre_link-131">foreign key constraints, 238</a></p>
<p class="calibre1"><a href="#calibre_link-160">except operation (sets), 100</a></p>
<p class="calibre1"><a href="#calibre_link-133">cascading, 240&ndash;242</a></p>
<p class="calibre1"><a href="#calibre_link-63">except operator, 107</a></p>
<p class="calibre1"><a href="#calibre_link-5">foreign keys, 6</a></p>
<p class="calibre1"><a href="#calibre_link-198">execute statements, 267</a></p>
<p class="calibre1"><a href="#calibre_link-6">defined, 7</a></p>
<p class="calibre1"><a href="#calibre_link-114">existence, checking for, 211</a></p>
<p class="calibre1">nonexistent key causing statement errors, </p>
<p class="calibre1"><a href="#calibre_link-94">exists operator, 169</a></p>
<p class="calibre1"><a href="#calibre_link-22">36</a></p>
<p class="calibre1"><a href="#calibre_link-80">explicit groups, 146</a></p>
<p class="calibre1"><a href="#calibre_link-55">self-referencing, 93</a></p>
<p class="calibre1"><a href="#calibre_link-108">expressions, 204</a></p>
<p class="calibre1"><a href="#calibre_link-49">using in joins, 82</a></p>
<p class="calibre1">(see also case expressions)</p>
<p class="calibre1"><a href="#calibre_link-179">from clauses, 11</a></p>
<p class="calibre1"><a href="#calibre_link-42">in filter conditions, 66</a></p>
<p class="calibre1"><a href="#calibre_link-53">join order and, 90</a></p>
<p class="calibre1"><a href="#calibre_link-98">generating with subqueries, 177</a></p>
<p class="calibre1"><a href="#calibre_link-52">joining three or more tables, 88</a></p>
<p class="calibre1"><a href="#calibre_link-85">grouping via, 152</a></p>
<p class="calibre1"><a href="#calibre_link-205">joining two tables using inner join, 84</a></p>
<p class="calibre1"><a href="#calibre_link-206">included in select clause (example), 45</a></p>
<p class="calibre1"><a href="#calibre_link-13">missing, 18</a></p>
<p class="calibre1"><a href="#calibre_link-50">on subclause, 83</a></p>
<p class="calibre1"><b class="calibre3">312 | Index</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-328"></a><a href="#calibre_link-51">ANSI join syntax in, 86</a></p>
<p class="calibre1"><b class="calibre3">H</b></p>
<p class="calibre1"><a href="#calibre_link-29">in select statement, 48&ndash;52</a></p>
<p class="calibre1"><a href="#calibre_link-32">table aliases, 52</a></p>
<p class="calibre1">having clauses</p>
<p class="calibre1"><a href="#calibre_link-31">table links, 51</a></p>
<p class="calibre1"><a href="#calibre_link-86">aggregate functions in, 155</a></p>
<p class="calibre1"><a href="#calibre_link-30">tables defined by, 49</a></p>
<p class="calibre1"><a href="#calibre_link-79">group filter conditions in, 145, 155</a></p>
<p class="calibre1"><a href="#calibre_link-140">select statements for updatable views, 252</a></p>
<p class="calibre1"><a href="#calibre_link-34">in select statements, 55</a></p>
<p class="calibre1"><a href="#calibre_link-97">subqueries in, 172</a></p>
<p class="calibre1"><a href="#calibre_link-98">subqueries in filter conditions, 177</a></p>
<p class="calibre1"><a href="#calibre_link-49">using in joins, 82</a></p>
<p class="calibre1"><a href="#calibre_link-3">hierarchical database systems, 2</a></p>
<p class="calibre1"><a href="#calibre_link-207">using subclause, 85</a></p>
<p class="calibre1"><a href="#calibre_link-129">high-cardinality data, 234</a></p>
<p class="calibre1">using with select clause in select statement, </p>
<p class="calibre1"><a href="#calibre_link-208">44</a></p>
<p class="calibre1"><b class="calibre3">I</b></p>
<p class="calibre1"><a href="#calibre_link-129">full-text indexes, 234</a></p>
<p class="calibre1"><a href="#calibre_link-108">if-then-else statements, 204</a></p>
<p class="calibre1">functions</p>
<p class="calibre1"><a href="#calibre_link-80">implicit groups, 146</a></p>
<p class="calibre1">advantages of case expressions over for</p>
<p class="calibre1"><a href="#calibre_link-44">in operator, 71</a></p>
<p class="calibre1"><a href="#calibre_link-108">conditional logic, 204</a></p>
<p class="calibre1">searching for value within set of values, </p>
<p class="calibre1"><a href="#calibre_link-79">aggregate, 145&ndash;150</a></p>
<p class="calibre1"><a href="#calibre_link-91">160</a></p>
<p class="calibre1">built-in function in select clause (example), </p>
<p class="calibre1"><a href="#calibre_link-209">using with subquery, 161</a></p>
<p class="calibre1"><a href="#calibre_link-206">45</a></p>
<p class="calibre1"><a href="#calibre_link-126">indexes, 227&ndash;237</a></p>
<p class="calibre1"><a href="#calibre_link-76">conversion, 141</a></p>
<p class="calibre1"><a href="#calibre_link-165">B-tree (balanced-tree), 232</a></p>
<p class="calibre1"><a href="#calibre_link-188">generating dates from strings, 135</a></p>
<p class="calibre1"><a href="#calibre_link-166">bitmap, 233</a></p>
<p class="calibre1">numeric</p>
<p class="calibre1"><a href="#calibre_link-132">constraints and, 239</a></p>
<p class="calibre1"><a href="#calibre_link-71">controlling number precision, 128</a></p>
<p class="calibre1"><a href="#calibre_link-127">creating, 228</a></p>
<p class="calibre1"><a href="#calibre_link-72">handling signed data, 130</a></p>
<p class="calibre1"><a href="#calibre_link-134">exercises, 242</a></p>
<p class="calibre1"><a href="#calibre_link-70">single-argument, 126</a></p>
<p class="calibre1"><a href="#calibre_link-128">multicolumn, 231</a></p>
<p class="calibre1"><a href="#calibre_link-69">string functions returning numbers, 119</a></p>
<p class="calibre1"><a href="#calibre_link-130">overhead of, strategy for minimizing, 237</a></p>
<p class="calibre1"><a href="#calibre_link-187">string functions returning strings, 123&ndash;125</a></p>
<p class="calibre1"><a href="#calibre_link-147">query returning number of, 265</a></p>
<p class="calibre1"><a href="#calibre_link-75">temporal functions returning dates, 137</a></p>
<p class="calibre1"><a href="#calibre_link-196">removing via alter table command, 230</a></p>
<p class="calibre1"><a href="#calibre_link-195">temporal functions returning numbers, 140</a></p>
<p class="calibre1">retrieving information about using</p>
<p class="calibre1"><a href="#calibre_link-192">temporal functions returning strings, 139</a></p>
<p class="calibre1"><a href="#calibre_link-184">information_schema, 260</a></p>
<p class="calibre1"><a href="#calibre_link-129">text, 234</a></p>
<p class="calibre1"><b class="calibre3">G</b></p>
<p class="calibre1"><a href="#calibre_link-196">unique, 230</a></p>
<p class="calibre1"><a href="#calibre_link-73">GMT (Greenwich Mean Time), 131</a></p>
<p class="calibre1"><a href="#calibre_link-129">uses of, 234</a></p>
<p class="calibre1"><a href="#calibre_link-171">group by clauses, 144</a></p>
<p class="calibre1"><a href="#calibre_link-174">viewing for a table, 229</a></p>
<p class="calibre1"><a href="#calibre_link-81">explicit groups in, 147</a></p>
<p class="calibre1"><a href="#calibre_link-170">inequality conditions, 67</a></p>
<p class="calibre1"><a href="#calibre_link-34">in select statements, 55</a></p>
<p class="calibre1"><a href="#calibre_link-90">scalar subquery in, 159</a></p>
<p class="calibre1"><a href="#calibre_link-79">where clause and, 145</a></p>
<p class="calibre1"><a href="#calibre_link-144">information_schema objects, 258&ndash;262</a></p>
<p class="calibre1"><a href="#calibre_link-78">grouping, 143&ndash;145, 150&ndash;154</a></p>
<p class="calibre1"><a href="#calibre_link-210">columns view, 268</a></p>
<p class="calibre1"><a href="#calibre_link-87">exercises in, 156</a></p>
<p class="calibre1"><a href="#calibre_link-167">information about constraints, 261</a></p>
<p class="calibre1"><a href="#calibre_link-85">generating rollups, 152, 174</a></p>
<p class="calibre1"><a href="#calibre_link-184">information about table indexes, 260</a></p>
<p class="calibre1"><a href="#calibre_link-86">group filter conditions, 155</a></p>
<p class="calibre1"><a href="#calibre_link-167">views available in MySQL 6.0, 261</a></p>
<p class="calibre1"><a href="#calibre_link-80">implicit versus explicit groups, 146</a></p>
<p class="calibre1"><a href="#calibre_link-211">views in, 259</a></p>
<p class="calibre1"><a href="#calibre_link-84">multicolumn groups, 151</a></p>
<p class="calibre1"><a href="#calibre_link-50">inner joins, 83</a></p>
<p class="calibre1"><a href="#calibre_link-84">single-column groups, 151</a></p>
<p class="calibre1"><a href="#calibre_link-58">exercises in, 97</a></p>
<p class="calibre1"><a href="#calibre_link-85">using expressions, 152</a></p>
<p class="calibre1"><a href="#calibre_link-205">INNER keyword, 84</a></p>
<p class="calibre1"><a href="#calibre_link-163">using subqueries, 173, 175</a></p>
<p class="calibre1"><a href="#calibre_link-175">InnoDB storage engine, 224</a></p>
<p class="calibre1"><a href="#calibre_link-197">with cube option, 154</a></p>
<p class="calibre1"><a href="#calibre_link-20">insert statements, 31, 32&ndash;34</a></p>
<p class="calibre1"><a href="#calibre_link-22">errors from nonexistent foreign key, 36</a></p>
<p class="calibre1"><a href="#calibre_link-22">errors from nonunique primary key, 36</a></p>
<p class="calibre1"><a href="#calibre_link-179">example, 11</a></p>
<p class="calibre1"><b class="calibre3">Index | 313</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-329"></a><a href="#calibre_link-212">important considerations, 33</a></p>
<p class="calibre1"><a href="#calibre_link-205">specifying type of join, 84</a></p>
<p class="calibre1"><a href="#calibre_link-213">inserting data through views, 254</a></p>
<p class="calibre1">noncorrelated scalar subqueries generating</p>
<p class="calibre1"><b class="calibre3">L</b></p>
<p class="calibre1"><a href="#calibre_link-214">values for, 180</a></p>
<p class="calibre1"><a href="#calibre_link-215">insert( ) function, 124</a></p>
<p class="calibre1"><a href="#calibre_link-216">last_day( ) function, 138</a></p>
<p class="calibre1"><a href="#calibre_link-156">integer types, MySQL, 22</a></p>
<p class="calibre1"><a href="#calibre_link-191">latin1 character set, 20</a></p>
<p class="calibre1"><a href="#calibre_link-7">integration toolkits for SQL, 9</a></p>
<p class="calibre1"><a href="#calibre_link-165">leaf nodes (B-tree indexes), 232</a></p>
<p class="calibre1"><a href="#calibre_link-53">intermediate result sets, 90</a></p>
<p class="calibre1"><a href="#calibre_link-101">left outer joins, 187</a></p>
<p class="calibre1"><a href="#calibre_link-62">intersect all operator, 106</a></p>
<p class="calibre1"><a href="#calibre_link-45">left( ) function, 73</a></p>
<p class="calibre1"><a href="#calibre_link-62">intersect operator, 106</a></p>
<p class="calibre1"><a href="#calibre_link-69">length( ) function, 119</a></p>
<p class="calibre1"><a href="#calibre_link-66">precedence of, 111</a></p>
<p class="calibre1"><a href="#calibre_link-159">like operator, 74</a></p>
<p class="calibre1"><a href="#calibre_link-160">intersection operation (sets), 100</a></p>
<p class="calibre1"><a href="#calibre_link-217">comparing strings, 122</a></p>
<p class="calibre1">intervals</p>
<p class="calibre1"><a href="#calibre_link-46">regular expressions and, 76</a></p>
<p class="calibre1"><a href="#calibre_link-75">adding to dates, 137</a></p>
<p class="calibre1"><a href="#calibre_link-36">limit clauses, 58</a></p>
<p class="calibre1"><a href="#calibre_link-216">common interval types, 138</a></p>
<p class="calibre1"><a href="#calibre_link-31">links, table, 51</a></p>
<p class="calibre1"><a href="#calibre_link-195">determing number between two dates, 140</a></p>
<p class="calibre1"><a href="#calibre_link-218">locate( ) function, 120</a></p>
<p class="calibre1"><a href="#calibre_link-195">using with extract( ) function, 140</a></p>
<p class="calibre1"><a href="#calibre_link-120">locking, 218</a></p>
<p class="calibre1"><a href="#calibre_link-173">is not null operator, 77</a></p>
<p class="calibre1"><a href="#calibre_link-120">granularities of locks, 218</a></p>
<p class="calibre1"><a href="#calibre_link-46">is null operator, 76</a></p>
<p class="calibre1"><a href="#calibre_link-175">storage engines and, 224</a></p>
<p class="calibre1"><a href="#calibre_link-166">low-cardinality data, 233</a></p>
<p class="calibre1"><b class="calibre3">J</b></p>
<p class="calibre1"><b class="calibre3">M</b></p>
<p class="calibre1">Java</p>
<p class="calibre1"><a href="#calibre_link-8">SQL integration toolkits, 10</a></p>
<p class="calibre1"><a href="#calibre_link-45">matching conditions, 73</a></p>
<p class="calibre1"><a href="#calibre_link-148">SQL statements and, 266</a></p>
<p class="calibre1"><a href="#calibre_link-219">using multiple search expressions, 75</a></p>
<p class="calibre1">join conditions</p>
<p class="calibre1"><a href="#calibre_link-219">using regular expressions, 75</a></p>
<p class="calibre1"><a href="#calibre_link-51">ANSI join syntax and, 86</a></p>
<p class="calibre1"><a href="#calibre_link-45">using wildcards, 73</a></p>
<p class="calibre1"><a href="#calibre_link-57">filter conditions versus, 96</a></p>
<p class="calibre1"><a href="#calibre_link-159">example search expressions, 74</a></p>
<p class="calibre1"><a href="#calibre_link-49">join keyword, 82</a></p>
<p class="calibre1"><a href="#calibre_link-79">max( ) function, 145</a></p>
<p class="calibre1"><a href="#calibre_link-48">joins, 81, 183&ndash;201</a></p>
<p class="calibre1"><a href="#calibre_link-44">membership conditions, 71</a></p>
<p class="calibre1"><a href="#calibre_link-51">ANSI syntax for, 86</a></p>
<p class="calibre1"><a href="#calibre_link-220">generating using subqueries, 72</a></p>
<p class="calibre1"><a href="#calibre_link-50">cross joins, 83, 192&ndash;198</a></p>
<p class="calibre1"><a href="#calibre_link-220">using not in operator, 72</a></p>
<p class="calibre1"><a href="#calibre_link-49">defined, 82</a></p>
<p class="calibre1"><a href="#calibre_link-199">metadata, 8, 257&ndash;270</a></p>
<p class="calibre1"><a href="#calibre_link-56">equi- versus non-equi-joins, 94&ndash;96</a></p>
<p class="calibre1"><a href="#calibre_link-149">exercises in, 270</a></p>
<p class="calibre1"><a href="#calibre_link-58">exercises, 97</a></p>
<p class="calibre1"><a href="#calibre_link-143">information included in, 257</a></p>
<p class="calibre1"><a href="#calibre_link-106">exercises in, 200</a></p>
<p class="calibre1"><a href="#calibre_link-144">information_schema objects, 258&ndash;262</a></p>
<p class="calibre1"><a href="#calibre_link-50">inner joins, 83</a></p>
<p class="calibre1"><a href="#calibre_link-144">publishing by database servers, 258</a></p>
<p class="calibre1"><a href="#calibre_link-57">join versus filter conditions, 96</a></p>
<p class="calibre1"><a href="#calibre_link-147">using in deployment verification, 265</a></p>
<p class="calibre1"><a href="#calibre_link-52">joining three or more tables, 88&ndash;93</a></p>
<p class="calibre1"><a href="#calibre_link-148">using in dynamic SQL generation, 266&ndash;270</a></p>
<p class="calibre1"><a href="#calibre_link-221">order of joins, 89</a></p>
<p class="calibre1"><a href="#calibre_link-145">using in schema generation scripts, 262&ndash;</a></p>
<p class="calibre1"><a href="#calibre_link-53">specifying join order, 90</a></p>
<p class="calibre1"><a href="#calibre_link-147">265</a></p>
<p class="calibre1"><a href="#calibre_link-54">using same table twice, 92</a></p>
<p class="calibre1"><a href="#calibre_link-79">min( ) function, 145</a></p>
<p class="calibre1"><a href="#calibre_link-53">using subqueries as tables, 90</a></p>
<p class="calibre1"><a href="#calibre_link-222">mod( ) function, 127</a></p>
<p class="calibre1"><a href="#calibre_link-201">joining views to other tables or views, 247</a></p>
<p class="calibre1">mode, checking and changing for MySQL, </p>
<p class="calibre1"><a href="#calibre_link-105">natural joins, 198</a></p>
<p class="calibre1"><a href="#calibre_link-176">115</a></p>
<p class="calibre1"><a href="#calibre_link-100">outer joins, 183&ndash;192</a></p>
<p class="calibre1"><a href="#calibre_link-222">modulo operator, 127</a></p>
<p class="calibre1"><a href="#calibre_link-101">left versus right, 187</a></p>
<p class="calibre1"><a href="#calibre_link-189">multibyte character sets, 19</a></p>
<p class="calibre1"><a href="#calibre_link-103">self, 190</a></p>
<p class="calibre1"><a href="#calibre_link-154">multiparent hierarchy, 3</a></p>
<p class="calibre1"><a href="#calibre_link-102">three-way, 188</a></p>
<p class="calibre1"><a href="#calibre_link-200">MySQL, x</a></p>
<p class="calibre1"><a href="#calibre_link-55">self-joins, 93</a></p>
<p class="calibre1"><a href="#calibre_link-24">bank schema (example), 38&ndash;40</a></p>
<p class="calibre1"><b class="calibre3">314 | Index</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-330"></a><a href="#calibre_link-132">constraint generation, indexes and, 239</a></p>
<p class="calibre1"><a href="#calibre_link-92">using any operator, 165</a></p>
<p class="calibre1"><a href="#calibre_link-155">creating a sample database, 16</a></p>
<p class="calibre1"><a href="#calibre_link-7">nonprocedural languages, 9</a></p>
<p class="calibre1"><a href="#calibre_link-13">data types, 18</a></p>
<p class="calibre1">normalization</p>
<p class="calibre1"><a href="#calibre_link-13">character, 18</a></p>
<p class="calibre1"><a href="#calibre_link-5">defined, 6</a></p>
<p class="calibre1"><a href="#calibre_link-14">numeric, 21</a></p>
<p class="calibre1"><a href="#calibre_link-17">table design in MySQL and, 26</a></p>
<p class="calibre1">downloading and installing MySQL 6.0</p>
<p class="calibre1"><a href="#calibre_link-95">not exists operator, 170, 171</a></p>
<p class="calibre1"><a href="#calibre_link-11">server, 15</a></p>
<p class="calibre1"><a href="#calibre_link-220">not in operator, 72</a></p>
<p class="calibre1"><a href="#calibre_link-198">dynamic SQL execution, 267</a></p>
<p class="calibre1"><a href="#calibre_link-172">&lt;&gt; all versus, 163</a></p>
<p class="calibre1"><a href="#calibre_link-63">except operator and, 107</a></p>
<p class="calibre1"><a href="#calibre_link-223">using in subquery, 162</a></p>
<p class="calibre1">grouping, with cube option not supported, </p>
<p class="calibre1"><a href="#calibre_link-41">not operator, using with filter conditions, 65</a></p>
<p class="calibre1"><a href="#calibre_link-197">154</a></p>
<p class="calibre1"><a href="#calibre_link-158">null values, 29</a></p>
<p class="calibre1"><a href="#calibre_link-108">if( ) function, 204</a></p>
<p class="calibre1">comparisons with not in and &lt;&gt; all</p>
<p class="calibre1"><a href="#calibre_link-174">indexes, 229</a></p>
<p class="calibre1"><a href="#calibre_link-172">operators, 163</a></p>
<p class="calibre1"><a href="#calibre_link-144">information_schema database, 258</a></p>
<p class="calibre1"><a href="#calibre_link-46">filtering, 76</a></p>
<p class="calibre1"><a href="#calibre_link-62">intersect operator and, 106</a></p>
<p class="calibre1"><a href="#calibre_link-117">handling using case expressions, 214</a></p>
<p class="calibre1"><a href="#calibre_link-74">loading time zone data, 132</a></p>
<p class="calibre1">handling when performing aggregations, </p>
<p class="calibre1"><a href="#calibre_link-120">locking, 218</a></p>
<p class="calibre1"><a href="#calibre_link-82">149</a></p>
<p class="calibre1"><a href="#calibre_link-8">mysql command-line tool, 10</a></p>
<p class="calibre1">subqueries generating data for columns</p>
<p class="calibre1"><a href="#calibre_link-9">overview of, 12</a></p>
<p class="calibre1"><a href="#calibre_link-214">allowing null values, 180</a></p>
<p class="calibre1"><a href="#calibre_link-19">populating and modifying tables, 30&ndash;36</a></p>
<p class="calibre1"><a href="#calibre_link-70">numeric data, 126&ndash;130</a></p>
<p class="calibre1"><a href="#calibre_link-21">deleting data, 35</a></p>
<p class="calibre1"><a href="#calibre_link-71">controlling number precision, 128</a></p>
<p class="calibre1"><a href="#calibre_link-20">inserting data, 31&ndash;35</a></p>
<p class="calibre1">converting strings to, using cast( ) function, </p>
<p class="calibre1"><a href="#calibre_link-21">updating data, 35</a></p>
<p class="calibre1"><a href="#calibre_link-76">141</a></p>
<p class="calibre1"><a href="#calibre_link-66">set operation precedence, 111</a></p>
<p class="calibre1"><a href="#calibre_link-70">performing arithmetic functions, 126</a></p>
<p class="calibre1"><a href="#calibre_link-53">specifying join order, 90</a></p>
<p class="calibre1"><a href="#calibre_link-72">signed data, 130</a></p>
<p class="calibre1"><a href="#calibre_link-124">storage engines, 223</a></p>
<p class="calibre1"><a href="#calibre_link-14">numeric data types, MySQL, 21</a></p>
<p class="calibre1"><a href="#calibre_link-16">table creation, 25&ndash;30</a></p>
<p class="calibre1">conditions specifying ranges of numbers, </p>
<p class="calibre1"><a href="#calibre_link-18">building SQL schema statements, 27</a></p>
<p class="calibre1"><a href="#calibre_link-224">70</a></p>
<p class="calibre1"><a href="#calibre_link-73">time zone settings, 131</a></p>
<p class="calibre1"><a href="#calibre_link-156">floating-point types, 22</a></p>
<p class="calibre1">transactions</p>
<p class="calibre1"><a href="#calibre_link-156">integer types, 22</a></p>
<p class="calibre1"><a href="#calibre_link-123">disabling auto-commit mode, 221</a></p>
<p class="calibre1"><a href="#calibre_link-185">error message for deadlock, 222</a></p>
<p class="calibre1"><b class="calibre3">O</b></p>
<p class="calibre1"><a href="#calibre_link-123">starting, 221</a></p>
<p class="calibre1"><a href="#calibre_link-139">updatable views, 251</a></p>
<p class="calibre1"><a href="#calibre_link-50">on subclause of from clause, 83</a></p>
<p class="calibre1">mysql command-line tool</p>
<p class="calibre1"><a href="#calibre_link-51">ANSI join syntax in, 86</a></p>
<p class="calibre1"><a href="#calibre_link-225">--xml option, 34</a></p>
<p class="calibre1"><a href="#calibre_link-52">joining three or more tables, 88</a></p>
<p class="calibre1"><a href="#calibre_link-226">result sets returned by, 42</a></p>
<p class="calibre1"><a href="#calibre_link-10">open source database servers, 13</a></p>
<p class="calibre1"><a href="#calibre_link-204">running create table statement, 28</a></p>
<p class="calibre1"><a href="#calibre_link-39">operators, 63</a></p>
<p class="calibre1"><a href="#calibre_link-12">using, 17</a></p>
<p class="calibre1">(see also names of individual operators)</p>
<p class="calibre1"><a href="#calibre_link-39">and, or operators in filter conditions, 63</a></p>
<p class="calibre1"><b class="calibre3">N</b></p>
<p class="calibre1"><a href="#calibre_link-42">in filter conditions, 66</a></p>
<p class="calibre1"><a href="#calibre_link-7">optimizers, 9</a></p>
<p class="calibre1"><a href="#calibre_link-105">natural joins, 198</a></p>
<p class="calibre1">or operator</p>
<p class="calibre1"><a href="#calibre_link-181">natural key, 5</a></p>
<p class="calibre1"><a href="#calibre_link-40">in filter conditions, 64</a></p>
<p class="calibre1"><a href="#calibre_link-154">network database systems, 3</a></p>
<p class="calibre1">three-condition evaluation using and, or, </p>
<p class="calibre1"><a href="#calibre_link-56">non-equi-joins, 94</a></p>
<p class="calibre1"><a href="#calibre_link-40">64</a></p>
<p class="calibre1"><a href="#calibre_link-89">noncorrelated subqueries, 158&ndash;167</a></p>
<p class="calibre1">three-condition evaluation using and, or, </p>
<p class="calibre1"><a href="#calibre_link-92">multiple-column, 165</a></p>
<p class="calibre1"><a href="#calibre_link-41">and not, 65</a></p>
<p class="calibre1"><a href="#calibre_link-91">multiple-row, single-column, 160&ndash;165</a></p>
<p class="calibre1"><a href="#calibre_link-40">two-condition evaluation using, 64</a></p>
<p class="calibre1"><a href="#calibre_link-172">using all operator, 163</a></p>
<p class="calibre1"><a href="#calibre_link-33">using in select statement where clause, 54</a></p>
<p class="calibre1"><b class="calibre3">Index | 315</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-331"></a><a href="#calibre_link-9">Oracle Database, 12</a></p>
<p class="calibre1"><a href="#calibre_link-69">position( ) function, 119</a></p>
<p class="calibre1"><a href="#calibre_link-166">bitmap indexes, 233</a></p>
<p class="calibre1"><a href="#calibre_link-10">PostgreSQL, 13</a></p>
<p class="calibre1"><a href="#calibre_link-177">chr( ) function, 117</a></p>
<p class="calibre1"><a href="#calibre_link-222">pow( ) or power( ) function, 127</a></p>
<p class="calibre1"><a href="#calibre_link-178">concatenation operator (||), 118, 124</a></p>
<p class="calibre1"><a href="#calibre_link-65">precedence of set operations, 109</a></p>
<p class="calibre1"><a href="#calibre_link-132">constraint generation, indexes and, 239</a></p>
<p class="calibre1"><a href="#calibre_link-198">prepare statements, 267</a></p>
<p class="calibre1"><a href="#calibre_link-108">decode( ) function, 204</a></p>
<p class="calibre1"><a href="#calibre_link-131">primary key constraints, 238</a></p>
<p class="calibre1"><a href="#calibre_link-196">drop index command, 230</a></p>
<p class="calibre1"><a href="#calibre_link-190">getting information about, 264</a></p>
<p class="calibre1"><a href="#calibre_link-148">dynamic SQL execution, 266</a></p>
<p class="calibre1"><a href="#calibre_link-147">query returning number of, 265</a></p>
<p class="calibre1"><a href="#calibre_link-13">from clauses and, 18</a></p>
<p class="calibre1"><a href="#calibre_link-181">primary keys, 5</a></p>
<p class="calibre1">generating current date or time from strings, </p>
<p class="calibre1"><a href="#calibre_link-6">defined, 7</a></p>
<p class="calibre1"><a href="#calibre_link-75">137</a></p>
<p class="calibre1"><a href="#calibre_link-20">generating numeric values for, 31</a></p>
<p class="calibre1"><a href="#calibre_link-197">grouping, with cube option, 154</a></p>
<p class="calibre1">nonunique key values causing SQL</p>
<p class="calibre1">inserting and updating data through views, </p>
<p class="calibre1"><a href="#calibre_link-22">statement errors, 36</a></p>
<p class="calibre1"><a href="#calibre_link-213">254</a></p>
<p class="calibre1"><a href="#calibre_link-7">procedural languages, 9</a></p>
<p class="calibre1"><a href="#calibre_link-218">instr( ) function, 120</a></p>
<p class="calibre1"><a href="#calibre_link-1">programming languages, ix</a></p>
<p class="calibre1"><a href="#calibre_link-120">locking, 218</a></p>
<p class="calibre1"><a href="#calibre_link-7">integrating SQL with, 9</a></p>
<p class="calibre1"><a href="#calibre_link-144">metadata, 258</a></p>
<p class="calibre1"><a href="#calibre_link-7">nonprocedural, 9</a></p>
<p class="calibre1"><a href="#calibre_link-63">minus operator, 107</a></p>
<p class="calibre1"><a href="#calibre_link-8">Python, SQL integration toolkit, 10</a></p>
<p class="calibre1"><a href="#calibre_link-222">mod( ) function, 127</a></p>
<p class="calibre1"><a href="#calibre_link-192">new_time( ) function, 139</a></p>
<p class="calibre1"><b class="calibre3">Q</b></p>
<p class="calibre1"><a href="#calibre_link-222">power( ) function, 127</a></p>
<p class="calibre1"><a href="#calibre_link-227">replace( ) function, 125</a></p>
<p class="calibre1"><a href="#calibre_link-25">queries, 41</a></p>
<p class="calibre1"><a href="#calibre_link-228">rollups, 153</a></p>
<p class="calibre1">(see also select statements)</p>
<p class="calibre1"><a href="#calibre_link-20">sequences, 31</a></p>
<p class="calibre1"><a href="#calibre_link-229">tuning, 236</a></p>
<p class="calibre1"><a href="#calibre_link-53">specifying join order, 90</a></p>
<p class="calibre1"><a href="#calibre_link-226">query optimizers, 42</a></p>
<p class="calibre1"><a href="#calibre_link-123">starting transactions, 221</a></p>
<p class="calibre1"><a href="#calibre_link-169">quote( ) function, 116</a></p>
<p class="calibre1"><a href="#calibre_link-227">substr( ) function, 125</a></p>
<p class="calibre1"><a href="#calibre_link-76">subtracting dates, 141</a></p>
<p class="calibre1"><b class="calibre3">R</b></p>
<p class="calibre1"><a href="#calibre_link-129">text indexes and search tools, 234</a></p>
<p class="calibre1"><a href="#calibre_link-43">range conditions, 68</a></p>
<p class="calibre1"><a href="#calibre_link-74">time zone settings, 132</a></p>
<p class="calibre1"><a href="#calibre_link-230">correlated subqueries in, 168</a></p>
<p class="calibre1"><a href="#calibre_link-162">to_date( ) function, 136</a></p>
<p class="calibre1"><a href="#calibre_link-224">string ranges, 70</a></p>
<p class="calibre1"><a href="#calibre_link-148">Oracle PL/SQL language, 266</a></p>
<p class="calibre1"><a href="#calibre_link-182">using between operator, 69</a></p>
<p class="calibre1"><a href="#calibre_link-225">order by clauses, 34</a></p>
<p class="calibre1"><a href="#calibre_link-120">read locks, 218</a></p>
<p class="calibre1"><a href="#calibre_link-34">in select statements, 55&ndash;59</a></p>
<p class="calibre1"><a href="#calibre_link-46">regexp operator, 76</a></p>
<p class="calibre1">ascending and descending sort order, </p>
<p class="calibre1"><a href="#calibre_link-217">using in string comparisons, 122</a></p>
<p class="calibre1"><a href="#calibre_link-35">57</a></p>
<p class="calibre1"><a href="#calibre_link-217">regular expressions, 122</a></p>
<p class="calibre1"><a href="#calibre_link-36">sorting via expressions, 58</a></p>
<p class="calibre1">(see also regexp operator)</p>
<p class="calibre1"><a href="#calibre_link-37">sorting via numeric placeholders, 59</a></p>
<p class="calibre1"><a href="#calibre_link-219">using to build search expressions, 75</a></p>
<p class="calibre1"><a href="#calibre_link-64">sorting compound query results, 108</a></p>
<p class="calibre1">relational databases</p>
<p class="calibre1"><a href="#calibre_link-100">outer joins, 183&ndash;192</a></p>
<p class="calibre1"><a href="#calibre_link-9">mature, popular commercial products, 12</a></p>
<p class="calibre1"><a href="#calibre_link-101">left versus right, 187</a></p>
<p class="calibre1"><a href="#calibre_link-4">relational model, 4</a></p>
<p class="calibre1"><a href="#calibre_link-103">self, 190</a></p>
<p class="calibre1"><a href="#calibre_link-227">replace( ) function, 125</a></p>
<p class="calibre1"><a href="#calibre_link-102">three-way, 188</a></p>
<p class="calibre1">result sets</p>
<p class="calibre1"><a href="#calibre_link-110">using subqueries instead of, 206</a></p>
<p class="calibre1"><a href="#calibre_link-6">defined, 7</a></p>
<p class="calibre1"><a href="#calibre_link-53">intermediate, 90</a></p>
<p class="calibre1"><b class="calibre3">P</b></p>
<p class="calibre1"><a href="#calibre_link-226">returned by mysql tool (example), 42</a></p>
<p class="calibre1"><a href="#calibre_link-120">page locks, 218</a></p>
<p class="calibre1"><a href="#calibre_link-88">returned by subqueries, 157</a></p>
<p class="calibre1"><a href="#calibre_link-8">Perl, SQL integration toolkit, 10</a></p>
<p class="calibre1">transformations performed with case</p>
<p class="calibre1"><a href="#calibre_link-148">PL/SQL language, 266</a></p>
<p class="calibre1"><a href="#calibre_link-112">expressions, 208</a></p>
<p class="calibre1"><b class="calibre3">316 | Index</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-332"></a><a href="#calibre_link-101">right outer joins, 187</a></p>
<p class="calibre1"><a href="#calibre_link-36">sorting via expressions, 58</a></p>
<p class="calibre1"><a href="#calibre_link-121">rollback command, 219</a></p>
<p class="calibre1"><a href="#calibre_link-25">query execution by database servers, 41</a></p>
<p class="calibre1"><a href="#calibre_link-123">ending transactions, 221</a></p>
<p class="calibre1"><a href="#calibre_link-201">querying views, 247</a></p>
<p class="calibre1"><a href="#calibre_link-125">issued against unnamed savepoint, 225</a></p>
<p class="calibre1"><a href="#calibre_link-26">select clause, 43&ndash;48</a></p>
<p class="calibre1"><a href="#calibre_link-175">rolling back savepoints, 224</a></p>
<p class="calibre1"><a href="#calibre_link-27">column aliases in, 46</a></p>
<p class="calibre1"><a href="#calibre_link-85">rollups, 152</a></p>
<p class="calibre1"><a href="#calibre_link-28">removing duplicates from returns, 47</a></p>
<p class="calibre1"><a href="#calibre_link-231">generating with subquery, 174</a></p>
<p class="calibre1"><a href="#calibre_link-32">table aliases used outside from clause, 52</a></p>
<p class="calibre1"><a href="#calibre_link-71">round( ) function, 128</a></p>
<p class="calibre1"><a href="#calibre_link-140">updatable views, 252</a></p>
<p class="calibre1"><a href="#calibre_link-120">row locks, 218</a></p>
<p class="calibre1"><a href="#calibre_link-32">where clause, 52&ndash;54</a></p>
<p class="calibre1"><a href="#calibre_link-181">rows, 5</a></p>
<p class="calibre1"><a href="#calibre_link-55">self-joins, 93</a></p>
<p class="calibre1"><a href="#calibre_link-5">defined, 6</a></p>
<p class="calibre1"><a href="#calibre_link-103">self outer joins, 190</a></p>
<p class="calibre1"><a href="#calibre_link-56">self-non-equi joins, 94</a></p>
<p class="calibre1"><b class="calibre3">S</b></p>
<p class="calibre1"><a href="#calibre_link-55">self-referencing foreign key, 93</a></p>
<p class="calibre1"><a href="#calibre_link-20">sequences, Oracle Database, 31</a></p>
<p class="calibre1"><a href="#calibre_link-124">savepoints in transactions, 223</a></p>
<p class="calibre1"><a href="#calibre_link-176">SET command, 115</a></p>
<p class="calibre1"><a href="#calibre_link-175">creating, 224</a></p>
<p class="calibre1"><a href="#calibre_link-61">set operators, 103&ndash;108</a></p>
<p class="calibre1"><a href="#calibre_link-175">example of use, 224</a></p>
<p class="calibre1"><a href="#calibre_link-63">except operator, 107</a></p>
<p class="calibre1"><a href="#calibre_link-175">rolling back, 224</a></p>
<p class="calibre1"><a href="#calibre_link-62">intersect operator, 106</a></p>
<p class="calibre1"><a href="#calibre_link-90">scalar subqueries, 159</a></p>
<p class="calibre1"><a href="#calibre_link-65">precedence of, 109</a></p>
<p class="calibre1"><a href="#calibre_link-193">correlated, 179</a></p>
<p class="calibre1">union all, merging results from queries, </p>
<p class="calibre1">noncorrelated, generating values for insert</p>
<p class="calibre1"><a href="#calibre_link-163">173</a></p>
<p class="calibre1"><a href="#calibre_link-214">statement, 180</a></p>
<p class="calibre1"><a href="#calibre_link-61">union and union all operators, 103&ndash;105</a></p>
<p class="calibre1"><a href="#calibre_link-200">schema statements, x, 7</a></p>
<p class="calibre1"><a href="#calibre_link-59">sets, 99&ndash;112</a></p>
<p class="calibre1"><a href="#calibre_link-18">building for table creation in MySQL, 27</a></p>
<p class="calibre1"><a href="#calibre_link-66">exercises in set operations, 111</a></p>
<p class="calibre1">schemas</p>
<p class="calibre1">guidelines for performing set operations on</p>
<p class="calibre1"><a href="#calibre_link-24">bank schema example for MySQL, 38&ndash;40</a></p>
<p class="calibre1"><a href="#calibre_link-232">two data sets, 102</a></p>
<p class="calibre1"><a href="#calibre_link-147">deployment verification for, 265</a></p>
<p class="calibre1"><a href="#calibre_link-59">primer in set theory, 99</a></p>
<p class="calibre1"><a href="#calibre_link-146">generation scripts, 263&ndash;265</a></p>
<p class="calibre1"><a href="#calibre_link-64">rules for set operations, 108&ndash;111</a></p>
<p class="calibre1"><a href="#calibre_link-144">information_schema, 258&ndash;262</a></p>
<p class="calibre1"><a href="#calibre_link-65">operation precedence, 109</a></p>
<p class="calibre1">search expressions</p>
<p class="calibre1"><a href="#calibre_link-64">sorting compound query results, 108</a></p>
<p class="calibre1"><a href="#calibre_link-159">examples using wildcards, 74</a></p>
<p class="calibre1">set theory applied to relational databases, </p>
<p class="calibre1"><a href="#calibre_link-219">using multiple, 75</a></p>
<p class="calibre1"><a href="#calibre_link-232">102</a></p>
<p class="calibre1"><a href="#calibre_link-219">using regular expressions, 75</a></p>
<p class="calibre1"><a href="#calibre_link-175">show table command, 224</a></p>
<p class="calibre1"><a href="#calibre_link-109">searched case expressions, 205</a></p>
<p class="calibre1"><a href="#calibre_link-183">show tables command, 39</a></p>
<p class="calibre1"><a href="#calibre_link-111">advantages of, 207</a></p>
<p class="calibre1"><a href="#calibre_link-72">sign( ) function, 130</a></p>
<p class="calibre1"><a href="#calibre_link-136">security, data security using views, 248</a></p>
<p class="calibre1"><a href="#calibre_link-110">simple case expressions, 206</a></p>
<p class="calibre1">select clause</p>
<p class="calibre1">sorting (see order by clauses)</p>
<p class="calibre1"><a href="#calibre_link-171">aggregate functions in, 144</a></p>
<p class="calibre1"><a href="#calibre_link-1">SQL (Structured Query Language), ix</a></p>
<p class="calibre1"><a href="#calibre_link-179">select clauses, 11</a></p>
<p class="calibre1"><a href="#calibre_link-148">dynamic generation of, 266&ndash;269</a></p>
<p class="calibre1"><a href="#calibre_link-25">select statements, 41&ndash;61</a></p>
<p class="calibre1"><a href="#calibre_link-6">history of, 7</a></p>
<p class="calibre1"><a href="#calibre_link-26">clauses, 43</a></p>
<p class="calibre1"><a href="#calibre_link-7">integration toolkits, 9</a></p>
<p class="calibre1"><a href="#calibre_link-38">exercises, 60</a></p>
<p class="calibre1"><a href="#calibre_link-7">as nonprocedural language, 9</a></p>
<p class="calibre1"><a href="#calibre_link-29">from clause, 48&ndash;52</a></p>
<p class="calibre1"><a href="#calibre_link-6">statement classes, 7</a></p>
<p class="calibre1"><a href="#calibre_link-97">subqueries in, 172</a></p>
<p class="calibre1"><a href="#calibre_link-8">statement examples, 10</a></p>
<p class="calibre1"><a href="#calibre_link-31">table links, 51</a></p>
<p class="calibre1"><a href="#calibre_link-9">SQL Server, 12</a></p>
<p class="calibre1"><a href="#calibre_link-34">group by and having clauses, 55</a></p>
<p class="calibre1"><a href="#calibre_link-108">coalesce( ) function, 204</a></p>
<p class="calibre1"><a href="#calibre_link-34">order by clause, 55&ndash;59</a></p>
<p class="calibre1"><a href="#calibre_link-178">concatenation operator (+), 118, 124</a></p>
<p class="calibre1">ascending and descending sort order, </p>
<p class="calibre1"><a href="#calibre_link-132">constraint generation, indexes and, 239</a></p>
<p class="calibre1"><a href="#calibre_link-35">57</a></p>
<p class="calibre1"><a href="#calibre_link-162">convert( ) function, 136</a></p>
<p class="calibre1"><a href="#calibre_link-37">soring via numeric placeholders, 59</a></p>
<p class="calibre1"><b class="calibre3">Index | 317</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-333"></a><a href="#calibre_link-75">current_timestamp( ) function, 137</a></p>
<p class="calibre1"><a href="#calibre_link-187">string functions returning strings, 123&ndash;</a></p>
<p class="calibre1"><a href="#calibre_link-76">datediff( ) function, 141</a></p>
<p class="calibre1"><a href="#calibre_link-227">125</a></p>
<p class="calibre1"><a href="#calibre_link-195">datepart( ) function, 140</a></p>
<p class="calibre1"><a href="#calibre_link-45">partial string matches, 73</a></p>
<p class="calibre1"><a href="#calibre_link-196">drop index command, 230</a></p>
<p class="calibre1"><a href="#calibre_link-224">ranges of, 70</a></p>
<p class="calibre1"><a href="#calibre_link-148">dynamic SQL execution, 266</a></p>
<p class="calibre1"><a href="#calibre_link-74">representing temporal data, 132</a></p>
<p class="calibre1"><a href="#calibre_link-21">generating XML from query output, 35</a></p>
<p class="calibre1"><a href="#calibre_link-233">date format components, 133</a></p>
<p class="calibre1"><a href="#calibre_link-197">grouping, with cube option, 154</a></p>
<p class="calibre1"><a href="#calibre_link-188">functions generating dates, 135</a></p>
<p class="calibre1">inserting and updating data through views, </p>
<p class="calibre1"><a href="#calibre_link-161">required date components, 134</a></p>
<p class="calibre1"><a href="#calibre_link-213">254</a></p>
<p class="calibre1"><a href="#calibre_link-188">strig-to-date conversions, 135</a></p>
<p class="calibre1"><a href="#calibre_link-69">len( ) function, 119</a></p>
<p class="calibre1">SQL statements submitted to database</p>
<p class="calibre1"><a href="#calibre_link-120">locking, 218</a></p>
<p class="calibre1"><a href="#calibre_link-148">server as, 266</a></p>
<p class="calibre1"><a href="#calibre_link-144">metadata and information_schema, 258</a></p>
<p class="calibre1"><a href="#calibre_link-192">temporal functions that return, 139</a></p>
<p class="calibre1"><a href="#calibre_link-222">modulo operator (%), 127</a></p>
<p class="calibre1"><a href="#calibre_link-188">str_to_date( ) function, 135</a></p>
<p class="calibre1"><a href="#calibre_link-222">power( ) function, 127</a></p>
<p class="calibre1"><a href="#calibre_link-88">subqueries, 157&ndash;182</a></p>
<p class="calibre1"><a href="#calibre_link-227">replace( ) and stuff( ) functions, 125</a></p>
<p class="calibre1"><a href="#calibre_link-93">correlated, 167&ndash;171</a></p>
<p class="calibre1"><a href="#calibre_link-53">specifying join order, 90</a></p>
<p class="calibre1"><a href="#calibre_link-95">data manipulation with, 170</a></p>
<p class="calibre1">transactions</p>
<p class="calibre1"><a href="#calibre_link-94">using with exists operator, 169</a></p>
<p class="calibre1"><a href="#calibre_link-123">disabling auto-commit mode, 221</a></p>
<p class="calibre1"><a href="#calibre_link-88">defined, 157</a></p>
<p class="calibre1"><a href="#calibre_link-125">savepoints, 225</a></p>
<p class="calibre1"><a href="#calibre_link-99">exercises in, 181</a></p>
<p class="calibre1"><a href="#calibre_link-123">starting, 221</a></p>
<p class="calibre1"><a href="#calibre_link-220">generating membership conditions, 72</a></p>
<p class="calibre1"><a href="#calibre_link-51">SQL92 version of ANSI SQL standard, 86</a></p>
<p class="calibre1"><a href="#calibre_link-139">in statements for updatable views, 251</a></p>
<p class="calibre1"><a href="#calibre_link-123">start transaction command, 221</a></p>
<p class="calibre1"><a href="#calibre_link-90">noncorrelated, 159</a></p>
<p class="calibre1"><a href="#calibre_link-6">statement classes, 7</a></p>
<p class="calibre1"><a href="#calibre_link-92">multicolumn, 165</a></p>
<p class="calibre1"><a href="#calibre_link-88">statement scope, 157</a></p>
<p class="calibre1"><a href="#calibre_link-91">multiple-row, single-column, 160&ndash;165</a></p>
<p class="calibre1">statements</p>
<p class="calibre1"><a href="#calibre_link-99">summary of types, 181</a></p>
<p class="calibre1"><a href="#calibre_link-109">case expressions in, 205</a></p>
<p class="calibre1"><a href="#calibre_link-30">tables generated by, 49</a></p>
<p class="calibre1"><a href="#calibre_link-179">clauses, 11</a></p>
<p class="calibre1"><a href="#calibre_link-89">types of, 158</a></p>
<p class="calibre1"><a href="#calibre_link-200">data and schema, x</a></p>
<p class="calibre1"><a href="#calibre_link-97">using as data source, 172&ndash;177</a></p>
<p class="calibre1"><a href="#calibre_link-198">dynamic SQL execution in MySQL, 267</a></p>
<p class="calibre1"><a href="#calibre_link-163">data fabrication with subqueries, 173</a></p>
<p class="calibre1"><a href="#calibre_link-22">errors in data statements, 36</a></p>
<p class="calibre1"><a href="#calibre_link-164">task-oriented subqueries, 175</a></p>
<p class="calibre1"><a href="#calibre_link-8">examples of, 10</a></p>
<p class="calibre1"><a href="#calibre_link-53">using as tables, 90</a></p>
<p class="calibre1"><a href="#calibre_link-139">for updatable views, 251</a></p>
<p class="calibre1"><a href="#calibre_link-98">using in filter conditions, 177</a></p>
<p class="calibre1">storage engines</p>
<p class="calibre1"><a href="#calibre_link-110">using instead of outer joins, 206</a></p>
<p class="calibre1"><a href="#calibre_link-124">choosing, 223</a></p>
<p class="calibre1"><a href="#calibre_link-98">using to generate expressions, 177</a></p>
<p class="calibre1"><a href="#calibre_link-120">locking and, 218</a></p>
<p class="calibre1"><a href="#calibre_link-234">using to limit number of joins, 189</a></p>
<p class="calibre1"><a href="#calibre_link-53">STRAIGHT_JOIN keyword, 90</a></p>
<p class="calibre1"><a href="#calibre_link-227">substring( ) function, 125</a></p>
<p class="calibre1"><a href="#calibre_link-218">strcmp( ) function, 120</a></p>
<p class="calibre1">substrings</p>
<p class="calibre1"><a href="#calibre_link-176">strict mode, 115</a></p>
<p class="calibre1"><a href="#calibre_link-227">extracting from strings, 125</a></p>
<p class="calibre1">strings</p>
<p class="calibre1"><a href="#calibre_link-69">locating within strings, 119</a></p>
<p class="calibre1"><a href="#calibre_link-67">character data types in string data, 113</a></p>
<p class="calibre1"><a href="#calibre_link-80">sum( ) function, 146, 210</a></p>
<p class="calibre1"><a href="#calibre_link-23">conversion to datetimes in MySQL, 37</a></p>
<p class="calibre1"><a href="#calibre_link-181">surrogate key, 5</a></p>
<p class="calibre1">converting to number using cast( ) function, </p>
<p class="calibre1"><a href="#calibre_link-9">Sybase Adaptive Server, 12</a></p>
<p class="calibre1"><a href="#calibre_link-76">141</a></p>
<p class="calibre1"><a href="#calibre_link-144">system catalog, 258</a></p>
<p class="calibre1"><a href="#calibre_link-68">generating string data, 114&ndash;118</a></p>
<p class="calibre1"><a href="#calibre_link-169">single quotes in strings, 116</a></p>
<p class="calibre1"><b class="calibre3">T</b></p>
<p class="calibre1"><a href="#calibre_link-177">special characters in strings, 117</a></p>
<p class="calibre1"><a href="#calibre_link-69">manipulating, 119&ndash;125</a></p>
<p class="calibre1"><a href="#calibre_link-32">table aliases, 52</a></p>
<p class="calibre1">string functions returning numbers, </p>
<p class="calibre1"><a href="#calibre_link-55">queries requiring, 93</a></p>
<p class="calibre1"><a href="#calibre_link-69">119&ndash;122</a></p>
<p class="calibre1"><a href="#calibre_link-120">table locks, 218</a></p>
<p class="calibre1"><a href="#calibre_link-4">tables, 4</a></p>
<p class="calibre1"><b class="calibre3">318 | Index</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-334"></a><a href="#calibre_link-24">bank schema (example), 38</a></p>
<p class="calibre1"><a href="#calibre_link-125">exercises in, 225</a></p>
<p class="calibre1">created for special purposes, problems with, </p>
<p class="calibre1"><a href="#calibre_link-119">multiuser databases, 217</a></p>
<p class="calibre1"><a href="#calibre_link-164">175</a></p>
<p class="calibre1"><a href="#calibre_link-124">savepoints, 223</a></p>
<p class="calibre1"><a href="#calibre_link-16">creating for MySQL database, 25&ndash;30</a></p>
<p class="calibre1"><a href="#calibre_link-122">starting, 220</a></p>
<p class="calibre1"><a href="#calibre_link-16">designing a table, 25</a></p>
<p class="calibre1"><a href="#calibre_link-235">truncate( ) function, 129</a></p>
<p class="calibre1"><a href="#calibre_link-17">refining design, 26</a></p>
<p class="calibre1"><a href="#calibre_link-229">tuning queries, 236</a></p>
<p class="calibre1"><a href="#calibre_link-18">SQL statements to create tables, 27</a></p>
<p class="calibre1"><a href="#calibre_link-5">defined, 6</a></p>
<p class="calibre1"><b class="calibre3">U</b></p>
<p class="calibre1"><a href="#calibre_link-30">defined for query with from clause, 49</a></p>
<p class="calibre1"><a href="#calibre_link-21">deleting data from MySQL table, 35</a></p>
<p class="calibre1">union all operator</p>
<p class="calibre1"><a href="#calibre_link-30">generated by subquery, 49</a></p>
<p class="calibre1"><a href="#calibre_link-139">joining partitioned data in a view, 251</a></p>
<p class="calibre1">inserting and modifying data, errors in SQL</p>
<p class="calibre1"><a href="#calibre_link-163">merging results from separate queries, 173</a></p>
<p class="calibre1"><a href="#calibre_link-22">statements, 36</a></p>
<p class="calibre1"><a href="#calibre_link-236">merging results of separate queries, 193</a></p>
<p class="calibre1">listing available tables in database with show</p>
<p class="calibre1"><a href="#calibre_link-61">union and union all operators, 103&ndash;105</a></p>
<p class="calibre1"><a href="#calibre_link-183">tables, 39</a></p>
<p class="calibre1"><a href="#calibre_link-237">precedence of, 110</a></p>
<p class="calibre1"><a href="#calibre_link-19">populating and modifying, 30</a></p>
<p class="calibre1"><a href="#calibre_link-59">union operation (sets), 99</a></p>
<p class="calibre1"><a href="#calibre_link-137">pre-aggregated data, 249</a></p>
<p class="calibre1"><a href="#calibre_link-131">unique constraints, 238</a></p>
<p class="calibre1"><a href="#calibre_link-175">storage engines for, 224</a></p>
<p class="calibre1"><a href="#calibre_link-196">unique keyword, 230</a></p>
<p class="calibre1"><a href="#calibre_link-21">updating data in MySQL, 35</a></p>
<p class="calibre1"><a href="#calibre_link-156">unsigned data, 22, 130</a></p>
<p class="calibre1"><a href="#calibre_link-72">temporal data, 130&ndash;141</a></p>
<p class="calibre1"><a href="#calibre_link-179">update statements, 11</a></p>
<p class="calibre1">converting strings to, using cast( ) function, </p>
<p class="calibre1"><a href="#calibre_link-23">column value violations, 37</a></p>
<p class="calibre1"><a href="#calibre_link-77">142</a></p>
<p class="calibre1"><a href="#calibre_link-23">invalid date conversions, 37</a></p>
<p class="calibre1"><a href="#calibre_link-74">generating, 132&ndash;137</a></p>
<p class="calibre1"><a href="#calibre_link-21">MySQL table updates, 35</a></p>
<p class="calibre1"><a href="#calibre_link-74">string representations of, 132</a></p>
<p class="calibre1"><a href="#calibre_link-95">using correlated subqueries, 170</a></p>
<p class="calibre1"><a href="#calibre_link-75">manipulating, 137&ndash;141</a></p>
<p class="calibre1">updates</p>
<p class="calibre1"><a href="#calibre_link-75">temporal functions returning dates, 137</a></p>
<p class="calibre1"><a href="#calibre_link-186">cascading, 241</a></p>
<p class="calibre1">temporal functions returning strings, </p>
<p class="calibre1"><a href="#calibre_link-117">conditional, 214</a></p>
<p class="calibre1"><a href="#calibre_link-192">139</a></p>
<p class="calibre1"><a href="#calibre_link-139">views, 251</a></p>
<p class="calibre1">maniuplating</p>
<p class="calibre1"><a href="#calibre_link-141">updating complex views, 253</a></p>
<p class="calibre1">temporal functions returning numbers, </p>
<p class="calibre1"><a href="#calibre_link-140">updating simple views, 252</a></p>
<p class="calibre1"><a href="#calibre_link-195">140</a></p>
<p class="calibre1"><a href="#calibre_link-12">username, specifying for mysql tool, 17</a></p>
<p class="calibre1"><a href="#calibre_link-73">time zones, 131</a></p>
<p class="calibre1"><a href="#calibre_link-207">using subclause of from clause, 85</a></p>
<p class="calibre1"><a href="#calibre_link-15">temporal data types, MySQL, 23</a></p>
<p class="calibre1"><a href="#calibre_link-73">UTC (Coordinated Universal Time), 131</a></p>
<p class="calibre1"><a href="#calibre_link-157">date format components, 24</a></p>
<p class="calibre1"><a href="#calibre_link-43">evaluating with range conditions, 68</a></p>
<p class="calibre1"><b class="calibre3">V</b></p>
<p class="calibre1"><a href="#calibre_link-23">invalid date conversions, 37</a></p>
<p class="calibre1"><a href="#calibre_link-189">varchar type, 19, 114</a></p>
<p class="calibre1"><a href="#calibre_link-191">text data, MySQL, 20</a></p>
<p class="calibre1"><a href="#calibre_link-68">columns storing strings, 114</a></p>
<p class="calibre1"><a href="#calibre_link-129">text indexes, 234</a></p>
<p class="calibre1"><a href="#calibre_link-176">string length in varchar columns, 115</a></p>
<p class="calibre1"><a href="#calibre_link-68">text type, 114</a></p>
<p class="calibre1"><a href="#calibre_link-120">versioning, 218</a></p>
<p class="calibre1"><a href="#calibre_link-15">time type, 23, 25</a></p>
<p class="calibre1"><a href="#calibre_link-175">storage engines and, 224</a></p>
<p class="calibre1"><a href="#calibre_link-73">time zones, 131</a></p>
<p class="calibre1"><a href="#calibre_link-238">views, 50, 245&ndash;256</a></p>
<p class="calibre1"><a href="#calibre_link-192">converting datetime values between, 139</a></p>
<p class="calibre1"><a href="#calibre_link-135">creating with create view statement, 245</a></p>
<p class="calibre1"><a href="#calibre_link-74">loading MySQL time zone data, 132</a></p>
<p class="calibre1"><a href="#calibre_link-135">defined, 245</a></p>
<p class="calibre1"><a href="#calibre_link-15">timestamp type, 23, 24</a></p>
<p class="calibre1"><a href="#calibre_link-201">examining with describe command, 247</a></p>
<p class="calibre1"><a href="#calibre_link-148">Transact-SQL language, 266</a></p>
<p class="calibre1"><a href="#calibre_link-142">exercises in, 255</a></p>
<p class="calibre1"><a href="#calibre_link-6">transaction statements, 7</a></p>
<p class="calibre1"><a href="#calibre_link-144">in information_schema, 258</a></p>
<p class="calibre1"><a href="#calibre_link-119">transactions, 217&ndash;225</a></p>
<p class="calibre1"><a href="#calibre_link-211">getting information about, 259</a></p>
<p class="calibre1"><a href="#calibre_link-121">defined, 219</a></p>
<p class="calibre1"><a href="#calibre_link-201">joining to other tables or views, 247</a></p>
<p class="calibre1"><a href="#calibre_link-123">ending, 221</a></p>
<p class="calibre1"><b class="calibre3">Index | 319</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-335"></a>listing of information_schema views in</p>
<p class="calibre1"><a href="#calibre_link-167">MySQL 6.0, 261</a></p>
<p class="calibre1"><a href="#calibre_link-239">querying, 246</a></p>
<p class="calibre1"><a href="#calibre_link-136">reasons to use, 248</a></p>
<p class="calibre1"><a href="#calibre_link-137">data aggregation, 249</a></p>
<p class="calibre1"><a href="#calibre_link-136">data security, 248</a></p>
<p class="calibre1"><a href="#calibre_link-138">hiding complexity, 250</a></p>
<p class="calibre1"><a href="#calibre_link-139">joining partitioned data, 251</a></p>
<p class="calibre1"><a href="#calibre_link-139">updatable, 251</a></p>
<p class="calibre1"><a href="#calibre_link-141">updating complex views, 253</a></p>
<p class="calibre1"><a href="#calibre_link-140">updating simple views, 252</a></p>
<p class="calibre1">virtual tables (see views)</p>
<p class="calibre1"><a href="#calibre_link-8">Visual Basic, SQL integration toolkit, 10</a></p>
<p class="calibre1"><b class="calibre3">W</b></p>
<p class="calibre1">when clauses</p>
<p class="calibre1"><a href="#calibre_link-108">in case expressions, 204</a></p>
<p class="calibre1">evaluation in searched case expressions, </p>
<p class="calibre1"><a href="#calibre_link-109">205</a></p>
<p class="calibre1"><a href="#calibre_link-179">where clauses, 11</a></p>
<p class="calibre1"><a href="#calibre_link-86">aggregate functions and, 155</a></p>
<p class="calibre1"><a href="#calibre_link-51">ANSI join syntax in, 86</a></p>
<p class="calibre1"><a href="#calibre_link-22">delete statement, 36</a></p>
<p class="calibre1"><a href="#calibre_link-39">filter conditions in, 63</a></p>
<p class="calibre1"><a href="#calibre_link-32">in select statements, 52&ndash;54</a></p>
<p class="calibre1"><a href="#calibre_link-9">update statement, 12, 35</a></p>
<p class="calibre1">wildcards in searches for partial string matches, </p>
<p class="calibre1"><a href="#calibre_link-45">73</a></p>
<p class="calibre1"><a href="#calibre_link-197">with cube option, 154</a></p>
<p class="calibre1"><a href="#calibre_link-85">with rollup option, 152</a></p>
<p class="calibre1"><a href="#calibre_link-120">write locks, 218</a></p>
<p class="calibre1"><b class="calibre3">X</b></p>
<p class="calibre1"><a href="#calibre_link-225">XML, generating from query output, 34</a></p>
<p class="calibre1"><b class="calibre3">Y</b></p>
<p class="calibre1"><a href="#calibre_link-15">year type, 23, 24</a></p>
<p class="calibre1"><b class="calibre3">320 | Index</b></p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-336"></a><b class="calibre3">About the Author</b></p>
<p class="calibre1"><b class="calibre3">Alan Beaulieu </b>has been designing, building, and implementing custom database applications for over 15 years. He currently runs his own consulting company that specializes in designing Oracle databases and supporting services in the fields of financial services and telecommunications. In building large databases for both OLTP and OLAP</p>
<p class="calibre1">environments, Alan utilizes such Oracle features as Parallel Query, Partitioning, and Parallel Server. Alan has a Bachelor of Science degree in Operations Research from the Cornell University School of Engineering. He lives in Massachusetts with his wife and two daughters and can be reached at  <i class="calibre4">albeau_mosql@yahoo.com</i>. </p>
<p class="calibre1"><b class="calibre3">Colophon</b></p>
<p class="calibre1">The animal on the cover of  <i class="calibre4">Learning SQL</i>, Second Edition, is an Andean marsupial tree frog ( <i class="calibre4">Gastrotheca riobambae</i>). As its name suggests, this crepuscular and nocturnal frog is native to the western slopes of the Andes mountains and is widely distributed from the Riobamba basin to Ibarra in the north. </p>
<p class="calibre1">During courtship, the male calls (“wraaack-ack-ack”) to attract a female. If a gravid female is attracted to him, he climbs onto her back and performs a common frog mating hold called the nuptial amplexus. As the eggs emerge from the female’s cloaca, the male catches the eggs with his feet and fertilizes them while maneuvering them into a pouch on the female’s back. A female may incubate an average of 130 eggs, and development in the pouch lasts between 60 and 120 days. During incubation, swelling becomes visible, and lumps appear beneath the skin on the female’s back. When the tadpoles emerge from the pouch, the female tree frog deposits them into the water. Within two or three months the tadpoles metamorphose into froglets, and at seven months they are ready to mate (“wraaaack-ack-ack”). </p>
<p class="calibre1">Both the male and female tree frog have expanded digital discs on their fingers and toes that help them climb vertical surfaces such as trees. Adult males reach 2 inches in length, while  females  reach  2.5  inches.  Sometimes  they  are  green,  sometimes  brown,  and sometimes a combination of green and brown. The color of the juveniles may change from brown to green as they grow. </p>
<p class="calibre1">The cover image is from the Dover Archive Pictorial. The cover font is Adobe ITC</p>
<p class="calibre1">Garamond. The text font is Linotype Birka; the heading font is Adobe Myriad Condensed; and the code font is LucasFont’s TheSansMonoCondensed. </p>
<p class="calibre1">D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a id="calibre_link-337"></a>D</p>
<p class="calibre1">l d  t W</p>
<p class="calibre1">B k C</p>
<p class="calibre1"><a name="outline"></a><h1 class="calibre5">Document Outline</h1>
<ul class="calibre6">
<li class="calibre7"><a href="#calibre_link-240">Table of Contents</a></li>
<li class="calibre7"><a href="#calibre_link-1">Preface</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-1">Why Learn SQL? </a></li>
<li class="calibre7"><a href="#calibre_link-200">Why Use This Book to Do It? </a></li>
<li class="calibre7"><a href="#calibre_link-200">Structure of This Book</a></li>
<li class="calibre7"><a href="#calibre_link-241">Conventions Used in This Book</a></li>
<li class="calibre7"><a href="#calibre_link-180">How to Contact Us</a></li>
<li class="calibre7"><a href="#calibre_link-180">Using Code Examples</a></li>
<li class="calibre7"><a href="#calibre_link-242">Safari® Books Online</a></li>
<li class="calibre7"><a href="#calibre_link-242">Acknowledgments</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-2">Chapter 1. A Little Background</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-2">Introduction to Databases</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-3">Nonrelational Database Systems</a></li>
<li class="calibre7"><a href="#calibre_link-4">The Relational Model</a></li>
<li class="calibre7"><a href="#calibre_link-5">Some Terminology</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-6">What Is SQL? </a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-6">SQL Statement Classes</a></li>
<li class="calibre7"><a href="#calibre_link-7">SQL: A Nonprocedural Language</a></li>
<li class="calibre7"><a href="#calibre_link-8">SQL Examples</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-9">What Is MySQL? </a></li>
<li class="calibre7"><a href="#calibre_link-10">What’s in Store</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-11">Chapter 2. Creating and Populating a Database</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-11">Creating a MySQL Database</a></li>
<li class="calibre7"><a href="#calibre_link-12">Using the mysql Command-Line Tool</a></li>
<li class="calibre7"><a href="#calibre_link-13">MySQL Data Types</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-13">Character Data</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-189">Character sets</a></li>
<li class="calibre7"><a href="#calibre_link-191">Text data</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-14">Numeric Data</a></li>
<li class="calibre7"><a href="#calibre_link-15">Temporal Data</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-16">Table Creation</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-16">Step 1: Design</a></li>
<li class="calibre7"><a href="#calibre_link-17">Step 2: Refinement</a></li>
<li class="calibre7"><a href="#calibre_link-18">Step 3: Building SQL Schema Statements</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-19">Populating and Modifying Tables</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-20">Inserting Data</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-20">Generating numeric key data</a></li>
<li class="calibre7"><a href="#calibre_link-243">The insert statement</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-21">Updating Data</a></li>
<li class="calibre7"><a href="#calibre_link-21">Deleting Data</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-22">When Good Statements Go Bad</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-22">Nonunique Primary Key</a></li>
<li class="calibre7"><a href="#calibre_link-22">Nonexistent Foreign Key</a></li>
<li class="calibre7"><a href="#calibre_link-23">Column Value Violations</a></li>
<li class="calibre7"><a href="#calibre_link-23">Invalid Date Conversions</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-24">The Bank Schema</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-25">Chapter 3. Query Primer</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-25">Query Mechanics</a></li>
<li class="calibre7"><a href="#calibre_link-26">Query Clauses</a></li>
<li class="calibre7"><a href="#calibre_link-26">The select Clause</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-27">Column Aliases</a></li>
<li class="calibre7"><a href="#calibre_link-28">Removing Duplicates</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-29">The from Clause</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-30">Tables</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-30">Subquery-generated tables</a></li>
<li class="calibre7"><a href="#calibre_link-238">Views</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-31">Table Links</a></li>
<li class="calibre7"><a href="#calibre_link-32">Defining Table Aliases</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-32">The where Clause</a></li>
<li class="calibre7"><a href="#calibre_link-33">The group by and having Clauses</a></li>
<li class="calibre7"><a href="#calibre_link-34">The order by Clause</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-35">Ascending Versus Descending Sort Order</a></li>
<li class="calibre7"><a href="#calibre_link-36">Sorting via Expressions</a></li>
<li class="calibre7"><a href="#calibre_link-37">Sorting via Numeric Placeholders</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-38">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-38">Exercise 3-1</a></li>
<li class="calibre7"><a href="#calibre_link-38">Exercise 3-2</a></li>
<li class="calibre7"><a href="#calibre_link-38">Exercise 3-3</a></li>
<li class="calibre7"><a href="#calibre_link-38">Exercise 3-4</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-39">Chapter 4. Filtering</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-39">Condition Evaluation</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-40">Using Parentheses</a></li>
<li class="calibre7"><a href="#calibre_link-41">Using the not Operator</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-42">Building a Condition</a></li>
<li class="calibre7"><a href="#calibre_link-42">Condition Types</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-42">Equality Conditions</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-170">Inequality conditions</a></li>
<li class="calibre7"><a href="#calibre_link-170">Data modification using equality conditions</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-43">Range Conditions</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-182">The between operator</a></li>
<li class="calibre7"><a href="#calibre_link-224">String ranges</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-44">Membership Conditions</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-220">Using subqueries</a></li>
<li class="calibre7"><a href="#calibre_link-220">Using not in</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-45">Matching Conditions</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-45">Using wildcards</a></li>
<li class="calibre7"><a href="#calibre_link-219">Using regular expressions</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-46">Null: That Four-Letter Word</a></li>
<li class="calibre7"><a href="#calibre_link-47">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-47">Exercise 4-1</a></li>
<li class="calibre7"><a href="#calibre_link-47">Exercise 4-2</a></li>
<li class="calibre7"><a href="#calibre_link-47">Exercise 4-3</a></li>
<li class="calibre7"><a href="#calibre_link-47">Exercise 4-4</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-48">Chapter 5. Querying Multiple Tables</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-48">What Is a Join? </a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-49">Cartesian Product</a></li>
<li class="calibre7"><a href="#calibre_link-50">Inner Joins</a></li>
<li class="calibre7"><a href="#calibre_link-51">The ANSI Join Syntax</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-52">Joining Three or More Tables</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-53">Using Subqueries As Tables</a></li>
<li class="calibre7"><a href="#calibre_link-54">Using the Same Table Twice</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-55">Self-Joins</a></li>
<li class="calibre7"><a href="#calibre_link-56">Equi-Joins Versus Non-Equi-Joins</a></li>
<li class="calibre7"><a href="#calibre_link-57">Join Conditions Versus Filter Conditions</a></li>
<li class="calibre7"><a href="#calibre_link-58">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-58">Exercise 5-1</a></li>
<li class="calibre7"><a href="#calibre_link-244">Exercise 5-2</a></li>
<li class="calibre7"><a href="#calibre_link-244">Exercise 5-3</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-59">Chapter 6. Working with Sets</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-59">Set Theory Primer</a></li>
<li class="calibre7"><a href="#calibre_link-60">Set Theory in Practice</a></li>
<li class="calibre7"><a href="#calibre_link-61">Set Operators</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-61">The union Operator</a></li>
<li class="calibre7"><a href="#calibre_link-62">The intersect Operator</a></li>
<li class="calibre7"><a href="#calibre_link-63">The except Operator</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-64">Set Operation Rules</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-64">Sorting Compound Query Results</a></li>
<li class="calibre7"><a href="#calibre_link-65">Set Operation Precedence</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-66">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-245">Exercise 6-1</a></li>
<li class="calibre7"><a href="#calibre_link-245">Exercise 6-2</a></li>
<li class="calibre7"><a href="#calibre_link-245">Exercise 6-3</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-67">Chapter 7. Data Generation, Conversion, and  Manipulation</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-67">Working with String Data</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-68">String Generation</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-169">Including single quotes</a></li>
<li class="calibre7"><a href="#calibre_link-177">Including special characters</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-69">String Manipulation</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-69">String functions that return numbers</a></li>
<li class="calibre7"><a href="#calibre_link-187">String functions that return strings</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-70">Working with Numeric Data</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-70">Performing Arithmetic Functions</a></li>
<li class="calibre7"><a href="#calibre_link-71">Controlling Number Precision</a></li>
<li class="calibre7"><a href="#calibre_link-72">Handling Signed Data</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-72">Working with Temporal Data</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-73">Dealing with Time Zones</a></li>
<li class="calibre7"><a href="#calibre_link-74">Generating Temporal Data</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-74">String representations of temporal data</a></li>
<li class="calibre7"><a href="#calibre_link-161">String-to-date conversions</a></li>
<li class="calibre7"><a href="#calibre_link-188">Functions for generating dates</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-75">Manipulating Temporal Data</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-75">Temporal functions that return dates</a></li>
<li class="calibre7"><a href="#calibre_link-192">Temporal functions that return strings</a></li>
<li class="calibre7"><a href="#calibre_link-195">Temporal functions that return numbers</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-76">Conversion Functions</a></li>
<li class="calibre7"><a href="#calibre_link-77">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-77">Exercise 7-1</a></li>
<li class="calibre7"><a href="#calibre_link-77">Exercise 7-2</a></li>
<li class="calibre7"><a href="#calibre_link-77">Exercise 7-3</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-78">Chapter 8. Grouping and Aggregates</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-78">Grouping Concepts</a></li>
<li class="calibre7"><a href="#calibre_link-79">Aggregate Functions</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-80">Implicit Versus Explicit Groups</a></li>
<li class="calibre7"><a href="#calibre_link-81">Counting Distinct Values</a></li>
<li class="calibre7"><a href="#calibre_link-82">Using Expressions</a></li>
<li class="calibre7"><a href="#calibre_link-82">How Nulls Are Handled</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-83">Generating Groups</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-84">Single-Column Grouping</a></li>
<li class="calibre7"><a href="#calibre_link-84">Multicolumn Grouping</a></li>
<li class="calibre7"><a href="#calibre_link-85">Grouping via Expressions</a></li>
<li class="calibre7"><a href="#calibre_link-85">Generating Rollups</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-86">Group Filter Conditions</a></li>
<li class="calibre7"><a href="#calibre_link-87">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-87">Exercise 8-1</a></li>
<li class="calibre7"><a href="#calibre_link-87">Exercise 8-2</a></li>
<li class="calibre7"><a href="#calibre_link-87">Exercise 8-3</a></li>
<li class="calibre7"><a href="#calibre_link-87">Exercise 8-4 (Extra Credit)</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-88">Chapter 9. Subqueries</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-88">What Is a Subquery? </a></li>
<li class="calibre7"><a href="#calibre_link-89">Subquery Types</a></li>
<li class="calibre7"><a href="#calibre_link-90">Noncorrelated Subqueries</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-91">Multiple-Row, Single-Column Subqueries</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-91">The in and not in operators</a></li>
<li class="calibre7"><a href="#calibre_link-172">The all operator</a></li>
<li class="calibre7"><a href="#calibre_link-92">The any operator</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-92">Multicolumn Subqueries</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-93">Correlated Subqueries</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-94">The exists Operator</a></li>
<li class="calibre7"><a href="#calibre_link-95">Data Manipulation Using Correlated Subqueries</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-96">When to Use Subqueries</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-97">Subqueries As Data Sources</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-163">Data fabrication</a></li>
<li class="calibre7"><a href="#calibre_link-164">Task-oriented subqueries</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-98">Subqueries in Filter Conditions</a></li>
<li class="calibre7"><a href="#calibre_link-98">Subqueries As Expression Generators</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-99">Subquery Wrap-up</a></li>
<li class="calibre7"><a href="#calibre_link-99">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-99">Exercise 9-1</a></li>
<li class="calibre7"><a href="#calibre_link-99">Exercise 9-2</a></li>
<li class="calibre7"><a href="#calibre_link-246">Exercise 9-3</a></li>
<li class="calibre7"><a href="#calibre_link-246">Exercise 9-4</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-100">Chapter 10. Joins Revisited</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-100">Outer Joins</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-101">Left Versus Right Outer Joins</a></li>
<li class="calibre7"><a href="#calibre_link-102">Three-Way Outer Joins</a></li>
<li class="calibre7"><a href="#calibre_link-103">Self Outer Joins</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-104">Cross Joins</a></li>
<li class="calibre7"><a href="#calibre_link-105">Natural Joins</a></li>
<li class="calibre7"><a href="#calibre_link-106">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-247">Exercise 10-1</a></li>
<li class="calibre7"><a href="#calibre_link-247">Exercise 10-2</a></li>
<li class="calibre7"><a href="#calibre_link-247">Exercise 10-3</a></li>
<li class="calibre7"><a href="#calibre_link-247">Exercise 10-4 (Extra Credit)</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-107">Chapter 11. Conditional Logic</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-107">What Is Conditional Logic? </a></li>
<li class="calibre7"><a href="#calibre_link-108">The Case Expression</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-109">Searched Case Expressions</a></li>
<li class="calibre7"><a href="#calibre_link-110">Simple Case Expressions</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-111">Case Expression Examples</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-112">Result Set Transformations</a></li>
<li class="calibre7"><a href="#calibre_link-113">Selective Aggregation</a></li>
<li class="calibre7"><a href="#calibre_link-114">Checking for Existence</a></li>
<li class="calibre7"><a href="#calibre_link-115">Division-by-Zero Errors</a></li>
<li class="calibre7"><a href="#calibre_link-116">Conditional Updates</a></li>
<li class="calibre7"><a href="#calibre_link-117">Handling Null Values</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-118">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-118">Exercise 11-1</a></li>
<li class="calibre7"><a href="#calibre_link-248">Exercise 11-2</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-119">Chapter 12. Transactions</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-119">Multiuser Databases</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-119">Locking</a></li>
<li class="calibre7"><a href="#calibre_link-120">Lock Granularities</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-121">What Is a Transaction? </a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-122">Starting a Transaction</a></li>
<li class="calibre7"><a href="#calibre_link-123">Ending a Transaction</a></li>
<li class="calibre7"><a href="#calibre_link-124">Transaction Savepoints</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-125">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-125">Exercise 12-1</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-126">Chapter 13. Indexes and Constraints</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-126">Indexes</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-127">Index Creation</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-196">Unique indexes</a></li>
<li class="calibre7"><a href="#calibre_link-128">Multicolumn indexes</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-128">Types of Indexes</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-165">B-tree indexes</a></li>
<li class="calibre7"><a href="#calibre_link-166">Bitmap indexes</a></li>
<li class="calibre7"><a href="#calibre_link-129">Text indexes</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-129">How Indexes Are Used</a></li>
<li class="calibre7"><a href="#calibre_link-130">The Downside of Indexes</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-131">Constraints</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-131">Constraint Creation</a></li>
<li class="calibre7"><a href="#calibre_link-132">Constraints and Indexes</a></li>
<li class="calibre7"><a href="#calibre_link-133">Cascading Constraints</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-134">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-249">Exercise 13-1</a></li>
<li class="calibre7"><a href="#calibre_link-249">Exercise 13-2</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-135">Chapter 14. Views</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-135">What Are Views? </a></li>
<li class="calibre7"><a href="#calibre_link-136">Why Use Views? </a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-136">Data Security</a></li>
<li class="calibre7"><a href="#calibre_link-137">Data Aggregation</a></li>
<li class="calibre7"><a href="#calibre_link-138">Hiding Complexity</a></li>
<li class="calibre7"><a href="#calibre_link-139">Joining Partitioned Data</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-139">Updatable Views</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-140">Updating Simple Views</a></li>
<li class="calibre7"><a href="#calibre_link-141">Updating Complex Views</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-142">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-142">Exercise 14-1</a></li>
<li class="calibre7"><a href="#calibre_link-250">Exercise 14-2</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-143">Chapter 15. Metadata</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-143">Data About Data</a></li>
<li class="calibre7"><a href="#calibre_link-144">Information_Schema</a></li>
<li class="calibre7"><a href="#calibre_link-145">Working with Metadata</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-146">Schema Generation Scripts</a></li>
<li class="calibre7"><a href="#calibre_link-147">Deployment Verification</a></li>
<li class="calibre7"><a href="#calibre_link-148">Dynamic SQL Generation</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-149">Test Your Knowledge</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-149">Exercise 15-1</a></li>
<li class="calibre7"><a href="#calibre_link-149">Exercise 15-2</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-150">Appendix A. ER Diagram for Example Database</a></li>
<li class="calibre7"><a href="#calibre_link-151">Appendix B. MySQL Extensions to the SQL Language</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-151">Extensions to the select Statement</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-151">The limit Clause</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-251">Combining the limit clause with the order by clause</a></li>
<li class="calibre7"><a href="#calibre_link-252">The limit clause’s optional second parameter</a></li>
<li class="calibre7"><a href="#calibre_link-253">Ranking queries</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-253">The into outfile Clause</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-254">Combination Insert/Update Statements</a></li>
<li class="calibre7"><a href="#calibre_link-255">Ordered Updates and Deletes</a></li>
<li class="calibre7"><a href="#calibre_link-256">Multitable Updates and Deletes</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-152">Appendix C. Solutions to Exercises</a>
<ul class="calibre8">
<li class="calibre7"><a href="#calibre_link-152">Chapter 3</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-152">3-1</a></li>
<li class="calibre7"><a href="#calibre_link-257">3-2</a></li>
<li class="calibre7"><a href="#calibre_link-257">3-3</a></li>
<li class="calibre7"><a href="#calibre_link-257">3-4</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-258">Chapter 4</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-258">4-1</a></li>
<li class="calibre7"><a href="#calibre_link-258">4-2</a></li>
<li class="calibre7"><a href="#calibre_link-259">4-3</a></li>
<li class="calibre7"><a href="#calibre_link-259">4-4</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-259">Chapter 5</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-259">5-1</a></li>
<li class="calibre7"><a href="#calibre_link-260">5-2</a></li>
<li class="calibre7"><a href="#calibre_link-261">5-3</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-261">Chapter 6</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-261">6-1</a></li>
<li class="calibre7"><a href="#calibre_link-261">6-2</a></li>
<li class="calibre7"><a href="#calibre_link-262">6-3</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-263">Chapter 7</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-263">7-1</a></li>
<li class="calibre7"><a href="#calibre_link-263">7-2</a></li>
<li class="calibre7"><a href="#calibre_link-264">7-3</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-264">Chapter 8</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-264">8-1</a></li>
<li class="calibre7"><a href="#calibre_link-264">8-2</a></li>
<li class="calibre7"><a href="#calibre_link-265">8-3</a></li>
<li class="calibre7"><a href="#calibre_link-265">8-4 (Extra Credit)</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-266">Chapter 9</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-266">9-1</a></li>
<li class="calibre7"><a href="#calibre_link-266">9-2</a></li>
<li class="calibre7"><a href="#calibre_link-266">9-3</a></li>
<li class="calibre7"><a href="#calibre_link-267">9-4</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-268">Chapter 10</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-268">10-1</a></li>
<li class="calibre7"><a href="#calibre_link-269">10-2</a></li>
<li class="calibre7"><a href="#calibre_link-270">10-3</a></li>
<li class="calibre7"><a href="#calibre_link-270">10-4 (Extra Credit)</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-271">Chapter 11</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-271">11-1</a></li>
<li class="calibre7"><a href="#calibre_link-272">11-2</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-272">Chapter 12</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-272">12-1</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-273">Chapter 13</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-273">13-1</a></li>
<li class="calibre7"><a href="#calibre_link-273">13-2</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-274">Chapter 14</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-274">14-1</a></li>
<li class="calibre7"><a href="#calibre_link-275">14-2</a></li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-275">Chapter 15</a>
<ul class="calibre9">
<li class="calibre7"><a href="#calibre_link-275">15-1</a></li>
<li class="calibre7"><a href="#calibre_link-276">15-2</a></li>
</ul>
</li>
</ul>
</li>
<li class="calibre7"><a href="#calibre_link-153">Index</a></li>
</ul></p>
</div>


</body></html>